{"version":3,"file":"converter.bundle.js","sources":["../src/converter.js"],"sourcesContent":["// converter.js\r\n// ────────────\r\n\r\n// 1️⃣  Imports from Skypack (ESM + CORS-friendly)\r\nimport { FFmpeg }               from 'https://cdn.skypack.dev/@ffmpeg/ffmpeg@0.12.6';\r\nimport { fetchFile, toBlobURL } from 'https://cdn.skypack.dev/@ffmpeg/util@0.12.6';\r\n\r\n// 2️⃣  Instantiate the class-based API (v0.12+)\r\nconst ffmpeg = new FFmpeg({ log: true });\r\n\r\nlet selectedFile = null;\r\nlet isLoaded     = false;\r\n\r\n// UI refs\r\nconst dropZone          = document.getElementById('dropZone');\r\nconst selectBtn         = document.getElementById('selectBtn');\r\nconst fileInput         = document.getElementById('fileInput');\r\nconst qualitySlider     = document.getElementById('qualitySlider');\r\nconst qualityValue      = document.getElementById('qualityValue');\r\nconst convertBtn        = document.getElementById('convertBtn');\r\nconst progressContainer = document.getElementById('progressContainer');\r\nconst progressBar       = document.getElementById('progressBar');\r\nconst progressText      = document.getElementById('progressText');\r\nconst statusDiv         = document.getElementById('status');\r\nconst preview           = document.getElementById('preview');\r\nconst downloadLink      = document.getElementById('downloadLink');\r\n\r\n// Simple show/hide helpers\r\nconst show      = el => el.classList.remove('hidden');\r\nconst hide      = el => el.classList.add('hidden');\r\nconst setStatus = txt => { statusDiv.textContent = txt; show(statusDiv); };\r\n\r\n// Reset UI to initial state\r\nfunction resetUI() {\r\n  convertBtn.disabled = !selectedFile;\r\n  hide(statusDiv);\r\n  hide(preview);\r\n  hide(downloadLink);\r\n  hide(progressContainer);\r\n  progressBar.value = 0;\r\n  progressText.textContent = '0%';\r\n}\r\n\r\n// File selection: browse\r\nselectBtn.addEventListener('click', () => fileInput.click());\r\nfileInput.addEventListener('change', () => {\r\n  if (fileInput.files[0]) handleFile(fileInput.files[0]);\r\n});\r\n\r\n// File selection: drag & drop\r\n['dragover','dragleave','drop'].forEach(evt => {\r\n  dropZone.addEventListener(evt, e => {\r\n    e.preventDefault();\r\n    dropZone.classList.toggle('hover', evt === 'dragover');\r\n    if (evt === 'drop' && e.dataTransfer.files[0]) {\r\n      handleFile(e.dataTransfer.files[0]);\r\n    }\r\n  });\r\n});\r\n\r\nfunction handleFile(file) {\r\n  if (!file.name.toLowerCase().endsWith('.mp4')) {\r\n    alert('Please select an MP4 file.');\r\n    return;\r\n  }\r\n  selectedFile = file;\r\n  dropZone.querySelector('p').textContent = `Selected: ${file.name}`;\r\n  resetUI();\r\n}\r\n\r\n// Quality slider update\r\nqualitySlider.addEventListener('input', () => {\r\n  qualityValue.textContent = parseFloat(qualitySlider.value).toFixed(1);\r\n});\r\n\r\n// Conversion\r\nconvertBtn.addEventListener('click', async () => {\r\n  if (!selectedFile) return;\r\n\r\n  resetUI();\r\n\r\n  // 3️⃣  Lazy-load the core-mt assets once\r\n  if (!isLoaded) {\r\n    setStatus('Loading FFmpeg core…');\r\n\r\n    const baseURL = 'https://cdn.jsdelivr.net/npm/@ffmpeg/core-mt@0.12.6/dist/umd';\r\n\r\n    // Blob-wrap each asset to avoid CORS\r\n    const [coreURL, wasmURL, workerURL] = await Promise.all([\r\n      toBlobURL(`${baseURL}/ffmpeg-core.js`,        'application/javascript'),\r\n      toBlobURL(`${baseURL}/ffmpeg-core.wasm`,      'application/wasm'),\r\n      toBlobURL(`${baseURL}/ffmpeg-core.worker.js`, 'application/javascript'),\r\n    ]);\r\n\r\n    // classWorkerURL needed for some builds\r\n    await ffmpeg.load({\r\n      coreURL,\r\n      wasmURL,\r\n      workerURL,\r\n      classWorkerURL: workerURL\r\n    });\r\n\r\n    isLoaded = true;\r\n  }\r\n\r\n  // 4️⃣  Write the input file into WASM FS\r\n  setStatus('Reading input file…');\r\n  const data = await fetchFile(selectedFile);\r\n  await ffmpeg.writeFile('input.mp4', data);\r\n\r\n  // 5️⃣  Hook up progress events\r\n  ffmpeg.on('progress', ({ ratio }) => {\r\n    show(progressContainer);\r\n    progressBar.value = ratio;\r\n    const pct = Math.round(ratio * 100);\r\n    progressText.textContent = `${pct}%`;\r\n    setStatus(`Converting… ${pct}%`);\r\n  });\r\n\r\n  // 6️⃣  Execute the CLI: MP4→WebM (VP9 + Opus)\r\n  const qp      = Math.max(0.1, parseFloat(qualitySlider.value));\r\n  const bitrate = `${Math.round(qp * 1000)}k`;\r\n\r\n  try {\r\n    await ffmpeg.exec([\r\n      '-y',\r\n      '-i', 'input.mp4',\r\n      '-c:v', 'libvpx-vp9',\r\n      '-b:v', bitrate,\r\n      '-c:a', 'libopus',\r\n      'output.webm'\r\n    ]);\r\n  } catch (err) {\r\n    return setStatus('Conversion failed: ' + err.message);\r\n  }\r\n\r\n  // 7️⃣  Pull the result back out\r\n  setStatus('Finalizing…');\r\n  const out = await ffmpeg.readFile('output.webm');\r\n  const blob = new Blob([out.buffer], { type: 'video/webm' });\r\n  const url  = URL.createObjectURL(blob);\r\n\r\n  // 8️⃣  Show preview and download link\r\n  preview.src = url;\r\n  show(preview);\r\n\r\n  downloadLink.href     = url;\r\n  downloadLink.download = selectedFile.name.replace(/\\.mp4$/i, '') + '.webm';\r\n  show(downloadLink);\r\n\r\n  setStatus('Done!');\r\n});\r\n\r\n// Initial UI state\r\nresetUI();\r\n"],"names":[],"mappings":";;;AAAA;AAMA;AACA;AACA,MAAM,MAAM,GAAG,IAAI,MAAM,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC;AACzC;AACA,IAAI,YAAY,GAAG,IAAI,CAAC;AACxB,IAAI,QAAQ,OAAO,KAAK,CAAC;AACzB;AACA;AACA,MAAM,QAAQ,YAAY,QAAQ,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;AAC9D,MAAM,SAAS,WAAW,QAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;AAC/D,MAAM,SAAS,WAAW,QAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;AAC/D,MAAM,aAAa,OAAO,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;AACnE,MAAM,YAAY,QAAQ,QAAQ,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;AAClE,MAAM,UAAU,UAAU,QAAQ,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC;AAChE,MAAM,iBAAiB,GAAG,QAAQ,CAAC,cAAc,CAAC,mBAAmB,CAAC,CAAC;AACvE,MAAM,WAAW,SAAS,QAAQ,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;AACjE,MAAM,YAAY,QAAQ,QAAQ,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;AAClE,MAAM,SAAS,WAAW,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;AAC5D,MAAM,OAAO,aAAa,QAAQ,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;AAC7D,MAAM,YAAY,QAAQ,QAAQ,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;AAClE;AACA;AACA,MAAM,IAAI,QAAQ,EAAE,IAAI,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;AACtD,MAAM,IAAI,QAAQ,EAAE,IAAI,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;AACnD,MAAM,SAAS,GAAG,GAAG,IAAI,EAAE,SAAS,CAAC,WAAW,GAAG,GAAG,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC;AAC3E;AACA;AACA,SAAS,OAAO,GAAG;AACnB,EAAE,UAAU,CAAC,QAAQ,GAAG,CAAC,YAAY,CAAC;AACtC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;AAClB,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;AAChB,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;AACrB,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;AAC1B,EAAE,WAAW,CAAC,KAAK,GAAG,CAAC,CAAC;AACxB,EAAE,YAAY,CAAC,WAAW,GAAG,IAAI,CAAC;AAClC,CAAC;AACD;AACA;AACA,SAAS,CAAC,gBAAgB,CAAC,OAAO,EAAE,MAAM,SAAS,CAAC,KAAK,EAAE,CAAC,CAAC;AAC7D,SAAS,CAAC,gBAAgB,CAAC,QAAQ,EAAE,MAAM;AAC3C,EAAE,IAAI,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AACzD,CAAC,CAAC,CAAC;AACH;AACA;AACA,CAAC,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,GAAG,IAAI;AAC/C,EAAE,QAAQ,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC,IAAI;AACtC,IAAI,CAAC,CAAC,cAAc,EAAE,CAAC;AACvB,IAAI,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,EAAE,GAAG,KAAK,UAAU,CAAC,CAAC;AAC3D,IAAI,IAAI,GAAG,KAAK,MAAM,IAAI,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;AACnD,MAAM,UAAU,CAAC,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1C,KAAK;AACL,GAAG,CAAC,CAAC;AACL,CAAC,CAAC,CAAC;AACH;AACA,SAAS,UAAU,CAAC,IAAI,EAAE;AAC1B,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;AACjD,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;AACxC,IAAI,OAAO;AACX,GAAG;AACH,EAAE,YAAY,GAAG,IAAI,CAAC;AACtB,EAAE,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,WAAW,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACrE,EAAE,OAAO,EAAE,CAAC;AACZ,CAAC;AACD;AACA;AACA,aAAa,CAAC,gBAAgB,CAAC,OAAO,EAAE,MAAM;AAC9C,EAAE,YAAY,CAAC,WAAW,GAAG,UAAU,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;AACxE,CAAC,CAAC,CAAC;AACH;AACA;AACA,UAAU,CAAC,gBAAgB,CAAC,OAAO,EAAE,YAAY;AACjD,EAAE,IAAI,CAAC,YAAY,EAAE,OAAO;AAC5B;AACA,EAAE,OAAO,EAAE,CAAC;AACZ;AACA;AACA,EAAE,IAAI,CAAC,QAAQ,EAAE;AACjB,IAAI,SAAS,CAAC,sBAAsB,CAAC,CAAC;AACtC;AACA,IAAI,MAAM,OAAO,GAAG,8DAA8D,CAAC;AACnF;AACA;AACA,IAAI,MAAM,CAAC,OAAO,EAAE,OAAO,EAAE,SAAS,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;AAC5D,MAAM,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,eAAe,CAAC,SAAS,wBAAwB,CAAC;AAC7E,MAAM,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,iBAAiB,CAAC,OAAO,kBAAkB,CAAC;AACvE,MAAM,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,sBAAsB,CAAC,EAAE,wBAAwB,CAAC;AAC7E,KAAK,CAAC,CAAC;AACP;AACA;AACA,IAAI,MAAM,MAAM,CAAC,IAAI,CAAC;AACtB,MAAM,OAAO;AACb,MAAM,OAAO;AACb,MAAM,SAAS;AACf,MAAM,cAAc,EAAE,SAAS;AAC/B,KAAK,CAAC,CAAC;AACP;AACA,IAAI,QAAQ,GAAG,IAAI,CAAC;AACpB,GAAG;AACH;AACA;AACA,EAAE,SAAS,CAAC,qBAAqB,CAAC,CAAC;AACnC,EAAE,MAAM,IAAI,GAAG,MAAM,SAAS,CAAC,YAAY,CAAC,CAAC;AAC7C,EAAE,MAAM,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;AAC5C;AACA;AACA,EAAE,MAAM,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,EAAE,KAAK,EAAE,KAAK;AACvC,IAAI,IAAI,CAAC,iBAAiB,CAAC,CAAC;AAC5B,IAAI,WAAW,CAAC,KAAK,GAAG,KAAK,CAAC;AAC9B,IAAI,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,GAAG,CAAC,CAAC;AACxC,IAAI,YAAY,CAAC,WAAW,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;AACzC,IAAI,SAAS,CAAC,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AACrC,GAAG,CAAC,CAAC;AACL;AACA;AACA,EAAE,MAAM,EAAE,QAAQ,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,UAAU,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC;AACjE,EAAE,MAAM,OAAO,GAAG,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AAC9C;AACA,EAAE,IAAI;AACN,IAAI,MAAM,MAAM,CAAC,IAAI,CAAC;AACtB,MAAM,IAAI;AACV,MAAM,IAAI,EAAE,WAAW;AACvB,MAAM,MAAM,EAAE,YAAY;AAC1B,MAAM,MAAM,EAAE,OAAO;AACrB,MAAM,MAAM,EAAE,SAAS;AACvB,MAAM,aAAa;AACnB,KAAK,CAAC,CAAC;AACP,GAAG,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,OAAO,SAAS,CAAC,qBAAqB,GAAG,GAAG,CAAC,OAAO,CAAC,CAAC;AAC1D,GAAG;AACH;AACA;AACA,EAAE,SAAS,CAAC,aAAa,CAAC,CAAC;AAC3B,EAAE,MAAM,GAAG,GAAG,MAAM,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;AACnD,EAAE,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,EAAE,YAAY,EAAE,CAAC,CAAC;AAC9D,EAAE,MAAM,GAAG,IAAI,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;AACzC;AACA;AACA,EAAE,OAAO,CAAC,GAAG,GAAG,GAAG,CAAC;AACpB,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;AAChB;AACA,EAAE,YAAY,CAAC,IAAI,OAAO,GAAG,CAAC;AAC9B,EAAE,YAAY,CAAC,QAAQ,GAAG,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,GAAG,OAAO,CAAC;AAC7E,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;AACrB;AACA,EAAE,SAAS,CAAC,OAAO,CAAC,CAAC;AACrB,CAAC,CAAC,CAAC;AACH;AACA;AACA,OAAO,EAAE"}