{"version":3,"file":"bundle.js","sources":["../../node_modules/webm-muxer/build/webm-muxer.mjs","../../node_modules/mp4box/dist/mp4box.all.js","../converter.js"],"sourcesContent":["var __accessCheck = (obj, member, msg) => {\r\n  if (!member.has(obj))\r\n    throw TypeError(\"Cannot \" + msg);\r\n};\r\nvar __privateGet = (obj, member, getter) => {\r\n  __accessCheck(obj, member, \"read from private field\");\r\n  return getter ? getter.call(obj) : member.get(obj);\r\n};\r\nvar __privateAdd = (obj, member, value) => {\r\n  if (member.has(obj))\r\n    throw TypeError(\"Cannot add the same private member more than once\");\r\n  member instanceof WeakSet ? member.add(obj) : member.set(obj, value);\r\n};\r\nvar __privateSet = (obj, member, value, setter) => {\r\n  __accessCheck(obj, member, \"write to private field\");\r\n  setter ? setter.call(obj, value) : member.set(obj, value);\r\n  return value;\r\n};\r\nvar __privateMethod = (obj, member, method) => {\r\n  __accessCheck(obj, member, \"access private method\");\r\n  return method;\r\n};\r\n\r\n// src/ebml.ts\r\nvar EBMLFloat32 = class {\r\n  constructor(value) {\r\n    this.value = value;\r\n  }\r\n};\r\nvar EBMLFloat64 = class {\r\n  constructor(value) {\r\n    this.value = value;\r\n  }\r\n};\r\nvar measureUnsignedInt = (value) => {\r\n  if (value < 1 << 8) {\r\n    return 1;\r\n  } else if (value < 1 << 16) {\r\n    return 2;\r\n  } else if (value < 1 << 24) {\r\n    return 3;\r\n  } else if (value < 2 ** 32) {\r\n    return 4;\r\n  } else if (value < 2 ** 40) {\r\n    return 5;\r\n  } else {\r\n    return 6;\r\n  }\r\n};\r\nvar measureEBMLVarInt = (value) => {\r\n  if (value < (1 << 7) - 1) {\r\n    return 1;\r\n  } else if (value < (1 << 14) - 1) {\r\n    return 2;\r\n  } else if (value < (1 << 21) - 1) {\r\n    return 3;\r\n  } else if (value < (1 << 28) - 1) {\r\n    return 4;\r\n  } else if (value < 2 ** 35 - 1) {\r\n    return 5;\r\n  } else if (value < 2 ** 42 - 1) {\r\n    return 6;\r\n  } else {\r\n    throw new Error(\"EBML VINT size not supported \" + value);\r\n  }\r\n};\r\n\r\n// src/misc.ts\r\nvar readBits = (bytes, start, end) => {\r\n  let result = 0;\r\n  for (let i = start; i < end; i++) {\r\n    let byteIndex = Math.floor(i / 8);\r\n    let byte = bytes[byteIndex];\r\n    let bitIndex = 7 - (i & 7);\r\n    let bit = (byte & 1 << bitIndex) >> bitIndex;\r\n    result <<= 1;\r\n    result |= bit;\r\n  }\r\n  return result;\r\n};\r\nvar writeBits = (bytes, start, end, value) => {\r\n  for (let i = start; i < end; i++) {\r\n    let byteIndex = Math.floor(i / 8);\r\n    let byte = bytes[byteIndex];\r\n    let bitIndex = 7 - (i & 7);\r\n    byte &= ~(1 << bitIndex);\r\n    byte |= (value & 1 << end - i - 1) >> end - i - 1 << bitIndex;\r\n    bytes[byteIndex] = byte;\r\n  }\r\n};\r\n\r\n// src/target.ts\r\nvar isTarget = Symbol(\"isTarget\");\r\nvar Target = class {\r\n};\r\nisTarget;\r\nvar ArrayBufferTarget = class extends Target {\r\n  constructor() {\r\n    super(...arguments);\r\n    this.buffer = null;\r\n  }\r\n};\r\nvar StreamTarget = class extends Target {\r\n  constructor(options) {\r\n    super();\r\n    this.options = options;\r\n    if (typeof options !== \"object\") {\r\n      throw new TypeError(\"StreamTarget requires an options object to be passed to its constructor.\");\r\n    }\r\n    if (options.onData) {\r\n      if (typeof options.onData !== \"function\") {\r\n        throw new TypeError(\"options.onData, when provided, must be a function.\");\r\n      }\r\n      if (options.onData.length < 2) {\r\n        throw new TypeError(\r\n          \"options.onData, when provided, must be a function that takes in at least two arguments (data and position). Ignoring the position argument, which specifies the byte offset at which the data is to be written, can lead to broken outputs.\"\r\n        );\r\n      }\r\n    }\r\n    if (options.onHeader && typeof options.onHeader !== \"function\") {\r\n      throw new TypeError(\"options.onHeader, when provided, must be a function.\");\r\n    }\r\n    if (options.onCluster && typeof options.onCluster !== \"function\") {\r\n      throw new TypeError(\"options.onCluster, when provided, must be a function.\");\r\n    }\r\n    if (options.chunked !== void 0 && typeof options.chunked !== \"boolean\") {\r\n      throw new TypeError(\"options.chunked, when provided, must be a boolean.\");\r\n    }\r\n    if (options.chunkSize !== void 0 && (!Number.isInteger(options.chunkSize) || options.chunkSize < 1024)) {\r\n      throw new TypeError(\"options.chunkSize, when provided, must be an integer and not smaller than 1024.\");\r\n    }\r\n  }\r\n};\r\nvar FileSystemWritableFileStreamTarget = class extends Target {\r\n  constructor(stream, options) {\r\n    super();\r\n    this.stream = stream;\r\n    this.options = options;\r\n    if (!(stream instanceof FileSystemWritableFileStream)) {\r\n      throw new TypeError(\"FileSystemWritableFileStreamTarget requires a FileSystemWritableFileStream instance.\");\r\n    }\r\n    if (options !== void 0 && typeof options !== \"object\") {\r\n      throw new TypeError(\"FileSystemWritableFileStreamTarget's options, when provided, must be an object.\");\r\n    }\r\n    if (options) {\r\n      if (options.chunkSize !== void 0 && (!Number.isInteger(options.chunkSize) || options.chunkSize <= 0)) {\r\n        throw new TypeError(\"options.chunkSize, when provided, must be a positive integer\");\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n// src/writer.ts\r\nvar _helper, _helperView, _writeByte, writeByte_fn, _writeFloat32, writeFloat32_fn, _writeFloat64, writeFloat64_fn, _writeUnsignedInt, writeUnsignedInt_fn, _writeString, writeString_fn;\r\nvar Writer = class {\r\n  constructor() {\r\n    __privateAdd(this, _writeByte);\r\n    __privateAdd(this, _writeFloat32);\r\n    __privateAdd(this, _writeFloat64);\r\n    __privateAdd(this, _writeUnsignedInt);\r\n    __privateAdd(this, _writeString);\r\n    this.pos = 0;\r\n    __privateAdd(this, _helper, new Uint8Array(8));\r\n    __privateAdd(this, _helperView, new DataView(__privateGet(this, _helper).buffer));\r\n    this.offsets = /* @__PURE__ */ new WeakMap();\r\n    this.dataOffsets = /* @__PURE__ */ new WeakMap();\r\n  }\r\n  seek(newPos) {\r\n    this.pos = newPos;\r\n  }\r\n  writeEBMLVarInt(value, width = measureEBMLVarInt(value)) {\r\n    let pos = 0;\r\n    switch (width) {\r\n      case 1:\r\n        __privateGet(this, _helperView).setUint8(pos++, 1 << 7 | value);\r\n        break;\r\n      case 2:\r\n        __privateGet(this, _helperView).setUint8(pos++, 1 << 6 | value >> 8);\r\n        __privateGet(this, _helperView).setUint8(pos++, value);\r\n        break;\r\n      case 3:\r\n        __privateGet(this, _helperView).setUint8(pos++, 1 << 5 | value >> 16);\r\n        __privateGet(this, _helperView).setUint8(pos++, value >> 8);\r\n        __privateGet(this, _helperView).setUint8(pos++, value);\r\n        break;\r\n      case 4:\r\n        __privateGet(this, _helperView).setUint8(pos++, 1 << 4 | value >> 24);\r\n        __privateGet(this, _helperView).setUint8(pos++, value >> 16);\r\n        __privateGet(this, _helperView).setUint8(pos++, value >> 8);\r\n        __privateGet(this, _helperView).setUint8(pos++, value);\r\n        break;\r\n      case 5:\r\n        __privateGet(this, _helperView).setUint8(pos++, 1 << 3 | value / 2 ** 32 & 7);\r\n        __privateGet(this, _helperView).setUint8(pos++, value >> 24);\r\n        __privateGet(this, _helperView).setUint8(pos++, value >> 16);\r\n        __privateGet(this, _helperView).setUint8(pos++, value >> 8);\r\n        __privateGet(this, _helperView).setUint8(pos++, value);\r\n        break;\r\n      case 6:\r\n        __privateGet(this, _helperView).setUint8(pos++, 1 << 2 | value / 2 ** 40 & 3);\r\n        __privateGet(this, _helperView).setUint8(pos++, value / 2 ** 32 | 0);\r\n        __privateGet(this, _helperView).setUint8(pos++, value >> 24);\r\n        __privateGet(this, _helperView).setUint8(pos++, value >> 16);\r\n        __privateGet(this, _helperView).setUint8(pos++, value >> 8);\r\n        __privateGet(this, _helperView).setUint8(pos++, value);\r\n        break;\r\n      default:\r\n        throw new Error(\"Bad EBML VINT size \" + width);\r\n    }\r\n    this.write(__privateGet(this, _helper).subarray(0, pos));\r\n  }\r\n  writeEBML(data) {\r\n    if (data === null)\r\n      return;\r\n    if (data instanceof Uint8Array) {\r\n      this.write(data);\r\n    } else if (Array.isArray(data)) {\r\n      for (let elem of data) {\r\n        this.writeEBML(elem);\r\n      }\r\n    } else {\r\n      this.offsets.set(data, this.pos);\r\n      __privateMethod(this, _writeUnsignedInt, writeUnsignedInt_fn).call(this, data.id);\r\n      if (Array.isArray(data.data)) {\r\n        let sizePos = this.pos;\r\n        let sizeSize = data.size === -1 ? 1 : data.size ?? 4;\r\n        if (data.size === -1) {\r\n          __privateMethod(this, _writeByte, writeByte_fn).call(this, 255);\r\n        } else {\r\n          this.seek(this.pos + sizeSize);\r\n        }\r\n        let startPos = this.pos;\r\n        this.dataOffsets.set(data, startPos);\r\n        this.writeEBML(data.data);\r\n        if (data.size !== -1) {\r\n          let size = this.pos - startPos;\r\n          let endPos = this.pos;\r\n          this.seek(sizePos);\r\n          this.writeEBMLVarInt(size, sizeSize);\r\n          this.seek(endPos);\r\n        }\r\n      } else if (typeof data.data === \"number\") {\r\n        let size = data.size ?? measureUnsignedInt(data.data);\r\n        this.writeEBMLVarInt(size);\r\n        __privateMethod(this, _writeUnsignedInt, writeUnsignedInt_fn).call(this, data.data, size);\r\n      } else if (typeof data.data === \"string\") {\r\n        this.writeEBMLVarInt(data.data.length);\r\n        __privateMethod(this, _writeString, writeString_fn).call(this, data.data);\r\n      } else if (data.data instanceof Uint8Array) {\r\n        this.writeEBMLVarInt(data.data.byteLength, data.size);\r\n        this.write(data.data);\r\n      } else if (data.data instanceof EBMLFloat32) {\r\n        this.writeEBMLVarInt(4);\r\n        __privateMethod(this, _writeFloat32, writeFloat32_fn).call(this, data.data.value);\r\n      } else if (data.data instanceof EBMLFloat64) {\r\n        this.writeEBMLVarInt(8);\r\n        __privateMethod(this, _writeFloat64, writeFloat64_fn).call(this, data.data.value);\r\n      }\r\n    }\r\n  }\r\n};\r\n_helper = new WeakMap();\r\n_helperView = new WeakMap();\r\n_writeByte = new WeakSet();\r\nwriteByte_fn = function(value) {\r\n  __privateGet(this, _helperView).setUint8(0, value);\r\n  this.write(__privateGet(this, _helper).subarray(0, 1));\r\n};\r\n_writeFloat32 = new WeakSet();\r\nwriteFloat32_fn = function(value) {\r\n  __privateGet(this, _helperView).setFloat32(0, value, false);\r\n  this.write(__privateGet(this, _helper).subarray(0, 4));\r\n};\r\n_writeFloat64 = new WeakSet();\r\nwriteFloat64_fn = function(value) {\r\n  __privateGet(this, _helperView).setFloat64(0, value, false);\r\n  this.write(__privateGet(this, _helper));\r\n};\r\n_writeUnsignedInt = new WeakSet();\r\nwriteUnsignedInt_fn = function(value, width = measureUnsignedInt(value)) {\r\n  let pos = 0;\r\n  switch (width) {\r\n    case 6:\r\n      __privateGet(this, _helperView).setUint8(pos++, value / 2 ** 40 | 0);\r\n    case 5:\r\n      __privateGet(this, _helperView).setUint8(pos++, value / 2 ** 32 | 0);\r\n    case 4:\r\n      __privateGet(this, _helperView).setUint8(pos++, value >> 24);\r\n    case 3:\r\n      __privateGet(this, _helperView).setUint8(pos++, value >> 16);\r\n    case 2:\r\n      __privateGet(this, _helperView).setUint8(pos++, value >> 8);\r\n    case 1:\r\n      __privateGet(this, _helperView).setUint8(pos++, value);\r\n      break;\r\n    default:\r\n      throw new Error(\"Bad UINT size \" + width);\r\n  }\r\n  this.write(__privateGet(this, _helper).subarray(0, pos));\r\n};\r\n_writeString = new WeakSet();\r\nwriteString_fn = function(str) {\r\n  this.write(new Uint8Array(str.split(\"\").map((x) => x.charCodeAt(0))));\r\n};\r\nvar _target, _buffer, _bytes, _ensureSize, ensureSize_fn;\r\nvar ArrayBufferTargetWriter = class extends Writer {\r\n  constructor(target) {\r\n    super();\r\n    __privateAdd(this, _ensureSize);\r\n    __privateAdd(this, _target, void 0);\r\n    __privateAdd(this, _buffer, new ArrayBuffer(2 ** 16));\r\n    __privateAdd(this, _bytes, new Uint8Array(__privateGet(this, _buffer)));\r\n    __privateSet(this, _target, target);\r\n  }\r\n  write(data) {\r\n    __privateMethod(this, _ensureSize, ensureSize_fn).call(this, this.pos + data.byteLength);\r\n    __privateGet(this, _bytes).set(data, this.pos);\r\n    this.pos += data.byteLength;\r\n  }\r\n  finalize() {\r\n    __privateMethod(this, _ensureSize, ensureSize_fn).call(this, this.pos);\r\n    __privateGet(this, _target).buffer = __privateGet(this, _buffer).slice(0, this.pos);\r\n  }\r\n};\r\n_target = new WeakMap();\r\n_buffer = new WeakMap();\r\n_bytes = new WeakMap();\r\n_ensureSize = new WeakSet();\r\nensureSize_fn = function(size) {\r\n  let newLength = __privateGet(this, _buffer).byteLength;\r\n  while (newLength < size)\r\n    newLength *= 2;\r\n  if (newLength === __privateGet(this, _buffer).byteLength)\r\n    return;\r\n  let newBuffer = new ArrayBuffer(newLength);\r\n  let newBytes = new Uint8Array(newBuffer);\r\n  newBytes.set(__privateGet(this, _bytes), 0);\r\n  __privateSet(this, _buffer, newBuffer);\r\n  __privateSet(this, _bytes, newBytes);\r\n};\r\nvar _trackingWrites, _trackedWrites, _trackedStart, _trackedEnd;\r\nvar BaseStreamTargetWriter = class extends Writer {\r\n  constructor(target) {\r\n    super();\r\n    this.target = target;\r\n    __privateAdd(this, _trackingWrites, false);\r\n    __privateAdd(this, _trackedWrites, void 0);\r\n    __privateAdd(this, _trackedStart, void 0);\r\n    __privateAdd(this, _trackedEnd, void 0);\r\n  }\r\n  write(data) {\r\n    if (!__privateGet(this, _trackingWrites))\r\n      return;\r\n    let pos = this.pos;\r\n    if (pos < __privateGet(this, _trackedStart)) {\r\n      if (pos + data.byteLength <= __privateGet(this, _trackedStart))\r\n        return;\r\n      data = data.subarray(__privateGet(this, _trackedStart) - pos);\r\n      pos = 0;\r\n    }\r\n    let neededSize = pos + data.byteLength - __privateGet(this, _trackedStart);\r\n    let newLength = __privateGet(this, _trackedWrites).byteLength;\r\n    while (newLength < neededSize)\r\n      newLength *= 2;\r\n    if (newLength !== __privateGet(this, _trackedWrites).byteLength) {\r\n      let copy = new Uint8Array(newLength);\r\n      copy.set(__privateGet(this, _trackedWrites), 0);\r\n      __privateSet(this, _trackedWrites, copy);\r\n    }\r\n    __privateGet(this, _trackedWrites).set(data, pos - __privateGet(this, _trackedStart));\r\n    __privateSet(this, _trackedEnd, Math.max(__privateGet(this, _trackedEnd), pos + data.byteLength));\r\n  }\r\n  startTrackingWrites() {\r\n    __privateSet(this, _trackingWrites, true);\r\n    __privateSet(this, _trackedWrites, new Uint8Array(2 ** 10));\r\n    __privateSet(this, _trackedStart, this.pos);\r\n    __privateSet(this, _trackedEnd, this.pos);\r\n  }\r\n  getTrackedWrites() {\r\n    if (!__privateGet(this, _trackingWrites)) {\r\n      throw new Error(\"Can't get tracked writes since nothing was tracked.\");\r\n    }\r\n    let slice = __privateGet(this, _trackedWrites).subarray(0, __privateGet(this, _trackedEnd) - __privateGet(this, _trackedStart));\r\n    let result = {\r\n      data: slice,\r\n      start: __privateGet(this, _trackedStart),\r\n      end: __privateGet(this, _trackedEnd)\r\n    };\r\n    __privateSet(this, _trackedWrites, void 0);\r\n    __privateSet(this, _trackingWrites, false);\r\n    return result;\r\n  }\r\n};\r\n_trackingWrites = new WeakMap();\r\n_trackedWrites = new WeakMap();\r\n_trackedStart = new WeakMap();\r\n_trackedEnd = new WeakMap();\r\nvar DEFAULT_CHUNK_SIZE = 2 ** 24;\r\nvar MAX_CHUNKS_AT_ONCE = 2;\r\nvar _sections, _lastFlushEnd, _ensureMonotonicity, _chunked, _chunkSize, _chunks, _writeDataIntoChunks, writeDataIntoChunks_fn, _insertSectionIntoChunk, insertSectionIntoChunk_fn, _createChunk, createChunk_fn, _flushChunks, flushChunks_fn;\r\nvar StreamTargetWriter = class extends BaseStreamTargetWriter {\r\n  constructor(target, ensureMonotonicity) {\r\n    super(target);\r\n    __privateAdd(this, _writeDataIntoChunks);\r\n    __privateAdd(this, _insertSectionIntoChunk);\r\n    __privateAdd(this, _createChunk);\r\n    __privateAdd(this, _flushChunks);\r\n    __privateAdd(this, _sections, []);\r\n    __privateAdd(this, _lastFlushEnd, 0);\r\n    __privateAdd(this, _ensureMonotonicity, void 0);\r\n    __privateAdd(this, _chunked, void 0);\r\n    __privateAdd(this, _chunkSize, void 0);\r\n    __privateAdd(this, _chunks, []);\r\n    __privateSet(this, _ensureMonotonicity, ensureMonotonicity);\r\n    __privateSet(this, _chunked, target.options?.chunked ?? false);\r\n    __privateSet(this, _chunkSize, target.options?.chunkSize ?? DEFAULT_CHUNK_SIZE);\r\n  }\r\n  write(data) {\r\n    super.write(data);\r\n    __privateGet(this, _sections).push({\r\n      data: data.slice(),\r\n      start: this.pos\r\n    });\r\n    this.pos += data.byteLength;\r\n  }\r\n  flush() {\r\n    if (__privateGet(this, _sections).length === 0)\r\n      return;\r\n    let chunks = [];\r\n    let sorted = [...__privateGet(this, _sections)].sort((a, b) => a.start - b.start);\r\n    chunks.push({\r\n      start: sorted[0].start,\r\n      size: sorted[0].data.byteLength\r\n    });\r\n    for (let i = 1; i < sorted.length; i++) {\r\n      let lastChunk = chunks[chunks.length - 1];\r\n      let section = sorted[i];\r\n      if (section.start <= lastChunk.start + lastChunk.size) {\r\n        lastChunk.size = Math.max(lastChunk.size, section.start + section.data.byteLength - lastChunk.start);\r\n      } else {\r\n        chunks.push({\r\n          start: section.start,\r\n          size: section.data.byteLength\r\n        });\r\n      }\r\n    }\r\n    for (let chunk of chunks) {\r\n      chunk.data = new Uint8Array(chunk.size);\r\n      for (let section of __privateGet(this, _sections)) {\r\n        if (chunk.start <= section.start && section.start < chunk.start + chunk.size) {\r\n          chunk.data.set(section.data, section.start - chunk.start);\r\n        }\r\n      }\r\n      if (__privateGet(this, _chunked)) {\r\n        __privateMethod(this, _writeDataIntoChunks, writeDataIntoChunks_fn).call(this, chunk.data, chunk.start);\r\n        __privateMethod(this, _flushChunks, flushChunks_fn).call(this);\r\n      } else {\r\n        if (__privateGet(this, _ensureMonotonicity) && chunk.start < __privateGet(this, _lastFlushEnd)) {\r\n          throw new Error(\"Internal error: Monotonicity violation.\");\r\n        }\r\n        this.target.options.onData?.(chunk.data, chunk.start);\r\n        __privateSet(this, _lastFlushEnd, chunk.start + chunk.data.byteLength);\r\n      }\r\n    }\r\n    __privateGet(this, _sections).length = 0;\r\n  }\r\n  finalize() {\r\n    if (__privateGet(this, _chunked)) {\r\n      __privateMethod(this, _flushChunks, flushChunks_fn).call(this, true);\r\n    }\r\n  }\r\n};\r\n_sections = new WeakMap();\r\n_lastFlushEnd = new WeakMap();\r\n_ensureMonotonicity = new WeakMap();\r\n_chunked = new WeakMap();\r\n_chunkSize = new WeakMap();\r\n_chunks = new WeakMap();\r\n_writeDataIntoChunks = new WeakSet();\r\nwriteDataIntoChunks_fn = function(data, position) {\r\n  let chunkIndex = __privateGet(this, _chunks).findIndex((x) => x.start <= position && position < x.start + __privateGet(this, _chunkSize));\r\n  if (chunkIndex === -1)\r\n    chunkIndex = __privateMethod(this, _createChunk, createChunk_fn).call(this, position);\r\n  let chunk = __privateGet(this, _chunks)[chunkIndex];\r\n  let relativePosition = position - chunk.start;\r\n  let toWrite = data.subarray(0, Math.min(__privateGet(this, _chunkSize) - relativePosition, data.byteLength));\r\n  chunk.data.set(toWrite, relativePosition);\r\n  let section = {\r\n    start: relativePosition,\r\n    end: relativePosition + toWrite.byteLength\r\n  };\r\n  __privateMethod(this, _insertSectionIntoChunk, insertSectionIntoChunk_fn).call(this, chunk, section);\r\n  if (chunk.written[0].start === 0 && chunk.written[0].end === __privateGet(this, _chunkSize)) {\r\n    chunk.shouldFlush = true;\r\n  }\r\n  if (__privateGet(this, _chunks).length > MAX_CHUNKS_AT_ONCE) {\r\n    for (let i = 0; i < __privateGet(this, _chunks).length - 1; i++) {\r\n      __privateGet(this, _chunks)[i].shouldFlush = true;\r\n    }\r\n    __privateMethod(this, _flushChunks, flushChunks_fn).call(this);\r\n  }\r\n  if (toWrite.byteLength < data.byteLength) {\r\n    __privateMethod(this, _writeDataIntoChunks, writeDataIntoChunks_fn).call(this, data.subarray(toWrite.byteLength), position + toWrite.byteLength);\r\n  }\r\n};\r\n_insertSectionIntoChunk = new WeakSet();\r\ninsertSectionIntoChunk_fn = function(chunk, section) {\r\n  let low = 0;\r\n  let high = chunk.written.length - 1;\r\n  let index = -1;\r\n  while (low <= high) {\r\n    let mid = Math.floor(low + (high - low + 1) / 2);\r\n    if (chunk.written[mid].start <= section.start) {\r\n      low = mid + 1;\r\n      index = mid;\r\n    } else {\r\n      high = mid - 1;\r\n    }\r\n  }\r\n  chunk.written.splice(index + 1, 0, section);\r\n  if (index === -1 || chunk.written[index].end < section.start)\r\n    index++;\r\n  while (index < chunk.written.length - 1 && chunk.written[index].end >= chunk.written[index + 1].start) {\r\n    chunk.written[index].end = Math.max(chunk.written[index].end, chunk.written[index + 1].end);\r\n    chunk.written.splice(index + 1, 1);\r\n  }\r\n};\r\n_createChunk = new WeakSet();\r\ncreateChunk_fn = function(includesPosition) {\r\n  let start = Math.floor(includesPosition / __privateGet(this, _chunkSize)) * __privateGet(this, _chunkSize);\r\n  let chunk = {\r\n    start,\r\n    data: new Uint8Array(__privateGet(this, _chunkSize)),\r\n    written: [],\r\n    shouldFlush: false\r\n  };\r\n  __privateGet(this, _chunks).push(chunk);\r\n  __privateGet(this, _chunks).sort((a, b) => a.start - b.start);\r\n  return __privateGet(this, _chunks).indexOf(chunk);\r\n};\r\n_flushChunks = new WeakSet();\r\nflushChunks_fn = function(force = false) {\r\n  for (let i = 0; i < __privateGet(this, _chunks).length; i++) {\r\n    let chunk = __privateGet(this, _chunks)[i];\r\n    if (!chunk.shouldFlush && !force)\r\n      continue;\r\n    for (let section of chunk.written) {\r\n      if (__privateGet(this, _ensureMonotonicity) && chunk.start + section.start < __privateGet(this, _lastFlushEnd)) {\r\n        throw new Error(\"Internal error: Monotonicity violation.\");\r\n      }\r\n      this.target.options.onData?.(\r\n        chunk.data.subarray(section.start, section.end),\r\n        chunk.start + section.start\r\n      );\r\n      __privateSet(this, _lastFlushEnd, chunk.start + section.end);\r\n    }\r\n    __privateGet(this, _chunks).splice(i--, 1);\r\n  }\r\n};\r\nvar FileSystemWritableFileStreamTargetWriter = class extends StreamTargetWriter {\r\n  constructor(target, ensureMonotonicity) {\r\n    super(new StreamTarget({\r\n      onData: (data, position) => target.stream.write({\r\n        type: \"write\",\r\n        data,\r\n        position\r\n      }),\r\n      chunked: true,\r\n      chunkSize: target.options?.chunkSize\r\n    }), ensureMonotonicity);\r\n  }\r\n};\r\n\r\n// src/muxer.ts\r\nvar VIDEO_TRACK_NUMBER = 1;\r\nvar AUDIO_TRACK_NUMBER = 2;\r\nvar SUBTITLE_TRACK_NUMBER = 3;\r\nvar VIDEO_TRACK_TYPE = 1;\r\nvar AUDIO_TRACK_TYPE = 2;\r\nvar SUBTITLE_TRACK_TYPE = 17;\r\nvar MAX_CHUNK_LENGTH_MS = 2 ** 15;\r\nvar CODEC_PRIVATE_MAX_SIZE = 2 ** 12;\r\nvar APP_NAME = \"https://github.com/Vanilagy/webm-muxer\";\r\nvar SEGMENT_SIZE_BYTES = 6;\r\nvar CLUSTER_SIZE_BYTES = 5;\r\nvar FIRST_TIMESTAMP_BEHAVIORS = [\"strict\", \"offset\", \"permissive\"];\r\nvar _options, _writer, _segment, _segmentInfo, _seekHead, _tracksElement, _segmentDuration, _colourElement, _videoCodecPrivate, _audioCodecPrivate, _subtitleCodecPrivate, _cues, _currentCluster, _currentClusterTimestamp, _duration, _videoChunkQueue, _audioChunkQueue, _subtitleChunkQueue, _firstVideoTimestamp, _firstAudioTimestamp, _lastVideoTimestamp, _lastAudioTimestamp, _lastSubtitleTimestamp, _colorSpace, _finalized, _validateOptions, validateOptions_fn, _createFileHeader, createFileHeader_fn, _writeEBMLHeader, writeEBMLHeader_fn, _createCodecPrivatePlaceholders, createCodecPrivatePlaceholders_fn, _createColourElement, createColourElement_fn, _createSeekHead, createSeekHead_fn, _createSegmentInfo, createSegmentInfo_fn, _createTracks, createTracks_fn, _createSegment, createSegment_fn, _createCues, createCues_fn, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn, _segmentDataOffset, segmentDataOffset_get, _writeVideoDecoderConfig, writeVideoDecoderConfig_fn, _fixVP9ColorSpace, fixVP9ColorSpace_fn, _writeSubtitleChunks, writeSubtitleChunks_fn, _createInternalChunk, createInternalChunk_fn, _validateTimestamp, validateTimestamp_fn, _writeBlock, writeBlock_fn, _createCodecPrivateElement, createCodecPrivateElement_fn, _writeCodecPrivate, writeCodecPrivate_fn, _createNewCluster, createNewCluster_fn, _finalizeCurrentCluster, finalizeCurrentCluster_fn, _ensureNotFinalized, ensureNotFinalized_fn;\r\nvar Muxer = class {\r\n  constructor(options) {\r\n    __privateAdd(this, _validateOptions);\r\n    __privateAdd(this, _createFileHeader);\r\n    __privateAdd(this, _writeEBMLHeader);\r\n    __privateAdd(this, _createCodecPrivatePlaceholders);\r\n    __privateAdd(this, _createColourElement);\r\n    __privateAdd(this, _createSeekHead);\r\n    __privateAdd(this, _createSegmentInfo);\r\n    __privateAdd(this, _createTracks);\r\n    __privateAdd(this, _createSegment);\r\n    __privateAdd(this, _createCues);\r\n    __privateAdd(this, _maybeFlushStreamingTargetWriter);\r\n    __privateAdd(this, _segmentDataOffset);\r\n    __privateAdd(this, _writeVideoDecoderConfig);\r\n    __privateAdd(this, _fixVP9ColorSpace);\r\n    __privateAdd(this, _writeSubtitleChunks);\r\n    __privateAdd(this, _createInternalChunk);\r\n    __privateAdd(this, _validateTimestamp);\r\n    __privateAdd(this, _writeBlock);\r\n    __privateAdd(this, _createCodecPrivateElement);\r\n    __privateAdd(this, _writeCodecPrivate);\r\n    __privateAdd(this, _createNewCluster);\r\n    __privateAdd(this, _finalizeCurrentCluster);\r\n    __privateAdd(this, _ensureNotFinalized);\r\n    __privateAdd(this, _options, void 0);\r\n    __privateAdd(this, _writer, void 0);\r\n    __privateAdd(this, _segment, void 0);\r\n    __privateAdd(this, _segmentInfo, void 0);\r\n    __privateAdd(this, _seekHead, void 0);\r\n    __privateAdd(this, _tracksElement, void 0);\r\n    __privateAdd(this, _segmentDuration, void 0);\r\n    __privateAdd(this, _colourElement, void 0);\r\n    __privateAdd(this, _videoCodecPrivate, void 0);\r\n    __privateAdd(this, _audioCodecPrivate, void 0);\r\n    __privateAdd(this, _subtitleCodecPrivate, void 0);\r\n    __privateAdd(this, _cues, void 0);\r\n    __privateAdd(this, _currentCluster, void 0);\r\n    __privateAdd(this, _currentClusterTimestamp, void 0);\r\n    __privateAdd(this, _duration, 0);\r\n    __privateAdd(this, _videoChunkQueue, []);\r\n    __privateAdd(this, _audioChunkQueue, []);\r\n    __privateAdd(this, _subtitleChunkQueue, []);\r\n    __privateAdd(this, _firstVideoTimestamp, void 0);\r\n    __privateAdd(this, _firstAudioTimestamp, void 0);\r\n    __privateAdd(this, _lastVideoTimestamp, -1);\r\n    __privateAdd(this, _lastAudioTimestamp, -1);\r\n    __privateAdd(this, _lastSubtitleTimestamp, -1);\r\n    __privateAdd(this, _colorSpace, void 0);\r\n    __privateAdd(this, _finalized, false);\r\n    __privateMethod(this, _validateOptions, validateOptions_fn).call(this, options);\r\n    __privateSet(this, _options, {\r\n      type: \"webm\",\r\n      firstTimestampBehavior: \"strict\",\r\n      ...options\r\n    });\r\n    this.target = options.target;\r\n    let ensureMonotonicity = !!__privateGet(this, _options).streaming;\r\n    if (options.target instanceof ArrayBufferTarget) {\r\n      __privateSet(this, _writer, new ArrayBufferTargetWriter(options.target));\r\n    } else if (options.target instanceof StreamTarget) {\r\n      __privateSet(this, _writer, new StreamTargetWriter(options.target, ensureMonotonicity));\r\n    } else if (options.target instanceof FileSystemWritableFileStreamTarget) {\r\n      __privateSet(this, _writer, new FileSystemWritableFileStreamTargetWriter(options.target, ensureMonotonicity));\r\n    } else {\r\n      throw new Error(`Invalid target: ${options.target}`);\r\n    }\r\n    __privateMethod(this, _createFileHeader, createFileHeader_fn).call(this);\r\n  }\r\n  addVideoChunk(chunk, meta, timestamp) {\r\n    if (!(chunk instanceof EncodedVideoChunk)) {\r\n      throw new TypeError(\"addVideoChunk's first argument (chunk) must be of type EncodedVideoChunk.\");\r\n    }\r\n    if (meta && typeof meta !== \"object\") {\r\n      throw new TypeError(\"addVideoChunk's second argument (meta), when provided, must be an object.\");\r\n    }\r\n    if (timestamp !== void 0 && (!Number.isFinite(timestamp) || timestamp < 0)) {\r\n      throw new TypeError(\r\n        \"addVideoChunk's third argument (timestamp), when provided, must be a non-negative real number.\"\r\n      );\r\n    }\r\n    let data = new Uint8Array(chunk.byteLength);\r\n    chunk.copyTo(data);\r\n    this.addVideoChunkRaw(data, chunk.type, timestamp ?? chunk.timestamp, meta);\r\n  }\r\n  addVideoChunkRaw(data, type, timestamp, meta) {\r\n    if (!(data instanceof Uint8Array)) {\r\n      throw new TypeError(\"addVideoChunkRaw's first argument (data) must be an instance of Uint8Array.\");\r\n    }\r\n    if (type !== \"key\" && type !== \"delta\") {\r\n      throw new TypeError(\"addVideoChunkRaw's second argument (type) must be either 'key' or 'delta'.\");\r\n    }\r\n    if (!Number.isFinite(timestamp) || timestamp < 0) {\r\n      throw new TypeError(\"addVideoChunkRaw's third argument (timestamp) must be a non-negative real number.\");\r\n    }\r\n    if (meta && typeof meta !== \"object\") {\r\n      throw new TypeError(\"addVideoChunkRaw's fourth argument (meta), when provided, must be an object.\");\r\n    }\r\n    __privateMethod(this, _ensureNotFinalized, ensureNotFinalized_fn).call(this);\r\n    if (!__privateGet(this, _options).video)\r\n      throw new Error(\"No video track declared.\");\r\n    if (__privateGet(this, _firstVideoTimestamp) === void 0)\r\n      __privateSet(this, _firstVideoTimestamp, timestamp);\r\n    if (meta)\r\n      __privateMethod(this, _writeVideoDecoderConfig, writeVideoDecoderConfig_fn).call(this, meta);\r\n    let videoChunk = __privateMethod(this, _createInternalChunk, createInternalChunk_fn).call(this, data, type, timestamp, VIDEO_TRACK_NUMBER);\r\n    if (__privateGet(this, _options).video.codec === \"V_VP9\")\r\n      __privateMethod(this, _fixVP9ColorSpace, fixVP9ColorSpace_fn).call(this, videoChunk);\r\n    __privateSet(this, _lastVideoTimestamp, videoChunk.timestamp);\r\n    while (__privateGet(this, _audioChunkQueue).length > 0 && __privateGet(this, _audioChunkQueue)[0].timestamp <= videoChunk.timestamp) {\r\n      let audioChunk = __privateGet(this, _audioChunkQueue).shift();\r\n      __privateMethod(this, _writeBlock, writeBlock_fn).call(this, audioChunk, false);\r\n    }\r\n    if (!__privateGet(this, _options).audio || videoChunk.timestamp <= __privateGet(this, _lastAudioTimestamp)) {\r\n      __privateMethod(this, _writeBlock, writeBlock_fn).call(this, videoChunk, true);\r\n    } else {\r\n      __privateGet(this, _videoChunkQueue).push(videoChunk);\r\n    }\r\n    __privateMethod(this, _writeSubtitleChunks, writeSubtitleChunks_fn).call(this);\r\n    __privateMethod(this, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn).call(this);\r\n  }\r\n  addAudioChunk(chunk, meta, timestamp) {\r\n    if (!(chunk instanceof EncodedAudioChunk)) {\r\n      throw new TypeError(\"addAudioChunk's first argument (chunk) must be of type EncodedAudioChunk.\");\r\n    }\r\n    if (meta && typeof meta !== \"object\") {\r\n      throw new TypeError(\"addAudioChunk's second argument (meta), when provided, must be an object.\");\r\n    }\r\n    if (timestamp !== void 0 && (!Number.isFinite(timestamp) || timestamp < 0)) {\r\n      throw new TypeError(\r\n        \"addAudioChunk's third argument (timestamp), when provided, must be a non-negative real number.\"\r\n      );\r\n    }\r\n    let data = new Uint8Array(chunk.byteLength);\r\n    chunk.copyTo(data);\r\n    this.addAudioChunkRaw(data, chunk.type, timestamp ?? chunk.timestamp, meta);\r\n  }\r\n  addAudioChunkRaw(data, type, timestamp, meta) {\r\n    if (!(data instanceof Uint8Array)) {\r\n      throw new TypeError(\"addAudioChunkRaw's first argument (data) must be an instance of Uint8Array.\");\r\n    }\r\n    if (type !== \"key\" && type !== \"delta\") {\r\n      throw new TypeError(\"addAudioChunkRaw's second argument (type) must be either 'key' or 'delta'.\");\r\n    }\r\n    if (!Number.isFinite(timestamp) || timestamp < 0) {\r\n      throw new TypeError(\"addAudioChunkRaw's third argument (timestamp) must be a non-negative real number.\");\r\n    }\r\n    if (meta && typeof meta !== \"object\") {\r\n      throw new TypeError(\"addAudioChunkRaw's fourth argument (meta), when provided, must be an object.\");\r\n    }\r\n    __privateMethod(this, _ensureNotFinalized, ensureNotFinalized_fn).call(this);\r\n    if (!__privateGet(this, _options).audio)\r\n      throw new Error(\"No audio track declared.\");\r\n    if (__privateGet(this, _firstAudioTimestamp) === void 0)\r\n      __privateSet(this, _firstAudioTimestamp, timestamp);\r\n    if (meta?.decoderConfig) {\r\n      if (__privateGet(this, _options).streaming) {\r\n        __privateSet(this, _audioCodecPrivate, __privateMethod(this, _createCodecPrivateElement, createCodecPrivateElement_fn).call(this, meta.decoderConfig.description));\r\n      } else {\r\n        __privateMethod(this, _writeCodecPrivate, writeCodecPrivate_fn).call(this, __privateGet(this, _audioCodecPrivate), meta.decoderConfig.description);\r\n      }\r\n    }\r\n    let audioChunk = __privateMethod(this, _createInternalChunk, createInternalChunk_fn).call(this, data, type, timestamp, AUDIO_TRACK_NUMBER);\r\n    __privateSet(this, _lastAudioTimestamp, audioChunk.timestamp);\r\n    while (__privateGet(this, _videoChunkQueue).length > 0 && __privateGet(this, _videoChunkQueue)[0].timestamp <= audioChunk.timestamp) {\r\n      let videoChunk = __privateGet(this, _videoChunkQueue).shift();\r\n      __privateMethod(this, _writeBlock, writeBlock_fn).call(this, videoChunk, true);\r\n    }\r\n    if (!__privateGet(this, _options).video || audioChunk.timestamp <= __privateGet(this, _lastVideoTimestamp)) {\r\n      __privateMethod(this, _writeBlock, writeBlock_fn).call(this, audioChunk, !__privateGet(this, _options).video);\r\n    } else {\r\n      __privateGet(this, _audioChunkQueue).push(audioChunk);\r\n    }\r\n    __privateMethod(this, _writeSubtitleChunks, writeSubtitleChunks_fn).call(this);\r\n    __privateMethod(this, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn).call(this);\r\n  }\r\n  addSubtitleChunk(chunk, meta, timestamp) {\r\n    if (typeof chunk !== \"object\" || !chunk) {\r\n      throw new TypeError(\"addSubtitleChunk's first argument (chunk) must be an object.\");\r\n    } else {\r\n      if (!(chunk.body instanceof Uint8Array)) {\r\n        throw new TypeError(\"body must be an instance of Uint8Array.\");\r\n      }\r\n      if (!Number.isFinite(chunk.timestamp) || chunk.timestamp < 0) {\r\n        throw new TypeError(\"timestamp must be a non-negative real number.\");\r\n      }\r\n      if (!Number.isFinite(chunk.duration) || chunk.duration < 0) {\r\n        throw new TypeError(\"duration must be a non-negative real number.\");\r\n      }\r\n      if (chunk.additions && !(chunk.additions instanceof Uint8Array)) {\r\n        throw new TypeError(\"additions, when present, must be an instance of Uint8Array.\");\r\n      }\r\n    }\r\n    if (typeof meta !== \"object\") {\r\n      throw new TypeError(\"addSubtitleChunk's second argument (meta) must be an object.\");\r\n    }\r\n    __privateMethod(this, _ensureNotFinalized, ensureNotFinalized_fn).call(this);\r\n    if (!__privateGet(this, _options).subtitles)\r\n      throw new Error(\"No subtitle track declared.\");\r\n    if (meta?.decoderConfig) {\r\n      if (__privateGet(this, _options).streaming) {\r\n        __privateSet(this, _subtitleCodecPrivate, __privateMethod(this, _createCodecPrivateElement, createCodecPrivateElement_fn).call(this, meta.decoderConfig.description));\r\n      } else {\r\n        __privateMethod(this, _writeCodecPrivate, writeCodecPrivate_fn).call(this, __privateGet(this, _subtitleCodecPrivate), meta.decoderConfig.description);\r\n      }\r\n    }\r\n    let subtitleChunk = __privateMethod(this, _createInternalChunk, createInternalChunk_fn).call(this, chunk.body, \"key\", timestamp ?? chunk.timestamp, SUBTITLE_TRACK_NUMBER, chunk.duration, chunk.additions);\r\n    __privateSet(this, _lastSubtitleTimestamp, subtitleChunk.timestamp);\r\n    __privateGet(this, _subtitleChunkQueue).push(subtitleChunk);\r\n    __privateMethod(this, _writeSubtitleChunks, writeSubtitleChunks_fn).call(this);\r\n    __privateMethod(this, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn).call(this);\r\n  }\r\n  finalize() {\r\n    if (__privateGet(this, _finalized)) {\r\n      throw new Error(\"Cannot finalize a muxer more than once.\");\r\n    }\r\n    while (__privateGet(this, _videoChunkQueue).length > 0)\r\n      __privateMethod(this, _writeBlock, writeBlock_fn).call(this, __privateGet(this, _videoChunkQueue).shift(), true);\r\n    while (__privateGet(this, _audioChunkQueue).length > 0)\r\n      __privateMethod(this, _writeBlock, writeBlock_fn).call(this, __privateGet(this, _audioChunkQueue).shift(), true);\r\n    while (__privateGet(this, _subtitleChunkQueue).length > 0 && __privateGet(this, _subtitleChunkQueue)[0].timestamp <= __privateGet(this, _duration)) {\r\n      __privateMethod(this, _writeBlock, writeBlock_fn).call(this, __privateGet(this, _subtitleChunkQueue).shift(), false);\r\n    }\r\n    if (__privateGet(this, _currentCluster)) {\r\n      __privateMethod(this, _finalizeCurrentCluster, finalizeCurrentCluster_fn).call(this);\r\n    }\r\n    __privateGet(this, _writer).writeEBML(__privateGet(this, _cues));\r\n    if (!__privateGet(this, _options).streaming) {\r\n      let endPos = __privateGet(this, _writer).pos;\r\n      let segmentSize = __privateGet(this, _writer).pos - __privateGet(this, _segmentDataOffset, segmentDataOffset_get);\r\n      __privateGet(this, _writer).seek(__privateGet(this, _writer).offsets.get(__privateGet(this, _segment)) + 4);\r\n      __privateGet(this, _writer).writeEBMLVarInt(segmentSize, SEGMENT_SIZE_BYTES);\r\n      __privateGet(this, _segmentDuration).data = new EBMLFloat64(__privateGet(this, _duration));\r\n      __privateGet(this, _writer).seek(__privateGet(this, _writer).offsets.get(__privateGet(this, _segmentDuration)));\r\n      __privateGet(this, _writer).writeEBML(__privateGet(this, _segmentDuration));\r\n      __privateGet(this, _seekHead).data[0].data[1].data = __privateGet(this, _writer).offsets.get(__privateGet(this, _cues)) - __privateGet(this, _segmentDataOffset, segmentDataOffset_get);\r\n      __privateGet(this, _seekHead).data[1].data[1].data = __privateGet(this, _writer).offsets.get(__privateGet(this, _segmentInfo)) - __privateGet(this, _segmentDataOffset, segmentDataOffset_get);\r\n      __privateGet(this, _seekHead).data[2].data[1].data = __privateGet(this, _writer).offsets.get(__privateGet(this, _tracksElement)) - __privateGet(this, _segmentDataOffset, segmentDataOffset_get);\r\n      __privateGet(this, _writer).seek(__privateGet(this, _writer).offsets.get(__privateGet(this, _seekHead)));\r\n      __privateGet(this, _writer).writeEBML(__privateGet(this, _seekHead));\r\n      __privateGet(this, _writer).seek(endPos);\r\n    }\r\n    __privateMethod(this, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn).call(this);\r\n    __privateGet(this, _writer).finalize();\r\n    __privateSet(this, _finalized, true);\r\n  }\r\n};\r\n_options = new WeakMap();\r\n_writer = new WeakMap();\r\n_segment = new WeakMap();\r\n_segmentInfo = new WeakMap();\r\n_seekHead = new WeakMap();\r\n_tracksElement = new WeakMap();\r\n_segmentDuration = new WeakMap();\r\n_colourElement = new WeakMap();\r\n_videoCodecPrivate = new WeakMap();\r\n_audioCodecPrivate = new WeakMap();\r\n_subtitleCodecPrivate = new WeakMap();\r\n_cues = new WeakMap();\r\n_currentCluster = new WeakMap();\r\n_currentClusterTimestamp = new WeakMap();\r\n_duration = new WeakMap();\r\n_videoChunkQueue = new WeakMap();\r\n_audioChunkQueue = new WeakMap();\r\n_subtitleChunkQueue = new WeakMap();\r\n_firstVideoTimestamp = new WeakMap();\r\n_firstAudioTimestamp = new WeakMap();\r\n_lastVideoTimestamp = new WeakMap();\r\n_lastAudioTimestamp = new WeakMap();\r\n_lastSubtitleTimestamp = new WeakMap();\r\n_colorSpace = new WeakMap();\r\n_finalized = new WeakMap();\r\n_validateOptions = new WeakSet();\r\nvalidateOptions_fn = function(options) {\r\n  if (typeof options !== \"object\") {\r\n    throw new TypeError(\"The muxer requires an options object to be passed to its constructor.\");\r\n  }\r\n  if (!(options.target instanceof Target)) {\r\n    throw new TypeError(\"The target must be provided and an instance of Target.\");\r\n  }\r\n  if (options.video) {\r\n    if (typeof options.video.codec !== \"string\") {\r\n      throw new TypeError(`Invalid video codec: ${options.video.codec}. Must be a string.`);\r\n    }\r\n    if (!Number.isInteger(options.video.width) || options.video.width <= 0) {\r\n      throw new TypeError(`Invalid video width: ${options.video.width}. Must be a positive integer.`);\r\n    }\r\n    if (!Number.isInteger(options.video.height) || options.video.height <= 0) {\r\n      throw new TypeError(`Invalid video height: ${options.video.height}. Must be a positive integer.`);\r\n    }\r\n    if (options.video.frameRate !== void 0) {\r\n      if (!Number.isFinite(options.video.frameRate) || options.video.frameRate <= 0) {\r\n        throw new TypeError(\r\n          `Invalid video frame rate: ${options.video.frameRate}. Must be a positive number.`\r\n        );\r\n      }\r\n    }\r\n    if (options.video.alpha !== void 0 && typeof options.video.alpha !== \"boolean\") {\r\n      throw new TypeError(`Invalid video alpha: ${options.video.alpha}. Must be a boolean.`);\r\n    }\r\n  }\r\n  if (options.audio) {\r\n    if (typeof options.audio.codec !== \"string\") {\r\n      throw new TypeError(`Invalid audio codec: ${options.audio.codec}. Must be a string.`);\r\n    }\r\n    if (!Number.isInteger(options.audio.numberOfChannels) || options.audio.numberOfChannels <= 0) {\r\n      throw new TypeError(\r\n        `Invalid number of audio channels: ${options.audio.numberOfChannels}. Must be a positive integer.`\r\n      );\r\n    }\r\n    if (!Number.isInteger(options.audio.sampleRate) || options.audio.sampleRate <= 0) {\r\n      throw new TypeError(\r\n        `Invalid audio sample rate: ${options.audio.sampleRate}. Must be a positive integer.`\r\n      );\r\n    }\r\n    if (options.audio.bitDepth !== void 0) {\r\n      if (!Number.isInteger(options.audio.bitDepth) || options.audio.bitDepth <= 0) {\r\n        throw new TypeError(\r\n          `Invalid audio bit depth: ${options.audio.bitDepth}. Must be a positive integer.`\r\n        );\r\n      }\r\n    }\r\n  }\r\n  if (options.subtitles) {\r\n    if (typeof options.subtitles.codec !== \"string\") {\r\n      throw new TypeError(`Invalid subtitles codec: ${options.subtitles.codec}. Must be a string.`);\r\n    }\r\n  }\r\n  if (options.type !== void 0 && ![\"webm\", \"matroska\"].includes(options.type)) {\r\n    throw new TypeError(`Invalid type: ${options.type}. Must be 'webm' or 'matroska'.`);\r\n  }\r\n  if (options.firstTimestampBehavior && !FIRST_TIMESTAMP_BEHAVIORS.includes(options.firstTimestampBehavior)) {\r\n    throw new TypeError(`Invalid first timestamp behavior: ${options.firstTimestampBehavior}`);\r\n  }\r\n  if (options.streaming !== void 0 && typeof options.streaming !== \"boolean\") {\r\n    throw new TypeError(`Invalid streaming option: ${options.streaming}. Must be a boolean.`);\r\n  }\r\n};\r\n_createFileHeader = new WeakSet();\r\ncreateFileHeader_fn = function() {\r\n  if (__privateGet(this, _writer) instanceof BaseStreamTargetWriter && __privateGet(this, _writer).target.options.onHeader) {\r\n    __privateGet(this, _writer).startTrackingWrites();\r\n  }\r\n  __privateMethod(this, _writeEBMLHeader, writeEBMLHeader_fn).call(this);\r\n  if (!__privateGet(this, _options).streaming) {\r\n    __privateMethod(this, _createSeekHead, createSeekHead_fn).call(this);\r\n  }\r\n  __privateMethod(this, _createSegmentInfo, createSegmentInfo_fn).call(this);\r\n  __privateMethod(this, _createCodecPrivatePlaceholders, createCodecPrivatePlaceholders_fn).call(this);\r\n  __privateMethod(this, _createColourElement, createColourElement_fn).call(this);\r\n  if (!__privateGet(this, _options).streaming) {\r\n    __privateMethod(this, _createTracks, createTracks_fn).call(this);\r\n    __privateMethod(this, _createSegment, createSegment_fn).call(this);\r\n  } else {\r\n  }\r\n  __privateMethod(this, _createCues, createCues_fn).call(this);\r\n  __privateMethod(this, _maybeFlushStreamingTargetWriter, maybeFlushStreamingTargetWriter_fn).call(this);\r\n};\r\n_writeEBMLHeader = new WeakSet();\r\nwriteEBMLHeader_fn = function() {\r\n  let ebmlHeader = { id: 440786851 /* EBML */, data: [\r\n    { id: 17030 /* EBMLVersion */, data: 1 },\r\n    { id: 17143 /* EBMLReadVersion */, data: 1 },\r\n    { id: 17138 /* EBMLMaxIDLength */, data: 4 },\r\n    { id: 17139 /* EBMLMaxSizeLength */, data: 8 },\r\n    { id: 17026 /* DocType */, data: __privateGet(this, _options).type ?? \"webm\" },\r\n    { id: 17031 /* DocTypeVersion */, data: 2 },\r\n    { id: 17029 /* DocTypeReadVersion */, data: 2 }\r\n  ] };\r\n  __privateGet(this, _writer).writeEBML(ebmlHeader);\r\n};\r\n_createCodecPrivatePlaceholders = new WeakSet();\r\ncreateCodecPrivatePlaceholders_fn = function() {\r\n  __privateSet(this, _videoCodecPrivate, { id: 236 /* Void */, size: 4, data: new Uint8Array(CODEC_PRIVATE_MAX_SIZE) });\r\n  __privateSet(this, _audioCodecPrivate, { id: 236 /* Void */, size: 4, data: new Uint8Array(CODEC_PRIVATE_MAX_SIZE) });\r\n  __privateSet(this, _subtitleCodecPrivate, { id: 236 /* Void */, size: 4, data: new Uint8Array(CODEC_PRIVATE_MAX_SIZE) });\r\n};\r\n_createColourElement = new WeakSet();\r\ncreateColourElement_fn = function() {\r\n  __privateSet(this, _colourElement, { id: 21936 /* Colour */, data: [\r\n    { id: 21937 /* MatrixCoefficients */, data: 2 },\r\n    { id: 21946 /* TransferCharacteristics */, data: 2 },\r\n    { id: 21947 /* Primaries */, data: 2 },\r\n    { id: 21945 /* Range */, data: 0 }\r\n  ] });\r\n};\r\n_createSeekHead = new WeakSet();\r\ncreateSeekHead_fn = function() {\r\n  const kaxCues = new Uint8Array([28, 83, 187, 107]);\r\n  const kaxInfo = new Uint8Array([21, 73, 169, 102]);\r\n  const kaxTracks = new Uint8Array([22, 84, 174, 107]);\r\n  let seekHead = { id: 290298740 /* SeekHead */, data: [\r\n    { id: 19899 /* Seek */, data: [\r\n      { id: 21419 /* SeekID */, data: kaxCues },\r\n      { id: 21420 /* SeekPosition */, size: 5, data: 0 }\r\n    ] },\r\n    { id: 19899 /* Seek */, data: [\r\n      { id: 21419 /* SeekID */, data: kaxInfo },\r\n      { id: 21420 /* SeekPosition */, size: 5, data: 0 }\r\n    ] },\r\n    { id: 19899 /* Seek */, data: [\r\n      { id: 21419 /* SeekID */, data: kaxTracks },\r\n      { id: 21420 /* SeekPosition */, size: 5, data: 0 }\r\n    ] }\r\n  ] };\r\n  __privateSet(this, _seekHead, seekHead);\r\n};\r\n_createSegmentInfo = new WeakSet();\r\ncreateSegmentInfo_fn = function() {\r\n  let segmentDuration = { id: 17545 /* Duration */, data: new EBMLFloat64(0) };\r\n  __privateSet(this, _segmentDuration, segmentDuration);\r\n  let segmentInfo = { id: 357149030 /* Info */, data: [\r\n    { id: 2807729 /* TimestampScale */, data: 1e6 },\r\n    { id: 19840 /* MuxingApp */, data: APP_NAME },\r\n    { id: 22337 /* WritingApp */, data: APP_NAME },\r\n    !__privateGet(this, _options).streaming ? segmentDuration : null\r\n  ] };\r\n  __privateSet(this, _segmentInfo, segmentInfo);\r\n};\r\n_createTracks = new WeakSet();\r\ncreateTracks_fn = function() {\r\n  let tracksElement = { id: 374648427 /* Tracks */, data: [] };\r\n  __privateSet(this, _tracksElement, tracksElement);\r\n  if (__privateGet(this, _options).video) {\r\n    tracksElement.data.push({ id: 174 /* TrackEntry */, data: [\r\n      { id: 215 /* TrackNumber */, data: VIDEO_TRACK_NUMBER },\r\n      { id: 29637 /* TrackUID */, data: VIDEO_TRACK_NUMBER },\r\n      { id: 131 /* TrackType */, data: VIDEO_TRACK_TYPE },\r\n      { id: 134 /* CodecID */, data: __privateGet(this, _options).video.codec },\r\n      __privateGet(this, _videoCodecPrivate),\r\n      __privateGet(this, _options).video.frameRate ? { id: 2352003 /* DefaultDuration */, data: 1e9 / __privateGet(this, _options).video.frameRate } : null,\r\n      { id: 224 /* Video */, data: [\r\n        { id: 176 /* PixelWidth */, data: __privateGet(this, _options).video.width },\r\n        { id: 186 /* PixelHeight */, data: __privateGet(this, _options).video.height },\r\n        __privateGet(this, _options).video.alpha ? { id: 21440 /* AlphaMode */, data: 1 } : null,\r\n        __privateGet(this, _colourElement)\r\n      ] }\r\n    ] });\r\n  }\r\n  if (__privateGet(this, _options).audio) {\r\n    __privateSet(this, _audioCodecPrivate, __privateGet(this, _options).streaming ? __privateGet(this, _audioCodecPrivate) || null : { id: 236 /* Void */, size: 4, data: new Uint8Array(CODEC_PRIVATE_MAX_SIZE) });\r\n    tracksElement.data.push({ id: 174 /* TrackEntry */, data: [\r\n      { id: 215 /* TrackNumber */, data: AUDIO_TRACK_NUMBER },\r\n      { id: 29637 /* TrackUID */, data: AUDIO_TRACK_NUMBER },\r\n      { id: 131 /* TrackType */, data: AUDIO_TRACK_TYPE },\r\n      { id: 134 /* CodecID */, data: __privateGet(this, _options).audio.codec },\r\n      __privateGet(this, _audioCodecPrivate),\r\n      { id: 225 /* Audio */, data: [\r\n        { id: 181 /* SamplingFrequency */, data: new EBMLFloat32(__privateGet(this, _options).audio.sampleRate) },\r\n        { id: 159 /* Channels */, data: __privateGet(this, _options).audio.numberOfChannels },\r\n        __privateGet(this, _options).audio.bitDepth ? { id: 25188 /* BitDepth */, data: __privateGet(this, _options).audio.bitDepth } : null\r\n      ] }\r\n    ] });\r\n  }\r\n  if (__privateGet(this, _options).subtitles) {\r\n    tracksElement.data.push({ id: 174 /* TrackEntry */, data: [\r\n      { id: 215 /* TrackNumber */, data: SUBTITLE_TRACK_NUMBER },\r\n      { id: 29637 /* TrackUID */, data: SUBTITLE_TRACK_NUMBER },\r\n      { id: 131 /* TrackType */, data: SUBTITLE_TRACK_TYPE },\r\n      { id: 134 /* CodecID */, data: __privateGet(this, _options).subtitles.codec },\r\n      __privateGet(this, _subtitleCodecPrivate)\r\n    ] });\r\n  }\r\n};\r\n_createSegment = new WeakSet();\r\ncreateSegment_fn = function() {\r\n  let segment = {\r\n    id: 408125543 /* Segment */,\r\n    size: __privateGet(this, _options).streaming ? -1 : SEGMENT_SIZE_BYTES,\r\n    data: [\r\n      !__privateGet(this, _options).streaming ? __privateGet(this, _seekHead) : null,\r\n      __privateGet(this, _segmentInfo),\r\n      __privateGet(this, _tracksElement)\r\n    ]\r\n  };\r\n  __privateSet(this, _segment, segment);\r\n  __privateGet(this, _writer).writeEBML(segment);\r\n  if (__privateGet(this, _writer) instanceof BaseStreamTargetWriter && __privateGet(this, _writer).target.options.onHeader) {\r\n    let { data, start } = __privateGet(this, _writer).getTrackedWrites();\r\n    __privateGet(this, _writer).target.options.onHeader(data, start);\r\n  }\r\n};\r\n_createCues = new WeakSet();\r\ncreateCues_fn = function() {\r\n  __privateSet(this, _cues, { id: 475249515 /* Cues */, data: [] });\r\n};\r\n_maybeFlushStreamingTargetWriter = new WeakSet();\r\nmaybeFlushStreamingTargetWriter_fn = function() {\r\n  if (__privateGet(this, _writer) instanceof StreamTargetWriter) {\r\n    __privateGet(this, _writer).flush();\r\n  }\r\n};\r\n_segmentDataOffset = new WeakSet();\r\nsegmentDataOffset_get = function() {\r\n  return __privateGet(this, _writer).dataOffsets.get(__privateGet(this, _segment));\r\n};\r\n_writeVideoDecoderConfig = new WeakSet();\r\nwriteVideoDecoderConfig_fn = function(meta) {\r\n  if (!meta.decoderConfig)\r\n    return;\r\n  if (meta.decoderConfig.colorSpace) {\r\n    let colorSpace = meta.decoderConfig.colorSpace;\r\n    __privateSet(this, _colorSpace, colorSpace);\r\n    __privateGet(this, _colourElement).data = [\r\n      { id: 21937 /* MatrixCoefficients */, data: {\r\n        \"rgb\": 1,\r\n        \"bt709\": 1,\r\n        \"bt470bg\": 5,\r\n        \"smpte170m\": 6\r\n      }[colorSpace.matrix] },\r\n      { id: 21946 /* TransferCharacteristics */, data: {\r\n        \"bt709\": 1,\r\n        \"smpte170m\": 6,\r\n        \"iec61966-2-1\": 13\r\n      }[colorSpace.transfer] },\r\n      { id: 21947 /* Primaries */, data: {\r\n        \"bt709\": 1,\r\n        \"bt470bg\": 5,\r\n        \"smpte170m\": 6\r\n      }[colorSpace.primaries] },\r\n      { id: 21945 /* Range */, data: [1, 2][Number(colorSpace.fullRange)] }\r\n    ];\r\n    if (!__privateGet(this, _options).streaming) {\r\n      let endPos = __privateGet(this, _writer).pos;\r\n      __privateGet(this, _writer).seek(__privateGet(this, _writer).offsets.get(__privateGet(this, _colourElement)));\r\n      __privateGet(this, _writer).writeEBML(__privateGet(this, _colourElement));\r\n      __privateGet(this, _writer).seek(endPos);\r\n    }\r\n  }\r\n  if (meta.decoderConfig.description) {\r\n    if (__privateGet(this, _options).streaming) {\r\n      __privateSet(this, _videoCodecPrivate, __privateMethod(this, _createCodecPrivateElement, createCodecPrivateElement_fn).call(this, meta.decoderConfig.description));\r\n    } else {\r\n      __privateMethod(this, _writeCodecPrivate, writeCodecPrivate_fn).call(this, __privateGet(this, _videoCodecPrivate), meta.decoderConfig.description);\r\n    }\r\n  }\r\n};\r\n_fixVP9ColorSpace = new WeakSet();\r\nfixVP9ColorSpace_fn = function(chunk) {\r\n  if (chunk.type !== \"key\")\r\n    return;\r\n  if (!__privateGet(this, _colorSpace))\r\n    return;\r\n  let i = 0;\r\n  if (readBits(chunk.data, 0, 2) !== 2)\r\n    return;\r\n  i += 2;\r\n  let profile = (readBits(chunk.data, i + 1, i + 2) << 1) + readBits(chunk.data, i + 0, i + 1);\r\n  i += 2;\r\n  if (profile === 3)\r\n    i++;\r\n  let showExistingFrame = readBits(chunk.data, i + 0, i + 1);\r\n  i++;\r\n  if (showExistingFrame)\r\n    return;\r\n  let frameType = readBits(chunk.data, i + 0, i + 1);\r\n  i++;\r\n  if (frameType !== 0)\r\n    return;\r\n  i += 2;\r\n  let syncCode = readBits(chunk.data, i + 0, i + 24);\r\n  i += 24;\r\n  if (syncCode !== 4817730)\r\n    return;\r\n  if (profile >= 2)\r\n    i++;\r\n  let colorSpaceID = {\r\n    \"rgb\": 7,\r\n    \"bt709\": 2,\r\n    \"bt470bg\": 1,\r\n    \"smpte170m\": 3\r\n  }[__privateGet(this, _colorSpace).matrix];\r\n  writeBits(chunk.data, i + 0, i + 3, colorSpaceID);\r\n};\r\n_writeSubtitleChunks = new WeakSet();\r\nwriteSubtitleChunks_fn = function() {\r\n  let lastWrittenMediaTimestamp = Math.min(\r\n    __privateGet(this, _options).video ? __privateGet(this, _lastVideoTimestamp) : Infinity,\r\n    __privateGet(this, _options).audio ? __privateGet(this, _lastAudioTimestamp) : Infinity\r\n  );\r\n  let queue = __privateGet(this, _subtitleChunkQueue);\r\n  while (queue.length > 0 && queue[0].timestamp <= lastWrittenMediaTimestamp) {\r\n    __privateMethod(this, _writeBlock, writeBlock_fn).call(this, queue.shift(), !__privateGet(this, _options).video && !__privateGet(this, _options).audio);\r\n  }\r\n};\r\n_createInternalChunk = new WeakSet();\r\ncreateInternalChunk_fn = function(data, type, timestamp, trackNumber, duration, additions) {\r\n  let adjustedTimestamp = __privateMethod(this, _validateTimestamp, validateTimestamp_fn).call(this, timestamp, trackNumber);\r\n  let internalChunk = {\r\n    data,\r\n    additions,\r\n    type,\r\n    timestamp: adjustedTimestamp,\r\n    duration,\r\n    trackNumber\r\n  };\r\n  return internalChunk;\r\n};\r\n_validateTimestamp = new WeakSet();\r\nvalidateTimestamp_fn = function(timestamp, trackNumber) {\r\n  let lastTimestamp = trackNumber === VIDEO_TRACK_NUMBER ? __privateGet(this, _lastVideoTimestamp) : trackNumber === AUDIO_TRACK_NUMBER ? __privateGet(this, _lastAudioTimestamp) : __privateGet(this, _lastSubtitleTimestamp);\r\n  if (trackNumber !== SUBTITLE_TRACK_NUMBER) {\r\n    let firstTimestamp = trackNumber === VIDEO_TRACK_NUMBER ? __privateGet(this, _firstVideoTimestamp) : __privateGet(this, _firstAudioTimestamp);\r\n    if (__privateGet(this, _options).firstTimestampBehavior === \"strict\" && lastTimestamp === -1 && timestamp !== 0) {\r\n      throw new Error(\r\n        `The first chunk for your media track must have a timestamp of 0 (received ${timestamp}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.\r\n\r\nIf you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.\r\nIf you want to allow non-zero first timestamps, set firstTimestampBehavior: 'permissive'.\r\n`\r\n      );\r\n    } else if (__privateGet(this, _options).firstTimestampBehavior === \"offset\") {\r\n      timestamp -= firstTimestamp;\r\n    }\r\n  }\r\n  if (timestamp < lastTimestamp) {\r\n    throw new Error(\r\n      `Timestamps must be monotonically increasing (went from ${lastTimestamp} to ${timestamp}).`\r\n    );\r\n  }\r\n  if (timestamp < 0) {\r\n    throw new Error(`Timestamps must be non-negative (received ${timestamp}).`);\r\n  }\r\n  return timestamp;\r\n};\r\n_writeBlock = new WeakSet();\r\nwriteBlock_fn = function(chunk, canCreateNewCluster) {\r\n  if (__privateGet(this, _options).streaming && !__privateGet(this, _tracksElement)) {\r\n    __privateMethod(this, _createTracks, createTracks_fn).call(this);\r\n    __privateMethod(this, _createSegment, createSegment_fn).call(this);\r\n  }\r\n  let msTimestamp = Math.floor(chunk.timestamp / 1e3);\r\n  let relativeTimestamp = msTimestamp - __privateGet(this, _currentClusterTimestamp);\r\n  let shouldCreateNewClusterFromKeyFrame = canCreateNewCluster && chunk.type === \"key\" && relativeTimestamp >= 1e3;\r\n  let clusterWouldBeTooLong = relativeTimestamp >= MAX_CHUNK_LENGTH_MS;\r\n  if (!__privateGet(this, _currentCluster) || shouldCreateNewClusterFromKeyFrame || clusterWouldBeTooLong) {\r\n    __privateMethod(this, _createNewCluster, createNewCluster_fn).call(this, msTimestamp);\r\n    relativeTimestamp = 0;\r\n  }\r\n  if (relativeTimestamp < 0) {\r\n    return;\r\n  }\r\n  let prelude = new Uint8Array(4);\r\n  let view = new DataView(prelude.buffer);\r\n  view.setUint8(0, 128 | chunk.trackNumber);\r\n  view.setInt16(1, relativeTimestamp, false);\r\n  if (chunk.duration === void 0 && !chunk.additions) {\r\n    view.setUint8(3, Number(chunk.type === \"key\") << 7);\r\n    let simpleBlock = { id: 163 /* SimpleBlock */, data: [\r\n      prelude,\r\n      chunk.data\r\n    ] };\r\n    __privateGet(this, _writer).writeEBML(simpleBlock);\r\n  } else {\r\n    let msDuration = Math.floor(chunk.duration / 1e3);\r\n    let blockGroup = { id: 160 /* BlockGroup */, data: [\r\n      { id: 161 /* Block */, data: [\r\n        prelude,\r\n        chunk.data\r\n      ] },\r\n      chunk.duration !== void 0 ? { id: 155 /* BlockDuration */, data: msDuration } : null,\r\n      chunk.additions ? { id: 30113 /* BlockAdditions */, data: chunk.additions } : null\r\n    ] };\r\n    __privateGet(this, _writer).writeEBML(blockGroup);\r\n  }\r\n  __privateSet(this, _duration, Math.max(__privateGet(this, _duration), msTimestamp));\r\n};\r\n_createCodecPrivateElement = new WeakSet();\r\ncreateCodecPrivateElement_fn = function(data) {\r\n  return { id: 25506 /* CodecPrivate */, size: 4, data: new Uint8Array(data) };\r\n};\r\n_writeCodecPrivate = new WeakSet();\r\nwriteCodecPrivate_fn = function(element, data) {\r\n  let endPos = __privateGet(this, _writer).pos;\r\n  __privateGet(this, _writer).seek(__privateGet(this, _writer).offsets.get(element));\r\n  let codecPrivateElementSize = 2 + 4 + data.byteLength;\r\n  let voidDataSize = CODEC_PRIVATE_MAX_SIZE - codecPrivateElementSize;\r\n  if (voidDataSize < 0) {\r\n    let newByteLength = data.byteLength + voidDataSize;\r\n    if (data instanceof ArrayBuffer) {\r\n      data = data.slice(0, newByteLength);\r\n    } else {\r\n      data = data.buffer.slice(0, newByteLength);\r\n    }\r\n    voidDataSize = 0;\r\n  }\r\n  element = [\r\n    __privateMethod(this, _createCodecPrivateElement, createCodecPrivateElement_fn).call(this, data),\r\n    { id: 236 /* Void */, size: 4, data: new Uint8Array(voidDataSize) }\r\n  ];\r\n  __privateGet(this, _writer).writeEBML(element);\r\n  __privateGet(this, _writer).seek(endPos);\r\n};\r\n_createNewCluster = new WeakSet();\r\ncreateNewCluster_fn = function(timestamp) {\r\n  if (__privateGet(this, _currentCluster)) {\r\n    __privateMethod(this, _finalizeCurrentCluster, finalizeCurrentCluster_fn).call(this);\r\n  }\r\n  if (__privateGet(this, _writer) instanceof BaseStreamTargetWriter && __privateGet(this, _writer).target.options.onCluster) {\r\n    __privateGet(this, _writer).startTrackingWrites();\r\n  }\r\n  __privateSet(this, _currentCluster, {\r\n    id: 524531317 /* Cluster */,\r\n    size: __privateGet(this, _options).streaming ? -1 : CLUSTER_SIZE_BYTES,\r\n    data: [\r\n      { id: 231 /* Timestamp */, data: timestamp }\r\n    ]\r\n  });\r\n  __privateGet(this, _writer).writeEBML(__privateGet(this, _currentCluster));\r\n  __privateSet(this, _currentClusterTimestamp, timestamp);\r\n  let clusterOffsetFromSegment = __privateGet(this, _writer).offsets.get(__privateGet(this, _currentCluster)) - __privateGet(this, _segmentDataOffset, segmentDataOffset_get);\r\n  __privateGet(this, _cues).data.push({ id: 187 /* CuePoint */, data: [\r\n    { id: 179 /* CueTime */, data: timestamp },\r\n    __privateGet(this, _options).video ? { id: 183 /* CueTrackPositions */, data: [\r\n      { id: 247 /* CueTrack */, data: VIDEO_TRACK_NUMBER },\r\n      { id: 241 /* CueClusterPosition */, data: clusterOffsetFromSegment }\r\n    ] } : null,\r\n    __privateGet(this, _options).audio ? { id: 183 /* CueTrackPositions */, data: [\r\n      { id: 247 /* CueTrack */, data: AUDIO_TRACK_NUMBER },\r\n      { id: 241 /* CueClusterPosition */, data: clusterOffsetFromSegment }\r\n    ] } : null\r\n  ] });\r\n};\r\n_finalizeCurrentCluster = new WeakSet();\r\nfinalizeCurrentCluster_fn = function() {\r\n  if (!__privateGet(this, _options).streaming) {\r\n    let clusterSize = __privateGet(this, _writer).pos - __privateGet(this, _writer).dataOffsets.get(__privateGet(this, _currentCluster));\r\n    let endPos = __privateGet(this, _writer).pos;\r\n    __privateGet(this, _writer).seek(__privateGet(this, _writer).offsets.get(__privateGet(this, _currentCluster)) + 4);\r\n    __privateGet(this, _writer).writeEBMLVarInt(clusterSize, CLUSTER_SIZE_BYTES);\r\n    __privateGet(this, _writer).seek(endPos);\r\n  }\r\n  if (__privateGet(this, _writer) instanceof BaseStreamTargetWriter && __privateGet(this, _writer).target.options.onCluster) {\r\n    let { data, start } = __privateGet(this, _writer).getTrackedWrites();\r\n    __privateGet(this, _writer).target.options.onCluster(data, start, __privateGet(this, _currentClusterTimestamp));\r\n  }\r\n};\r\n_ensureNotFinalized = new WeakSet();\r\nensureNotFinalized_fn = function() {\r\n  if (__privateGet(this, _finalized)) {\r\n    throw new Error(\"Cannot add new video or audio chunks after the file has been finalized.\");\r\n  }\r\n};\r\n\r\n// src/subtitles.ts\r\nvar cueBlockHeaderRegex = /(?:(.+?)\\n)?((?:\\d{2}:)?\\d{2}:\\d{2}.\\d{3})\\s+-->\\s+((?:\\d{2}:)?\\d{2}:\\d{2}.\\d{3})/g;\r\nvar preambleStartRegex = /^WEBVTT.*?\\n{2}/;\r\nvar timestampRegex = /(?:(\\d{2}):)?(\\d{2}):(\\d{2}).(\\d{3})/;\r\nvar inlineTimestampRegex = /<(?:(\\d{2}):)?(\\d{2}):(\\d{2}).(\\d{3})>/g;\r\nvar textEncoder = new TextEncoder();\r\nvar _options2, _config, _preambleSeen, _preambleBytes, _preambleEmitted, _parseTimestamp, parseTimestamp_fn, _formatTimestamp, formatTimestamp_fn;\r\nvar SubtitleEncoder = class {\r\n  constructor(options) {\r\n    __privateAdd(this, _parseTimestamp);\r\n    __privateAdd(this, _formatTimestamp);\r\n    __privateAdd(this, _options2, void 0);\r\n    __privateAdd(this, _config, void 0);\r\n    __privateAdd(this, _preambleSeen, false);\r\n    __privateAdd(this, _preambleBytes, void 0);\r\n    __privateAdd(this, _preambleEmitted, false);\r\n    __privateSet(this, _options2, options);\r\n  }\r\n  configure(config) {\r\n    if (config.codec !== \"webvtt\") {\r\n      throw new Error(\"Codec must be 'webvtt'.\");\r\n    }\r\n    __privateSet(this, _config, config);\r\n  }\r\n  encode(text) {\r\n    if (!__privateGet(this, _config)) {\r\n      throw new Error(\"Encoder not configured.\");\r\n    }\r\n    text = text.replace(\"\\r\\n\", \"\\n\").replace(\"\\r\", \"\\n\");\r\n    cueBlockHeaderRegex.lastIndex = 0;\r\n    let match;\r\n    if (!__privateGet(this, _preambleSeen)) {\r\n      if (!preambleStartRegex.test(text)) {\r\n        let error = new Error(\"WebVTT preamble incorrect.\");\r\n        __privateGet(this, _options2).error(error);\r\n        throw error;\r\n      }\r\n      match = cueBlockHeaderRegex.exec(text);\r\n      let preamble = text.slice(0, match?.index ?? text.length).trimEnd();\r\n      if (!preamble) {\r\n        let error = new Error(\"No WebVTT preamble provided.\");\r\n        __privateGet(this, _options2).error(error);\r\n        throw error;\r\n      }\r\n      __privateSet(this, _preambleBytes, textEncoder.encode(preamble));\r\n      __privateSet(this, _preambleSeen, true);\r\n      if (match) {\r\n        text = text.slice(match.index);\r\n        cueBlockHeaderRegex.lastIndex = 0;\r\n      }\r\n    }\r\n    while (match = cueBlockHeaderRegex.exec(text)) {\r\n      let notes = text.slice(0, match.index);\r\n      let cueIdentifier = match[1] || \"\";\r\n      let matchEnd = match.index + match[0].length;\r\n      let bodyStart = text.indexOf(\"\\n\", matchEnd) + 1;\r\n      let cueSettings = text.slice(matchEnd, bodyStart).trim();\r\n      let bodyEnd = text.indexOf(\"\\n\\n\", matchEnd);\r\n      if (bodyEnd === -1)\r\n        bodyEnd = text.length;\r\n      let startTime = __privateMethod(this, _parseTimestamp, parseTimestamp_fn).call(this, match[2]);\r\n      let endTime = __privateMethod(this, _parseTimestamp, parseTimestamp_fn).call(this, match[3]);\r\n      let duration = endTime - startTime;\r\n      let body = text.slice(bodyStart, bodyEnd);\r\n      let additions = `${cueSettings}\r\n${cueIdentifier}\r\n${notes}`;\r\n      inlineTimestampRegex.lastIndex = 0;\r\n      body = body.replace(inlineTimestampRegex, (match2) => {\r\n        let time = __privateMethod(this, _parseTimestamp, parseTimestamp_fn).call(this, match2.slice(1, -1));\r\n        let offsetTime = time - startTime;\r\n        return `<${__privateMethod(this, _formatTimestamp, formatTimestamp_fn).call(this, offsetTime)}>`;\r\n      });\r\n      text = text.slice(bodyEnd).trimStart();\r\n      cueBlockHeaderRegex.lastIndex = 0;\r\n      let chunk = {\r\n        body: textEncoder.encode(body),\r\n        additions: additions.trim() === \"\" ? void 0 : textEncoder.encode(additions),\r\n        timestamp: startTime * 1e3,\r\n        duration: duration * 1e3\r\n      };\r\n      let meta = {};\r\n      if (!__privateGet(this, _preambleEmitted)) {\r\n        meta.decoderConfig = {\r\n          description: __privateGet(this, _preambleBytes)\r\n        };\r\n        __privateSet(this, _preambleEmitted, true);\r\n      }\r\n      __privateGet(this, _options2).output(chunk, meta);\r\n    }\r\n  }\r\n};\r\n_options2 = new WeakMap();\r\n_config = new WeakMap();\r\n_preambleSeen = new WeakMap();\r\n_preambleBytes = new WeakMap();\r\n_preambleEmitted = new WeakMap();\r\n_parseTimestamp = new WeakSet();\r\nparseTimestamp_fn = function(string) {\r\n  let match = timestampRegex.exec(string);\r\n  if (!match)\r\n    throw new Error(\"Expected match.\");\r\n  return 60 * 60 * 1e3 * Number(match[1] || \"0\") + 60 * 1e3 * Number(match[2]) + 1e3 * Number(match[3]) + Number(match[4]);\r\n};\r\n_formatTimestamp = new WeakSet();\r\nformatTimestamp_fn = function(timestamp) {\r\n  let hours = Math.floor(timestamp / (60 * 60 * 1e3));\r\n  let minutes = Math.floor(timestamp % (60 * 60 * 1e3) / (60 * 1e3));\r\n  let seconds = Math.floor(timestamp % (60 * 1e3) / 1e3);\r\n  let milliseconds = timestamp % 1e3;\r\n  return hours.toString().padStart(2, \"0\") + \":\" + minutes.toString().padStart(2, \"0\") + \":\" + seconds.toString().padStart(2, \"0\") + \".\" + milliseconds.toString().padStart(3, \"0\");\r\n};\r\nexport {\r\n  ArrayBufferTarget,\r\n  FileSystemWritableFileStreamTarget,\r\n  Muxer,\r\n  StreamTarget,\r\n  SubtitleEncoder\r\n};\r\n","// file:src/log.js\r\n/* \r\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nvar Log = (function (){\r\n\t\tvar start = new Date();\r\n\t\tvar LOG_LEVEL_ERROR \t= 4;\r\n\t\tvar LOG_LEVEL_WARNING \t= 3;\r\n\t\tvar LOG_LEVEL_INFO \t\t= 2;\r\n\t\tvar LOG_LEVEL_DEBUG\t\t= 1;\r\n\t\tvar log_level = LOG_LEVEL_ERROR;\r\n\t\tvar logObject = {\r\n\t\t\tsetLogLevel : function(level) {\r\n\t\t\t\tif (level == this.debug) log_level = LOG_LEVEL_DEBUG;\r\n\t\t\t\telse if (level == this.info) log_level = LOG_LEVEL_INFO;\r\n\t\t\t\telse if (level == this.warn) log_level = LOG_LEVEL_WARNING;\r\n\t\t\t\telse if (level == this.error) log_level = LOG_LEVEL_ERROR;\r\n\t\t\t\telse log_level = LOG_LEVEL_ERROR;\r\n\t\t\t},\r\n\t\t\tdebug : function(module, msg) {\r\n\t\t\t\tif (console.debug === undefined) {\r\n\t\t\t\t\tconsole.debug = console.log;\r\n\t\t\t\t}\r\n\t\t\t\tif (LOG_LEVEL_DEBUG >= log_level) {\r\n\t\t\t\t\tconsole.debug(\"[\"+Log.getDurationString(new Date()-start,1000)+\"]\",\"[\"+module+\"]\",msg);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlog : function(module, msg) {\r\n\t\t\t\tthis.debug(module.msg)\r\n\t\t\t},\r\n\t\t\tinfo : function(module, msg) {\r\n\t\t\t\tif (LOG_LEVEL_INFO >= log_level) {\r\n\t\t\t\t\tconsole.info(\"[\"+Log.getDurationString(new Date()-start,1000)+\"]\",\"[\"+module+\"]\",msg);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\twarn : function(module, msg) {\r\n\t\t\t\tif (LOG_LEVEL_WARNING >= log_level) {\r\n\t\t\t\t\tconsole.warn(\"[\"+Log.getDurationString(new Date()-start,1000)+\"]\",\"[\"+module+\"]\",msg);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror : function(module, msg) {\r\n\t\t\t\tif (LOG_LEVEL_ERROR >= log_level) {\r\n\t\t\t\t\tconsole.error(\"[\"+Log.getDurationString(new Date()-start,1000)+\"]\",\"[\"+module+\"]\",msg);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn logObject;\r\n\t})();\r\n\t\r\n/* Helper function to print a duration value in the form H:MM:SS.MS */\r\nLog.getDurationString = function(duration, _timescale) {\r\n\tvar neg;\r\n\t/* Helper function to print a number on a fixed number of digits */\r\n\tfunction pad(number, length) {\r\n\t\tvar str = '' + number;\r\n\t\tvar a = str.split('.');\t\t\r\n\t\twhile (a[0].length < length) {\r\n\t\t\ta[0] = '0' + a[0];\r\n\t\t}\r\n\t\treturn a.join('.');\r\n\t}\r\n\tif (duration < 0) {\r\n\t\tneg = true;\r\n\t\tduration = -duration;\r\n\t} else {\r\n\t\tneg = false;\t\r\n\t}\r\n\tvar timescale = _timescale || 1;\r\n\tvar duration_sec = duration/timescale;\r\n\tvar hours = Math.floor(duration_sec/3600);\r\n\tduration_sec -= hours * 3600;\r\n\tvar minutes = Math.floor(duration_sec/60);\r\n\tduration_sec -= minutes * 60;\t\t\r\n\tvar msec = duration_sec*1000;\r\n\tduration_sec = Math.floor(duration_sec);\r\n\tmsec -= duration_sec*1000;\r\n\tmsec = Math.floor(msec);\r\n\treturn (neg ? \"-\": \"\")+hours+\":\"+pad(minutes,2)+\":\"+pad(duration_sec,2)+\".\"+pad(msec,3);\r\n}\r\n\t\r\n/* Helper function to stringify HTML5 TimeRanges objects */\t\r\nLog.printRanges = function(ranges) {\r\n\tvar length = ranges.length;\r\n\tif (length > 0) {\r\n\t\tvar str = \"\";\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t  if (i > 0) str += \",\";\r\n\t\t  str += \"[\"+Log.getDurationString(ranges.start(i))+ \",\"+Log.getDurationString(ranges.end(i))+\"]\";\r\n\t\t}\r\n\t\treturn str;\r\n\t} else {\r\n\t\treturn \"(empty)\";\r\n\t}\r\n}\r\n\r\nif (typeof exports !== 'undefined') {\r\n\texports.Log = Log;\r\n}\r\n// file:src/stream.js\r\nvar MP4BoxStream = function(arrayBuffer) {\r\n  if (arrayBuffer instanceof ArrayBuffer) {\r\n    this.buffer = arrayBuffer;\r\n    this.dataview = new DataView(arrayBuffer);\r\n  } else {\r\n    throw (\"Needs an array buffer\");\r\n  }\r\n  this.position = 0;\r\n};\r\n\r\n/*************************************************************************\r\n  Common API between MultiBufferStream and SimpleStream\r\n *************************************************************************/\r\nMP4BoxStream.prototype.getPosition = function() {\r\n  return this.position;\r\n}\r\n\r\nMP4BoxStream.prototype.getEndPosition = function() {\r\n  return this.buffer.byteLength;\r\n}\r\n\r\nMP4BoxStream.prototype.getLength = function() {\r\n  return this.buffer.byteLength;\r\n}\r\n\r\nMP4BoxStream.prototype.seek = function (pos) {\r\n  var npos = Math.max(0, Math.min(this.buffer.byteLength, pos));\r\n  this.position = (isNaN(npos) || !isFinite(npos)) ? 0 : npos;\r\n  return true;\r\n}\r\n\r\nMP4BoxStream.prototype.isEos = function () {\r\n  return this.getPosition() >= this.getEndPosition();\r\n}\r\n\r\n/*************************************************************************\r\n  Read methods, simimar to DataStream but simpler\r\n *************************************************************************/\r\nMP4BoxStream.prototype.readAnyInt = function(size, signed) {\r\n  var res = 0;\r\n  if (this.position + size <= this.buffer.byteLength) {\r\n    switch (size) {\r\n      case 1:\r\n        if (signed) {\r\n          res = this.dataview.getInt8(this.position);\r\n        } else {\r\n          res = this.dataview.getUint8(this.position);\r\n        }\r\n        break;\r\n      case 2:\r\n        if (signed) {\r\n          res = this.dataview.getInt16(this.position);\r\n        } else {\r\n          res = this.dataview.getUint16(this.position);\r\n        }\r\n        break;\r\n      case 3:\r\n        if (signed) {\r\n          throw (\"No method for reading signed 24 bits values\");\r\n        } else {\r\n          res = this.dataview.getUint8(this.position) << 16;\r\n          res |= this.dataview.getUint8(this.position+1) << 8;\r\n          res |= this.dataview.getUint8(this.position+2);\r\n        }\r\n        break;\r\n      case 4:\r\n        if (signed) {\r\n          res = this.dataview.getInt32(this.position);\r\n        } else {\r\n          res = this.dataview.getUint32(this.position);\r\n        }\r\n        break;\r\n      case 8:\r\n        if (signed) {\r\n          throw (\"No method for reading signed 64 bits values\");\r\n        } else {\r\n          res = this.dataview.getUint32(this.position) << 32;\r\n          res |= this.dataview.getUint32(this.position+4);\r\n        }\r\n        break;\r\n      default:\r\n        throw (\"readInt method not implemented for size: \"+size);\r\n    }\r\n    this.position+= size;\r\n    return res;\r\n  } else {\r\n    throw (\"Not enough bytes in buffer\");\r\n  }\r\n}\r\n\r\nMP4BoxStream.prototype.readUint8 = function() {\r\n  return this.readAnyInt(1, false);\r\n}\r\n\r\nMP4BoxStream.prototype.readUint16 = function() {\r\n  return this.readAnyInt(2, false);\r\n}\r\n\r\nMP4BoxStream.prototype.readUint24 = function() {\r\n  return this.readAnyInt(3, false);\r\n}\r\n\r\nMP4BoxStream.prototype.readUint32 = function() {\r\n  return this.readAnyInt(4, false);\r\n}\r\n\r\nMP4BoxStream.prototype.readUint64 = function() {\r\n  return this.readAnyInt(8, false);\r\n}\r\n\r\nMP4BoxStream.prototype.readString = function(length) {\r\n  if (this.position + length <= this.buffer.byteLength) {\r\n    var s = \"\";\r\n    for (var i = 0; i < length; i++) {\r\n      s += String.fromCharCode(this.readUint8());\r\n    }\r\n    return s;\r\n  } else {\r\n    throw (\"Not enough bytes in buffer\");\r\n  }\r\n}\r\n\r\nMP4BoxStream.prototype.readCString = function() {\r\n  var arr = [];\r\n  while(true) {\r\n    var b = this.readUint8();\r\n    if (b !== 0) {\r\n      arr.push(b);\r\n    } else {\r\n      break;\r\n    }\r\n  }\r\n  return String.fromCharCode.apply(null, arr); \r\n}\r\n\r\nMP4BoxStream.prototype.readInt8 = function() {\r\n  return this.readAnyInt(1, true);\r\n}\r\n\r\nMP4BoxStream.prototype.readInt16 = function() {\r\n  return this.readAnyInt(2, true);\r\n}\r\n\r\nMP4BoxStream.prototype.readInt32 = function() {\r\n  return this.readAnyInt(4, true);\r\n}\r\n\r\nMP4BoxStream.prototype.readInt64 = function() {\r\n  return this.readAnyInt(8, false);\r\n}\r\n\r\nMP4BoxStream.prototype.readUint8Array = function(length) {\r\n  var arr = new Uint8Array(length);\r\n  for (var i = 0; i < length; i++) {\r\n    arr[i] = this.readUint8();\r\n  }\r\n  return arr;\r\n}\r\n\r\nMP4BoxStream.prototype.readInt16Array = function(length) {\r\n  var arr = new Int16Array(length);\r\n  for (var i = 0; i < length; i++) {\r\n    arr[i] = this.readInt16();\r\n  }\r\n  return arr;\r\n}\r\n\r\nMP4BoxStream.prototype.readUint16Array = function(length) {\r\n  var arr = new Int16Array(length);\r\n  for (var i = 0; i < length; i++) {\r\n    arr[i] = this.readUint16();\r\n  }\r\n  return arr;\r\n}\r\n\r\nMP4BoxStream.prototype.readUint32Array = function(length) {\r\n  var arr = new Uint32Array(length);\r\n  for (var i = 0; i < length; i++) {\r\n    arr[i] = this.readUint32();\r\n  }\r\n  return arr;\r\n}\r\n\r\nMP4BoxStream.prototype.readInt32Array = function(length) {\r\n  var arr = new Int32Array(length);\r\n  for (var i = 0; i < length; i++) {\r\n    arr[i] = this.readInt32();\r\n  }\r\n  return arr;\r\n}\r\n\r\nif (typeof exports !== 'undefined') {\r\n  exports.MP4BoxStream = MP4BoxStream;\r\n}// file:src/DataStream.js\r\n/**\r\n  DataStream reads scalars, arrays and structs of data from an ArrayBuffer.\r\n  It's like a file-like DataView on steroids.\r\n\r\n  @param {ArrayBuffer} arrayBuffer ArrayBuffer to read from.\r\n  @param {?Number} byteOffset Offset from arrayBuffer beginning for the DataStream.\r\n  @param {?Boolean} endianness DataStream.BIG_ENDIAN or DataStream.LITTLE_ENDIAN (the default).\r\n  */\r\nvar DataStream = function(arrayBuffer, byteOffset, endianness) {\r\n  this._byteOffset = byteOffset || 0;\r\n  if (arrayBuffer instanceof ArrayBuffer) {\r\n    this.buffer = arrayBuffer;\r\n  } else if (typeof arrayBuffer == \"object\") {\r\n    this.dataView = arrayBuffer;\r\n    if (byteOffset) {\r\n      this._byteOffset += byteOffset;\r\n    }\r\n  } else {\r\n    this.buffer = new ArrayBuffer(arrayBuffer || 0);\r\n  }\r\n  this.position = 0;\r\n  this.endianness = endianness == null ? DataStream.LITTLE_ENDIAN : endianness;\r\n};\r\nDataStream.prototype = {};\r\n\r\nDataStream.prototype.getPosition = function() {\r\n  return this.position;\r\n}\r\n\r\n/**\r\n  Internal function to resize the DataStream buffer when required.\r\n  @param {number} extra Number of bytes to add to the buffer allocation.\r\n  @return {null}\r\n  */\r\nDataStream.prototype._realloc = function(extra) {\r\n  if (!this._dynamicSize) {\r\n    return;\r\n  }\r\n  var req = this._byteOffset + this.position + extra;\r\n  var blen = this._buffer.byteLength;\r\n  if (req <= blen) {\r\n    if (req > this._byteLength) {\r\n      this._byteLength = req;\r\n    }\r\n    return;\r\n  }\r\n  if (blen < 1) {\r\n    blen = 1;\r\n  }\r\n  while (req > blen) {\r\n    blen *= 2;\r\n  }\r\n  var buf = new ArrayBuffer(blen);\r\n  var src = new Uint8Array(this._buffer);\r\n  var dst = new Uint8Array(buf, 0, src.length);\r\n  dst.set(src);\r\n  this.buffer = buf;\r\n  this._byteLength = req;\r\n};\r\n\r\n/**\r\n  Internal function to trim the DataStream buffer when required.\r\n  Used for stripping out the extra bytes from the backing buffer when\r\n  the virtual byteLength is smaller than the buffer byteLength (happens after\r\n  growing the buffer with writes and not filling the extra space completely).\r\n\r\n  @return {null}\r\n  */\r\nDataStream.prototype._trimAlloc = function() {\r\n  if (this._byteLength == this._buffer.byteLength) {\r\n    return;\r\n  }\r\n  var buf = new ArrayBuffer(this._byteLength);\r\n  var dst = new Uint8Array(buf);\r\n  var src = new Uint8Array(this._buffer, 0, dst.length);\r\n  dst.set(src);\r\n  this.buffer = buf;\r\n};\r\n\r\n\r\n/**\r\n  Big-endian const to use as default endianness.\r\n  @type {boolean}\r\n  */\r\nDataStream.BIG_ENDIAN = false;\r\n\r\n/**\r\n  Little-endian const to use as default endianness.\r\n  @type {boolean}\r\n  */\r\nDataStream.LITTLE_ENDIAN = true;\r\n\r\n/**\r\n  Virtual byte length of the DataStream backing buffer.\r\n  Updated to be max of original buffer size and last written size.\r\n  If dynamicSize is false is set to buffer size.\r\n  @type {number}\r\n  */\r\nDataStream.prototype._byteLength = 0;\r\n\r\n/**\r\n  Returns the byte length of the DataStream object.\r\n  @type {number}\r\n  */\r\nObject.defineProperty(DataStream.prototype, 'byteLength',\r\n  { get: function() {\r\n    return this._byteLength - this._byteOffset;\r\n  }});\r\n\r\n/**\r\n  Set/get the backing ArrayBuffer of the DataStream object.\r\n  The setter updates the DataView to point to the new buffer.\r\n  @type {Object}\r\n  */\r\nObject.defineProperty(DataStream.prototype, 'buffer',\r\n  { get: function() {\r\n      this._trimAlloc();\r\n      return this._buffer;\r\n    },\r\n    set: function(v) {\r\n      this._buffer = v;\r\n      this._dataView = new DataView(this._buffer, this._byteOffset);\r\n      this._byteLength = this._buffer.byteLength;\r\n    } });\r\n\r\n/**\r\n  Set/get the byteOffset of the DataStream object.\r\n  The setter updates the DataView to point to the new byteOffset.\r\n  @type {number}\r\n  */\r\nObject.defineProperty(DataStream.prototype, 'byteOffset',\r\n  { get: function() {\r\n      return this._byteOffset;\r\n    },\r\n    set: function(v) {\r\n      this._byteOffset = v;\r\n      this._dataView = new DataView(this._buffer, this._byteOffset);\r\n      this._byteLength = this._buffer.byteLength;\r\n    } });\r\n\r\n/**\r\n  Set/get the backing DataView of the DataStream object.\r\n  The setter updates the buffer and byteOffset to point to the DataView values.\r\n  @type {Object}\r\n  */\r\nObject.defineProperty(DataStream.prototype, 'dataView',\r\n  { get: function() {\r\n      return this._dataView;\r\n    },\r\n    set: function(v) {\r\n      this._byteOffset = v.byteOffset;\r\n      this._buffer = v.buffer;\r\n      this._dataView = new DataView(this._buffer, this._byteOffset);\r\n      this._byteLength = this._byteOffset + v.byteLength;\r\n    } });\r\n\r\n/**\r\n  Sets the DataStream read/write position to given position.\r\n  Clamps between 0 and DataStream length.\r\n\r\n  @param {number} pos Position to seek to.\r\n  @return {null}\r\n  */\r\nDataStream.prototype.seek = function(pos) {\r\n  var npos = Math.max(0, Math.min(this.byteLength, pos));\r\n  this.position = (isNaN(npos) || !isFinite(npos)) ? 0 : npos;\r\n};\r\n\r\n/**\r\n  Returns true if the DataStream seek pointer is at the end of buffer and\r\n  there's no more data to read.\r\n\r\n  @return {boolean} True if the seek pointer is at the end of the buffer.\r\n  */\r\nDataStream.prototype.isEof = function() {\r\n  return (this.position >= this._byteLength);\r\n};\r\n\r\n\r\n/**\r\n  Maps a Uint8Array into the DataStream buffer.\r\n\r\n  Nice for quickly reading in data.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} Uint8Array to the DataStream backing buffer.\r\n  */\r\nDataStream.prototype.mapUint8Array = function(length) {\r\n  this._realloc(length * 1);\r\n  var arr = new Uint8Array(this._buffer, this.byteOffset+this.position, length);\r\n  this.position += length * 1;\r\n  return arr;\r\n};\r\n\r\n\r\n/**\r\n  Reads an Int32Array of desired length and endianness from the DataStream.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} The read Int32Array.\r\n */\r\nDataStream.prototype.readInt32Array = function(length, e) {\r\n  length = length == null ? (this.byteLength-this.position / 4) : length;\r\n  var arr = new Int32Array(length);\r\n  DataStream.memcpy(arr.buffer, 0,\r\n                    this.buffer, this.byteOffset+this.position,\r\n                    length*arr.BYTES_PER_ELEMENT);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += arr.byteLength;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Reads an Int16Array of desired length and endianness from the DataStream.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} The read Int16Array.\r\n */\r\nDataStream.prototype.readInt16Array = function(length, e) {\r\n  length = length == null ? (this.byteLength-this.position / 2) : length;\r\n  var arr = new Int16Array(length);\r\n  DataStream.memcpy(arr.buffer, 0,\r\n                    this.buffer, this.byteOffset+this.position,\r\n                    length*arr.BYTES_PER_ELEMENT);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += arr.byteLength;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Reads an Int8Array of desired length from the DataStream.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} The read Int8Array.\r\n */\r\nDataStream.prototype.readInt8Array = function(length) {\r\n  length = length == null ? (this.byteLength-this.position) : length;\r\n  var arr = new Int8Array(length);\r\n  DataStream.memcpy(arr.buffer, 0,\r\n                    this.buffer, this.byteOffset+this.position,\r\n                    length*arr.BYTES_PER_ELEMENT);\r\n  this.position += arr.byteLength;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Reads a Uint32Array of desired length and endianness from the DataStream.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} The read Uint32Array.\r\n */\r\nDataStream.prototype.readUint32Array = function(length, e) {\r\n  length = length == null ? (this.byteLength-this.position / 4) : length;\r\n  var arr = new Uint32Array(length);\r\n  DataStream.memcpy(arr.buffer, 0,\r\n                    this.buffer, this.byteOffset+this.position,\r\n                    length*arr.BYTES_PER_ELEMENT);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += arr.byteLength;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Reads a Uint16Array of desired length and endianness from the DataStream.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} The read Uint16Array.\r\n */\r\nDataStream.prototype.readUint16Array = function(length, e) {\r\n  length = length == null ? (this.byteLength-this.position / 2) : length;\r\n  var arr = new Uint16Array(length);\r\n  DataStream.memcpy(arr.buffer, 0,\r\n                    this.buffer, this.byteOffset+this.position,\r\n                    length*arr.BYTES_PER_ELEMENT);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += arr.byteLength;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Reads a Uint8Array of desired length from the DataStream.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} The read Uint8Array.\r\n */\r\nDataStream.prototype.readUint8Array = function(length) {\r\n  length = length == null ? (this.byteLength-this.position) : length;\r\n  var arr = new Uint8Array(length);\r\n  DataStream.memcpy(arr.buffer, 0,\r\n                    this.buffer, this.byteOffset+this.position,\r\n                    length*arr.BYTES_PER_ELEMENT);\r\n  this.position += arr.byteLength;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Reads a Float64Array of desired length and endianness from the DataStream.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} The read Float64Array.\r\n */\r\nDataStream.prototype.readFloat64Array = function(length, e) {\r\n  length = length == null ? (this.byteLength-this.position / 8) : length;\r\n  var arr = new Float64Array(length);\r\n  DataStream.memcpy(arr.buffer, 0,\r\n                    this.buffer, this.byteOffset+this.position,\r\n                    length*arr.BYTES_PER_ELEMENT);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += arr.byteLength;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Reads a Float32Array of desired length and endianness from the DataStream.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} The read Float32Array.\r\n */\r\nDataStream.prototype.readFloat32Array = function(length, e) {\r\n  length = length == null ? (this.byteLength-this.position / 4) : length;\r\n  var arr = new Float32Array(length);\r\n  DataStream.memcpy(arr.buffer, 0,\r\n                    this.buffer, this.byteOffset+this.position,\r\n                    length*arr.BYTES_PER_ELEMENT);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += arr.byteLength;\r\n  return arr;\r\n};\r\n\r\n\r\n/**\r\n  Reads a 32-bit int from the DataStream with the desired endianness.\r\n\r\n  @param {?boolean} e Endianness of the number.\r\n  @return {number} The read number.\r\n */\r\nDataStream.prototype.readInt32 = function(e) {\r\n  var v = this._dataView.getInt32(this.position, e == null ? this.endianness : e);\r\n  this.position += 4;\r\n  return v;\r\n};\r\n\r\n/**\r\n  Reads a 16-bit int from the DataStream with the desired endianness.\r\n\r\n  @param {?boolean} e Endianness of the number.\r\n  @return {number} The read number.\r\n */\r\nDataStream.prototype.readInt16 = function(e) {\r\n  var v = this._dataView.getInt16(this.position, e == null ? this.endianness : e);\r\n  this.position += 2;\r\n  return v;\r\n};\r\n\r\n/**\r\n  Reads an 8-bit int from the DataStream.\r\n\r\n  @return {number} The read number.\r\n */\r\nDataStream.prototype.readInt8 = function() {\r\n  var v = this._dataView.getInt8(this.position);\r\n  this.position += 1;\r\n  return v;\r\n};\r\n\r\n/**\r\n  Reads a 32-bit unsigned int from the DataStream with the desired endianness.\r\n\r\n  @param {?boolean} e Endianness of the number.\r\n  @return {number} The read number.\r\n */\r\nDataStream.prototype.readUint32 = function(e) {\r\n  var v = this._dataView.getUint32(this.position, e == null ? this.endianness : e);\r\n  this.position += 4;\r\n  return v;\r\n};\r\n\r\n/**\r\n  Reads a 16-bit unsigned int from the DataStream with the desired endianness.\r\n\r\n  @param {?boolean} e Endianness of the number.\r\n  @return {number} The read number.\r\n */\r\nDataStream.prototype.readUint16 = function(e) {\r\n  var v = this._dataView.getUint16(this.position, e == null ? this.endianness : e);\r\n  this.position += 2;\r\n  return v;\r\n};\r\n\r\n/**\r\n  Reads an 8-bit unsigned int from the DataStream.\r\n\r\n  @return {number} The read number.\r\n */\r\nDataStream.prototype.readUint8 = function() {\r\n  var v = this._dataView.getUint8(this.position);\r\n  this.position += 1;\r\n  return v;\r\n};\r\n\r\n/**\r\n  Reads a 32-bit float from the DataStream with the desired endianness.\r\n\r\n  @param {?boolean} e Endianness of the number.\r\n  @return {number} The read number.\r\n */\r\nDataStream.prototype.readFloat32 = function(e) {\r\n  var v = this._dataView.getFloat32(this.position, e == null ? this.endianness : e);\r\n  this.position += 4;\r\n  return v;\r\n};\r\n\r\n/**\r\n  Reads a 64-bit float from the DataStream with the desired endianness.\r\n\r\n  @param {?boolean} e Endianness of the number.\r\n  @return {number} The read number.\r\n */\r\nDataStream.prototype.readFloat64 = function(e) {\r\n  var v = this._dataView.getFloat64(this.position, e == null ? this.endianness : e);\r\n  this.position += 8;\r\n  return v;\r\n};\r\n\r\n/**\r\n  Native endianness. Either DataStream.BIG_ENDIAN or DataStream.LITTLE_ENDIAN\r\n  depending on the platform endianness.\r\n\r\n  @type {boolean}\r\n */\r\nDataStream.endianness = new Int8Array(new Int16Array([1]).buffer)[0] > 0;\r\n\r\n/**\r\n  Copies byteLength bytes from the src buffer at srcOffset to the\r\n  dst buffer at dstOffset.\r\n\r\n  @param {Object} dst Destination ArrayBuffer to write to.\r\n  @param {number} dstOffset Offset to the destination ArrayBuffer.\r\n  @param {Object} src Source ArrayBuffer to read from.\r\n  @param {number} srcOffset Offset to the source ArrayBuffer.\r\n  @param {number} byteLength Number of bytes to copy.\r\n */\r\nDataStream.memcpy = function(dst, dstOffset, src, srcOffset, byteLength) {\r\n  var dstU8 = new Uint8Array(dst, dstOffset, byteLength);\r\n  var srcU8 = new Uint8Array(src, srcOffset, byteLength);\r\n  dstU8.set(srcU8);\r\n};\r\n\r\n/**\r\n  Converts array to native endianness in-place.\r\n\r\n  @param {Object} array Typed array to convert.\r\n  @param {boolean} arrayIsLittleEndian True if the data in the array is\r\n                                       little-endian. Set false for big-endian.\r\n  @return {Object} The converted typed array.\r\n */\r\nDataStream.arrayToNative = function(array, arrayIsLittleEndian) {\r\n  if (arrayIsLittleEndian == this.endianness) {\r\n    return array;\r\n  } else {\r\n    return this.flipArrayEndianness(array);\r\n  }\r\n};\r\n\r\n/**\r\n  Converts native endianness array to desired endianness in-place.\r\n\r\n  @param {Object} array Typed array to convert.\r\n  @param {boolean} littleEndian True if the converted array should be\r\n                                little-endian. Set false for big-endian.\r\n  @return {Object} The converted typed array.\r\n */\r\nDataStream.nativeToEndian = function(array, littleEndian) {\r\n  if (this.endianness == littleEndian) {\r\n    return array;\r\n  } else {\r\n    return this.flipArrayEndianness(array);\r\n  }\r\n};\r\n\r\n/**\r\n  Flips typed array endianness in-place.\r\n\r\n  @param {Object} array Typed array to flip.\r\n  @return {Object} The converted typed array.\r\n */\r\nDataStream.flipArrayEndianness = function(array) {\r\n  var u8 = new Uint8Array(array.buffer, array.byteOffset, array.byteLength);\r\n  for (var i=0; i<array.byteLength; i+=array.BYTES_PER_ELEMENT) {\r\n    for (var j=i+array.BYTES_PER_ELEMENT-1, k=i; j>k; j--, k++) {\r\n      var tmp = u8[k];\r\n      u8[k] = u8[j];\r\n      u8[j] = tmp;\r\n    }\r\n  }\r\n  return array;\r\n};\r\n\r\n/**\r\n  Seek position where DataStream#readStruct ran into a problem.\r\n  Useful for debugging struct parsing.\r\n\r\n  @type {number}\r\n */\r\nDataStream.prototype.failurePosition = 0;\r\n\r\nString.fromCharCodeUint8 = function(uint8arr) {\r\n    var arr = [];\r\n    for (var i = 0; i < uint8arr.length; i++) {\r\n      arr[i] = uint8arr[i];\r\n    }\r\n    return String.fromCharCode.apply(null, arr);\r\n}\r\n/**\r\n  Read a string of desired length and encoding from the DataStream.\r\n\r\n  @param {number} length The length of the string to read in bytes.\r\n  @param {?string} encoding The encoding of the string data in the DataStream.\r\n                            Defaults to ASCII.\r\n  @return {string} The read string.\r\n */\r\nDataStream.prototype.readString = function(length, encoding) {\r\n  if (encoding == null || encoding == \"ASCII\") {\r\n    return String.fromCharCodeUint8.apply(null, [this.mapUint8Array(length == null ? this.byteLength-this.position : length)]);\r\n  } else {\r\n    return (new TextDecoder(encoding)).decode(this.mapUint8Array(length));\r\n  }\r\n};\r\n\r\n/**\r\n  Read null-terminated string of desired length from the DataStream. Truncates\r\n  the returned string so that the null byte is not a part of it.\r\n\r\n  @param {?number} length The length of the string to read.\r\n  @return {string} The read string.\r\n */\r\nDataStream.prototype.readCString = function(length) {\r\n  var blen = this.byteLength-this.position;\r\n  var u8 = new Uint8Array(this._buffer, this._byteOffset + this.position);\r\n  var len = blen;\r\n  if (length != null) {\r\n    len = Math.min(length, blen);\r\n  }\r\n  for (var i = 0; i < len && u8[i] !== 0; i++); // find first zero byte\r\n  var s = String.fromCharCodeUint8.apply(null, [this.mapUint8Array(i)]);\r\n  if (length != null) {\r\n    this.position += len-i;\r\n  } else if (i != blen) {\r\n    this.position += 1; // trailing zero if not at end of buffer\r\n  }\r\n  return s;\r\n};\r\n\r\n/* \r\n   TODO: fix endianness for 24/64-bit fields\r\n   TODO: check range/support for 64-bits numbers in JavaScript\r\n*/\r\nvar MAX_SIZE = Math.pow(2, 32);\r\n\r\nDataStream.prototype.readInt64 = function () {\r\n  return (this.readInt32()*MAX_SIZE)+this.readUint32();\r\n}\r\nDataStream.prototype.readUint64 = function () {\r\n\treturn (this.readUint32()*MAX_SIZE)+this.readUint32();\r\n}\r\n\r\nDataStream.prototype.readInt64 = function () {\r\n  return (this.readUint32()*MAX_SIZE)+this.readUint32();\r\n}\r\n\r\nDataStream.prototype.readUint24 = function () {\r\n\treturn (this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8();\r\n}\r\n\r\nif (typeof exports !== 'undefined') {\r\n  exports.DataStream = DataStream;  \r\n}\r\n// file:src/DataStream-write.js\r\n/**\r\n  Saves the DataStream contents to the given filename.\r\n  Uses Chrome's anchor download property to initiate download.\r\n \r\n  @param {string} filename Filename to save as.\r\n  @return {null}\r\n  */\r\nDataStream.prototype.save = function(filename) {\r\n  var blob = new Blob([this.buffer]);\r\n  if (window.URL && URL.createObjectURL) {\r\n      var url = window.URL.createObjectURL(blob);\r\n      var a = document.createElement('a');\r\n      // Required in Firefox:\r\n      document.body.appendChild(a);\r\n      a.setAttribute('href', url);\r\n      a.setAttribute('download', filename);\r\n      // Required in Firefox:\r\n      a.setAttribute('target', '_self');\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n  } else {\r\n      throw(\"DataStream.save: Can't create object URL.\");\r\n  }\r\n};\r\n\r\n/**\r\n  Whether to extend DataStream buffer when trying to write beyond its size.\r\n  If set, the buffer is reallocated to twice its current size until the\r\n  requested write fits the buffer.\r\n  @type {boolean}\r\n  */\r\nDataStream.prototype._dynamicSize = true;\r\nObject.defineProperty(DataStream.prototype, 'dynamicSize',\r\n  { get: function() {\r\n      return this._dynamicSize;\r\n    },\r\n    set: function(v) {\r\n      if (!v) {\r\n        this._trimAlloc();\r\n      }\r\n      this._dynamicSize = v;\r\n    } });\r\n\r\n/**\r\n  Internal function to trim the DataStream buffer when required.\r\n  Used for stripping out the first bytes when not needed anymore.\r\n\r\n  @return {null}\r\n  */\r\nDataStream.prototype.shift = function(offset) {\r\n  var buf = new ArrayBuffer(this._byteLength-offset);\r\n  var dst = new Uint8Array(buf);\r\n  var src = new Uint8Array(this._buffer, offset, dst.length);\r\n  dst.set(src);\r\n  this.buffer = buf;\r\n  this.position -= offset;\r\n};\r\n\r\n/**\r\n  Writes an Int32Array of specified endianness to the DataStream.\r\n\r\n  @param {Object} arr The array to write.\r\n  @param {?boolean} e Endianness of the data to write.\r\n */\r\nDataStream.prototype.writeInt32Array = function(arr, e) {\r\n  this._realloc(arr.length * 4);\r\n  if (arr instanceof Int32Array &&\r\n      this.byteOffset+this.position % arr.BYTES_PER_ELEMENT === 0) {\r\n    DataStream.memcpy(this._buffer, this.byteOffset+this.position,\r\n                      arr.buffer, 0,\r\n                      arr.byteLength);\r\n    this.mapInt32Array(arr.length, e);\r\n  } else {\r\n    for (var i=0; i<arr.length; i++) {\r\n      this.writeInt32(arr[i], e);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n  Writes an Int16Array of specified endianness to the DataStream.\r\n\r\n  @param {Object} arr The array to write.\r\n  @param {?boolean} e Endianness of the data to write.\r\n */\r\nDataStream.prototype.writeInt16Array = function(arr, e) {\r\n  this._realloc(arr.length * 2);\r\n  if (arr instanceof Int16Array &&\r\n      this.byteOffset+this.position % arr.BYTES_PER_ELEMENT === 0) {\r\n    DataStream.memcpy(this._buffer, this.byteOffset+this.position,\r\n                      arr.buffer, 0,\r\n                      arr.byteLength);\r\n    this.mapInt16Array(arr.length, e);\r\n  } else {\r\n    for (var i=0; i<arr.length; i++) {\r\n      this.writeInt16(arr[i], e);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n  Writes an Int8Array to the DataStream.\r\n\r\n  @param {Object} arr The array to write.\r\n */\r\nDataStream.prototype.writeInt8Array = function(arr) {\r\n  this._realloc(arr.length * 1);\r\n  if (arr instanceof Int8Array &&\r\n      this.byteOffset+this.position % arr.BYTES_PER_ELEMENT === 0) {\r\n    DataStream.memcpy(this._buffer, this.byteOffset+this.position,\r\n                      arr.buffer, 0,\r\n                      arr.byteLength);\r\n    this.mapInt8Array(arr.length);\r\n  } else {\r\n    for (var i=0; i<arr.length; i++) {\r\n      this.writeInt8(arr[i]);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n  Writes a Uint32Array of specified endianness to the DataStream.\r\n\r\n  @param {Object} arr The array to write.\r\n  @param {?boolean} e Endianness of the data to write.\r\n */\r\nDataStream.prototype.writeUint32Array = function(arr, e) {\r\n  this._realloc(arr.length * 4);\r\n  if (arr instanceof Uint32Array &&\r\n      this.byteOffset+this.position % arr.BYTES_PER_ELEMENT === 0) {\r\n    DataStream.memcpy(this._buffer, this.byteOffset+this.position,\r\n                      arr.buffer, 0,\r\n                      arr.byteLength);\r\n    this.mapUint32Array(arr.length, e);\r\n  } else {\r\n    for (var i=0; i<arr.length; i++) {\r\n      this.writeUint32(arr[i], e);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n  Writes a Uint16Array of specified endianness to the DataStream.\r\n\r\n  @param {Object} arr The array to write.\r\n  @param {?boolean} e Endianness of the data to write.\r\n */\r\nDataStream.prototype.writeUint16Array = function(arr, e) {\r\n  this._realloc(arr.length * 2);\r\n  if (arr instanceof Uint16Array &&\r\n      this.byteOffset+this.position % arr.BYTES_PER_ELEMENT === 0) {\r\n    DataStream.memcpy(this._buffer, this.byteOffset+this.position,\r\n                      arr.buffer, 0,\r\n                      arr.byteLength);\r\n    this.mapUint16Array(arr.length, e);\r\n  } else {\r\n    for (var i=0; i<arr.length; i++) {\r\n      this.writeUint16(arr[i], e);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n  Writes a Uint8Array to the DataStream.\r\n\r\n  @param {Object} arr The array to write.\r\n */\r\nDataStream.prototype.writeUint8Array = function(arr) {\r\n  this._realloc(arr.length * 1);\r\n  if (arr instanceof Uint8Array &&\r\n      this.byteOffset+this.position % arr.BYTES_PER_ELEMENT === 0) {\r\n    DataStream.memcpy(this._buffer, this.byteOffset+this.position,\r\n                      arr.buffer, 0,\r\n                      arr.byteLength);\r\n    this.mapUint8Array(arr.length);\r\n  } else {\r\n    for (var i=0; i<arr.length; i++) {\r\n      this.writeUint8(arr[i]);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n  Writes a Float64Array of specified endianness to the DataStream.\r\n\r\n  @param {Object} arr The array to write.\r\n  @param {?boolean} e Endianness of the data to write.\r\n */\r\nDataStream.prototype.writeFloat64Array = function(arr, e) {\r\n  this._realloc(arr.length * 8);\r\n  if (arr instanceof Float64Array &&\r\n      this.byteOffset+this.position % arr.BYTES_PER_ELEMENT === 0) {\r\n    DataStream.memcpy(this._buffer, this.byteOffset+this.position,\r\n                      arr.buffer, 0,\r\n                      arr.byteLength);\r\n    this.mapFloat64Array(arr.length, e);\r\n  } else {\r\n    for (var i=0; i<arr.length; i++) {\r\n      this.writeFloat64(arr[i], e);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n  Writes a Float32Array of specified endianness to the DataStream.\r\n\r\n  @param {Object} arr The array to write.\r\n  @param {?boolean} e Endianness of the data to write.\r\n */\r\nDataStream.prototype.writeFloat32Array = function(arr, e) {\r\n  this._realloc(arr.length * 4);\r\n  if (arr instanceof Float32Array &&\r\n      this.byteOffset+this.position % arr.BYTES_PER_ELEMENT === 0) {\r\n    DataStream.memcpy(this._buffer, this.byteOffset+this.position,\r\n                      arr.buffer, 0,\r\n                      arr.byteLength);\r\n    this.mapFloat32Array(arr.length, e);\r\n  } else {\r\n    for (var i=0; i<arr.length; i++) {\r\n      this.writeFloat32(arr[i], e);\r\n    }\r\n  }\r\n};\r\n\r\n\r\n/**\r\n  Writes a 32-bit int to the DataStream with the desired endianness.\r\n\r\n  @param {number} v Number to write.\r\n  @param {?boolean} e Endianness of the number.\r\n */\r\nDataStream.prototype.writeInt32 = function(v, e) {\r\n  this._realloc(4);\r\n  this._dataView.setInt32(this.position, v, e == null ? this.endianness : e);\r\n  this.position += 4;\r\n};\r\n\r\n/**\r\n  Writes a 16-bit int to the DataStream with the desired endianness.\r\n\r\n  @param {number} v Number to write.\r\n  @param {?boolean} e Endianness of the number.\r\n */\r\nDataStream.prototype.writeInt16 = function(v, e) {\r\n  this._realloc(2);\r\n  this._dataView.setInt16(this.position, v, e == null ? this.endianness : e);\r\n  this.position += 2;\r\n};\r\n\r\n/**\r\n  Writes an 8-bit int to the DataStream.\r\n\r\n  @param {number} v Number to write.\r\n */\r\nDataStream.prototype.writeInt8 = function(v) {\r\n  this._realloc(1);\r\n  this._dataView.setInt8(this.position, v);\r\n  this.position += 1;\r\n};\r\n\r\n/**\r\n  Writes a 32-bit unsigned int to the DataStream with the desired endianness.\r\n\r\n  @param {number} v Number to write.\r\n  @param {?boolean} e Endianness of the number.\r\n */\r\nDataStream.prototype.writeUint32 = function(v, e) {\r\n  this._realloc(4);\r\n  this._dataView.setUint32(this.position, v, e == null ? this.endianness : e);\r\n  this.position += 4;\r\n};\r\n\r\n/**\r\n  Writes a 16-bit unsigned int to the DataStream with the desired endianness.\r\n\r\n  @param {number} v Number to write.\r\n  @param {?boolean} e Endianness of the number.\r\n */\r\nDataStream.prototype.writeUint16 = function(v, e) {\r\n  this._realloc(2);\r\n  this._dataView.setUint16(this.position, v, e == null ? this.endianness : e);\r\n  this.position += 2;\r\n};\r\n\r\n/**\r\n  Writes an 8-bit unsigned  int to the DataStream.\r\n\r\n  @param {number} v Number to write.\r\n */\r\nDataStream.prototype.writeUint8 = function(v) {\r\n  this._realloc(1);\r\n  this._dataView.setUint8(this.position, v);\r\n  this.position += 1;\r\n};\r\n\r\n/**\r\n  Writes a 32-bit float to the DataStream with the desired endianness.\r\n\r\n  @param {number} v Number to write.\r\n  @param {?boolean} e Endianness of the number.\r\n */\r\nDataStream.prototype.writeFloat32 = function(v, e) {\r\n  this._realloc(4);\r\n  this._dataView.setFloat32(this.position, v, e == null ? this.endianness : e);\r\n  this.position += 4;\r\n};\r\n\r\n/**\r\n  Writes a 64-bit float to the DataStream with the desired endianness.\r\n\r\n  @param {number} v Number to write.\r\n  @param {?boolean} e Endianness of the number.\r\n */\r\nDataStream.prototype.writeFloat64 = function(v, e) {\r\n  this._realloc(8);\r\n  this._dataView.setFloat64(this.position, v, e == null ? this.endianness : e);\r\n  this.position += 8;\r\n};\r\n\r\n/**\r\n  Write a UCS-2 string of desired endianness to the DataStream. The\r\n  lengthOverride argument lets you define the number of characters to write.\r\n  If the string is shorter than lengthOverride, the extra space is padded with\r\n  zeroes.\r\n\r\n  @param {string} str The string to write.\r\n  @param {?boolean} endianness The endianness to use for the written string data.\r\n  @param {?number} lengthOverride The number of characters to write.\r\n */\r\nDataStream.prototype.writeUCS2String = function(str, endianness, lengthOverride) {\r\n  if (lengthOverride == null) {\r\n    lengthOverride = str.length;\r\n  }\r\n  for (var i = 0; i < str.length && i < lengthOverride; i++) {\r\n    this.writeUint16(str.charCodeAt(i), endianness);\r\n  }\r\n  for (; i<lengthOverride; i++) {\r\n    this.writeUint16(0);\r\n  }\r\n};\r\n\r\n/**\r\n  Writes a string of desired length and encoding to the DataStream.\r\n\r\n  @param {string} s The string to write.\r\n  @param {?string} encoding The encoding for the written string data.\r\n                            Defaults to ASCII.\r\n  @param {?number} length The number of characters to write.\r\n */\r\nDataStream.prototype.writeString = function(s, encoding, length) {\r\n  var i = 0;\r\n  if (encoding == null || encoding == \"ASCII\") {\r\n    if (length != null) {\r\n      var len = Math.min(s.length, length);\r\n      for (i=0; i<len; i++) {\r\n        this.writeUint8(s.charCodeAt(i));\r\n      }\r\n      for (; i<length; i++) {\r\n        this.writeUint8(0);\r\n      }\r\n    } else {\r\n      for (i=0; i<s.length; i++) {\r\n        this.writeUint8(s.charCodeAt(i));\r\n      }\r\n    }\r\n  } else {\r\n    this.writeUint8Array((new TextEncoder(encoding)).encode(s.substring(0, length)));\r\n  }\r\n};\r\n\r\n/**\r\n  Writes a null-terminated string to DataStream and zero-pads it to length\r\n  bytes. If length is not given, writes the string followed by a zero.\r\n  If string is longer than length, the written part of the string does not have\r\n  a trailing zero.\r\n\r\n  @param {string} s The string to write.\r\n  @param {?number} length The number of characters to write.\r\n */\r\nDataStream.prototype.writeCString = function(s, length) {\r\n  var i = 0;\r\n  if (length != null) {\r\n    var len = Math.min(s.length, length);\r\n    for (i=0; i<len; i++) {\r\n      this.writeUint8(s.charCodeAt(i));\r\n    }\r\n    for (; i<length; i++) {\r\n      this.writeUint8(0);\r\n    }\r\n  } else {\r\n    for (i=0; i<s.length; i++) {\r\n      this.writeUint8(s.charCodeAt(i));\r\n    }\r\n    this.writeUint8(0);\r\n  }\r\n};\r\n\r\n/**\r\n  Writes a struct to the DataStream. Takes a structDefinition that gives the\r\n  types and a struct object that gives the values. Refer to readStruct for the\r\n  structure of structDefinition.\r\n\r\n  @param {Object} structDefinition Type definition of the struct.\r\n  @param {Object} struct The struct data object.\r\n  */\r\nDataStream.prototype.writeStruct = function(structDefinition, struct) {\r\n  for (var i = 0; i < structDefinition.length; i+=2) {\r\n    var t = structDefinition[i+1];\r\n    this.writeType(t, struct[structDefinition[i]], struct);\r\n  }\r\n};\r\n\r\n/**\r\n  Writes object v of type t to the DataStream.\r\n\r\n  @param {Object} t Type of data to write.\r\n  @param {Object} v Value of data to write.\r\n  @param {Object} struct Struct to pass to write callback functions.\r\n  */\r\nDataStream.prototype.writeType = function(t, v, struct) {\r\n  var tp;\r\n  if (typeof t == \"function\") {\r\n    return t(this, v);\r\n  } else if (typeof t == \"object\" && !(t instanceof Array)) {\r\n    return t.set(this, v, struct);\r\n  }\r\n  var lengthOverride = null;\r\n  var charset = \"ASCII\";\r\n  var pos = this.position;\r\n  if (typeof(t) == 'string' && /:/.test(t)) {\r\n    tp = t.split(\":\");\r\n    t = tp[0];\r\n    lengthOverride = parseInt(tp[1]);\r\n  }\r\n  if (typeof t == 'string' && /,/.test(t)) {\r\n    tp = t.split(\",\");\r\n    t = tp[0];\r\n    charset = parseInt(tp[1]);\r\n  }\r\n\r\n  switch(t) {\r\n    case 'uint8':\r\n      this.writeUint8(v);\r\n      break;\r\n    case 'int8':\r\n      this.writeInt8(v);\r\n      break;\r\n\r\n    case 'uint16':\r\n      this.writeUint16(v, this.endianness);\r\n      break;\r\n    case 'int16':\r\n      this.writeInt16(v, this.endianness);\r\n      break;\r\n    case 'uint32':\r\n      this.writeUint32(v, this.endianness);\r\n      break;\r\n    case 'int32':\r\n      this.writeInt32(v, this.endianness);\r\n      break;\r\n    case 'float32':\r\n      this.writeFloat32(v, this.endianness);\r\n      break;\r\n    case 'float64':\r\n      this.writeFloat64(v, this.endianness);\r\n      break;\r\n\r\n    case 'uint16be':\r\n      this.writeUint16(v, DataStream.BIG_ENDIAN);\r\n      break;\r\n    case 'int16be':\r\n      this.writeInt16(v, DataStream.BIG_ENDIAN);\r\n      break;\r\n    case 'uint32be':\r\n      this.writeUint32(v, DataStream.BIG_ENDIAN);\r\n      break;\r\n    case 'int32be':\r\n      this.writeInt32(v, DataStream.BIG_ENDIAN);\r\n      break;\r\n    case 'float32be':\r\n      this.writeFloat32(v, DataStream.BIG_ENDIAN);\r\n      break;\r\n    case 'float64be':\r\n      this.writeFloat64(v, DataStream.BIG_ENDIAN);\r\n      break;\r\n\r\n    case 'uint16le':\r\n      this.writeUint16(v, DataStream.LITTLE_ENDIAN);\r\n      break;\r\n    case 'int16le':\r\n      this.writeInt16(v, DataStream.LITTLE_ENDIAN);\r\n      break;\r\n    case 'uint32le':\r\n      this.writeUint32(v, DataStream.LITTLE_ENDIAN);\r\n      break;\r\n    case 'int32le':\r\n      this.writeInt32(v, DataStream.LITTLE_ENDIAN);\r\n      break;\r\n    case 'float32le':\r\n      this.writeFloat32(v, DataStream.LITTLE_ENDIAN);\r\n      break;\r\n    case 'float64le':\r\n      this.writeFloat64(v, DataStream.LITTLE_ENDIAN);\r\n      break;\r\n\r\n    case 'cstring':\r\n      this.writeCString(v, lengthOverride);\r\n      break;\r\n\r\n    case 'string':\r\n      this.writeString(v, charset, lengthOverride);\r\n      break;\r\n\r\n    case 'u16string':\r\n      this.writeUCS2String(v, this.endianness, lengthOverride);\r\n      break;\r\n\r\n    case 'u16stringle':\r\n      this.writeUCS2String(v, DataStream.LITTLE_ENDIAN, lengthOverride);\r\n      break;\r\n\r\n    case 'u16stringbe':\r\n      this.writeUCS2String(v, DataStream.BIG_ENDIAN, lengthOverride);\r\n      break;\r\n\r\n    default:\r\n      if (t.length == 3) {\r\n        var ta = t[1];\r\n        for (var i=0; i<v.length; i++) {\r\n          this.writeType(ta, v[i]);\r\n        }\r\n        break;\r\n      } else {\r\n        this.writeStruct(t, v);\r\n        break;\r\n      }\r\n  }\r\n  if (lengthOverride != null) {\r\n    this.position = pos;\r\n    this._realloc(lengthOverride);\r\n    this.position = pos + lengthOverride;\r\n  }\r\n};\r\n\r\n\r\nDataStream.prototype.writeUint64 = function (v) {\r\n\tvar h = Math.floor(v / MAX_SIZE);\r\n\tthis.writeUint32(h);\r\n\tthis.writeUint32(v & 0xFFFFFFFF);\r\n}\r\n\r\nDataStream.prototype.writeUint24 = function (v) {\r\n\tthis.writeUint8((v & 0x00FF0000)>>16);\r\n\tthis.writeUint8((v & 0x0000FF00)>>8);\r\n\tthis.writeUint8((v & 0x000000FF));\r\n}\r\n\r\nDataStream.prototype.adjustUint32 = function(position, value) {\r\n\tvar pos = this.position;\r\n\tthis.seek(position);\r\n\tthis.writeUint32(value);\r\n\tthis.seek(pos);\r\n}\r\n// file:src/DataStream-map.js\r\n/**\r\n  Maps an Int32Array into the DataStream buffer, swizzling it to native\r\n  endianness in-place. The current offset from the start of the buffer needs to\r\n  be a multiple of element size, just like with typed array views.\r\n\r\n  Nice for quickly reading in data. Warning: potentially modifies the buffer\r\n  contents.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} Int32Array to the DataStream backing buffer.\r\n  */\r\nDataStream.prototype.mapInt32Array = function(length, e) {\r\n  this._realloc(length * 4);\r\n  var arr = new Int32Array(this._buffer, this.byteOffset+this.position, length);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += length * 4;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Maps an Int16Array into the DataStream buffer, swizzling it to native\r\n  endianness in-place. The current offset from the start of the buffer needs to\r\n  be a multiple of element size, just like with typed array views.\r\n\r\n  Nice for quickly reading in data. Warning: potentially modifies the buffer\r\n  contents.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} Int16Array to the DataStream backing buffer.\r\n  */\r\nDataStream.prototype.mapInt16Array = function(length, e) {\r\n  this._realloc(length * 2);\r\n  var arr = new Int16Array(this._buffer, this.byteOffset+this.position, length);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += length * 2;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Maps an Int8Array into the DataStream buffer.\r\n\r\n  Nice for quickly reading in data.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} Int8Array to the DataStream backing buffer.\r\n  */\r\nDataStream.prototype.mapInt8Array = function(length) {\r\n  this._realloc(length * 1);\r\n  var arr = new Int8Array(this._buffer, this.byteOffset+this.position, length);\r\n  this.position += length * 1;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Maps a Uint32Array into the DataStream buffer, swizzling it to native\r\n  endianness in-place. The current offset from the start of the buffer needs to\r\n  be a multiple of element size, just like with typed array views.\r\n\r\n  Nice for quickly reading in data. Warning: potentially modifies the buffer\r\n  contents.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} Uint32Array to the DataStream backing buffer.\r\n  */\r\nDataStream.prototype.mapUint32Array = function(length, e) {\r\n  this._realloc(length * 4);\r\n  var arr = new Uint32Array(this._buffer, this.byteOffset+this.position, length);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += length * 4;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Maps a Uint16Array into the DataStream buffer, swizzling it to native\r\n  endianness in-place. The current offset from the start of the buffer needs to\r\n  be a multiple of element size, just like with typed array views.\r\n\r\n  Nice for quickly reading in data. Warning: potentially modifies the buffer\r\n  contents.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} Uint16Array to the DataStream backing buffer.\r\n  */\r\nDataStream.prototype.mapUint16Array = function(length, e) {\r\n  this._realloc(length * 2);\r\n  var arr = new Uint16Array(this._buffer, this.byteOffset+this.position, length);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += length * 2;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Maps a Float64Array into the DataStream buffer, swizzling it to native\r\n  endianness in-place. The current offset from the start of the buffer needs to\r\n  be a multiple of element size, just like with typed array views.\r\n\r\n  Nice for quickly reading in data. Warning: potentially modifies the buffer\r\n  contents.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} Float64Array to the DataStream backing buffer.\r\n  */\r\nDataStream.prototype.mapFloat64Array = function(length, e) {\r\n  this._realloc(length * 8);\r\n  var arr = new Float64Array(this._buffer, this.byteOffset+this.position, length);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += length * 8;\r\n  return arr;\r\n};\r\n\r\n/**\r\n  Maps a Float32Array into the DataStream buffer, swizzling it to native\r\n  endianness in-place. The current offset from the start of the buffer needs to\r\n  be a multiple of element size, just like with typed array views.\r\n\r\n  Nice for quickly reading in data. Warning: potentially modifies the buffer\r\n  contents.\r\n\r\n  @param {number} length Number of elements to map.\r\n  @param {?boolean} e Endianness of the data to read.\r\n  @return {Object} Float32Array to the DataStream backing buffer.\r\n  */\r\nDataStream.prototype.mapFloat32Array = function(length, e) {\r\n  this._realloc(length * 4);\r\n  var arr = new Float32Array(this._buffer, this.byteOffset+this.position, length);\r\n  DataStream.arrayToNative(arr, e == null ? this.endianness : e);\r\n  this.position += length * 4;\r\n  return arr;\r\n};\r\n// file:src/buffer.js\r\n/**\r\n * MultiBufferStream is a class that acts as a SimpleStream for parsing \r\n * It holds several, possibly non-contiguous ArrayBuffer objects, each with a fileStart property \r\n * containing the offset for the buffer data in an original/virtual file \r\n *\r\n * It inherits also from DataStream for all read/write/alloc operations\r\n */\r\n\r\n/**\r\n * Constructor\r\n */\r\nvar MultiBufferStream = function(buffer) {\r\n\t/* List of ArrayBuffers, with a fileStart property, sorted in fileStart order and non overlapping */\r\n\tthis.buffers = [];\t\r\n\tthis.bufferIndex = -1;\r\n\tif (buffer) {\r\n\t\tthis.insertBuffer(buffer);\r\n\t\tthis.bufferIndex = 0;\r\n\t}\r\n}\r\nMultiBufferStream.prototype = new DataStream(new ArrayBuffer(), 0, DataStream.BIG_ENDIAN);\r\n\r\n/************************************************************************************\r\n  Methods for the managnement of the buffers (insertion, removal, concatenation, ...)\r\n ***********************************************************************************/\r\n\r\nMultiBufferStream.prototype.initialized = function() {\r\n\tvar firstBuffer;\r\n\tif (this.bufferIndex > -1) {\r\n\t\treturn true;\r\n\t} else if (this.buffers.length > 0) {\r\n\t\tfirstBuffer = this.buffers[0];\r\n\t\tif (firstBuffer.fileStart === 0) {\r\n\t\t\tthis.buffer = firstBuffer;\r\n\t\t\tthis.bufferIndex = 0;\r\n\t\t\tLog.debug(\"MultiBufferStream\", \"Stream ready for parsing\");\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\tLog.warn(\"MultiBufferStream\", \"The first buffer should have a fileStart of 0\");\r\n\t\t\tthis.logBufferLevel();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t} else {\r\n\t\tLog.warn(\"MultiBufferStream\", \"No buffer to start parsing from\");\r\n\t\tthis.logBufferLevel();\r\n\t\treturn false;\r\n\t}\t\t\t\r\n}\r\n\r\n/**\r\n * helper functions to concatenate two ArrayBuffer objects\r\n * @param  {ArrayBuffer} buffer1 \r\n * @param  {ArrayBuffer} buffer2 \r\n * @return {ArrayBuffer} the concatenation of buffer1 and buffer2 in that order\r\n */\r\nArrayBuffer.concat = function(buffer1, buffer2) {\r\n  Log.debug(\"ArrayBuffer\", \"Trying to create a new buffer of size: \"+(buffer1.byteLength + buffer2.byteLength));\r\n  var tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\r\n  tmp.set(new Uint8Array(buffer1), 0);\r\n  tmp.set(new Uint8Array(buffer2), buffer1.byteLength);\r\n  return tmp.buffer;\r\n};\r\n\r\n/**\r\n * Reduces the size of a given buffer, but taking the part between offset and offset+newlength\r\n * @param  {ArrayBuffer} buffer    \r\n * @param  {Number}      offset    the start of new buffer\r\n * @param  {Number}      newLength the length of the new buffer\r\n * @return {ArrayBuffer}           the new buffer\r\n */\r\nMultiBufferStream.prototype.reduceBuffer = function(buffer, offset, newLength) {\r\n\tvar smallB;\r\n\tsmallB = new Uint8Array(newLength);\r\n\tsmallB.set(new Uint8Array(buffer, offset, newLength));\r\n\tsmallB.buffer.fileStart = buffer.fileStart+offset;\r\n\tsmallB.buffer.usedBytes = 0;\r\n\treturn smallB.buffer;\t\r\n}\r\n\r\n/**\r\n * Inserts the new buffer in the sorted list of buffers,\r\n *  making sure, it is not overlapping with existing ones (possibly reducing its size).\r\n *  if the new buffer overrides/replaces the 0-th buffer (for instance because it is bigger), \r\n *  updates the DataStream buffer for parsing \r\n*/\r\nMultiBufferStream.prototype.insertBuffer = function(ab) {\t\r\n\tvar to_add = true;\r\n\t/* TODO: improve insertion if many buffers */\r\n\tfor (var i = 0; i < this.buffers.length; i++) {\r\n\t\tvar b = this.buffers[i];\r\n\t\tif (ab.fileStart <= b.fileStart) {\r\n\t\t\t/* the insertion position is found */\r\n\t\t\tif (ab.fileStart === b.fileStart) {\r\n\t\t\t\t/* The new buffer overlaps with an existing buffer */\r\n\t\t\t\tif (ab.byteLength >  b.byteLength) {\r\n\t\t\t\t\t/* the new buffer is bigger than the existing one\r\n\t\t\t\t\t   remove the existing buffer and try again to insert \r\n\t\t\t\t\t   the new buffer to check overlap with the next ones */\r\n\t\t\t\t\tthis.buffers.splice(i, 1);\r\n\t\t\t\t\ti--; \r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t/* the new buffer is smaller than the existing one, just drop it */\r\n\t\t\t\t\tLog.warn(\"MultiBufferStream\", \"Buffer (fileStart: \"+ab.fileStart+\" - Length: \"+ab.byteLength+\") already appended, ignoring\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t/* The beginning of the new buffer is not overlapping with an existing buffer\r\n\t\t\t\t   let's check the end of it */\r\n\t\t\t\tif (ab.fileStart + ab.byteLength <= b.fileStart) {\r\n\t\t\t\t\t/* no overlap, we can add it as is */\r\n\t\t\t\t} else {\r\n\t\t\t\t\t/* There is some overlap, cut the new buffer short, and add it*/\r\n\t\t\t\t\tab = this.reduceBuffer(ab, 0, b.fileStart - ab.fileStart);\r\n\t\t\t\t}\r\n\t\t\t\tLog.debug(\"MultiBufferStream\", \"Appending new buffer (fileStart: \"+ab.fileStart+\" - Length: \"+ab.byteLength+\")\");\r\n\t\t\t\tthis.buffers.splice(i, 0, ab);\r\n\t\t\t\t/* if this new buffer is inserted in the first place in the list of the buffer, \r\n\t\t\t\t   and the DataStream is initialized, make it the buffer used for parsing */\r\n\t\t\t\tif (i === 0) {\r\n\t\t\t\t\tthis.buffer = ab;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tto_add = false;\r\n\t\t\tbreak;\r\n\t\t} else if (ab.fileStart < b.fileStart + b.byteLength) {\r\n\t\t\t/* the new buffer overlaps its beginning with the end of the current buffer */\r\n\t\t\tvar offset = b.fileStart + b.byteLength - ab.fileStart;\r\n\t\t\tvar newLength = ab.byteLength - offset;\r\n\t\t\tif (newLength > 0) {\r\n\t\t\t\t/* the new buffer is bigger than the current overlap, drop the overlapping part and try again inserting the remaining buffer */\r\n\t\t\t\tab = this.reduceBuffer(ab, offset, newLength);\r\n\t\t\t} else {\r\n\t\t\t\t/* the content of the new buffer is entirely contained in the existing buffer, drop it entirely */\r\n\t\t\t\tto_add = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/* if the buffer has not been added, we can add it at the end */\r\n\tif (to_add) {\r\n\t\tLog.debug(\"MultiBufferStream\", \"Appending new buffer (fileStart: \"+ab.fileStart+\" - Length: \"+ab.byteLength+\")\");\r\n\t\tthis.buffers.push(ab);\r\n\t\t/* if this new buffer is inserted in the first place in the list of the buffer, \r\n\t\t   and the DataStream is initialized, make it the buffer used for parsing */\r\n\t\tif (i === 0) {\r\n\t\t\tthis.buffer = ab;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Displays the status of the buffers (number and used bytes)\r\n * @param  {Object} info callback method for display\r\n */\r\nMultiBufferStream.prototype.logBufferLevel = function(info) {\r\n\tvar i;\r\n\tvar buffer;\r\n\tvar used, total;\r\n\tvar ranges = [];\r\n\tvar range;\r\n\tvar bufferedString = \"\";\r\n\tused = 0;\r\n\ttotal = 0;\r\n\tfor (i = 0; i < this.buffers.length; i++) {\r\n\t\tbuffer = this.buffers[i];\r\n\t\tif (i === 0) {\r\n\t\t\trange = {};\r\n\t\t\tranges.push(range);\r\n\t\t\trange.start = buffer.fileStart;\r\n\t\t\trange.end = buffer.fileStart+buffer.byteLength;\r\n\t\t\tbufferedString += \"[\"+range.start+\"-\";\r\n\t\t} else if (range.end === buffer.fileStart) {\r\n\t\t\trange.end = buffer.fileStart+buffer.byteLength;\r\n\t\t} else {\r\n\t\t\trange = {};\r\n\t\t\trange.start = buffer.fileStart;\r\n\t\t\tbufferedString += (ranges[ranges.length-1].end-1)+\"], [\"+range.start+\"-\";\r\n\t\t\trange.end = buffer.fileStart+buffer.byteLength;\r\n\t\t\tranges.push(range);\r\n\t\t}\r\n\t\tused += buffer.usedBytes;\r\n\t\ttotal += buffer.byteLength;\r\n\t}\r\n\tif (ranges.length > 0) {\r\n\t\tbufferedString += (range.end-1)+\"]\";\r\n\t}\r\n\tvar log = (info ? Log.info : Log.debug)\r\n\tif (this.buffers.length === 0) {\r\n\t\tlog(\"MultiBufferStream\", \"No more buffer in memory\");\r\n\t} else {\r\n\t\tlog(\"MultiBufferStream\", \"\"+this.buffers.length+\" stored buffer(s) (\"+used+\"/\"+total+\" bytes), continuous ranges: \"+bufferedString);\r\n\t}\r\n}\r\n\r\nMultiBufferStream.prototype.cleanBuffers = function () {\r\n\tvar i;\r\n\tvar buffer;\r\n\tfor (i = 0; i < this.buffers.length; i++) {\r\n\t\tbuffer = this.buffers[i];\r\n\t\tif (buffer.usedBytes === buffer.byteLength) {\r\n\t\t\tLog.debug(\"MultiBufferStream\", \"Removing buffer #\"+i);\r\n\t\t\tthis.buffers.splice(i, 1);\r\n\t\t\ti--;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nMultiBufferStream.prototype.mergeNextBuffer = function() {\r\n\tvar next_buffer;\r\n\tif (this.bufferIndex+1 < this.buffers.length) {\r\n\t\tnext_buffer = this.buffers[this.bufferIndex+1];\r\n\t\tif (next_buffer.fileStart === this.buffer.fileStart + this.buffer.byteLength) {\r\n\t\t\tvar oldLength = this.buffer.byteLength;\r\n\t\t\tvar oldUsedBytes = this.buffer.usedBytes;\r\n\t\t\tvar oldFileStart = this.buffer.fileStart;\r\n\t\t\tthis.buffers[this.bufferIndex] = ArrayBuffer.concat(this.buffer, next_buffer);\r\n\t\t\tthis.buffer = this.buffers[this.bufferIndex];\r\n\t\t\tthis.buffers.splice(this.bufferIndex+1, 1);\r\n\t\t\tthis.buffer.usedBytes = oldUsedBytes; /* TODO: should it be += ? */\r\n\t\t\tthis.buffer.fileStart = oldFileStart;\r\n\t\t\tLog.debug(\"ISOFile\", \"Concatenating buffer for box parsing (length: \"+oldLength+\"->\"+this.buffer.byteLength+\")\");\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n\r\n/*************************************************************************\r\n  Seek-related functions\r\n *************************************************************************/\r\n\r\n/**\r\n * Finds the buffer that holds the given file position\r\n * @param  {Boolean} fromStart    indicates if the search should start from the current buffer (false) \r\n *                                or from the first buffer (true)\r\n * @param  {Number}  filePosition position in the file to seek to\r\n * @param  {Boolean} markAsUsed   indicates if the bytes in between the current position and the seek position \r\n *                                should be marked as used for garbage collection\r\n * @return {Number}               the index of the buffer holding the seeked file position, -1 if not found.\r\n */\r\nMultiBufferStream.prototype.findPosition = function(fromStart, filePosition, markAsUsed) {\r\n\tvar i;\r\n\tvar abuffer = null;\r\n\tvar index = -1;\r\n\r\n\t/* find the buffer with the largest position smaller than the given position */\r\n\tif (fromStart === true) {\r\n\t   /* the reposition can be in the past, we need to check from the beginning of the list of buffers */\r\n\t\ti = 0;\r\n\t} else {\r\n\t\ti = this.bufferIndex;\r\n\t}\r\n\r\n\twhile (i < this.buffers.length) {\r\n\t\tabuffer = this.buffers[i];\r\n\t\tif (abuffer.fileStart <= filePosition) {\r\n\t\t\tindex = i;\r\n\t\t\tif (markAsUsed) {\r\n\t\t\t\tif (abuffer.fileStart + abuffer.byteLength <= filePosition) {\r\n\t\t\t\t\tabuffer.usedBytes = abuffer.byteLength;\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tabuffer.usedBytes = filePosition - abuffer.fileStart;\r\n\t\t\t\t}\t\t\r\n\t\t\t\tthis.logBufferLevel();\t\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\ti++;\r\n\t}\r\n\r\n\tif (index !== -1) {\r\n\t\tabuffer = this.buffers[index];\r\n\t\tif (abuffer.fileStart + abuffer.byteLength >= filePosition) {\t\t\t\r\n\t\t\tLog.debug(\"MultiBufferStream\", \"Found position in existing buffer #\"+index);\r\n\t\t\treturn index;\r\n\t\t} else {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t} else {\r\n\t\treturn -1;\r\n\t}\r\n}\r\n\r\n/**\r\n * Finds the largest file position contained in a buffer or in the next buffers if they are contiguous (no gap)\r\n * starting from the given buffer index or from the current buffer if the index is not given\r\n *\r\n * @param  {Number} inputindex Index of the buffer to start from\r\n * @return {Number}            The largest file position found in the buffers\r\n */\r\nMultiBufferStream.prototype.findEndContiguousBuf = function(inputindex) {\r\n\tvar i;\r\n\tvar currentBuf;\r\n\tvar nextBuf;\r\n\tvar index = (inputindex !== undefined ? inputindex : this.bufferIndex);\r\n\tcurrentBuf = this.buffers[index];\r\n\t/* find the end of the contiguous range of data */\r\n\tif (this.buffers.length > index+1) {\r\n\t\tfor (i = index+1; i < this.buffers.length; i++) {\r\n\t\t\tnextBuf = this.buffers[i];\r\n\t\t\tif (nextBuf.fileStart === currentBuf.fileStart + currentBuf.byteLength) {\r\n\t\t\t\tcurrentBuf = nextBuf;\r\n\t\t\t} else {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/* return the position of last byte in the file that we have */\r\n\treturn currentBuf.fileStart + currentBuf.byteLength;\r\n}\r\n\r\n/**\r\n * Returns the largest file position contained in the buffers, larger than the given position\r\n * @param  {Number} pos the file position to start from\r\n * @return {Number}     the largest position in the current buffer or in the buffer and the next contiguous \r\n *                      buffer that holds the given position\r\n */\r\nMultiBufferStream.prototype.getEndFilePositionAfter = function(pos) {\r\n\tvar index = this.findPosition(true, pos, false);\r\n\tif (index !== -1) {\r\n\t\treturn this.findEndContiguousBuf(index);\r\n\t} else {\r\n\t\treturn pos;\r\n\t}\r\n}\r\n\r\n/*************************************************************************\r\n  Garbage collection related functions\r\n *************************************************************************/\r\n\r\n/**\r\n * Marks a given number of bytes as used in the current buffer for garbage collection\r\n * @param {Number} nbBytes \r\n */\r\nMultiBufferStream.prototype.addUsedBytes = function(nbBytes) {\r\n\tthis.buffer.usedBytes += nbBytes;\r\n\tthis.logBufferLevel();\r\n}\r\n\r\n/**\r\n * Marks the entire current buffer as used, ready for garbage collection\r\n */\r\nMultiBufferStream.prototype.setAllUsedBytes = function() {\r\n\tthis.buffer.usedBytes = this.buffer.byteLength;\r\n\tthis.logBufferLevel();\r\n}\r\n\r\n/*************************************************************************\r\n  Common API between MultiBufferStream and SimpleStream\r\n *************************************************************************/\r\n\r\n/**\r\n * Tries to seek to a given file position\r\n * if possible, repositions the parsing from there and returns true \r\n * if not possible, does not change anything and returns false \r\n * @param  {Number}  filePosition position in the file to seek to\r\n * @param  {Boolean} fromStart    indicates if the search should start from the current buffer (false) \r\n *                                or from the first buffer (true)\r\n * @param  {Boolean} markAsUsed   indicates if the bytes in between the current position and the seek position \r\n *                                should be marked as used for garbage collection\r\n * @return {Boolean}              true if the seek succeeded, false otherwise\r\n */\r\nMultiBufferStream.prototype.seek = function(filePosition, fromStart, markAsUsed) {\r\n\tvar index;\r\n\tindex = this.findPosition(fromStart, filePosition, markAsUsed);\r\n\tif (index !== -1) {\r\n\t\tthis.buffer = this.buffers[index];\r\n\t\tthis.bufferIndex = index;\r\n\t\tthis.position = filePosition - this.buffer.fileStart;\r\n\t\tLog.debug(\"MultiBufferStream\", \"Repositioning parser at buffer position: \"+this.position);\r\n\t\treturn true;\r\n\t} else {\r\n\t\tLog.debug(\"MultiBufferStream\", \"Position \"+filePosition+\" not found in buffered data\");\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns the current position in the file\r\n * @return {Number} the position in the file\r\n */\r\nMultiBufferStream.prototype.getPosition = function() {\r\n\tif (this.bufferIndex === -1 || this.buffers[this.bufferIndex] === null) {\r\n\t\tthrow \"Error accessing position in the MultiBufferStream\";\r\n\t}\r\n\treturn this.buffers[this.bufferIndex].fileStart+this.position;\r\n}\r\n\r\n/**\r\n * Returns the length of the current buffer\r\n * @return {Number} the length of the current buffer\r\n */\r\nMultiBufferStream.prototype.getLength = function() {\r\n\treturn this.byteLength;\r\n}\r\n\r\nMultiBufferStream.prototype.getEndPosition = function() {\r\n\tif (this.bufferIndex === -1 || this.buffers[this.bufferIndex] === null) {\r\n\t\tthrow \"Error accessing position in the MultiBufferStream\";\r\n\t}\r\n\treturn this.buffers[this.bufferIndex].fileStart+this.byteLength;\r\n}\r\n\r\nif (typeof exports !== 'undefined') {\r\n\texports.MultiBufferStream = MultiBufferStream;\r\n}// file:src/descriptor.js\r\n/*\r\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nvar MPEG4DescriptorParser = function () {\r\n\tvar ES_DescrTag \t\t\t= 0x03;\r\n\tvar DecoderConfigDescrTag \t= 0x04;\r\n\tvar DecSpecificInfoTag \t\t= 0x05;\r\n\tvar SLConfigDescrTag \t\t= 0x06;\r\n\r\n\tvar descTagToName = [];\r\n\tdescTagToName[ES_DescrTag] \t\t\t\t= \"ES_Descriptor\";\r\n\tdescTagToName[DecoderConfigDescrTag] \t= \"DecoderConfigDescriptor\";\r\n\tdescTagToName[DecSpecificInfoTag] \t\t= \"DecoderSpecificInfo\";\r\n\tdescTagToName[SLConfigDescrTag] \t\t= \"SLConfigDescriptor\";\r\n\r\n\tthis.getDescriptorName = function(tag) {\r\n\t\treturn descTagToName[tag];\r\n\t}\r\n\r\n\tvar that = this;\r\n\tvar classes = {};\r\n\r\n\tthis.parseOneDescriptor = function (stream) {\r\n\t\tvar hdrSize = 0;\r\n\t\tvar size = 0;\r\n\t\tvar tag;\r\n\t\tvar desc;\r\n\t\tvar byteRead;\r\n\t\ttag = stream.readUint8();\r\n\t\thdrSize++;\r\n\t\tbyteRead = stream.readUint8();\r\n\t\thdrSize++;\r\n\t\twhile (byteRead & 0x80) {\r\n\t\t\tsize = (size << 7) + (byteRead & 0x7F);\r\n\t\t\tbyteRead = stream.readUint8();\r\n\t\t\thdrSize++;\r\n\t\t}\r\n\t\tsize = (size << 7) + (byteRead & 0x7F);\r\n\t\tLog.debug(\"MPEG4DescriptorParser\", \"Found \"+(descTagToName[tag] || \"Descriptor \"+tag)+\", size \"+size+\" at position \"+stream.getPosition());\r\n\t\tif (descTagToName[tag]) {\r\n\t\t\tdesc = new classes[descTagToName[tag]](size);\r\n\t\t} else {\r\n\t\t\tdesc = new classes.Descriptor(size);\r\n\t\t}\r\n\t\tdesc.parse(stream);\r\n\t\treturn desc;\r\n\t}\r\n\r\n\tclasses.Descriptor = function(_tag, _size) {\r\n\t\tthis.tag = _tag;\r\n\t\tthis.size = _size;\r\n\t\tthis.descs = [];\r\n\t}\r\n\r\n\tclasses.Descriptor.prototype.parse = function (stream) {\r\n\t\tthis.data = stream.readUint8Array(this.size);\r\n\t}\r\n\r\n\tclasses.Descriptor.prototype.findDescriptor = function (tag) {\r\n\t\tfor (var i = 0; i < this.descs.length; i++) {\r\n\t\t\tif (this.descs[i].tag == tag) {\r\n\t\t\t\treturn this.descs[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tclasses.Descriptor.prototype.parseRemainingDescriptors = function (stream) {\r\n\t\tvar start = stream.position;\r\n\t\twhile (stream.position < start+this.size) {\r\n\t\t\tvar desc = that.parseOneDescriptor(stream);\r\n\t\t\tthis.descs.push(desc);\r\n\t\t}\r\n\t}\r\n\r\n\tclasses.ES_Descriptor = function (size) {\r\n\t\tclasses.Descriptor.call(this, ES_DescrTag, size);\r\n\t}\r\n\r\n\tclasses.ES_Descriptor.prototype = new classes.Descriptor();\r\n\r\n\tclasses.ES_Descriptor.prototype.parse = function(stream) {\r\n\t\tthis.ES_ID = stream.readUint16();\r\n\t\tthis.flags = stream.readUint8();\r\n\t\tthis.size -= 3;\r\n\t\tif (this.flags & 0x80) {\r\n\t\t\tthis.dependsOn_ES_ID = stream.readUint16();\r\n\t\t\tthis.size -= 2;\r\n\t\t} else {\r\n\t\t\tthis.dependsOn_ES_ID = 0;\r\n\t\t}\r\n\t\tif (this.flags & 0x40) {\r\n\t\t\tvar l = stream.readUint8();\r\n\t\t\tthis.URL = stream.readString(l);\r\n\t\t\tthis.size -= l+1;\r\n\t\t} else {\r\n\t\t\tthis.URL = \"\";\r\n\t\t}\r\n\t\tif (this.flags & 0x20) {\r\n\t\t\tthis.OCR_ES_ID = stream.readUint16();\r\n\t\t\tthis.size -= 2;\r\n\t\t} else {\r\n\t\t\tthis.OCR_ES_ID = 0;\r\n\t\t}\r\n\t\tthis.parseRemainingDescriptors(stream);\r\n\t}\r\n\r\n\tclasses.ES_Descriptor.prototype.getOTI = function(stream) {\r\n\t\tvar dcd = this.findDescriptor(DecoderConfigDescrTag);\r\n\t\tif (dcd) {\r\n\t\t\treturn dcd.oti;\r\n\t\t} else {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\tclasses.ES_Descriptor.prototype.getAudioConfig = function(stream) {\r\n\t\tvar dcd = this.findDescriptor(DecoderConfigDescrTag);\r\n\t\tif (!dcd) return null;\r\n\t\tvar dsi = dcd.findDescriptor(DecSpecificInfoTag);\r\n\t\tif (dsi && dsi.data) {\r\n\t\t\tvar audioObjectType = (dsi.data[0]& 0xF8) >> 3;\r\n\t\t\tif (audioObjectType === 31 && dsi.data.length >= 2) {\r\n\t\t\t\taudioObjectType = 32 + ((dsi.data[0] & 0x7) << 3) + ((dsi.data[1] & 0xE0) >> 5);\r\n\t\t\t}\r\n\t\t\treturn audioObjectType;\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tclasses.DecoderConfigDescriptor = function (size) {\r\n\t\tclasses.Descriptor.call(this, DecoderConfigDescrTag, size);\r\n\t}\r\n\tclasses.DecoderConfigDescriptor.prototype = new classes.Descriptor();\r\n\r\n\tclasses.DecoderConfigDescriptor.prototype.parse = function(stream) {\r\n\t\tthis.oti = stream.readUint8();\r\n\t\tthis.streamType = stream.readUint8();\r\n\t\tthis.upStream = ((this.streamType >> 1) & 1) !== 0;\r\n\t\tthis.streamType = this.streamType >>> 2;\r\n\t\tthis.bufferSize = stream.readUint24();\r\n\t\tthis.maxBitrate = stream.readUint32();\r\n\t\tthis.avgBitrate = stream.readUint32();\r\n\t\tthis.size -= 13;\r\n\t\tthis.parseRemainingDescriptors(stream);\r\n\t}\r\n\r\n\tclasses.DecoderSpecificInfo = function (size) {\r\n\t\tclasses.Descriptor.call(this, DecSpecificInfoTag, size);\r\n\t}\r\n\tclasses.DecoderSpecificInfo.prototype = new classes.Descriptor();\r\n\r\n\tclasses.SLConfigDescriptor = function (size) {\r\n\t\tclasses.Descriptor.call(this, SLConfigDescrTag, size);\r\n\t}\r\n\tclasses.SLConfigDescriptor.prototype = new classes.Descriptor();\r\n\r\n\treturn this;\r\n}\r\n\r\nif (typeof exports !== 'undefined') {\r\n\texports.MPEG4DescriptorParser = MPEG4DescriptorParser;\r\n}\r\n// file:src/box.js\r\n/*\r\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nvar BoxParser = {\r\n\tERR_INVALID_DATA : -1,\r\n\tERR_NOT_ENOUGH_DATA : 0,\r\n\tOK : 1,\r\n\r\n\t// Boxes to be created with default parsing\r\n\tBASIC_BOXES: [\r\n\t\t{type: \"mdat\", name: \"MediaDataBox\"},\r\n\t\t{type: \"idat\", name: \"ItemDataBox\"},\r\n\t\t{type: \"free\", name: \"FreeSpaceBox\"},\r\n\t\t{type: \"skip\", name: \"FreeSpaceBox\"},\r\n\t\t{type: \"meco\", name: \"AdditionalMetadataContainerBox\"},\r\n\t\t{type: \"strk\", name: \"SubTrackBox\"}\r\n\t],\r\n\tFULL_BOXES: [\r\n\t\t{type: \"hmhd\", name: \"HintMediaHeaderBox\"},\r\n\t\t{type: \"nmhd\", name: \"NullMediaHeaderBox\"},\r\n\t\t{type: \"iods\", name: \"ObjectDescriptorBox\"},\r\n\t\t{type: \"xml \", name: \"XMLBox\"},\r\n\t\t{type: \"bxml\", name: \"BinaryXMLBox\"},\r\n\t\t{type: \"ipro\", name: \"ItemProtectionBox\"},\r\n\t\t{type: \"mere\", name: \"MetaboxRelationBox\"}\r\n\t],\r\n\tCONTAINER_BOXES: [\r\n\t\t[{type: \"moov\", name: \"CompressedMovieBox\"}, [\"trak\", \"pssh\"]],\r\n\t\t[{type: \"trak\", name: \"TrackBox\"}],\r\n\t\t[{type: \"edts\", name: \"EditBox\"}],\r\n\t\t[{type: \"mdia\", name: \"MediaBox\"}],\r\n\t\t[{type: \"minf\", name: \"MediaInformationBox\"}],\r\n\t\t[{type: \"dinf\", name: \"DataInformationBox\"}],\r\n\t\t[{type: \"stbl\", name: \"SampleTableBox\"}, [\"sgpd\", \"sbgp\"]],\r\n\t\t[{type: \"mvex\", name: \"MovieExtendsBox\"}, [\"trex\"]],\r\n\t\t[{type: \"moof\", name: \"CompressedMovieFragmentBox\"}, [\"traf\"]],\r\n\t\t[{type: \"traf\", name: \"TrackFragmentBox\"}, [\"trun\", \"sgpd\", \"sbgp\"]],\r\n\t\t[{type: \"vttc\", name: \"VTTCueBox\"}],\r\n\t\t[{type: \"tref\", name: \"TrackReferenceBox\"}],\r\n\t\t[{type: \"iref\", name: \"ItemReferenceBox\"}],\r\n\t\t[{type: \"mfra\", name: \"MovieFragmentRandomAccessBox\"}, [\"tfra\"]],\r\n\t\t[{type: \"meco\", name: \"AdditionalMetadataContainerBox\"}],\r\n\t\t[{type: \"hnti\", name: \"trackhintinformation\"}],\r\n\t\t[{type: \"hinf\", name: \"hintstatisticsbox\"}],\r\n\t\t[{type: \"strk\", name: \"SubTrackBox\"}],\r\n\t\t[{type: \"strd\", name: \"SubTrackDefinitionBox\"}],\r\n\t\t[{type: \"sinf\", name: \"ProtectionSchemeInfoBox\"}],\r\n\t\t[{type: \"rinf\", name: \"RestrictedSchemeInfoBox\"}],\r\n\t\t[{type: \"schi\", name: \"SchemeInformationBox\"}],\r\n\t\t[{type: \"trgr\", name: \"TrackGroupBox\"}],\r\n\t\t[{type: \"udta\", name: \"UserDataBox\"}, [\"kind\"]],\r\n\t\t[{type: \"iprp\", name: \"ItemPropertiesBox\"}, [\"ipma\"]],\r\n\t\t[{type: \"ipco\", name: \"ItemPropertyContainerBox\"}],\r\n\t\t[{type: \"grpl\", name: \"GroupsListBox\"}],\r\n\t\t[{type: \"j2kH\", name: \"J2KHeaderInfoBox\"}],\r\n\t\t[{type: \"etyp\", name: \"ExtendedTypeBox\"}, [\"tyco\"]]\r\n\t],\r\n\t// Boxes effectively created\r\n\tboxCodes : [],\r\n\tfullBoxCodes : [],\r\n\tcontainerBoxCodes : [],\r\n\tsampleEntryCodes : {},\r\n\tsampleGroupEntryCodes: [],\r\n\ttrackGroupTypes: [],\r\n\tUUIDBoxes: {},\r\n\tUUIDs: [],\r\n\tinitialize: function() {\r\n\t\tBoxParser.FullBox.prototype = new BoxParser.Box();\r\n\t\tBoxParser.ContainerBox.prototype = new BoxParser.Box();\r\n\t\tBoxParser.SampleEntry.prototype = new BoxParser.Box();\r\n\t\tBoxParser.TrackGroupTypeBox.prototype = new BoxParser.FullBox();\r\n\r\n\t\t/* creating constructors for simple boxes */\r\n\t\tBoxParser.BASIC_BOXES.forEach(function(box) {\r\n\t\t\tBoxParser.createBoxCtor(box.type, box.name)\r\n\t\t});\r\n\t\tBoxParser.FULL_BOXES.forEach(function(box) {\r\n\t\t\tBoxParser.createFullBoxCtor(box.type, box.name);\r\n\t\t});\r\n\t\tBoxParser.CONTAINER_BOXES.forEach(function(boxes) {\r\n\t\t\tBoxParser.createContainerBoxCtor(boxes[0].type, boxes[0].name, null, boxes[1]);\r\n\t\t});\r\n\t},\r\n\tBox: function(_type, _size, _name, _uuid) {\r\n\t\tthis.type = _type;\r\n\t\tthis.box_name = _name;\r\n\t\tthis.size = _size;\r\n\t\tthis.uuid = _uuid;\r\n\t},\r\n\tFullBox: function(type, size, name, uuid) {\r\n\t\tBoxParser.Box.call(this, type, size, name, uuid);\r\n\t\tthis.flags = 0;\r\n\t\tthis.version = 0;\r\n\t},\r\n\tContainerBox: function(type, size, name, uuid) {\r\n\t\tBoxParser.Box.call(this, type, size, name, uuid);\r\n\t\tthis.boxes = [];\r\n\t},\r\n\tSampleEntry: function(type, size, hdr_size, start) {\r\n\t\tBoxParser.ContainerBox.call(this, type, size);\r\n\t\tthis.hdr_size = hdr_size;\r\n\t\tthis.start = start;\r\n\t},\r\n\tSampleGroupEntry: function(type) {\r\n\t\tthis.grouping_type = type;\r\n\t},\r\n\tTrackGroupTypeBox: function(type, size) {\r\n\t\tBoxParser.FullBox.call(this, type, size);\r\n\t},\r\n\tcreateBoxCtor: function(type, name, parseMethod){\r\n\t\tBoxParser.boxCodes.push(type);\r\n\t\tBoxParser[type+\"Box\"] = function(size) {\r\n\t\t\tBoxParser.Box.call(this, type, size, name);\r\n\t\t}\r\n\t\tBoxParser[type+\"Box\"].prototype = new BoxParser.Box();\r\n\t\tif (parseMethod) BoxParser[type+\"Box\"].prototype.parse = parseMethod;\r\n\t},\r\n\tcreateFullBoxCtor: function(type, name, parseMethod) {\r\n\t\t//BoxParser.fullBoxCodes.push(type);\r\n\t\tBoxParser[type+\"Box\"] = function(size) {\r\n\t\t\tBoxParser.FullBox.call(this, type, size, name);\r\n\t\t}\r\n\t\tBoxParser[type+\"Box\"].prototype = new BoxParser.FullBox();\r\n\t\tBoxParser[type+\"Box\"].prototype.parse = function(stream) {\r\n\t\t\tthis.parseFullHeader(stream);\r\n\t\t\tif (parseMethod) {\r\n\t\t\t\tparseMethod.call(this, stream);\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\taddSubBoxArrays: function(subBoxNames) {\r\n\t\tif (subBoxNames) {\r\n\t\t\tthis.subBoxNames = subBoxNames;\r\n\t\t\tvar nbSubBoxes = subBoxNames.length;\r\n\t\t\tfor (var k = 0; k<nbSubBoxes; k++) {\r\n\t\t\t\tthis[subBoxNames[k]+\"s\"] = [];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tcreateContainerBoxCtor: function(type, name, parseMethod, subBoxNames) {\r\n\t\t//BoxParser.containerBoxCodes.push(type);\r\n\t\tBoxParser[type+\"Box\"] = function(size) {\r\n\t\t\tBoxParser.ContainerBox.call(this, type, size, name);\r\n\t\t\tBoxParser.addSubBoxArrays.call(this, subBoxNames);\r\n\t\t}\r\n\t\tBoxParser[type+\"Box\"].prototype = new BoxParser.ContainerBox();\r\n\t\tif (parseMethod) BoxParser[type+\"Box\"].prototype.parse = parseMethod;\r\n\t},\r\n\tcreateMediaSampleEntryCtor: function(mediaType, parseMethod, subBoxNames) {\r\n\t\tBoxParser.sampleEntryCodes[mediaType] = [];\r\n\t\tBoxParser[mediaType+\"SampleEntry\"] = function(type, size) {\r\n\t\t\tBoxParser.SampleEntry.call(this, type, size);\r\n\t\t\tBoxParser.addSubBoxArrays.call(this, subBoxNames);\r\n\t\t};\r\n\t\tBoxParser[mediaType+\"SampleEntry\"].prototype = new BoxParser.SampleEntry();\r\n\t\tif (parseMethod) BoxParser[mediaType+\"SampleEntry\"].prototype .parse = parseMethod;\r\n\t},\r\n\tcreateSampleEntryCtor: function(mediaType, type, parseMethod, subBoxNames) {\r\n\t\tBoxParser.sampleEntryCodes[mediaType].push(type);\r\n\t\tBoxParser[type+\"SampleEntry\"] = function(size) {\r\n\t\t\tBoxParser[mediaType+\"SampleEntry\"].call(this, type, size);\r\n\t\t\tBoxParser.addSubBoxArrays.call(this, subBoxNames);\r\n\t\t};\r\n\t\tBoxParser[type+\"SampleEntry\"].prototype = new BoxParser[mediaType+\"SampleEntry\"]();\r\n\t\tif (parseMethod) BoxParser[type+\"SampleEntry\"].prototype.parse = parseMethod;\r\n\t},\r\n\tcreateEncryptedSampleEntryCtor: function(mediaType, type, parseMethod) {\r\n\t\tBoxParser.createSampleEntryCtor.call(this, mediaType, type, parseMethod, [\"sinf\"]);\r\n\t},\r\n\tcreateSampleGroupCtor: function(type, parseMethod) {\r\n\t\t//BoxParser.sampleGroupEntryCodes.push(type);\r\n\t\tBoxParser[type+\"SampleGroupEntry\"] = function(size) {\r\n\t\t\tBoxParser.SampleGroupEntry.call(this, type, size);\r\n\t\t}\r\n\t\tBoxParser[type+\"SampleGroupEntry\"].prototype = new BoxParser.SampleGroupEntry();\r\n\t\tif (parseMethod) BoxParser[type+\"SampleGroupEntry\"].prototype.parse = parseMethod;\r\n\t},\r\n\tcreateTrackGroupCtor: function(type, parseMethod) {\r\n\t\t//BoxParser.trackGroupTypes.push(type);\r\n\t\tBoxParser[type+\"TrackGroupTypeBox\"] = function(size) {\r\n\t\t\tBoxParser.TrackGroupTypeBox.call(this, type, size);\r\n\t\t}\r\n\t\tBoxParser[type+\"TrackGroupTypeBox\"].prototype = new BoxParser.TrackGroupTypeBox();\r\n\t\tif (parseMethod) BoxParser[type+\"TrackGroupTypeBox\"].prototype.parse = parseMethod;\r\n\t},\r\n\tcreateUUIDBox: function(uuid, name, isFullBox, isContainerBox, parseMethod) {\r\n\t\tBoxParser.UUIDs.push(uuid);\r\n\t\tBoxParser.UUIDBoxes[uuid] = function(size) {\r\n\t\t\tif (isFullBox) {\r\n\t\t\t\tBoxParser.FullBox.call(this, \"uuid\", size, name, uuid);\r\n\t\t\t} else {\r\n\t\t\t\tif (isContainerBox) {\r\n\t\t\t\t\tBoxParser.ContainerBox.call(this, \"uuid\", size, name, uuid);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tBoxParser.Box.call(this, \"uuid\", size, name, uuid);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tBoxParser.UUIDBoxes[uuid].prototype = (isFullBox ? new BoxParser.FullBox() : (isContainerBox ? new BoxParser.ContainerBox() : new BoxParser.Box()));\r\n\t\tif (parseMethod) {\r\n\t\t\tif (isFullBox) {\r\n\t\t\t\tBoxParser.UUIDBoxes[uuid].prototype.parse = function(stream) {\r\n\t\t\t\t\tthis.parseFullHeader(stream);\r\n\t\t\t\t\tif (parseMethod) {\r\n\t\t\t\t\t\tparseMethod.call(this, stream);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tBoxParser.UUIDBoxes[uuid].prototype.parse = parseMethod;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nBoxParser.initialize();\r\n\r\nBoxParser.TKHD_FLAG_ENABLED    = 0x000001;\r\nBoxParser.TKHD_FLAG_IN_MOVIE   = 0x000002;\r\nBoxParser.TKHD_FLAG_IN_PREVIEW = 0x000004;\r\n\r\nBoxParser.TFHD_FLAG_BASE_DATA_OFFSET\t= 0x01;\r\nBoxParser.TFHD_FLAG_SAMPLE_DESC\t\t\t= 0x02;\r\nBoxParser.TFHD_FLAG_SAMPLE_DUR\t\t\t= 0x08;\r\nBoxParser.TFHD_FLAG_SAMPLE_SIZE\t\t\t= 0x10;\r\nBoxParser.TFHD_FLAG_SAMPLE_FLAGS\t\t= 0x20;\r\nBoxParser.TFHD_FLAG_DUR_EMPTY\t\t\t= 0x10000;\r\nBoxParser.TFHD_FLAG_DEFAULT_BASE_IS_MOOF= 0x20000;\r\n\r\nBoxParser.TRUN_FLAGS_DATA_OFFSET= 0x01;\r\nBoxParser.TRUN_FLAGS_FIRST_FLAG\t= 0x04;\r\nBoxParser.TRUN_FLAGS_DURATION\t= 0x100;\r\nBoxParser.TRUN_FLAGS_SIZE\t\t= 0x200;\r\nBoxParser.TRUN_FLAGS_FLAGS\t\t= 0x400;\r\nBoxParser.TRUN_FLAGS_CTS_OFFSET\t= 0x800;\r\n\r\nBoxParser.Box.prototype.add = function(name) {\r\n\treturn this.addBox(new BoxParser[name+\"Box\"]());\r\n}\r\n\r\nBoxParser.Box.prototype.addBox = function(box) {\r\n\tthis.boxes.push(box);\r\n\tif (this[box.type+\"s\"]) {\r\n\t\tthis[box.type+\"s\"].push(box);\r\n\t} else {\r\n\t\tthis[box.type] = box;\r\n\t}\r\n\treturn box;\r\n}\r\n\r\nBoxParser.Box.prototype.set = function(prop, value) {\r\n\tthis[prop] = value;\r\n\treturn this;\r\n}\r\n\r\nBoxParser.Box.prototype.addEntry = function(value, _prop) {\r\n\tvar prop = _prop || \"entries\";\r\n\tif (!this[prop]) {\r\n\t\tthis[prop] = [];\r\n\t}\r\n\tthis[prop].push(value);\r\n\treturn this;\r\n}\r\n\r\nif (typeof exports !== \"undefined\") {\r\n\texports.BoxParser = BoxParser;\r\n}\r\n// file:src/box-parse.js\r\n/* \r\n * Copyright (c) Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nBoxParser.parseUUID = function(stream) {\r\n\treturn BoxParser.parseHex16(stream);\r\n}\r\n\r\nBoxParser.parseHex16 = function(stream) {\r\n\tvar hex16 = \"\"\r\n\tfor (var i = 0; i <16; i++) {\r\n\t\tvar hex = stream.readUint8().toString(16);\r\n\t\thex16 += (hex.length === 1 ? \"0\"+hex : hex);\r\n\t}\r\n\treturn hex16;\r\n}\r\n\r\nBoxParser.parseOneBox = function(stream, headerOnly, parentSize) {\r\n\tvar box;\r\n\tvar start = stream.getPosition();\r\n\tvar hdr_size = 0;\r\n\tvar diff;\r\n\tvar uuid;\r\n\tif (stream.getEndPosition() - start < 8) {\r\n\t\tLog.debug(\"BoxParser\", \"Not enough data in stream to parse the type and size of the box\");\r\n\t\treturn { code: BoxParser.ERR_NOT_ENOUGH_DATA };\r\n\t}\r\n\tif (parentSize && parentSize < 8) {\r\n\t\tLog.debug(\"BoxParser\", \"Not enough bytes left in the parent box to parse a new box\");\r\n\t\treturn { code: BoxParser.ERR_NOT_ENOUGH_DATA };\r\n\t}\r\n\tvar size = stream.readUint32();\r\n\tvar type = stream.readString(4);\r\n\tvar box_type = type;\r\n\tLog.debug(\"BoxParser\", \"Found box of type '\"+type+\"' and size \"+size+\" at position \"+start);\r\n\thdr_size = 8;\r\n\tif (type == \"uuid\") {\r\n\t\tif ((stream.getEndPosition() - stream.getPosition() < 16) || (parentSize -hdr_size < 16)) {\r\n\t\t\tstream.seek(start);\r\n\t\t\tLog.debug(\"BoxParser\", \"Not enough bytes left in the parent box to parse a UUID box\");\r\n\t\t\treturn { code: BoxParser.ERR_NOT_ENOUGH_DATA };\r\n\t\t}\r\n\t\tuuid = BoxParser.parseUUID(stream);\r\n\t\thdr_size += 16;\r\n\t\tbox_type = uuid;\r\n\t}\r\n\tif (size == 1) {\r\n\t\tif ((stream.getEndPosition() - stream.getPosition() < 8) || (parentSize && (parentSize - hdr_size) < 8)) {\r\n\t\t\tstream.seek(start);\r\n\t\t\tLog.warn(\"BoxParser\", \"Not enough data in stream to parse the extended size of the \\\"\"+type+\"\\\" box\");\r\n\t\t\treturn { code: BoxParser.ERR_NOT_ENOUGH_DATA };\r\n\t\t}\r\n\t\tsize = stream.readUint64();\r\n\t\thdr_size += 8;\r\n\t} else if (size === 0) {\r\n\t\t/* box extends till the end of file or invalid file */\r\n\t\tif (parentSize) {\r\n\t\t\tsize = parentSize;\r\n\t\t} else {\r\n\t\t\t/* box extends till the end of file */\r\n\t\t\tif (type !== \"mdat\") {\r\n\t\t\t\tLog.error(\"BoxParser\", \"Unlimited box size not supported for type: '\"+type+\"'\");\r\n\t\t\t\tbox = new BoxParser.Box(type, size);\r\n\t\t\t\treturn { code: BoxParser.OK, box: box, size: box.size };\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (size !== 0 && size < hdr_size) {\r\n\t\tLog.error(\"BoxParser\", \"Box of type \"+type+\" has an invalid size \"+size+\" (too small to be a box)\");\r\n\t\treturn { code: BoxParser.ERR_NOT_ENOUGH_DATA, type: type, size: size, hdr_size: hdr_size, start: start };\r\n\t}\r\n\tif (size !== 0 && parentSize && size > parentSize) {\r\n\t\tLog.error(\"BoxParser\", \"Box of type '\"+type+\"' has a size \"+size+\" greater than its container size \"+parentSize);\r\n\t\treturn { code: BoxParser.ERR_NOT_ENOUGH_DATA, type: type, size: size, hdr_size: hdr_size, start: start };\r\n\t}\r\n\tif (size !== 0 && start + size > stream.getEndPosition()) {\r\n\t\tstream.seek(start);\r\n\t\tLog.info(\"BoxParser\", \"Not enough data in stream to parse the entire '\"+type+\"' box\");\r\n\t\treturn { code: BoxParser.ERR_NOT_ENOUGH_DATA, type: type, size: size, hdr_size: hdr_size, start: start };\r\n\t}\r\n\tif (headerOnly) {\r\n\t\treturn { code: BoxParser.OK, type: type, size: size, hdr_size: hdr_size, start: start };\r\n\t} else {\r\n\t\tif (BoxParser[type+\"Box\"]) {\r\n\t\t\tbox = new BoxParser[type+\"Box\"](size);\r\n\t\t} else {\r\n\t\t\tif (type !== \"uuid\") {\r\n\t\t\t\tLog.warn(\"BoxParser\", \"Unknown box type: '\"+type+\"'\");\r\n\t\t\t\tbox = new BoxParser.Box(type, size);\r\n\t\t\t\tbox.has_unparsed_data = true;\r\n\t\t\t} else {\r\n\t\t\t\tif (BoxParser.UUIDBoxes[uuid]) {\r\n\t\t\t\t\tbox = new BoxParser.UUIDBoxes[uuid](size);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tLog.warn(\"BoxParser\", \"Unknown uuid type: '\"+uuid+\"'\");\r\n\t\t\t\t\tbox = new BoxParser.Box(type, size);\r\n\t\t\t\t\tbox.uuid = uuid;\r\n\t\t\t\t\tbox.has_unparsed_data = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tbox.hdr_size = hdr_size;\r\n\t/* recording the position of the box in the input stream */\r\n\tbox.start = start;\r\n\tif (box.write === BoxParser.Box.prototype.write && box.type !== \"mdat\") {\r\n\t\tLog.info(\"BoxParser\", \"'\"+box_type+\"' box writing not yet implemented, keeping unparsed data in memory for later write\");\r\n\t\tbox.parseDataAndRewind(stream);\r\n\t}\r\n\tbox.parse(stream);\r\n\tdiff = stream.getPosition() - (box.start+box.size);\r\n\tif (diff < 0) {\r\n\t\tLog.warn(\"BoxParser\", \"Parsing of box '\"+box_type+\"' did not read the entire indicated box data size (missing \"+(-diff)+\" bytes), seeking forward\");\r\n\t\tstream.seek(box.start+box.size);\r\n\t} else if (diff > 0) {\r\n\t\tLog.error(\"BoxParser\", \"Parsing of box '\"+box_type+\"' read \"+diff+\" more bytes than the indicated box data size, seeking backwards\");\r\n\t\tif (box.size !== 0) stream.seek(box.start+box.size);\r\n\t}\r\n\treturn { code: BoxParser.OK, box: box, size: box.size };\r\n}\r\n\r\nBoxParser.Box.prototype.parse = function(stream) {\r\n\tif (this.type != \"mdat\") {\r\n\t\tthis.data = stream.readUint8Array(this.size-this.hdr_size);\r\n\t} else {\r\n\t\tif (this.size === 0) {\r\n\t\t\tstream.seek(stream.getEndPosition());\r\n\t\t} else {\r\n\t\t\tstream.seek(this.start+this.size);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/* Used to parse a box without consuming its data, to allow detailled parsing\r\n   Useful for boxes for which a write method is not yet implemented */\r\nBoxParser.Box.prototype.parseDataAndRewind = function(stream) {\r\n\tthis.data = stream.readUint8Array(this.size-this.hdr_size);\r\n\t// rewinding\r\n\tstream.position -= this.size-this.hdr_size;\r\n}\r\n\r\nBoxParser.FullBox.prototype.parseDataAndRewind = function(stream) {\r\n\tthis.parseFullHeader(stream);\r\n\tthis.data = stream.readUint8Array(this.size-this.hdr_size);\r\n\t// restore the header size as if the full header had not been parsed\r\n\tthis.hdr_size -= 4;\r\n\t// rewinding\r\n\tstream.position -= this.size-this.hdr_size;\r\n}\r\n\r\nBoxParser.FullBox.prototype.parseFullHeader = function (stream) {\r\n\tthis.version = stream.readUint8();\r\n\tthis.flags = stream.readUint24();\r\n\tthis.hdr_size += 4;\r\n}\r\n\r\nBoxParser.FullBox.prototype.parse = function (stream) {\r\n\tthis.parseFullHeader(stream);\r\n\tthis.data = stream.readUint8Array(this.size-this.hdr_size);\r\n}\r\n\r\nBoxParser.ContainerBox.prototype.parse = function(stream) {\r\n\tvar ret;\r\n\tvar box;\r\n\twhile (stream.getPosition() < this.start+this.size) {\r\n\t\tret = BoxParser.parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\r\n\t\tif (ret.code === BoxParser.OK) {\r\n\t\t\tbox = ret.box;\r\n\t\t\t/* store the box in the 'boxes' array to preserve box order (for offset) but also store box in a property for more direct access */\r\n\t\t\tthis.boxes.push(box);\r\n\t\t\tif (this.subBoxNames && this.subBoxNames.indexOf(box.type) != -1) {\r\n\t\t\t\tthis[this.subBoxNames[this.subBoxNames.indexOf(box.type)]+\"s\"].push(box);\r\n\t\t\t} else {\r\n\t\t\t\tvar box_type = box.type !== \"uuid\" ? box.type : box.uuid;\r\n\t\t\t\tif (this[box_type]) {\r\n\t\t\t\t\tLog.warn(\"Box of type \"+box_type+\" already stored in field of this type\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis[box_type] = box;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nBoxParser.Box.prototype.parseLanguage = function(stream) {\r\n\tthis.language = stream.readUint16();\r\n\tvar chars = [];\r\n\tchars[0] = (this.language>>10)&0x1F;\r\n\tchars[1] = (this.language>>5)&0x1F;\r\n\tchars[2] = (this.language)&0x1F;\r\n\tthis.languageString = String.fromCharCode(chars[0]+0x60, chars[1]+0x60, chars[2]+0x60);\r\n}\r\n\r\n// file:src/parsing/sampleentries/sampleentry.js\r\nBoxParser.SAMPLE_ENTRY_TYPE_VISUAL \t\t= \"Visual\";\r\nBoxParser.SAMPLE_ENTRY_TYPE_AUDIO \t\t= \"Audio\";\r\nBoxParser.SAMPLE_ENTRY_TYPE_HINT \t\t= \"Hint\";\r\nBoxParser.SAMPLE_ENTRY_TYPE_METADATA \t= \"Metadata\";\r\nBoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE \t= \"Subtitle\";\r\nBoxParser.SAMPLE_ENTRY_TYPE_SYSTEM \t\t= \"System\";\r\nBoxParser.SAMPLE_ENTRY_TYPE_TEXT \t\t= \"Text\";\r\n\r\nBoxParser.SampleEntry.prototype.parseHeader = function(stream) {\r\n\tstream.readUint8Array(6);\r\n\tthis.data_reference_index = stream.readUint16();\r\n\tthis.hdr_size += 8;\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.parse = function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tthis.data = stream.readUint8Array(this.size - this.hdr_size);\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.parseDataAndRewind = function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tthis.data = stream.readUint8Array(this.size - this.hdr_size);\r\n\t// restore the header size as if the sample entry header had not been parsed\r\n\tthis.hdr_size -= 8;\r\n\t// rewinding\r\n\tstream.position -= this.size-this.hdr_size;\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.parseFooter = function(stream) {\r\n\tBoxParser.ContainerBox.prototype.parse.call(this, stream);\r\n}\r\n\r\n// Base SampleEntry types with default parsing\r\nBoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_HINT);\r\nBoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA);\r\nBoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE);\r\nBoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SYSTEM);\r\nBoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_TEXT);\r\n\r\n//Base SampleEntry types for Audio and Video with specific parsing\r\nBoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, function(stream) {\r\n\tvar compressorname_length;\r\n\tthis.parseHeader(stream);\r\n\tstream.readUint16();\r\n\tstream.readUint16();\r\n\tstream.readUint32Array(3);\r\n\tthis.width = stream.readUint16();\r\n\tthis.height = stream.readUint16();\r\n\tthis.horizresolution = stream.readUint32();\r\n\tthis.vertresolution = stream.readUint32();\r\n\tstream.readUint32();\r\n\tthis.frame_count = stream.readUint16();\r\n\tcompressorname_length = Math.min(31, stream.readUint8());\r\n\tthis.compressorname = stream.readString(compressorname_length);\r\n\tif (compressorname_length < 31) {\r\n\t\tstream.readString(31 - compressorname_length);\r\n\t}\r\n\tthis.depth = stream.readUint16();\r\n\tstream.readUint16();\r\n\tthis.parseFooter(stream);\r\n});\r\n\r\nBoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tstream.readUint32Array(2);\r\n\tthis.channel_count = stream.readUint16();\r\n\tthis.samplesize = stream.readUint16();\r\n\tstream.readUint16();\r\n\tstream.readUint16();\r\n\tthis.samplerate = (stream.readUint32()/(1<<16));\r\n\tthis.parseFooter(stream);\r\n});\r\n\r\n// Sample entries inheriting from Audio and Video\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"avc1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"avc2\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"avc3\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"avc4\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"av01\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"dav1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"hvc1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"hev1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"hvt1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"lhe1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"dvh1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"dvhe\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"vvc1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"vvi1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"vvs1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"vvcN\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"vp08\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"vp09\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"avs3\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"j2ki\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"mjp2\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \"mjpg\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,\t\"uncv\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"mp4a\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"ac-3\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"ac-4\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"ec-3\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"Opus\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"mha1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"mha2\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"mhm1\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"mhm2\");\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"fLaC\");\r\n\r\n// Encrypted sample entries\r\nBoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL, \t\"encv\");\r\nBoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO, \t\"enca\");\r\nBoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE, \t\"encu\");\r\nBoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SYSTEM, \t\"encs\");\r\nBoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_TEXT, \t\t\"enct\");\r\nBoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA, \t\"encm\");\r\n// file:src/parsing/a1lx.js\r\nBoxParser.createBoxCtor(\"a1lx\", \"AV1LayeredImageIndexingProperty\", function(stream) {\r\n\tvar large_size = stream.readUint8() & 1;\r\n\tvar FieldLength = ((large_size & 1) + 1) * 16;\r\n\tthis.layer_size = [];\r\n\tfor (var i = 0; i < 3; i++) {\r\n\t\tif (FieldLength == 16) {\r\n\t\t\tthis.layer_size[i] = stream.readUint16();\r\n\t\t} else {\r\n\t\t\tthis.layer_size[i] = stream.readUint32();\r\n\t\t}\r\n\t}\r\n});// file:src/parsing/a1op.js\r\nBoxParser.createBoxCtor(\"a1op\", \"OperatingPointSelectorProperty\", function(stream) {\r\n\tthis.op_index = stream.readUint8();\r\n});// file:src/parsing/auxC.js\r\nBoxParser.createFullBoxCtor(\"auxC\", \"AuxiliaryTypeProperty\", function(stream) {\r\n\tthis.aux_type = stream.readCString();\r\n\tvar aux_subtype_length = this.size - this.hdr_size - (this.aux_type.length + 1);\r\n\tthis.aux_subtype = stream.readUint8Array(aux_subtype_length);\r\n});// file:src/parsing/av1C.js\r\nBoxParser.createBoxCtor(\"av1C\", \"AV1CodecConfigurationBox\", function(stream) {\r\n\tvar i;\r\n\tvar toparse;\r\n\tvar tmp = stream.readUint8();\r\n\tif ((tmp >> 7 & 0x1) !== 1) {\r\n\t\tLog.error(\"av1C marker problem\");\r\n\t\treturn;\r\n\t}\r\n\tthis.version = tmp & 0x7F;\r\n\tif (this.version !== 1) {\r\n\t\tLog.error(\"av1C version \"+this.version+\" not supported\");\r\n\t\treturn;\r\n\t}\r\n\ttmp = stream.readUint8();\r\n\tthis.seq_profile = (tmp >> 5) & 0x7;\r\n\tthis.seq_level_idx_0 = tmp & 0x1F;\r\n\ttmp = stream.readUint8();\r\n\tthis.seq_tier_0 = (tmp >> 7) & 0x1;\r\n\tthis.high_bitdepth = (tmp >> 6) & 0x1;\r\n\tthis.twelve_bit = (tmp >> 5) & 0x1;\r\n\tthis.monochrome = (tmp >> 4) & 0x1;\r\n\tthis.chroma_subsampling_x = (tmp >> 3) & 0x1;\r\n\tthis.chroma_subsampling_y = (tmp >> 2) & 0x1;\r\n\tthis.chroma_sample_position = (tmp & 0x3);\r\n\ttmp = stream.readUint8();\r\n\tthis.reserved_1 = (tmp >> 5) & 0x7;\r\n\tif (this.reserved_1 !== 0) {\r\n\t\tLog.error(\"av1C reserved_1 parsing problem\");\r\n\t\treturn;\r\n\t}\r\n\tthis.initial_presentation_delay_present = (tmp >> 4) & 0x1;\r\n\tif (this.initial_presentation_delay_present === 1) {\r\n\t\tthis.initial_presentation_delay_minus_one = (tmp & 0xF);\r\n\t} else {\r\n\t\tthis.reserved_2 = (tmp & 0xF);\r\n\t\tif (this.reserved_2 !== 0) {\r\n\t\t\tLog.error(\"av1C reserved_2 parsing problem\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tvar configOBUs_length = this.size - this.hdr_size - 4;\r\n\tthis.configOBUs = stream.readUint8Array(configOBUs_length);\r\n});\r\n\r\n// file:src/parsing/avcC.js\r\nfunction printPS(ps) {\r\n\tvar str = \"<table class='inner-table'>\";\r\n\tstr += \"<thead><tr><th>length</th><th>nalu_data</th></tr></thead>\";\r\n\tstr += \"<tbody>\";\r\n\r\n\tfor (var i=0; i < ps.length; i++) {\r\n\t\tvar nalu = ps[i];\r\n\t\tstr += \"<tr>\";\r\n\t\tstr += \"<td>\"+nalu.length+\"</td>\";\r\n\t\tstr += \"<td>\";\r\n\t\tstr += nalu.nalu.reduce(function(str, byte) {\r\n\t\t\treturn str + byte.toString(16).padStart(2, \"0\");\r\n\t\t}, \"0x\");\r\n\t\tstr += \"</td></tr>\";\r\n\t}\r\n\tstr += \"</tbody></table>\";\r\n\treturn str;\r\n}\r\n\r\nBoxParser.createBoxCtor(\"avcC\", \"AVCConfigurationBox\", function(stream) {\r\n\tvar i;\r\n\tvar toparse;\r\n\tthis.configurationVersion = stream.readUint8();\r\n\tthis.AVCProfileIndication = stream.readUint8();\r\n\tthis.profile_compatibility = stream.readUint8();\r\n\tthis.AVCLevelIndication = stream.readUint8();\r\n\tthis.lengthSizeMinusOne = (stream.readUint8() & 0x3);\r\n\tthis.nb_SPS_nalus = (stream.readUint8() & 0x1F);\r\n\ttoparse = this.size - this.hdr_size - 6;\r\n\tthis.SPS = [];\r\n\tthis.SPS.toString = function () {\r\n\t\treturn printPS(this);\r\n\t}\r\n\tfor (i = 0; i < this.nb_SPS_nalus; i++) {\r\n\t\tthis.SPS[i] = {};\r\n\t\tthis.SPS[i].length = stream.readUint16();\r\n\t\tthis.SPS[i].nalu = stream.readUint8Array(this.SPS[i].length);\r\n\t\ttoparse -= 2+this.SPS[i].length;\r\n\t}\r\n\tthis.nb_PPS_nalus = stream.readUint8();\r\n\ttoparse--;\r\n\tthis.PPS = [];\r\n\tthis.PPS.toString = function () {\r\n\t\treturn printPS(this);\r\n\t}\r\n\tfor (i = 0; i < this.nb_PPS_nalus; i++) {\r\n\t\tthis.PPS[i] = {};\r\n\t\tthis.PPS[i].length = stream.readUint16();\r\n\t\tthis.PPS[i].nalu = stream.readUint8Array(this.PPS[i].length);\r\n\t\ttoparse -= 2+this.PPS[i].length;\r\n\t}\r\n\tif (toparse>0) {\r\n\t\tthis.ext = stream.readUint8Array(toparse);\r\n\t}\r\n});\r\n\r\n// file:src/parsing/btrt.js\r\nBoxParser.createBoxCtor(\"btrt\", \"BitRateBox\", function(stream) {\r\n\tthis.bufferSizeDB = stream.readUint32();\r\n\tthis.maxBitrate = stream.readUint32();\r\n\tthis.avgBitrate = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/ccst.js\r\nBoxParser.createFullBoxCtor(\"ccst\", \"CodingConstraintsBox\", function(stream) {\r\n\tvar flags = stream.readUint8();\r\n\tthis.all_ref_pics_intra = ((flags & 0x80) == 0x80);\r\n\tthis.intra_pred_used = ((flags & 0x40) == 0x40);\r\n\tthis.max_ref_per_pic = ((flags & 0x3f) >> 2);\r\n\tstream.readUint24();\r\n});\r\n\r\n// file:src/parsing/cdef.js\r\nBoxParser.createBoxCtor(\"cdef\", \"ComponentDefinitionBox\", function(stream) {\r\n    var i;\r\n    this.channel_count = stream.readUint16();\r\n    this.channel_indexes = [];\r\n    this.channel_types = [];\r\n    this.channel_associations = [];\r\n    for (i = 0; i < this.channel_count; i++) {\r\n        this.channel_indexes.push(stream.readUint16());\r\n        this.channel_types.push(stream.readUint16());\r\n        this.channel_associations.push(stream.readUint16());\r\n    }\r\n});\r\n\r\n// file:src/parsing/clap.js\r\nBoxParser.createBoxCtor(\"clap\", \"CleanApertureBox\", function(stream) {\r\n\tthis.cleanApertureWidthN = stream.readUint32();\r\n\tthis.cleanApertureWidthD = stream.readUint32();\r\n\tthis.cleanApertureHeightN = stream.readUint32();\r\n\tthis.cleanApertureHeightD = stream.readUint32();\r\n\tthis.horizOffN = stream.readUint32();\r\n\tthis.horizOffD = stream.readUint32();\r\n\tthis.vertOffN = stream.readUint32();\r\n\tthis.vertOffD = stream.readUint32();\r\n});// file:src/parsing/clli.js\r\nBoxParser.createBoxCtor(\"clli\", \"ContentLightLevelBox\", function(stream) {\r\n\tthis.max_content_light_level = stream.readUint16();\r\n    this.max_pic_average_light_level = stream.readUint16();\r\n});\r\n\r\n// file:src/parsing/cmex.js\r\nBoxParser.createFullBoxCtor(\"cmex\", \"CameraExtrinsicMatrixProperty\", function(stream) {\r\n\tif (this.flags & 0x1) {\r\n\t\tthis.pos_x = stream.readInt32();\r\n\t}\r\n\tif (this.flags & 0x2) {\r\n\t\tthis.pos_y = stream.readInt32();\r\n\t}\r\n\tif (this.flags & 0x4) {\r\n\t\tthis.pos_z = stream.readInt32();\r\n\t}\r\n\tif (this.flags & 0x8) {\r\n\t\tif (this.version == 0) {\r\n\t\t\tif (this.flags & 0x10) {\r\n\t\t\t\tthis.quat_x = stream.readInt32();\r\n\t\t\t\tthis.quat_y = stream.readInt32();\r\n\t\t\t\tthis.quat_z = stream.readInt32();\r\n\t\t\t} else {\r\n\t\t\t\tthis.quat_x = stream.readInt16();\r\n\t\t\t\tthis.quat_y = stream.readInt16();\r\n\t\t\t\tthis.quat_z = stream.readInt16();\r\n\t\t\t}\r\n\t\t} else if (this.version == 1) {\r\n\t\t\t//ViewpointGlobalCoordinateSysRotationStruct rot;\r\n\t\t}\r\n\t}\r\n\tif (this.flags & 0x20) {\r\n\t\tthis.id = stream.readUint32();\r\n\t}\r\n});\r\n// file:src/parsing/cmin.js\r\nBoxParser.createFullBoxCtor(\"cmin\", \"CameraIntrinsicMatrixProperty\", function(stream) {\r\n\tthis.focal_length_x = stream.readInt32();\r\n\tthis.principal_point_x = stream.readInt32();\r\n\tthis.principal_point_y = stream.readInt32();\r\n\tif (this.flags & 0x1) {\r\n\t\tthis.focal_length_y = stream.readInt32();\r\n\t\tthis.skew_factor = stream.readInt32();\r\n\t}\r\n});// file:src/parsing/cmpd.js\r\nBoxParser.createBoxCtor(\"cmpd\", \"ComponentDefinitionBox\", function(stream) {\r\n\tthis.component_count = stream.readUint32();\r\n\tthis.component_types = [];\r\n\tthis.component_type_urls = [];\r\n\tfor (i = 0; i < this.component_count; i++) {\r\n\t\tvar component_type = stream.readUint16();\r\n\t\tthis.component_types.push(component_type);\r\n\t\tif (component_type >= 0x8000) {\r\n\t\t\tthis.component_type_urls.push(stream.readCString());\r\n\t\t}\r\n\t}\r\n});// file:src/parsing/co64.js\r\nBoxParser.createFullBoxCtor(\"co64\", \"ChunkLargeOffsetBox\", function(stream) {\r\n\tvar entry_count;\r\n\tvar i;\r\n\tentry_count = stream.readUint32();\r\n\tthis.chunk_offsets = [];\r\n\tif (this.version === 0) {\r\n\t\tfor(i=0; i<entry_count; i++) {\r\n\t\t\tthis.chunk_offsets.push(stream.readUint64());\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/CoLL.js\r\nBoxParser.createFullBoxCtor(\"CoLL\", \"ContentLightLevelBox\", function(stream) {\r\n\tthis.maxCLL = stream.readUint16();\r\n    this.maxFALL = stream.readUint16();\r\n});\r\n\r\n// file:src/parsing/colr.js\r\nBoxParser.createBoxCtor(\"colr\", \"ColourInformationBox\", function(stream) {\r\n\tthis.colour_type = stream.readString(4);\r\n\tif (this.colour_type === 'nclx') {\r\n\t\tthis.colour_primaries = stream.readUint16();\r\n\t\tthis.transfer_characteristics = stream.readUint16();\r\n\t\tthis.matrix_coefficients = stream.readUint16();\r\n\t\tvar tmp = stream.readUint8();\r\n\t\tthis.full_range_flag = tmp >> 7;\r\n\t} else if (this.colour_type === 'rICC') {\r\n\t\tthis.ICC_profile = stream.readUint8Array(this.size - 4);\r\n\t} else if (this.colour_type === 'prof') {\r\n\t\tthis.ICC_profile = stream.readUint8Array(this.size - 4);\r\n\t}\r\n});// file:src/parsing/cprt.js\r\nBoxParser.createFullBoxCtor(\"cprt\", \"CopyrightBox\", function (stream) {\r\n\tthis.parseLanguage(stream);\r\n\tthis.notice = stream.readCString();\r\n});\r\n\r\n// file:src/parsing/cslg.js\r\nBoxParser.createFullBoxCtor(\"cslg\", \"CompositionToDecodeBox\", function(stream) {\r\n\tvar entry_count;\r\n\tif (this.version === 0) {\r\n\t\tthis.compositionToDTSShift = stream.readInt32(); /* signed */\r\n\t\tthis.leastDecodeToDisplayDelta = stream.readInt32(); /* signed */\r\n\t\tthis.greatestDecodeToDisplayDelta = stream.readInt32(); /* signed */\r\n\t\tthis.compositionStartTime = stream.readInt32(); /* signed */\r\n\t\tthis.compositionEndTime = stream.readInt32(); /* signed */\r\n\t}\r\n});\r\n\r\n// file:src/parsing/ctts.js\r\nBoxParser.createFullBoxCtor(\"ctts\", \"CompositionOffsetBox\", function(stream) {\r\n\tvar entry_count;\r\n\tvar i;\r\n\tentry_count = stream.readUint32();\r\n\tthis.sample_counts = [];\r\n\tthis.sample_offsets = [];\r\n\tif (this.version === 0) {\r\n\t\tfor(i=0; i<entry_count; i++) {\r\n\t\t\tthis.sample_counts.push(stream.readUint32());\r\n\t\t\t/* some files are buggy and declare version=0 while using signed offsets.\r\n\t\t\t   The likelyhood of using the most significant bit in a 32-bits time offset is very low,\r\n\t\t\t   so using signed value here as well */\r\n\t\t\t   var value = stream.readInt32();\r\n\t\t\t   if (value < 0) {\r\n\t\t\t   \t\tLog.warn(\"BoxParser\", \"ctts box uses negative values without using version 1\");\r\n\t\t\t   }\r\n\t\t\tthis.sample_offsets.push(value);\r\n\t\t}\r\n\t} else if (this.version == 1) {\r\n\t\tfor(i=0; i<entry_count; i++) {\r\n\t\t\tthis.sample_counts.push(stream.readUint32());\r\n\t\t\tthis.sample_offsets.push(stream.readInt32()); /* signed */\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/dac3.js\r\nBoxParser.createBoxCtor(\"dac3\", \"AC3SpecificBox\", function(stream) {\r\n\tvar tmp_byte1 = stream.readUint8();\r\n\tvar tmp_byte2 = stream.readUint8();\r\n\tvar tmp_byte3 = stream.readUint8();\r\n\tthis.fscod = tmp_byte1 >> 6;\r\n\tthis.bsid  = ((tmp_byte1 >> 1) & 0x1F);\r\n\tthis.bsmod = ((tmp_byte1 & 0x1) <<  2) | ((tmp_byte2 >> 6) & 0x3);\r\n\tthis.acmod = ((tmp_byte2 >> 3) & 0x7);\r\n\tthis.lfeon = ((tmp_byte2 >> 2) & 0x1);\r\n\tthis.bit_rate_code = (tmp_byte2 & 0x3) | ((tmp_byte3 >> 5) & 0x7);\r\n});\r\n\r\n// file:src/parsing/dec3.js\r\nBoxParser.createBoxCtor(\"dec3\", \"EC3SpecificBox\", function(stream) {\r\n\tvar tmp_16 = stream.readUint16();\r\n\tthis.data_rate = tmp_16 >> 3;\r\n\tthis.num_ind_sub = tmp_16 & 0x7;\r\n\tthis.ind_subs = [];\r\n\tfor (var i = 0; i < this.num_ind_sub+1; i++) {\r\n\t\tvar ind_sub = {};\r\n\t\tthis.ind_subs.push(ind_sub);\r\n\t\tvar tmp_byte1 = stream.readUint8();\r\n\t\tvar tmp_byte2 = stream.readUint8();\r\n\t\tvar tmp_byte3 = stream.readUint8();\r\n\t\tind_sub.fscod = tmp_byte1 >> 6;\r\n\t\tind_sub.bsid  = ((tmp_byte1 >> 1) & 0x1F);\r\n\t\tind_sub.bsmod = ((tmp_byte1 & 0x1) << 4) | ((tmp_byte2 >> 4) & 0xF);\r\n\t\tind_sub.acmod = ((tmp_byte2 >> 1) & 0x7);\r\n\t\tind_sub.lfeon = (tmp_byte2 & 0x1);\r\n\t\tind_sub.num_dep_sub = ((tmp_byte3 >> 1) & 0xF);\r\n\t\tif (ind_sub.num_dep_sub > 0) {\r\n\t\t\tind_sub.chan_loc = ((tmp_byte3 & 0x1) << 8) | stream.readUint8();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/dfLa.js\r\nBoxParser.createFullBoxCtor(\"dfLa\", \"FLACSpecificBox\", function(stream) {\r\n    var BLOCKTYPE_MASK = 0x7F;\r\n    var LASTMETADATABLOCKFLAG_MASK = 0x80;\r\n\r\n    var boxesFound = [];\r\n    var knownBlockTypes = [\r\n        \"STREAMINFO\",\r\n        \"PADDING\",\r\n        \"APPLICATION\",\r\n        \"SEEKTABLE\",\r\n        \"VORBIS_COMMENT\",\r\n        \"CUESHEET\",\r\n        \"PICTURE\",\r\n        \"RESERVED\"\r\n    ];\r\n\r\n    // for (i=0; ; i++) { // to end of box\r\n    do {\r\n        var flagAndType = stream.readUint8();\r\n\r\n        var type = Math.min(\r\n            (flagAndType & BLOCKTYPE_MASK),\r\n            (knownBlockTypes.length - 1)\r\n        );\r\n\r\n        // if this is a STREAMINFO block, read the true samplerate since this\r\n        // can be different to the AudioSampleEntry samplerate.\r\n        if (!(type)) {\r\n            // read past all the other stuff\r\n            stream.readUint8Array(13);\r\n\r\n            // extract samplerate\r\n            this.samplerate = (stream.readUint32() >> 12);\r\n\r\n            // read to end of STREAMINFO\r\n            stream.readUint8Array(20);\r\n        } else {\r\n            // not interested in other block types so just discard length bytes\r\n            stream.readUint8Array(stream.readUint24());\r\n        }\r\n\r\n        boxesFound.push(knownBlockTypes[type]);\r\n\r\n        if (!!(flagAndType & LASTMETADATABLOCKFLAG_MASK)) {\r\n            break;\r\n        }\r\n    } while (true);\r\n\r\n    this.numMetadataBlocks =\r\n        boxesFound.length + \" (\" + boxesFound.join(\", \") + \")\";\r\n});\r\n// file:src/parsing/dimm.js\r\nBoxParser.createBoxCtor(\"dimm\", \"hintimmediateBytesSent\", function(stream) {\r\n\tthis.bytessent = stream.readUint64();\r\n});\r\n\r\n// file:src/parsing/dmax.js\r\nBoxParser.createBoxCtor(\"dmax\", \"hintlongestpacket\", function(stream) {\r\n\tthis.time = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/dmed.js\r\nBoxParser.createBoxCtor(\"dmed\", \"hintmediaBytesSent\", function(stream) {\r\n\tthis.bytessent = stream.readUint64();\r\n});\r\n\r\n// file:src/parsing/dOps.js\r\nBoxParser.createBoxCtor(\"dOps\", \"OpusSpecificBox\", function(stream) {\r\n\tthis.Version = stream.readUint8();\r\n\tthis.OutputChannelCount = stream.readUint8();\r\n\tthis.PreSkip = stream.readUint16();\r\n\tthis.InputSampleRate = stream.readUint32();\r\n\tthis.OutputGain = stream.readInt16();\r\n\tthis.ChannelMappingFamily = stream.readUint8();\r\n\tif (this.ChannelMappingFamily !== 0) {\r\n\t\tthis.StreamCount = stream.readUint8();\r\n\t\tthis.CoupledCount = stream.readUint8();\r\n\t\tthis.ChannelMapping = [];\r\n\t\tfor (var i = 0; i < this.OutputChannelCount; i++) {\r\n\t\t\tthis.ChannelMapping[i] = stream.readUint8();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/dref.js\r\nBoxParser.createFullBoxCtor(\"dref\", \"DataReferenceBox\", function(stream) {\r\n\tvar ret;\r\n\tvar box;\r\n\tthis.entries = [];\r\n\tvar entry_count = stream.readUint32();\r\n\tfor (var i = 0; i < entry_count; i++) {\r\n\t\tret = BoxParser.parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\r\n\t\tif (ret.code === BoxParser.OK) {\r\n\t\t\tbox = ret.box;\r\n\t\t\tthis.entries.push(box);\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/drep.js\r\nBoxParser.createBoxCtor(\"drep\", \"hintrepeatedBytesSent\", function(stream) {\r\n\tthis.bytessent = stream.readUint64();\r\n});\r\n\r\n// file:src/parsing/elng.js\r\nBoxParser.createFullBoxCtor(\"elng\", \"ExtendedLanguageBox\", function(stream) {\r\n\tthis.extended_language = stream.readString(this.size-this.hdr_size);\r\n});\r\n\r\n// file:src/parsing/elst.js\r\nBoxParser.createFullBoxCtor(\"elst\", \"EditListBox\", function(stream) {\r\n\tthis.entries = [];\r\n\tvar entry_count = stream.readUint32();\r\n\tfor (var i = 0; i < entry_count; i++) {\r\n\t\tvar entry = {};\r\n\t\tthis.entries.push(entry);\r\n\t\tif (this.version === 1) {\r\n\t\t\tentry.segment_duration = stream.readUint64();\r\n\t\t\tentry.media_time = stream.readInt64();\r\n\t\t} else {\r\n\t\t\tentry.segment_duration = stream.readUint32();\r\n\t\t\tentry.media_time = stream.readInt32();\r\n\t\t}\r\n\t\tentry.media_rate_integer = stream.readInt16();\r\n\t\tentry.media_rate_fraction = stream.readInt16();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/emsg.js\r\nBoxParser.createFullBoxCtor(\"emsg\", \"EventMessageBox\", function(stream) {\r\n\tif (this.version == 1) {\r\n\t\tthis.timescale \t\t\t\t\t= stream.readUint32();\r\n\t\tthis.presentation_time \t\t\t= stream.readUint64();\r\n\t\tthis.event_duration\t\t\t \t= stream.readUint32();\r\n\t\tthis.id \t\t\t\t\t\t= stream.readUint32();\r\n\t\tthis.scheme_id_uri \t\t\t\t= stream.readCString();\r\n\t\tthis.value \t\t\t\t\t\t= stream.readCString();\r\n\t} else {\r\n\t\tthis.scheme_id_uri \t\t\t\t= stream.readCString();\r\n\t\tthis.value \t\t\t\t\t\t= stream.readCString();\r\n\t\tthis.timescale \t\t\t\t\t= stream.readUint32();\r\n\t\tthis.presentation_time_delta \t= stream.readUint32();\r\n\t\tthis.event_duration\t\t\t \t= stream.readUint32();\r\n\t\tthis.id \t\t\t\t\t\t= stream.readUint32();\r\n\t}\r\n\tvar message_size = this.size - this.hdr_size - (4*4 + (this.scheme_id_uri.length+1) + (this.value.length+1));\r\n\tif (this.version == 1) {\r\n\t\tmessage_size -= 4;\r\n\t}\r\n\tthis.message_data = stream.readUint8Array(message_size);\r\n});\r\n\r\n// file:src/parsing/EntityToGroup.js\r\n// ISO/IEC 14496-12:2022 Section 8.18.3 Entity to group box\r\nBoxParser.createEntityToGroupCtor = function(type, parseMethod) {\r\n    BoxParser[type+\"Box\"] = function(size) {\r\n        BoxParser.FullBox.call(this, type, size);\r\n    }\r\n    BoxParser[type+\"Box\"].prototype = new BoxParser.FullBox();\r\n    BoxParser[type+\"Box\"].prototype.parse = function(stream) {\r\n        this.parseFullHeader(stream);\r\n        if (parseMethod) {\r\n            parseMethod.call(this, stream);\r\n        } else {\r\n            this.group_id = stream.readUint32();\r\n            this.num_entities_in_group = stream.readUint32();\r\n            this.entity_ids = [];\r\n            for (i = 0; i < this.num_entities_in_group; i++) {\r\n                var entity_id = stream.readUint32();\r\n                this.entity_ids.push(entity_id);\r\n            }\r\n        }\r\n    };\r\n};\r\n\r\n// Auto exposure bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.2.1)\r\nBoxParser.createEntityToGroupCtor(\"aebr\");\r\n\r\n// Flash exposure bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.5.1)\r\nBoxParser.createEntityToGroupCtor(\"afbr\");\r\n\r\n// Album collection (ISO/IEC 23008-12:2022 Section 6.8.7.1)\r\nBoxParser.createEntityToGroupCtor(\"albc\");\r\n\r\n// Alternative entity (ISO/IEC 14496-12:2022 Section 8.18.3.1)\r\nBoxParser.createEntityToGroupCtor(\"altr\");\r\n\r\n// Burst image entity group (ISO/IEC 23008-12:2022 Section 6.8.2.2)\r\nBoxParser.createEntityToGroupCtor(\"brst\");\r\n\r\n// Depth of field bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.6.1)\r\nBoxParser.createEntityToGroupCtor(\"dobr\");\r\n\r\n// Equivalent entity (ISO/IEC 23008-12:2022 Section 6.8.1.1)\r\nBoxParser.createEntityToGroupCtor(\"eqiv\");\r\n\r\n// Favourites collection (ISO/IEC 23008-12:2022 Section 6.8.7.2)\r\nBoxParser.createEntityToGroupCtor(\"favc\");\r\n\r\n// Focus bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.4.1)\r\nBoxParser.createEntityToGroupCtor(\"fobr\");\r\n\r\n// Audio to image entity group (ISO/IEC 23008-12:2022 Section 6.8.4)\r\nBoxParser.createEntityToGroupCtor(\"iaug\");\r\n\r\n// Panorama (ISO/IEC 23008-12:2022 Section 6.8.8.1)\r\nBoxParser.createEntityToGroupCtor(\"pano\");\r\n\r\n// Slideshow (ISO/IEC 23008-12:2022 Section 6.8.9.1)\r\nBoxParser.createEntityToGroupCtor(\"slid\");\r\n\r\n// Stereo pair (ISO/IEC 23008-12:2022 Section 6.8.5)\r\nBoxParser.createEntityToGroupCtor(\"ster\");\r\n\r\n// Time-synchronised capture entity group (ISO/IEC 23008-12:2022 Section 6.8.3)\r\nBoxParser.createEntityToGroupCtor(\"tsyn\");\r\n\r\n// White balance bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.3.1)\r\nBoxParser.createEntityToGroupCtor(\"wbbr\");\r\n\r\n// Alternative entity (ISO/IEC 23008-12:2022 AMD1 Section 6.8.10)\r\nBoxParser.createEntityToGroupCtor(\"prgr\");\r\n\r\n// Image Pyramid entity group (ISO/IEC 23008-12:20xx Section 6.8.11)\r\nBoxParser.createEntityToGroupCtor(\"pymd\", function(stream) {\r\n    this.group_id = stream.readUint32();\r\n    this.num_entities_in_group = stream.readUint32();\r\n    this.entity_ids = [];\r\n    for (var i = 0; i < this.num_entities_in_group; i++) {\r\n        var entity_id = stream.readUint32();\r\n        this.entity_ids.push(entity_id);\r\n    }\r\n    \r\n    this.tile_size_x = stream.readUint16();\r\n    this.tile_size_y = stream.readUint16();\r\n    this.layer_binning = [];\r\n    this.tiles_in_layer_column_minus1 = [];\r\n    this.tiles_in_layer_row_minus1 = [];\r\n    for (i = 0; i < this.num_entities_in_group; i++) {\r\n        this.layer_binning[i] = stream.readUint16();\r\n        this.tiles_in_layer_row_minus1[i] = stream.readUint16();\r\n        this.tiles_in_layer_column_minus1[i] = stream.readUint16();\r\n    }\r\n});\r\n\r\n// file:src/parsing/esds.js\r\nBoxParser.createFullBoxCtor(\"esds\", \"ElementaryStreamDescriptorBox\", function(stream) {\r\n\tvar esd_data = stream.readUint8Array(this.size-this.hdr_size);\r\n\tif (typeof MPEG4DescriptorParser !== \"undefined\") {\r\n\t\tvar esd_parser = new MPEG4DescriptorParser();\r\n\t\tthis.esd = esd_parser.parseOneDescriptor(new DataStream(esd_data.buffer, 0, DataStream.BIG_ENDIAN));\r\n\t}\r\n});\r\n\r\n// file:src/parsing/fiel.js\r\nBoxParser.createBoxCtor(\"fiel\", \"FieldHandlingBox\", function(stream) {\r\n\tthis.fieldCount = stream.readUint8();\r\n\tthis.fieldOrdering = stream.readUint8();\r\n});\r\n\r\n// file:src/parsing/frma.js\r\nBoxParser.createBoxCtor(\"frma\", \"OriginalFormatBox\", function(stream) {\r\n\tthis.data_format = stream.readString(4);\r\n});\r\n\r\n// file:src/parsing/ftyp.js\r\nBoxParser.createBoxCtor(\"ftyp\", \"FileTypeBox\", function(stream) {\r\n\tvar toparse = this.size - this.hdr_size;\r\n\tthis.major_brand = stream.readString(4);\r\n\tthis.minor_version = stream.readUint32();\r\n\ttoparse -= 8;\r\n\tthis.compatible_brands = [];\r\n\tvar i = 0;\r\n\twhile (toparse>=4) {\r\n\t\tthis.compatible_brands[i] = stream.readString(4);\r\n\t\ttoparse -= 4;\r\n\t\ti++;\r\n\t}\r\n});\r\n\r\n// file:src/parsing/hdlr.js\r\nBoxParser.createFullBoxCtor(\"hdlr\", \"HandlerBox\", function(stream) {\r\n\tif (this.version === 0) {\r\n\t\tstream.readUint32();\r\n\t\tthis.handler = stream.readString(4);\r\n\t\tstream.readUint32Array(3);\r\n\t\tthis.name = stream.readString(this.size-this.hdr_size-20);\r\n\t\tif (this.name[this.name.length-1]==='\\0') {\r\n\t\t\tthis.name = this.name.slice(0,-1);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/hvcC.js\r\nBoxParser.createBoxCtor(\"hvcC\", \"HEVCConfigurationBox\", function(stream) {\r\n\tvar i, j;\r\n\tvar nb_nalus;\r\n\tvar length;\r\n\tvar tmp_byte;\r\n\tthis.configurationVersion = stream.readUint8();\r\n\ttmp_byte = stream.readUint8();\r\n\tthis.general_profile_space = tmp_byte >> 6;\r\n\tthis.general_tier_flag = (tmp_byte & 0x20) >> 5;\r\n\tthis.general_profile_idc = (tmp_byte & 0x1F);\r\n\tthis.general_profile_compatibility = stream.readUint32();\r\n\tthis.general_constraint_indicator = stream.readUint8Array(6);\r\n\tthis.general_level_idc = stream.readUint8();\r\n\tthis.min_spatial_segmentation_idc = stream.readUint16() & 0xFFF;\r\n\tthis.parallelismType = (stream.readUint8() & 0x3);\r\n\tthis.chroma_format_idc = (stream.readUint8() & 0x3);\r\n\tthis.bit_depth_luma_minus8 = (stream.readUint8() & 0x7);\r\n\tthis.bit_depth_chroma_minus8 = (stream.readUint8() & 0x7);\r\n\tthis.avgFrameRate = stream.readUint16();\r\n\ttmp_byte = stream.readUint8();\r\n\tthis.constantFrameRate = (tmp_byte >> 6);\r\n\tthis.numTemporalLayers = (tmp_byte & 0XD) >> 3;\r\n\tthis.temporalIdNested = (tmp_byte & 0X4) >> 2;\r\n\tthis.lengthSizeMinusOne = (tmp_byte & 0X3);\r\n\r\n\tthis.nalu_arrays = [];\r\n\tthis.nalu_arrays.toString = function () {\r\n\t\tvar str = \"<table class='inner-table'>\";\r\n\t\tstr += \"<thead><tr><th>completeness</th><th>nalu_type</th><th>nalu_data</th></tr></thead>\";\r\n\t\tstr += \"<tbody>\";\r\n\r\n\t\tfor (var i=0; i<this.length; i++) {\r\n\t\t\tvar nalu_array = this[i];\r\n\t\t\tstr += \"<tr>\";\r\n\t\t\tstr += \"<td rowspan='\"+nalu_array.length+\"'>\"+nalu_array.completeness+\"</td>\";\r\n\t\t\tstr += \"<td rowspan='\"+nalu_array.length+\"'>\"+nalu_array.nalu_type+\"</td>\";\r\n\t\t\tfor (var j=0; j<nalu_array.length; j++) {\r\n\t\t\t\tvar nalu = nalu_array[j];\r\n\t\t\t\tif (j !== 0) str += \"<tr>\";\r\n\t\t\t\tstr += \"<td>\";\r\n\t\t\t\tstr += nalu.data.reduce(function(str, byte) {\r\n\t\t\t\t\treturn str + byte.toString(16).padStart(2, \"0\");\r\n\t\t\t\t}, \"0x\");\r\n\t\t\t\tstr += \"</td></tr>\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tstr += \"</tbody></table>\";\r\n\t\treturn str;\r\n\t}\r\n\tvar numOfArrays = stream.readUint8();\r\n\tfor (i = 0; i < numOfArrays; i++) {\r\n\t\tvar nalu_array = [];\r\n\t\tthis.nalu_arrays.push(nalu_array);\r\n\t\ttmp_byte = stream.readUint8()\r\n\t\tnalu_array.completeness = (tmp_byte & 0x80) >> 7;\r\n\t\tnalu_array.nalu_type = tmp_byte & 0x3F;\r\n\t\tvar numNalus = stream.readUint16();\r\n\t\tfor (j = 0; j < numNalus; j++) {\r\n\t\t\tvar nalu = {}\r\n\t\t\tnalu_array.push(nalu);\r\n\t\t\tlength = stream.readUint16();\r\n\t\t\tnalu.data   = stream.readUint8Array(length);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/iinf.js\r\nBoxParser.createFullBoxCtor(\"iinf\", \"ItemInfoBox\", function(stream) {\r\n\tvar ret;\r\n\tif (this.version === 0) {\r\n\t\tthis.entry_count = stream.readUint16();\r\n\t} else {\r\n\t\tthis.entry_count = stream.readUint32();\r\n\t}\r\n\tthis.item_infos = [];\r\n\tfor (var i = 0; i < this.entry_count; i++) {\r\n\t\tret = BoxParser.parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\r\n\t\tif (ret.code === BoxParser.OK) {\r\n\t\t\tif (ret.box.type !== \"infe\") {\r\n\t\t\t\tLog.error(\"BoxParser\", \"Expected 'infe' box, got \"+ret.box.type);\r\n\t\t\t}\r\n\t\t\tthis.item_infos[i] = ret.box;\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/iloc.js\r\nBoxParser.createFullBoxCtor(\"iloc\", \"ItemLocationBox\", function(stream) {\r\n\tvar byte;\r\n\tbyte = stream.readUint8();\r\n\tthis.offset_size = (byte >> 4) & 0xF;\r\n\tthis.length_size = byte & 0xF;\r\n\tbyte = stream.readUint8();\r\n\tthis.base_offset_size = (byte >> 4) & 0xF;\r\n\tif (this.version === 1 || this.version === 2) {\r\n\t\tthis.index_size = byte & 0xF;\r\n\t} else {\r\n\t\tthis.index_size = 0;\r\n\t\t// reserved = byte & 0xF;\r\n\t}\r\n\tthis.items = [];\r\n\tvar item_count = 0;\r\n\tif (this.version < 2) {\r\n\t\titem_count = stream.readUint16();\r\n\t} else if (this.version === 2) {\r\n\t\titem_count = stream.readUint32();\r\n\t} else {\r\n\t\tthrow \"version of iloc box not supported\";\r\n\t}\r\n\tfor (var i = 0; i < item_count; i++) {\r\n\t\tvar item = {};\r\n\t\tthis.items.push(item);\r\n\t\tif (this.version < 2) {\r\n\t\t\titem.item_ID = stream.readUint16();\r\n\t\t} else if (this.version === 2) {\r\n\t\t\titem.item_ID = stream.readUint32();\r\n\t\t} else {\r\n\t\t\tthrow \"version of iloc box not supported\";\r\n\t\t}\r\n\t\tif (this.version === 1 || this.version === 2) {\r\n\t\t\titem.construction_method = (stream.readUint16() & 0xF);\r\n\t\t} else {\r\n\t\t\titem.construction_method = 0;\r\n\t\t}\r\n\t\titem.data_reference_index = stream.readUint16();\r\n\t\tswitch(this.base_offset_size) {\r\n\t\t\tcase 0:\r\n\t\t\t\titem.base_offset = 0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\titem.base_offset = stream.readUint32();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\titem.base_offset = stream.readUint64();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"Error reading base offset size\";\r\n\t\t}\r\n\t\tvar extent_count = stream.readUint16();\r\n\t\titem.extents = [];\r\n\t\tfor (var j=0; j < extent_count; j++) {\r\n\t\t\tvar extent = {};\r\n\t\t\titem.extents.push(extent);\r\n\t\t\tif (this.version === 1 || this.version === 2) {\r\n\t\t\t\tswitch(this.index_size) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\textent.extent_index = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\textent.extent_index = stream.readUint32();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 8:\r\n\t\t\t\t\t\textent.extent_index = stream.readUint64();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"Error reading extent index\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tswitch(this.offset_size) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\textent.extent_offset = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\textent.extent_offset = stream.readUint32();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 8:\r\n\t\t\t\t\textent.extent_offset = stream.readUint64();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow \"Error reading extent index\";\r\n\t\t\t}\r\n\t\t\tswitch(this.length_size) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\textent.extent_length = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\textent.extent_length = stream.readUint32();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 8:\r\n\t\t\t\t\textent.extent_length = stream.readUint64();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow \"Error reading extent index\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/imir.js\r\nBoxParser.createBoxCtor(\"imir\", \"ImageMirror\", function(stream) {\r\n\tvar tmp = stream.readUint8();\r\n\tthis.reserved = tmp >> 7;\r\n\tthis.axis = tmp & 1;\r\n});// file:src/parsing/infe.js\r\nBoxParser.createFullBoxCtor(\"infe\", \"ItemInfoEntry\", function(stream) {\r\n\tif (this.version === 0 || this.version === 1) {\r\n\t\tthis.item_ID = stream.readUint16();\r\n\t\tthis.item_protection_index = stream.readUint16();\r\n\t\tthis.item_name = stream.readCString();\r\n\t\tthis.content_type = stream.readCString();\r\n\t\tthis.content_encoding = stream.readCString();\r\n\t}\r\n\tif (this.version === 1) {\r\n\t\tthis.extension_type = stream.readString(4);\r\n\t\tLog.warn(\"BoxParser\", \"Cannot parse extension type\");\r\n\t\tstream.seek(this.start+this.size);\r\n\t\treturn;\r\n\t}\r\n\tif (this.version >= 2) {\r\n\t\tif (this.version === 2) {\r\n\t\t\tthis.item_ID = stream.readUint16();\r\n\t\t} else if (this.version === 3) {\r\n\t\t\tthis.item_ID = stream.readUint32();\r\n\t\t}\r\n\t\tthis.item_protection_index = stream.readUint16();\r\n\t\tthis.item_type = stream.readString(4);\r\n\t\tthis.item_name = stream.readCString();\r\n\t\tif (this.item_type === \"mime\") {\r\n\t\t\tthis.content_type = stream.readCString();\r\n\t\t\tthis.content_encoding = stream.readCString();\r\n\t\t} else if (this.item_type === \"uri \") {\r\n\t\t\tthis.item_uri_type = stream.readCString();\r\n\t\t}\r\n\t}\r\n});\r\n// file:src/parsing/ipma.js\r\nBoxParser.createFullBoxCtor(\"ipma\", \"ItemPropertyAssociationBox\", function(stream) {\r\n\tvar i, j;\r\n\tentry_count = stream.readUint32();\r\n\tthis.associations = [];\r\n\tfor(i=0; i<entry_count; i++) {\r\n\t\tvar item_assoc = {};\r\n\t\tthis.associations.push(item_assoc);\r\n\t\tif (this.version < 1) {\r\n\t\t\titem_assoc.id = stream.readUint16();\r\n\t\t} else {\r\n\t\t\titem_assoc.id = stream.readUint32();\r\n\t\t}\r\n\t\tvar association_count = stream.readUint8();\r\n\t\titem_assoc.props = [];\r\n\t\tfor (j = 0; j < association_count; j++) {\r\n\t\t\tvar tmp = stream.readUint8();\r\n\t\t\tvar p = {};\r\n\t\t\titem_assoc.props.push(p);\r\n\t\t\tp.essential = ((tmp & 0x80) >> 7) === 1;\r\n\t\t\tif (this.flags & 0x1) {\r\n\t\t\t\tp.property_index = (tmp & 0x7F) << 8 | stream.readUint8();\r\n\t\t\t} else {\r\n\t\t\t\tp.property_index = (tmp & 0x7F);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/iref.js\r\nBoxParser.createFullBoxCtor(\"iref\", \"ItemReferenceBox\", function(stream) {\r\n\tvar ret;\r\n\tvar entryCount;\r\n\tvar box;\r\n\tthis.references = [];\r\n\r\n\twhile (stream.getPosition() < this.start+this.size) {\r\n\t\tret = BoxParser.parseOneBox(stream, true, this.size - (stream.getPosition() - this.start));\r\n\t\tif (ret.code === BoxParser.OK) {\r\n\t\t\tif (this.version === 0) {\r\n\t\t\t\tbox = new BoxParser.SingleItemTypeReferenceBox(ret.type, ret.size, ret.hdr_size, ret.start);\r\n\t\t\t} else {\r\n\t\t\t\tbox = new BoxParser.SingleItemTypeReferenceBoxLarge(ret.type, ret.size, ret.hdr_size, ret.start);\r\n\t\t\t}\r\n\t\t\tif (box.write === BoxParser.Box.prototype.write && box.type !== \"mdat\") {\r\n\t\t\t\tLog.warn(\"BoxParser\", box.type+\" box writing not yet implemented, keeping unparsed data in memory for later write\");\r\n\t\t\t\tbox.parseDataAndRewind(stream);\r\n\t\t\t}\r\n\t\t\tbox.parse(stream);\r\n\t\t\tthis.references.push(box);\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n});\r\n// file:src/parsing/irot.js\r\nBoxParser.createBoxCtor(\"irot\", \"ImageRotation\", function(stream) {\r\n\tthis.angle = stream.readUint8() & 0x3;\r\n});\r\n\r\n// file:src/parsing/ispe.js\r\nBoxParser.createFullBoxCtor(\"ispe\", \"ImageSpatialExtentsProperty\", function(stream) {\r\n\tthis.image_width = stream.readUint32();\r\n\tthis.image_height = stream.readUint32();\r\n});// file:src/parsing/kind.js\r\nBoxParser.createFullBoxCtor(\"kind\", \"KindBox\", function(stream) {\r\n\tthis.schemeURI = stream.readCString();\r\n\tthis.value = stream.readCString();\r\n});\r\n// file:src/parsing/leva.js\r\nBoxParser.createFullBoxCtor(\"leva\", \"LevelAssignmentBox\", function(stream) {\r\n\tvar count = stream.readUint8();\r\n\tthis.levels = [];\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\tvar level = {};\r\n\t\tthis.levels[i] = level;\r\n\t\tlevel.track_ID = stream.readUint32();\r\n\t\tvar tmp_byte = stream.readUint8();\r\n\t\tlevel.padding_flag = tmp_byte >> 7;\r\n\t\tlevel.assignment_type = tmp_byte & 0x7F;\r\n\t\tswitch (level.assignment_type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tlevel.grouping_type = stream.readString(4);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tlevel.grouping_type = stream.readString(4);\r\n\t\t\t\tlevel.grouping_type_parameter = stream.readUint32();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tlevel.sub_track_id = stream.readUint32();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tLog.warn(\"BoxParser\", \"Unknown leva assignement type\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/lhvC.js\r\nBoxParser.createBoxCtor(\"lhvC\", \"LHEVCConfigurationBox\", function(stream) {\r\n\tvar i, j;\r\n\tvar tmp_byte;\r\n\tthis.configurationVersion = stream.readUint8();\r\n\tthis.min_spatial_segmentation_idc = stream.readUint16() & 0xFFF;\r\n\tthis.parallelismType = (stream.readUint8() & 0x3);\r\n\ttmp_byte = stream.readUint8();\r\n\tthis.numTemporalLayers = (tmp_byte & 0XD) >> 3;\r\n\tthis.temporalIdNested = (tmp_byte & 0X4) >> 2;\r\n\tthis.lengthSizeMinusOne = (tmp_byte & 0X3);\r\n\r\n\tthis.nalu_arrays = [];\r\n\tthis.nalu_arrays.toString = function () {\r\n\t\tvar str = \"<table class='inner-table'>\";\r\n\t\tstr += \"<thead><tr><th>completeness</th><th>nalu_type</th><th>nalu_data</th></tr></thead>\";\r\n\t\tstr += \"<tbody>\";\r\n\r\n\t\tfor (var i=0; i<this.length; i++) {\r\n\t\t\tvar nalu_array = this[i];\r\n\t\t\tstr += \"<tr>\";\r\n\t\t\tstr += \"<td rowspan='\"+nalu_array.length+\"'>\"+nalu_array.completeness+\"</td>\";\r\n\t\t\tstr += \"<td rowspan='\"+nalu_array.length+\"'>\"+nalu_array.nalu_type+\"</td>\";\r\n\t\t\tfor (var j=0; j<nalu_array.length; j++) {\r\n\t\t\t\tvar nalu = nalu_array[j];\r\n\t\t\t\tif (j !== 0) str += \"<tr>\";\r\n\t\t\t\tstr += \"<td>\";\r\n\t\t\t\tstr += nalu.data.reduce(function(str, byte) {\r\n\t\t\t\t\treturn str + byte.toString(16).padStart(2, \"0\");\r\n\t\t\t\t}, \"0x\");\r\n\t\t\t\tstr += \"</td></tr>\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tstr += \"</tbody></table>\";\r\n\t\treturn str;\r\n\t}\r\n\tvar numOfArrays = stream.readUint8();\r\n\tfor (i = 0; i < numOfArrays; i++) {\r\n\t\tvar nalu_array = [];\r\n\t\tthis.nalu_arrays.push(nalu_array);\r\n\t\ttmp_byte = stream.readUint8()\r\n\t\tnalu_array.completeness = (tmp_byte & 0x80) >> 7;\r\n\t\tnalu_array.nalu_type = tmp_byte & 0x3F;\r\n\t\tvar numNalus = stream.readUint16();\r\n\t\tfor (j = 0; j < numNalus; j++) {\r\n\t\t\tvar nalu = {}\r\n\t\t\tnalu_array.push(nalu);\r\n\t\t\tvar length = stream.readUint16();\r\n\t\t\tnalu.data  = stream.readUint8Array(length);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/lsel.js\r\nBoxParser.createBoxCtor(\"lsel\", \"LayerSelectorProperty\", function(stream) {\r\n\tthis.layer_id = stream.readUint16();\r\n});// file:src/parsing/maxr.js\r\nBoxParser.createBoxCtor(\"maxr\", \"hintmaxrate\", function(stream) {\r\n\tthis.period = stream.readUint32();\r\n\tthis.bytes = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/mdcv.js\r\nfunction ColorPoint(x, y) {\r\n    this.x = x;\r\n    this.y = y;\r\n}\r\n\r\nColorPoint.prototype.toString = function() {\r\n    return \"(\"+this.x+\",\"+this.y+\")\";\r\n}\r\n\r\nBoxParser.createBoxCtor(\"mdcv\", \"MasteringDisplayColourVolumeBox\", function(stream) {\r\n    this.display_primaries = [];\r\n    this.display_primaries[0] = new ColorPoint(stream.readUint16(),stream.readUint16());\r\n    this.display_primaries[1] = new ColorPoint(stream.readUint16(),stream.readUint16());\r\n    this.display_primaries[2] = new ColorPoint(stream.readUint16(),stream.readUint16());\r\n    this.white_point = new ColorPoint(stream.readUint16(),stream.readUint16());\r\n    this.max_display_mastering_luminance = stream.readUint32();\r\n    this.min_display_mastering_luminance = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/mdhd.js\r\nBoxParser.createFullBoxCtor(\"mdhd\", \"MediaHeaderBox\", function(stream) {\r\n\tif (this.version == 1) {\r\n\t\tthis.creation_time = stream.readUint64();\r\n\t\tthis.modification_time = stream.readUint64();\r\n\t\tthis.timescale = stream.readUint32();\r\n\t\tthis.duration = stream.readUint64();\r\n\t} else {\r\n\t\tthis.creation_time = stream.readUint32();\r\n\t\tthis.modification_time = stream.readUint32();\r\n\t\tthis.timescale = stream.readUint32();\r\n\t\tthis.duration = stream.readUint32();\r\n\t}\r\n\tthis.parseLanguage(stream);\r\n\tstream.readUint16();\r\n});\r\n\r\n// file:src/parsing/mehd.js\r\nBoxParser.createFullBoxCtor(\"mehd\", \"MovieExtendsHeaderBox\", function(stream) {\r\n\tif (this.flags & 0x1) {\r\n\t\tLog.warn(\"BoxParser\", \"mehd box incorrectly uses flags set to 1, converting version to 1\");\r\n\t\tthis.version = 1;\r\n\t}\r\n\tif (this.version == 1) {\r\n\t\tthis.fragment_duration = stream.readUint64();\r\n\t} else {\r\n\t\tthis.fragment_duration = stream.readUint32();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/meta.js\r\nBoxParser.createFullBoxCtor(\"meta\", \"MetaBox\", function(stream) {\r\n\tthis.boxes = [];\r\n\tBoxParser.ContainerBox.prototype.parse.call(this, stream);\r\n});\r\n// file:src/parsing/mfhd.js\r\nBoxParser.createFullBoxCtor(\"mfhd\", \"MovieFragmentHeaderBox\", function(stream) {\r\n\tthis.sequence_number = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/mfro.js\r\nBoxParser.createFullBoxCtor(\"mfro\", \"MovieFragmentRandomAccessOffsetBox\", function(stream) {\r\n\tthis._size = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/mskC.js\r\nBoxParser.createFullBoxCtor(\"mskC\", \"MaskConfigurationProperty\", function(stream) {\r\n    this.bits_per_pixel = stream.readUint8();\r\n});\r\n\r\n// file:src/parsing/mvhd.js\r\nBoxParser.createFullBoxCtor(\"mvhd\", \"MovieHeaderBox\", function(stream) {\r\n\tif (this.version == 1) {\r\n\t\tthis.creation_time = stream.readUint64();\r\n\t\tthis.modification_time = stream.readUint64();\r\n\t\tthis.timescale = stream.readUint32();\r\n\t\tthis.duration = stream.readUint64();\r\n\t} else {\r\n\t\tthis.creation_time = stream.readUint32();\r\n\t\tthis.modification_time = stream.readUint32();\r\n\t\tthis.timescale = stream.readUint32();\r\n\t\tthis.duration = stream.readUint32();\r\n\t}\r\n\tthis.rate = stream.readUint32();\r\n\tthis.volume = stream.readUint16()>>8;\r\n\tstream.readUint16();\r\n\tstream.readUint32Array(2);\r\n\tthis.matrix = stream.readUint32Array(9);\r\n\tstream.readUint32Array(6);\r\n\tthis.next_track_id = stream.readUint32();\r\n});\r\n// file:src/parsing/npck.js\r\nBoxParser.createBoxCtor(\"npck\", \"hintPacketsSent\", function(stream) {\r\n\tthis.packetssent = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/nump.js\r\nBoxParser.createBoxCtor(\"nump\", \"hintPacketsSent\", function(stream) {\r\n\tthis.packetssent = stream.readUint64();\r\n});\r\n\r\n// file:src/parsing/padb.js\r\nBoxParser.createFullBoxCtor(\"padb\", \"PaddingBitsBox\", function(stream) {\r\n\tvar sample_count = stream.readUint32();\r\n\tthis.padbits = [];\r\n\tfor (var i = 0; i < Math.floor((sample_count+1)/2); i++) {\r\n\t\tthis.padbits = stream.readUint8();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/pasp.js\r\nBoxParser.createBoxCtor(\"pasp\", \"PixelAspectRatioBox\", function(stream) {\r\n\tthis.hSpacing = stream.readUint32();\r\n\tthis.vSpacing = stream.readUint32();\r\n});// file:src/parsing/payl.js\r\nBoxParser.createBoxCtor(\"payl\", \"CuePayloadBox\", function(stream) {\r\n\tthis.text = stream.readString(this.size - this.hdr_size);\r\n});\r\n\r\n// file:src/parsing/payt.js\r\nBoxParser.createBoxCtor(\"payt\", \"hintpayloadID\", function(stream) {\r\n\tthis.payloadID = stream.readUint32();\r\n\tvar count = stream.readUint8();\r\n\tthis.rtpmap_string = stream.readString(count);\r\n});\r\n\r\n// file:src/parsing/pdin.js\r\nBoxParser.createFullBoxCtor(\"pdin\", \"ProgressiveDownloadInfoBox\", function(stream) {\r\n\tvar count = (this.size - this.hdr_size)/8;\r\n\tthis.rate = [];\r\n\tthis.initial_delay = [];\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\tthis.rate[i] = stream.readUint32();\r\n\t\tthis.initial_delay[i] = stream.readUint32();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/pitm.js\r\nBoxParser.createFullBoxCtor(\"pitm\", \"PrimaryItemBox\", function(stream) {\r\n\tif (this.version === 0) {\r\n\t\tthis.item_id = stream.readUint16();\r\n\t} else {\r\n\t\tthis.item_id = stream.readUint32();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/pixi.js\r\nBoxParser.createFullBoxCtor(\"pixi\", \"PixelInformationProperty\", function(stream) {\r\n\tvar i;\r\n\tthis.num_channels = stream.readUint8();\r\n\tthis.bits_per_channels = [];\r\n\tfor (i = 0; i < this.num_channels; i++) {\r\n\t\tthis.bits_per_channels[i] = stream.readUint8();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/pmax.js\r\nBoxParser.createBoxCtor(\"pmax\", \"hintlargestpacket\", function(stream) {\r\n\tthis.bytes = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/prdi.js\r\nBoxParser.createFullBoxCtor(\"prdi\", \"ProgressiveDerivedImageItemInformationProperty\", function(stream) {\r\n\tthis.step_count = stream.readUint16();\r\n\tthis.item_count = [];\r\n\tif (this.flags & 0x2) {\r\n\t\tfor (var i = 0; i < this.step_count; i++) {\r\n\t\t\tthis.item_count[i] = stream.readUint16();\r\n\t\t}\r\n\t}\r\n});// file:src/parsing/prft.js\r\nBoxParser.createFullBoxCtor(\"prft\", \"ProducerReferenceTimeBox\", function(stream) {\r\n\tthis.ref_track_id = stream.readUint32();\r\n\tthis.ntp_timestamp = stream.readUint64();\r\n\tif (this.version === 0) {\r\n\t\tthis.media_time = stream.readUint32();\r\n\t} else {\r\n\t\tthis.media_time = stream.readUint64();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/pssh.js\r\nBoxParser.createFullBoxCtor(\"pssh\", \"ProtectionSystemSpecificHeaderBox\", function(stream) {\r\n\tthis.system_id = BoxParser.parseHex16(stream);\r\n\tif (this.version > 0) {\r\n\t\tvar count = stream.readUint32();\r\n\t\tthis.kid = [];\r\n\t\tfor (var i = 0; i < count; i++) {\r\n\t\t\tthis.kid[i] = BoxParser.parseHex16(stream);\r\n\t\t}\r\n\t}\r\n\tvar datasize = stream.readUint32();\r\n\tif (datasize > 0) {\r\n\t\tthis.data = stream.readUint8Array(datasize);\r\n\t}\r\n});\r\n\r\n// file:src/parsing/qt/clef.js\r\nBoxParser.createFullBoxCtor(\"clef\", \"TrackCleanApertureDimensionsBox\", function(stream) {\r\n\tthis.width = stream.readUint32();\r\n\tthis.height = stream.readUint32();\r\n});// file:src/parsing/qt/enof.js\r\nBoxParser.createFullBoxCtor(\"enof\", \"TrackEncodedPixelsDimensionsBox\", function(stream) {\r\n\tthis.width = stream.readUint32();\r\n\tthis.height = stream.readUint32();\r\n});// file:src/parsing/qt/prof.js\r\nBoxParser.createFullBoxCtor(\"prof\", \"TrackProductionApertureDimensionsBox\", function(stream) {\r\n\tthis.width = stream.readUint32();\r\n\tthis.height = stream.readUint32();\r\n});// file:src/parsing/qt/tapt.js\r\nBoxParser.createContainerBoxCtor(\"tapt\", \"TrackApertureModeDimensionsBox\", null, [ \"clef\", \"prof\", \"enof\"]);// file:src/parsing/rtp.js\r\nBoxParser.createBoxCtor(\"rtp \", \"rtpmoviehintinformation\", function(stream) {\r\n\tthis.descriptionformat = stream.readString(4);\r\n\tthis.sdptext = stream.readString(this.size - this.hdr_size - 4);\r\n});\r\n\r\n// file:src/parsing/saio.js\r\nBoxParser.createFullBoxCtor(\"saio\", \"SampleAuxiliaryInformationOffsetsBox\", function(stream) {\r\n\tif (this.flags & 0x1) {\r\n\t\tthis.aux_info_type = stream.readString(4);\r\n\t\tthis.aux_info_type_parameter = stream.readUint32();\r\n\t}\r\n\tvar count = stream.readUint32();\r\n\tthis.offset = [];\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\tif (this.version === 0) {\r\n\t\t\tthis.offset[i] = stream.readUint32();\r\n\t\t} else {\r\n\t\t\tthis.offset[i] = stream.readUint64();\r\n\t\t}\r\n\t}\r\n});\r\n// file:src/parsing/saiz.js\r\nBoxParser.createFullBoxCtor(\"saiz\", \"SampleAuxiliaryInformationSizesBox\", function(stream) {\r\n\tif (this.flags & 0x1) {\r\n\t\tthis.aux_info_type = stream.readString(4);\r\n\t\tthis.aux_info_type_parameter = stream.readUint32();\r\n\t}\r\n\tthis.default_sample_info_size = stream.readUint8();\r\n\tthis.sample_count = stream.readUint32();\r\n\tthis.sample_info_size = [];\r\n\tif (this.default_sample_info_size === 0) {\r\n\t\tfor (var i = 0; i < this.sample_count; i++) {\r\n\t\t\tthis.sample_info_size[i] = stream.readUint8();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/sampleentries/mett.js\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA, \"mett\", function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tthis.content_encoding = stream.readCString();\r\n\tthis.mime_format = stream.readCString();\r\n\tthis.parseFooter(stream);\r\n});\r\n\r\n// file:src/parsing/sampleentries/metx.js\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA, \"metx\", function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tthis.content_encoding = stream.readCString();\r\n\tthis.namespace = stream.readCString();\r\n\tthis.schema_location = stream.readCString();\r\n\tthis.parseFooter(stream);\r\n});\r\n\r\n// file:src/parsing/sampleentries/sbtt.js\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE, \"sbtt\", function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tthis.content_encoding = stream.readCString();\r\n\tthis.mime_format = stream.readCString();\r\n\tthis.parseFooter(stream);\r\n});\r\n\r\n// file:src/parsing/sampleentries/stpp.js\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE, \"stpp\", function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tthis.namespace = stream.readCString();\r\n\tthis.schema_location = stream.readCString();\r\n\tthis.auxiliary_mime_types = stream.readCString();\r\n\tthis.parseFooter(stream);\r\n});\r\n\r\n// file:src/parsing/sampleentries/stxt.js\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE, \"stxt\", function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tthis.content_encoding = stream.readCString();\r\n\tthis.mime_format = stream.readCString();\r\n\tthis.parseFooter(stream);\r\n});\r\n\r\n// file:src/parsing/sampleentries/tx3g.js\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE, \"tx3g\", function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tthis.displayFlags = stream.readUint32();\r\n\tthis.horizontal_justification = stream.readInt8();\r\n\tthis.vertical_justification = stream.readInt8();\r\n\tthis.bg_color_rgba = stream.readUint8Array(4);\r\n\tthis.box_record = stream.readInt16Array(4);\r\n\tthis.style_record = stream.readUint8Array(12);\r\n\tthis.parseFooter(stream);\r\n});\r\n// file:src/parsing/sampleentries/wvtt.js\r\nBoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA, \"wvtt\", function(stream) {\r\n\tthis.parseHeader(stream);\r\n\tthis.parseFooter(stream);\r\n});\r\n\r\n// file:src/parsing/samplegroups/alst.js\r\nBoxParser.createSampleGroupCtor(\"alst\", function(stream) {\r\n\tvar i;\r\n\tvar roll_count = stream.readUint16();\r\n\tthis.first_output_sample = stream.readUint16();\r\n\tthis.sample_offset = [];\r\n\tfor (i = 0; i < roll_count; i++) {\r\n\t\tthis.sample_offset[i] = stream.readUint32();\r\n\t}\r\n\tvar remaining = this.description_length - 4 - 4*roll_count;\r\n\tthis.num_output_samples = [];\r\n\tthis.num_total_samples = [];\r\n\tfor (i = 0; i < remaining/4; i++) {\r\n\t\tthis.num_output_samples[i] = stream.readUint16();\r\n\t\tthis.num_total_samples[i] = stream.readUint16();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/samplegroups/avll.js\r\nBoxParser.createSampleGroupCtor(\"avll\", function(stream) {\r\n\tthis.layerNumber = stream.readUint8();\r\n\tthis.accurateStatisticsFlag = stream.readUint8();\r\n\tthis.avgBitRate = stream.readUint16();\r\n\tthis.avgFrameRate = stream.readUint16();\r\n});\r\n\r\n// file:src/parsing/samplegroups/avss.js\r\nBoxParser.createSampleGroupCtor(\"avss\", function(stream) {\r\n\tthis.subSequenceIdentifier = stream.readUint16();\r\n\tthis.layerNumber = stream.readUint8();\r\n\tvar tmp_byte = stream.readUint8();\r\n\tthis.durationFlag = tmp_byte >> 7;\r\n\tthis.avgRateFlag = (tmp_byte >> 6) & 0x1;\r\n\tif (this.durationFlag) {\r\n\t\tthis.duration = stream.readUint32();\r\n\t}\r\n\tif (this.avgRateFlag) {\r\n\t\tthis.accurateStatisticsFlag = stream.readUint8();\r\n\t\tthis.avgBitRate = stream.readUint16();\r\n\t\tthis.avgFrameRate = stream.readUint16();\r\n\t}\r\n\tthis.dependency = [];\r\n\tvar numReferences = stream.readUint8();\r\n\tfor (var i = 0; i < numReferences; i++) {\r\n\t\tvar dependencyInfo = {};\r\n\t\tthis.dependency.push(dependencyInfo);\r\n\t\tdependencyInfo.subSeqDirectionFlag = stream.readUint8();\r\n\t\tdependencyInfo.layerNumber = stream.readUint8();\r\n\t\tdependencyInfo.subSequenceIdentifier = stream.readUint16();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/samplegroups/dtrt.js\r\nBoxParser.createSampleGroupCtor(\"dtrt\", function(stream) {\r\n\tLog.warn(\"BoxParser\", \"Sample Group type: \"+this.grouping_type+\" not fully parsed\");\r\n});\r\n\r\n// file:src/parsing/samplegroups/mvif.js\r\nBoxParser.createSampleGroupCtor(\"mvif\", function(stream) {\r\n\tLog.warn(\"BoxParser\", \"Sample Group type: \"+this.grouping_type+\" not fully parsed\");\r\n});\r\n\r\n// file:src/parsing/samplegroups/prol.js\r\nBoxParser.createSampleGroupCtor(\"prol\", function(stream) {\r\n\tthis.roll_distance = stream.readInt16();\r\n});\r\n\r\n// file:src/parsing/samplegroups/rap.js\r\nBoxParser.createSampleGroupCtor(\"rap \", function(stream) {\r\n\tvar tmp_byte = stream.readUint8();\r\n\tthis.num_leading_samples_known = tmp_byte >> 7;\r\n\tthis.num_leading_samples = tmp_byte & 0x7F;\r\n});\r\n\r\n// file:src/parsing/samplegroups/rash.js\r\nBoxParser.createSampleGroupCtor(\"rash\", function(stream) {\r\n\tthis.operation_point_count = stream.readUint16();\r\n\tif (this.description_length !== 2+(this.operation_point_count === 1?2:this.operation_point_count*6)+9) {\r\n\t\tLog.warn(\"BoxParser\", \"Mismatch in \"+this.grouping_type+\" sample group length\");\r\n\t\tthis.data =  stream.readUint8Array(this.description_length-2);\r\n\t} else {\r\n\t\tif (this.operation_point_count === 1) {\r\n\t\t\tthis.target_rate_share = stream.readUint16();\r\n\t\t} else {\r\n\t\t\tthis.target_rate_share = [];\r\n\t\t\tthis.available_bitrate = [];\r\n\t\t\tfor (var i = 0; i < this.operation_point_count; i++) {\r\n\t\t\t\tthis.available_bitrate[i] = stream.readUint32();\r\n\t\t\t\tthis.target_rate_share[i] = stream.readUint16();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.maximum_bitrate = stream.readUint32();\r\n\t\tthis.minimum_bitrate = stream.readUint32();\r\n\t\tthis.discard_priority = stream.readUint8();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/samplegroups/roll.js\r\nBoxParser.createSampleGroupCtor(\"roll\", function(stream) {\r\n\tthis.roll_distance = stream.readInt16();\r\n});\r\n\r\n// file:src/parsing/samplegroups/samplegroup.js\r\nBoxParser.SampleGroupEntry.prototype.parse = function(stream) {\r\n\tLog.warn(\"BoxParser\", \"Unknown Sample Group type: \"+this.grouping_type);\r\n\tthis.data =  stream.readUint8Array(this.description_length);\r\n}\r\n\r\n// file:src/parsing/samplegroups/scif.js\r\nBoxParser.createSampleGroupCtor(\"scif\", function(stream) {\r\n\tLog.warn(\"BoxParser\", \"Sample Group type: \"+this.grouping_type+\" not fully parsed\");\r\n});\r\n\r\n// file:src/parsing/samplegroups/scnm.js\r\nBoxParser.createSampleGroupCtor(\"scnm\", function(stream) {\r\n\tLog.warn(\"BoxParser\", \"Sample Group type: \"+this.grouping_type+\" not fully parsed\");\r\n});\r\n\r\n// file:src/parsing/samplegroups/seig.js\r\nBoxParser.createSampleGroupCtor(\"seig\", function(stream) {\r\n\tthis.reserved = stream.readUint8();\r\n\tvar tmp = stream.readUint8();\r\n\tthis.crypt_byte_block = tmp >> 4;\r\n\tthis.skip_byte_block = tmp & 0xF;\r\n\tthis.isProtected = stream.readUint8();\r\n\tthis.Per_Sample_IV_Size = stream.readUint8();\r\n\tthis.KID = BoxParser.parseHex16(stream);\r\n\tthis.constant_IV_size = 0;\r\n\tthis.constant_IV = 0;\r\n\tif (this.isProtected === 1 && this.Per_Sample_IV_Size === 0) {\r\n\t\tthis.constant_IV_size = stream.readUint8();\r\n\t\tthis.constant_IV = stream.readUint8Array(this.constant_IV_size);\r\n\t}\r\n});\r\n\r\n// file:src/parsing/samplegroups/stsa.js\r\nBoxParser.createSampleGroupCtor(\"stsa\", function(stream) {\r\n\tLog.warn(\"BoxParser\", \"Sample Group type: \"+this.grouping_type+\" not fully parsed\");\r\n});\r\n\r\n// file:src/parsing/samplegroups/sync.js\r\nBoxParser.createSampleGroupCtor(\"sync\", function(stream) {\r\n\tvar tmp_byte = stream.readUint8();\r\n\tthis.NAL_unit_type = tmp_byte & 0x3F;\r\n});\r\n\r\n// file:src/parsing/samplegroups/tele.js\r\nBoxParser.createSampleGroupCtor(\"tele\", function(stream) {\r\n\tvar tmp_byte = stream.readUint8();\r\n\tthis.level_independently_decodable = tmp_byte >> 7;\r\n});\r\n\r\n// file:src/parsing/samplegroups/tsas.js\r\nBoxParser.createSampleGroupCtor(\"tsas\", function(stream) {\r\n\tLog.warn(\"BoxParser\", \"Sample Group type: \"+this.grouping_type+\" not fully parsed\");\r\n});\r\n\r\n// file:src/parsing/samplegroups/tscl.js\r\nBoxParser.createSampleGroupCtor(\"tscl\", function(stream) {\r\n\tLog.warn(\"BoxParser\", \"Sample Group type: \"+this.grouping_type+\" not fully parsed\");\r\n});\r\n\r\n// file:src/parsing/samplegroups/vipr.js\r\nBoxParser.createSampleGroupCtor(\"vipr\", function(stream) {\r\n\tLog.warn(\"BoxParser\", \"Sample Group type: \"+this.grouping_type+\" not fully parsed\");\r\n});\r\n\r\n// file:src/parsing/sbgp.js\r\nBoxParser.createFullBoxCtor(\"sbgp\", \"SampleToGroupBox\", function(stream) {\r\n\tthis.grouping_type = stream.readString(4);\r\n\tif (this.version === 1) {\r\n\t\tthis.grouping_type_parameter = stream.readUint32();\r\n\t} else {\r\n\t\tthis.grouping_type_parameter = 0;\r\n\t}\r\n\tthis.entries = [];\r\n\tvar entry_count = stream.readUint32();\r\n\tfor (var i = 0; i < entry_count; i++) {\r\n\t\tvar entry = {};\r\n\t\tthis.entries.push(entry);\r\n\t\tentry.sample_count = stream.readInt32();\r\n\t\tentry.group_description_index = stream.readInt32();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/sbpm.js\r\nfunction Pixel(row, col) {\r\n\tthis.bad_pixel_row = row;\r\n\tthis.bad_pixel_column = col;\r\n}\r\n\r\nPixel.prototype.toString = function pixelToString() {\r\n\treturn \"[row: \" + this.bad_pixel_row + \", column: \" + this.bad_pixel_column + \"]\";\r\n}\r\n\r\nBoxParser.createFullBoxCtor(\"sbpm\", \"SensorBadPixelsMapBox\", function(stream) {\r\n\tvar i;\r\n\tthis.component_count = stream.readUint16();\r\n    this.component_index = [];\r\n    for (i = 0; i < this.component_count; i++) {\r\n        this.component_index.push(stream.readUint16());\r\n    }\r\n\tvar flags = stream.readUint8();\r\n\tthis.correction_applied = (0x80 == (flags & 0x80));\r\n\tthis.num_bad_rows = stream.readUint32();\r\n\tthis.num_bad_cols = stream.readUint32();\r\n\tthis.num_bad_pixels = stream.readUint32();\r\n\tthis.bad_rows = [];\r\n\tthis.bad_columns = [];\r\n\tthis.bad_pixels = [];\r\n\tfor (i = 0; i < this.num_bad_rows; i++) {\r\n\t\tthis.bad_rows.push(stream.readUint32());\r\n\t}\r\n\tfor (i = 0; i < this.num_bad_cols; i++) {\r\n\t\tthis.bad_columns.push(stream.readUint32());\r\n\t}\r\n\tfor (i = 0; i < this.num_bad_pixels; i++) {\r\n\t\tvar row = stream.readUint32();\r\n\t\tvar col = stream.readUint32();\r\n\t\tthis.bad_pixels.push(new Pixel(row, col));\r\n\t}\r\n});\r\n\r\n// file:src/parsing/schm.js\r\nBoxParser.createFullBoxCtor(\"schm\", \"SchemeTypeBox\", function(stream) {\r\n\tthis.scheme_type = stream.readString(4);\r\n\tthis.scheme_version = stream.readUint32();\r\n\tif (this.flags & 0x000001) {\r\n\t\tthis.scheme_uri = stream.readString(this.size - this.hdr_size - 8);\r\n\t}\r\n});\r\n\r\n// file:src/parsing/sdp.js\r\nBoxParser.createBoxCtor(\"sdp \", \"rtptracksdphintinformation\", function(stream) {\r\n\tthis.sdptext = stream.readString(this.size - this.hdr_size);\r\n});\r\n\r\n// file:src/parsing/sdtp.js\r\nBoxParser.createFullBoxCtor(\"sdtp\", \"SampleDependencyTypeBox\", function(stream) {\r\n\tvar tmp_byte;\r\n\tvar count = (this.size - this.hdr_size);\r\n\tthis.is_leading = [];\r\n\tthis.sample_depends_on = [];\r\n\tthis.sample_is_depended_on = [];\r\n\tthis.sample_has_redundancy = [];\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\ttmp_byte = stream.readUint8();\r\n\t\tthis.is_leading[i] = tmp_byte >> 6;\r\n\t\tthis.sample_depends_on[i] = (tmp_byte >> 4) & 0x3;\r\n\t\tthis.sample_is_depended_on[i] = (tmp_byte >> 2) & 0x3;\r\n\t\tthis.sample_has_redundancy[i] = tmp_byte & 0x3;\r\n\t}\r\n});\r\n\r\n// file:src/parsing/senc.js\r\n// Cannot be fully parsed because Per_Sample_IV_Size needs to be known\r\nBoxParser.createFullBoxCtor(\"senc\", \"SampleEncryptionBox\" /*, function(stream) {\r\n\tthis.parseFullHeader(stream);\r\n\tvar sample_count = stream.readUint32();\r\n\tthis.samples = [];\r\n\tfor (var i = 0; i < sample_count; i++) {\r\n\t\tvar sample = {};\r\n\t\t// tenc.default_Per_Sample_IV_Size or seig.Per_Sample_IV_Size\r\n\t\tsample.InitializationVector = this.readUint8Array(Per_Sample_IV_Size*8);\r\n\t\tif (this.flags & 0x2) {\r\n\t\t\tsample.subsamples = [];\r\n\t\t\tsubsample_count = stream.readUint16();\r\n\t\t\tfor (var j = 0; j < subsample_count; j++) {\r\n\t\t\t\tvar subsample = {};\r\n\t\t\t\tsubsample.BytesOfClearData = stream.readUint16();\r\n\t\t\t\tsubsample.BytesOfProtectedData = stream.readUint32();\r\n\t\t\t\tsample.subsamples.push(subsample);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// TODO\r\n\t\tthis.samples.push(sample);\r\n\t}\r\n}*/);\r\n// file:src/parsing/sgpd.js\r\nBoxParser.createFullBoxCtor(\"sgpd\", \"SampleGroupDescriptionBox\", function(stream) {\r\n\tthis.grouping_type = stream.readString(4);\r\n\tLog.debug(\"BoxParser\", \"Found Sample Groups of type \"+this.grouping_type);\r\n\tif (this.version === 1) {\r\n\t\tthis.default_length = stream.readUint32();\r\n\t} else {\r\n\t\tthis.default_length = 0;\r\n\t}\r\n\tif (this.version >= 2) {\r\n\t\tthis.default_group_description_index = stream.readUint32();\r\n\t}\r\n\tthis.entries = [];\r\n\tvar entry_count = stream.readUint32();\r\n\tfor (var i = 0; i < entry_count; i++) {\r\n\t\tvar entry;\r\n\t\tif (BoxParser[this.grouping_type+\"SampleGroupEntry\"]) {\r\n\t\t\tentry = new BoxParser[this.grouping_type+\"SampleGroupEntry\"](this.grouping_type);\r\n\t\t}  else {\r\n\t\t\tentry = new BoxParser.SampleGroupEntry(this.grouping_type);\r\n\t\t}\r\n\t\tthis.entries.push(entry);\r\n\t\tif (this.version === 1) {\r\n\t\t\tif (this.default_length === 0) {\r\n\t\t\t\tentry.description_length = stream.readUint32();\r\n\t\t\t} else {\r\n\t\t\t\tentry.description_length = this.default_length;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tentry.description_length = this.default_length;\r\n\t\t}\r\n\t\tif (entry.write === BoxParser.SampleGroupEntry.prototype.write) {\r\n\t\t\tLog.info(\"BoxParser\", \"SampleGroup for type \"+this.grouping_type+\" writing not yet implemented, keeping unparsed data in memory for later write\");\r\n\t\t\t// storing data\r\n\t\t\tentry.data = stream.readUint8Array(entry.description_length);\r\n\t\t\t// rewinding\r\n\t\t\tstream.position -= entry.description_length;\r\n\t\t}\r\n\t\tentry.parse(stream);\r\n\t}\r\n});\r\n\r\n// file:src/parsing/sidx.js\r\nBoxParser.createFullBoxCtor(\"sidx\", \"CompressedSegmentIndexBox\", function(stream) {\r\n\tthis.reference_ID = stream.readUint32();\r\n\tthis.timescale = stream.readUint32();\r\n\tif (this.version === 0) {\r\n\t\tthis.earliest_presentation_time = stream.readUint32();\r\n\t\tthis.first_offset = stream.readUint32();\r\n\t} else {\r\n\t\tthis.earliest_presentation_time = stream.readUint64();\r\n\t\tthis.first_offset = stream.readUint64();\r\n\t}\r\n\tstream.readUint16();\r\n\tthis.references = [];\r\n\tvar count = stream.readUint16();\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\tvar ref = {};\r\n\t\tthis.references.push(ref);\r\n\t\tvar tmp_32 = stream.readUint32();\r\n\t\tref.reference_type = (tmp_32 >> 31) & 0x1;\r\n\t\tref.referenced_size = tmp_32 & 0x7FFFFFFF;\r\n\t\tref.subsegment_duration = stream.readUint32();\r\n\t\ttmp_32 = stream.readUint32();\r\n\t\tref.starts_with_SAP = (tmp_32 >> 31) & 0x1;\r\n\t\tref.SAP_type = (tmp_32 >> 28) & 0x7;\r\n\t\tref.SAP_delta_time = tmp_32 & 0xFFFFFFF;\r\n\t}\r\n});\r\n\r\n// file:src/parsing/singleitemtypereference.js\r\nBoxParser.SingleItemTypeReferenceBox = function(type, size, hdr_size, start) {\r\n\tBoxParser.Box.call(this, type, size);\r\n\tthis.hdr_size = hdr_size;\r\n\tthis.start = start;\r\n}\r\nBoxParser.SingleItemTypeReferenceBox.prototype = new BoxParser.Box();\r\nBoxParser.SingleItemTypeReferenceBox.prototype.parse = function(stream) {\r\n\tthis.from_item_ID = stream.readUint16();\r\n\tvar count =  stream.readUint16();\r\n\tthis.references = [];\r\n\tfor(var i = 0; i < count; i++) {\r\n\t\tthis.references[i] = {};\r\n\t\tthis.references[i].to_item_ID = stream.readUint16();\r\n\t}\r\n}\r\n\r\n// file:src/parsing/singleitemtypereferencelarge.js\r\nBoxParser.SingleItemTypeReferenceBoxLarge = function(type, size, hdr_size, start) {\r\n\tBoxParser.Box.call(this, type, size);\r\n\tthis.hdr_size = hdr_size;\r\n\tthis.start = start;\r\n}\r\nBoxParser.SingleItemTypeReferenceBoxLarge.prototype = new BoxParser.Box();\r\nBoxParser.SingleItemTypeReferenceBoxLarge.prototype.parse = function(stream) {\r\n\tthis.from_item_ID = stream.readUint32();\r\n\tvar count =  stream.readUint16();\r\n\tthis.references = [];\r\n\tfor(var i = 0; i < count; i++) {\r\n\t\tthis.references[i] = {};\r\n\t\tthis.references[i].to_item_ID = stream.readUint32();\r\n\t}\r\n}\r\n\r\n// file:src/parsing/SmDm.js\r\nBoxParser.createFullBoxCtor(\"SmDm\", \"SMPTE2086MasteringDisplayMetadataBox\", function(stream) {\r\n\tthis.primaryRChromaticity_x = stream.readUint16();\r\n    this.primaryRChromaticity_y = stream.readUint16();\r\n    this.primaryGChromaticity_x = stream.readUint16();\r\n    this.primaryGChromaticity_y = stream.readUint16();\r\n    this.primaryBChromaticity_x = stream.readUint16();\r\n    this.primaryBChromaticity_y = stream.readUint16();\r\n    this.whitePointChromaticity_x = stream.readUint16();\r\n    this.whitePointChromaticity_y = stream.readUint16();\r\n    this.luminanceMax = stream.readUint32();\r\n    this.luminanceMin = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/smhd.js\r\nBoxParser.createFullBoxCtor(\"smhd\", \"SoundMediaHeaderBox\", function(stream) {\r\n\tthis.balance = stream.readUint16();\r\n\tstream.readUint16();\r\n});\r\n\r\n// file:src/parsing/ssix.js\r\nBoxParser.createFullBoxCtor(\"ssix\", \"CompressedSubsegmentIndexBox\", function(stream) {\r\n\tthis.subsegments = [];\r\n\tvar subsegment_count = stream.readUint32();\r\n\tfor (var i = 0; i < subsegment_count; i++) {\r\n\t\tvar subsegment = {};\r\n\t\tthis.subsegments.push(subsegment);\r\n\t\tsubsegment.ranges = [];\r\n\t\tvar range_count = stream.readUint32();\r\n\t\tfor (var j = 0; j < range_count; j++) {\r\n\t\t\tvar range = {};\r\n\t\t\tsubsegment.ranges.push(range);\r\n\t\t\trange.level = stream.readUint8();\r\n\t\t\trange.range_size = stream.readUint24();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stco.js\r\nBoxParser.createFullBoxCtor(\"stco\", \"ChunkOffsetBox\", function(stream) {\r\n\tvar entry_count;\r\n\tentry_count = stream.readUint32();\r\n\tthis.chunk_offsets = [];\r\n\tif (this.version === 0) {\r\n\t\tfor (var i = 0; i < entry_count; i++) {\r\n\t\t\tthis.chunk_offsets.push(stream.readUint32());\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stdp.js\r\nBoxParser.createFullBoxCtor(\"stdp\", \"DegradationPriorityBox\", function(stream) {\r\n\tvar count = (this.size - this.hdr_size)/2;\r\n\tthis.priority = [];\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\tthis.priority[i] = stream.readUint16();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/sthd.js\r\nBoxParser.createFullBoxCtor(\"sthd\", \"SubtitleMediaHeaderBox\");\r\n\r\n// file:src/parsing/stri.js\r\nBoxParser.createFullBoxCtor(\"stri\", \"SubTrackInformationBox\", function(stream) {\r\n\tthis.switch_group = stream.readUint16();\r\n\tthis.alternate_group = stream.readUint16();\r\n\tthis.sub_track_id = stream.readUint32();\r\n\tvar count = (this.size - this.hdr_size - 8)/4;\r\n\tthis.attribute_list = [];\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\tthis.attribute_list[i] = stream.readUint32();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stsc.js\r\nBoxParser.createFullBoxCtor(\"stsc\", \"SampleToChunkBox\", function(stream) {\r\n\tvar entry_count;\r\n\tvar i;\r\n\tentry_count = stream.readUint32();\r\n\tthis.first_chunk = [];\r\n\tthis.samples_per_chunk = [];\r\n\tthis.sample_description_index = [];\r\n\tif (this.version === 0) {\r\n\t\tfor(i=0; i<entry_count; i++) {\r\n\t\t\tthis.first_chunk.push(stream.readUint32());\r\n\t\t\tthis.samples_per_chunk.push(stream.readUint32());\r\n\t\t\tthis.sample_description_index.push(stream.readUint32());\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stsd.js\r\nBoxParser.createFullBoxCtor(\"stsd\", \"SampleDescriptionBox\", function(stream) {\r\n\tvar i;\r\n\tvar ret;\r\n\tvar entryCount;\r\n\tvar box;\r\n\tthis.entries = [];\r\n\tentryCount = stream.readUint32();\r\n\tfor (i = 1; i <= entryCount; i++) {\r\n\t\tret = BoxParser.parseOneBox(stream, true, this.size - (stream.getPosition() - this.start));\r\n\t\tif (ret.code === BoxParser.OK) {\r\n\t\t\tif (BoxParser[ret.type+\"SampleEntry\"]) {\r\n\t\t\t\tbox = new BoxParser[ret.type+\"SampleEntry\"](ret.size);\r\n\t\t\t\tbox.hdr_size = ret.hdr_size;\r\n\t\t\t\tbox.start = ret.start;\r\n\t\t\t} else {\r\n\t\t\t\tLog.warn(\"BoxParser\", \"Unknown sample entry type: \"+ret.type);\r\n\t\t\t\tbox = new BoxParser.SampleEntry(ret.type, ret.size, ret.hdr_size, ret.start);\r\n\t\t\t}\r\n\t\t\tif (box.write === BoxParser.SampleEntry.prototype.write) {\r\n\t\t\t\tLog.info(\"BoxParser\", \"SampleEntry \"+box.type+\" box writing not yet implemented, keeping unparsed data in memory for later write\");\r\n\t\t\t\tbox.parseDataAndRewind(stream);\r\n\t\t\t}\r\n\t\t\tbox.parse(stream);\r\n\t\t\tthis.entries.push(box);\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stsg.js\r\nBoxParser.createFullBoxCtor(\"stsg\", \"SubTrackSampleGroupBox\", function(stream) {\r\n\tthis.grouping_type = stream.readUint32();\r\n\tvar count = stream.readUint16();\r\n\tthis.group_description_index = [];\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\tthis.group_description_index[i] = stream.readUint32();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stsh.js\r\nBoxParser.createFullBoxCtor(\"stsh\", \"ShadowSyncSampleBox\", function(stream) {\r\n\tvar entry_count;\r\n\tvar i;\r\n\tentry_count = stream.readUint32();\r\n\tthis.shadowed_sample_numbers = [];\r\n\tthis.sync_sample_numbers = [];\r\n\tif (this.version === 0) {\r\n\t\tfor(i=0; i<entry_count; i++) {\r\n\t\t\tthis.shadowed_sample_numbers.push(stream.readUint32());\r\n\t\t\tthis.sync_sample_numbers.push(stream.readUint32());\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stss.js\r\nBoxParser.createFullBoxCtor(\"stss\", \"SyncSampleBox\", function(stream) {\r\n\tvar i;\r\n\tvar entry_count;\r\n\tentry_count = stream.readUint32();\r\n\tif (this.version === 0) {\r\n\t\tthis.sample_numbers = [];\r\n\t\tfor(i=0; i<entry_count; i++) {\r\n\t\t\tthis.sample_numbers.push(stream.readUint32());\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stsz.js\r\nBoxParser.createFullBoxCtor(\"stsz\", \"SampleSizeBox\", function(stream) {\r\n\tvar i;\r\n\tthis.sample_sizes = [];\r\n\tif (this.version === 0) {\r\n\t\tthis.sample_size = stream.readUint32();\r\n\t\tthis.sample_count = stream.readUint32();\r\n\t\tfor (i = 0; i < this.sample_count; i++) {\r\n\t\t\tif (this.sample_size === 0) {\r\n\t\t\t\tthis.sample_sizes.push(stream.readUint32());\r\n\t\t\t} else {\r\n\t\t\t\tthis.sample_sizes[i] = this.sample_size;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stts.js\r\nBoxParser.createFullBoxCtor(\"stts\", \"TimeToSampleBox\", function(stream) {\r\n\tvar entry_count;\r\n\tvar i;\r\n\tvar delta;\r\n\tentry_count = stream.readUint32();\r\n\tthis.sample_counts = [];\r\n\tthis.sample_deltas = [];\r\n\tif (this.version === 0) {\r\n\t\tfor(i=0; i<entry_count; i++) {\r\n\t\t\tthis.sample_counts.push(stream.readUint32());\r\n\t\t\tdelta = stream.readInt32();\r\n\t\t\tif (delta < 0) {\r\n\t\t\t\tLog.warn(\"BoxParser\", \"File uses negative stts sample delta, using value 1 instead, sync may be lost!\");\r\n\t\t\t\tdelta = 1;\r\n\t\t\t}\r\n\t\t\tthis.sample_deltas.push(delta);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/stvi.js\r\nBoxParser.createFullBoxCtor(\"stvi\", \"StereoVideoBox\", function(stream) {\r\n\tvar tmp32 = stream.readUint32();\r\n\tthis.single_view_allowed = tmp32 & 0x3;\r\n\tthis.stereo_scheme = stream.readUint32();\r\n\tvar length = stream.readUint32();\r\n\tthis.stereo_indication_type = stream.readString(length);\r\n\tvar ret;\r\n\tvar box;\r\n\tthis.boxes = [];\r\n\twhile (stream.getPosition() < this.start+this.size) {\r\n\t\tret = BoxParser.parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\r\n\t\tif (ret.code === BoxParser.OK) {\r\n\t\t\tbox = ret.box;\r\n\t\t\tthis.boxes.push(box);\r\n\t\t\tthis[box.type] = box;\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/styp.js\r\nBoxParser.createBoxCtor(\"styp\", \"SegmentTypeBox\", function(stream) {\r\n\tBoxParser.ftypBox.prototype.parse.call(this, stream);\r\n});\r\n\r\n// file:src/parsing/stz2.js\r\nBoxParser.createFullBoxCtor(\"stz2\", \"CompactSampleSizeBox\", function(stream) {\r\n\tvar i;\r\n\tvar sample_size;\r\n\tvar sample_count;\r\n\tthis.sample_sizes = [];\r\n\tif (this.version === 0) {\r\n\t\tthis.reserved = stream.readUint24();\r\n\t\tthis.field_size = stream.readUint8();\r\n\t\tsample_count = stream.readUint32();\r\n\t\tif (this.field_size === 4) {\r\n\t\t\tfor (i = 0; i < sample_count; i+=2) {\r\n\t\t\t\tvar tmp = stream.readUint8();\r\n\t\t\t\tthis.sample_sizes[i] = (tmp >> 4) & 0xF;\r\n\t\t\t\tthis.sample_sizes[i+1] = tmp & 0xF;\r\n\t\t\t}\r\n\t\t} else if (this.field_size === 8) {\r\n\t\t\tfor (i = 0; i < sample_count; i++) {\r\n\t\t\t\tthis.sample_sizes[i] = stream.readUint8();\r\n\t\t\t}\r\n\t\t} else if (this.field_size === 16) {\r\n\t\t\tfor (i = 0; i < sample_count; i++) {\r\n\t\t\t\tthis.sample_sizes[i] = stream.readUint16();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tLog.error(\"BoxParser\", \"Error in length field in stz2 box\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/subs.js\r\nBoxParser.createFullBoxCtor(\"subs\", \"SubSampleInformationBox\", function(stream) {\r\n\tvar i,j;\r\n\tvar entry_count;\r\n\tvar subsample_count;\r\n\tentry_count = stream.readUint32();\r\n\tthis.entries = [];\r\n\tfor (i = 0; i < entry_count; i++) {\r\n\t\tvar sampleInfo = {};\r\n\t\tthis.entries[i] = sampleInfo;\r\n\t\tsampleInfo.sample_delta = stream.readUint32();\r\n\t\tsampleInfo.subsamples = [];\r\n\t\tsubsample_count = stream.readUint16();\r\n\t\tif (subsample_count>0) {\r\n\t\t\tfor (j = 0; j < subsample_count; j++) {\r\n\t\t\t\tvar subsample = {};\r\n\t\t\t\tsampleInfo.subsamples.push(subsample);\r\n\t\t\t\tif (this.version == 1) {\r\n\t\t\t\t\tsubsample.size = stream.readUint32();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsubsample.size = stream.readUint16();\r\n\t\t\t\t}\r\n\t\t\t\tsubsample.priority = stream.readUint8();\r\n\t\t\t\tsubsample.discardable = stream.readUint8();\r\n\t\t\t\tsubsample.codec_specific_parameters = stream.readUint32();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/tenc.js\r\nBoxParser.createFullBoxCtor(\"tenc\", \"TrackEncryptionBox\", function(stream) {\r\n\tstream.readUint8(); // reserved\r\n\tif (this.version === 0) {\r\n\t\tstream.readUint8();\r\n\t} else {\r\n\t\tvar tmp = stream.readUint8();\r\n\t\tthis.default_crypt_byte_block = (tmp >> 4) & 0xF;\r\n\t\tthis.default_skip_byte_block = tmp & 0xF;\r\n\t}\r\n\tthis.default_isProtected = stream.readUint8();\r\n\tthis.default_Per_Sample_IV_Size = stream.readUint8();\r\n\tthis.default_KID = BoxParser.parseHex16(stream);\r\n\tif (this.default_isProtected === 1 && this.default_Per_Sample_IV_Size === 0) {\r\n\t\tthis.default_constant_IV_size = stream.readUint8();\r\n\t\tthis.default_constant_IV = stream.readUint8Array(this.default_constant_IV_size);\r\n\t}\r\n});// file:src/parsing/tfdt.js\r\nBoxParser.createFullBoxCtor(\"tfdt\", \"TrackFragmentBaseMediaDecodeTimeBox\", function(stream) {\r\n\tif (this.version == 1) {\r\n\t\tthis.baseMediaDecodeTime = stream.readUint64();\r\n\t} else {\r\n\t\tthis.baseMediaDecodeTime = stream.readUint32();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/tfhd.js\r\nBoxParser.createFullBoxCtor(\"tfhd\", \"TrackFragmentHeaderBox\", function(stream) {\r\n\tvar readBytes = 0;\r\n\tthis.track_id = stream.readUint32();\r\n\tif (this.size - this.hdr_size > readBytes && (this.flags & BoxParser.TFHD_FLAG_BASE_DATA_OFFSET)) {\r\n\t\tthis.base_data_offset = stream.readUint64();\r\n\t\treadBytes += 8;\r\n\t} else {\r\n\t\tthis.base_data_offset = 0;\r\n\t}\r\n\tif (this.size - this.hdr_size > readBytes && (this.flags & BoxParser.TFHD_FLAG_SAMPLE_DESC)) {\r\n\t\tthis.default_sample_description_index = stream.readUint32();\r\n\t\treadBytes += 4;\r\n\t} else {\r\n\t\tthis.default_sample_description_index = 0;\r\n\t}\r\n\tif (this.size - this.hdr_size > readBytes && (this.flags & BoxParser.TFHD_FLAG_SAMPLE_DUR)) {\r\n\t\tthis.default_sample_duration = stream.readUint32();\r\n\t\treadBytes += 4;\r\n\t} else {\r\n\t\tthis.default_sample_duration = 0;\r\n\t}\r\n\tif (this.size - this.hdr_size > readBytes && (this.flags & BoxParser.TFHD_FLAG_SAMPLE_SIZE)) {\r\n\t\tthis.default_sample_size = stream.readUint32();\r\n\t\treadBytes += 4;\r\n\t} else {\r\n\t\tthis.default_sample_size = 0;\r\n\t}\r\n\tif (this.size - this.hdr_size > readBytes && (this.flags & BoxParser.TFHD_FLAG_SAMPLE_FLAGS)) {\r\n\t\tthis.default_sample_flags = stream.readUint32();\r\n\t\treadBytes += 4;\r\n\t} else {\r\n\t\tthis.default_sample_flags = 0;\r\n\t}\r\n});\r\n\r\n// file:src/parsing/tfra.js\r\nBoxParser.createFullBoxCtor(\"tfra\", \"TrackFragmentRandomAccessBox\", function(stream) {\r\n\tthis.track_ID = stream.readUint32();\r\n\tstream.readUint24();\r\n\tvar tmp_byte = stream.readUint8();\r\n\tthis.length_size_of_traf_num = (tmp_byte >> 4) & 0x3;\r\n\tthis.length_size_of_trun_num = (tmp_byte >> 2) & 0x3;\r\n\tthis.length_size_of_sample_num = (tmp_byte) & 0x3;\r\n\tthis.entries = [];\r\n\tvar number_of_entries = stream.readUint32();\r\n\tfor (var i = 0; i < number_of_entries; i++) {\r\n\t\tif (this.version === 1) {\r\n\t\t\tthis.time = stream.readUint64();\r\n\t\t\tthis.moof_offset = stream.readUint64();\r\n\t\t} else {\r\n\t\t\tthis.time = stream.readUint32();\r\n\t\t\tthis.moof_offset = stream.readUint32();\r\n\t\t}\r\n\t\tthis.traf_number = stream[\"readUint\"+(8*(this.length_size_of_traf_num+1))]();\r\n\t\tthis.trun_number = stream[\"readUint\"+(8*(this.length_size_of_trun_num+1))]();\r\n\t\tthis.sample_number = stream[\"readUint\"+(8*(this.length_size_of_sample_num+1))]();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/tkhd.js\r\nBoxParser.createFullBoxCtor(\"tkhd\", \"TrackHeaderBox\", function(stream) {\r\n\tif (this.version == 1) {\r\n\t\tthis.creation_time = stream.readUint64();\r\n\t\tthis.modification_time = stream.readUint64();\r\n\t\tthis.track_id = stream.readUint32();\r\n\t\tstream.readUint32();\r\n\t\tthis.duration = stream.readUint64();\r\n\t} else {\r\n\t\tthis.creation_time = stream.readUint32();\r\n\t\tthis.modification_time = stream.readUint32();\r\n\t\tthis.track_id = stream.readUint32();\r\n\t\tstream.readUint32();\r\n\t\tthis.duration = stream.readUint32();\r\n\t}\r\n\tstream.readUint32Array(2);\r\n\tthis.layer = stream.readInt16();\r\n\tthis.alternate_group = stream.readInt16();\r\n\tthis.volume = stream.readInt16()>>8;\r\n\tstream.readUint16();\r\n\tthis.matrix = stream.readInt32Array(9);\r\n\tthis.width = stream.readUint32();\r\n\tthis.height = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/tmax.js\r\nBoxParser.createBoxCtor(\"tmax\", \"hintmaxrelativetime\", function(stream) {\r\n\tthis.time = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/tmin.js\r\nBoxParser.createBoxCtor(\"tmin\", \"hintminrelativetime\", function(stream) {\r\n\tthis.time = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/totl.js\r\nBoxParser.createBoxCtor(\"totl\", \"hintBytesSent\", function(stream) {\r\n\tthis.bytessent = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/tpay.js\r\nBoxParser.createBoxCtor(\"tpay\", \"hintBytesSent\", function(stream) {\r\n\tthis.bytessent = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/tpyl.js\r\nBoxParser.createBoxCtor(\"tpyl\", \"hintBytesSent\", function(stream) {\r\n\tthis.bytessent = stream.readUint64();\r\n});\r\n\r\n// file:src/parsing/TrackGroup.js\r\nBoxParser.TrackGroupTypeBox.prototype.parse = function(stream) {\r\n\tthis.parseFullHeader(stream);\r\n\tthis.track_group_id = stream.readUint32();\r\n}\r\n\r\n// file:src/parsing/trackgroups/msrc.js\r\nBoxParser.createTrackGroupCtor(\"msrc\");// file:src/parsing/TrakReference.js\r\nBoxParser.TrackReferenceTypeBox = function(type, size, hdr_size, start) {\r\n\tBoxParser.Box.call(this, type, size);\r\n\tthis.hdr_size = hdr_size;\r\n\tthis.start = start;\r\n}\r\nBoxParser.TrackReferenceTypeBox.prototype = new BoxParser.Box();\r\nBoxParser.TrackReferenceTypeBox.prototype.parse = function(stream) {\r\n\tthis.track_ids = stream.readUint32Array((this.size-this.hdr_size)/4);\r\n}\r\n\r\n// file:src/parsing/tref.js\r\nBoxParser.trefBox.prototype.parse = function(stream) {\r\n\tvar ret;\r\n\tvar box;\r\n\twhile (stream.getPosition() < this.start+this.size) {\r\n\t\tret = BoxParser.parseOneBox(stream, true, this.size - (stream.getPosition() - this.start));\r\n\t\tif (ret.code === BoxParser.OK) {\r\n\t\t\tbox = new BoxParser.TrackReferenceTypeBox(ret.type, ret.size, ret.hdr_size, ret.start);\r\n\t\t\tif (box.write === BoxParser.Box.prototype.write && box.type !== \"mdat\") {\r\n\t\t\t\tLog.info(\"BoxParser\", \"TrackReference \"+box.type+\" box writing not yet implemented, keeping unparsed data in memory for later write\");\r\n\t\t\t\tbox.parseDataAndRewind(stream);\r\n\t\t\t}\r\n\t\t\tbox.parse(stream);\r\n\t\t\tthis.boxes.push(box);\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// file:src/parsing/trep.js\r\nBoxParser.createFullBoxCtor(\"trep\", \"TrackExtensionPropertiesBox\", function(stream) {\r\n\tthis.track_ID = stream.readUint32();\r\n\tthis.boxes = [];\r\n\twhile (stream.getPosition() < this.start+this.size) {\r\n\t\tret = BoxParser.parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\r\n\t\tif (ret.code === BoxParser.OK) {\r\n\t\t\tbox = ret.box;\r\n\t\t\tthis.boxes.push(box);\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/trex.js\r\nBoxParser.createFullBoxCtor(\"trex\", \"TrackExtendsBox\", function(stream) {\r\n\tthis.track_id = stream.readUint32();\r\n\tthis.default_sample_description_index = stream.readUint32();\r\n\tthis.default_sample_duration = stream.readUint32();\r\n\tthis.default_sample_size = stream.readUint32();\r\n\tthis.default_sample_flags = stream.readUint32();\r\n});\r\n\r\n// file:src/parsing/trpy.js\r\nBoxParser.createBoxCtor(\"trpy\", \"hintBytesSent\", function(stream) {\r\n\tthis.bytessent = stream.readUint64();\r\n});\r\n\r\n// file:src/parsing/trun.js\r\nBoxParser.createFullBoxCtor(\"trun\", \"TrackRunBox\", function(stream) {\r\n\tvar readBytes = 0;\r\n\tthis.sample_count = stream.readUint32();\r\n\treadBytes+= 4;\r\n\tif (this.size - this.hdr_size > readBytes && (this.flags & BoxParser.TRUN_FLAGS_DATA_OFFSET) ) {\r\n\t\tthis.data_offset = stream.readInt32(); //signed\r\n\t\treadBytes += 4;\r\n\t} else {\r\n\t\tthis.data_offset = 0;\r\n\t}\r\n\tif (this.size - this.hdr_size > readBytes && (this.flags & BoxParser.TRUN_FLAGS_FIRST_FLAG) ) {\r\n\t\tthis.first_sample_flags = stream.readUint32();\r\n\t\treadBytes += 4;\r\n\t} else {\r\n\t\tthis.first_sample_flags = 0;\r\n\t}\r\n\tthis.sample_duration = [];\r\n\tthis.sample_size = [];\r\n\tthis.sample_flags = [];\r\n\tthis.sample_composition_time_offset = [];\r\n\tif (this.size - this.hdr_size > readBytes) {\r\n\t\tfor (var i = 0; i < this.sample_count; i++) {\r\n\t\t\tif (this.flags & BoxParser.TRUN_FLAGS_DURATION) {\r\n\t\t\t\tthis.sample_duration[i] = stream.readUint32();\r\n\t\t\t}\r\n\t\t\tif (this.flags & BoxParser.TRUN_FLAGS_SIZE) {\r\n\t\t\t\tthis.sample_size[i] = stream.readUint32();\r\n\t\t\t}\r\n\t\t\tif (this.flags & BoxParser.TRUN_FLAGS_FLAGS) {\r\n\t\t\t\tthis.sample_flags[i] = stream.readUint32();\r\n\t\t\t}\r\n\t\t\tif (this.flags & BoxParser.TRUN_FLAGS_CTS_OFFSET) {\r\n\t\t\t\tif (this.version === 0) {\r\n\t\t\t\t\tthis.sample_composition_time_offset[i] = stream.readUint32();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.sample_composition_time_offset[i] = stream.readInt32(); //signed\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// file:src/parsing/tsel.js\r\nBoxParser.createFullBoxCtor(\"tsel\", \"TrackSelectionBox\", function(stream) {\r\n\tthis.switch_group = stream.readUint32();\r\n\tvar count = (this.size - this.hdr_size - 4)/4;\r\n\tthis.attribute_list = [];\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\tthis.attribute_list[i] = stream.readUint32();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/txtC.js\r\nBoxParser.createFullBoxCtor(\"txtC\", \"TextConfigBox\", function(stream) {\r\n\tthis.config = stream.readCString();\r\n});\r\n\r\n// file:src/parsing/tyco.js\r\nBoxParser.createBoxCtor(\"tyco\", \"TypeCombinationBox\", function(stream) {\r\n\tvar count = (this.size - this.hdr_size) / 4;\r\n\tthis.compatible_brands = [];\r\n\tfor (var i = 0; i < count; i++) {\r\n\t\tthis.compatible_brands[i] = stream.readString(4);\r\n\t}\r\n});\r\n\r\n// file:src/parsing/udes.js\r\nBoxParser.createFullBoxCtor(\"udes\", \"UserDescriptionProperty\", function(stream) {\r\n\tthis.lang = stream.readCString();\r\n\tthis.name = stream.readCString();\r\n\tthis.description = stream.readCString();\r\n\tthis.tags = stream.readCString();\r\n});\r\n\r\n// file:src/parsing/uncC.js\r\nBoxParser.createFullBoxCtor(\"uncC\", \"UncompressedFrameConfigBox\", function(stream) {\r\n    var i;\r\n    this.profile = stream.readString(4);\r\n    if (this.version == 1) {\r\n        // Nothing - just the profile\r\n    } else if (this.version == 0) {\r\n        this.component_count = stream.readUint32();\r\n        this.component_index = [];\r\n        this.component_bit_depth_minus_one = [];\r\n        this.component_format = [];\r\n        this.component_align_size = [];\r\n        for (i = 0; i < this.component_count; i++) {\r\n            this.component_index.push(stream.readUint16());\r\n            this.component_bit_depth_minus_one.push(stream.readUint8());\r\n            this.component_format.push(stream.readUint8());\r\n            this.component_align_size.push(stream.readUint8());\r\n        }\r\n        this.sampling_type = stream.readUint8();\r\n        this.interleave_type = stream.readUint8();\r\n        this.block_size = stream.readUint8();\r\n        var flags = stream.readUint8();\r\n        this.component_little_endian = (flags >> 7) & 0x1;\r\n        this.block_pad_lsb = (flags >> 6) & 0x1;\r\n        this.block_little_endian = (flags >> 5) & 0x1;\r\n        this.block_reversed = (flags >> 4) & 0x1;\r\n        this.pad_unknown = (flags >> 3) & 0x1;\r\n        this.pixel_size = stream.readUint32();\r\n        this.row_align_size = stream.readUint32();\r\n        this.tile_align_size = stream.readUint32();\r\n        this.num_tile_cols_minus_one = stream.readUint32();\r\n        this.num_tile_rows_minus_one = stream.readUint32();\r\n    }\r\n});\r\n\r\n// file:src/parsing/url.js\r\nBoxParser.createFullBoxCtor(\"url \", \"DataEntryUrlBox\", function(stream) {\r\n\tif (this.flags !== 0x000001) {\r\n\t\tthis.location = stream.readCString();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/urn.js\r\nBoxParser.createFullBoxCtor(\"urn \", \"DataEntryUrnBox\", function(stream) {\r\n\tthis.name = stream.readCString();\r\n\tif (this.size - this.hdr_size - this.name.length - 1 > 0) {\r\n\t\tthis.location = stream.readCString();\r\n\t}\r\n});\r\n\r\n// file:src/parsing/uuid/piff/piffLsm.js\r\nBoxParser.createUUIDBox(\"a5d40b30e81411ddba2f0800200c9a66\", \"LiveServerManifestBox\", true, false, function(stream) {\r\n    this.LiveServerManifest = stream.readString(this.size - this.hdr_size)\r\n        .replace(/&/g, \"&amp;\")\r\n        .replace(/</g, \"&lt;\")\r\n        .replace(/>/g, \"&gt;\")\r\n        .replace(/\"/g, \"&quot;\")\r\n        .replace(/'/g, \"&#039;\");\r\n});// file:src/parsing/uuid/piff/piffPssh.js\r\nBoxParser.createUUIDBox(\"d08a4f1810f34a82b6c832d8aba183d3\", \"PiffProtectionSystemSpecificHeaderBox\", true, false, function(stream) {\r\n\tthis.system_id = BoxParser.parseHex16(stream);\r\n\tvar datasize = stream.readUint32();\r\n\tif (datasize > 0) {\r\n\t\tthis.data = stream.readUint8Array(datasize);\r\n\t}\r\n});\r\n\r\n// file:src/parsing/uuid/piff/piffSenc.js\r\nBoxParser.createUUIDBox(\"a2394f525a9b4f14a2446c427c648df4\", \"PiffSampleEncryptionBox\", true, false /*, function(stream) {\r\n\tif (this.flags & 0x1) {\r\n\t\tthis.AlgorithmID = stream.readUint24();\r\n\t\tthis.IV_size = stream.readUint8();\r\n\t\tthis.KID = BoxParser.parseHex16(stream);\r\n\t}\r\n\tvar sample_count = stream.readUint32();\r\n\tthis.samples = [];\r\n\tfor (var i = 0; i < sample_count; i++) {\r\n\t\tvar sample = {};\r\n\t\tsample.InitializationVector = this.readUint8Array(this.IV_size*8);\r\n\t\tif (this.flags & 0x2) {\r\n\t\t\tsample.subsamples = [];\r\n\t\t\tsample.NumberOfEntries = stream.readUint16();\r\n\t\t\tfor (var j = 0; j < sample.NumberOfEntries; j++) {\r\n\t\t\t\tvar subsample = {};\r\n\t\t\t\tsubsample.BytesOfClearData = stream.readUint16();\r\n\t\t\t\tsubsample.BytesOfProtectedData = stream.readUint32();\r\n\t\t\t\tsample.subsamples.push(subsample);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.samples.push(sample);\r\n\t}\r\n}*/);\r\n// file:src/parsing/uuid/piff/piffTenc.js\r\nBoxParser.createUUIDBox(\"8974dbce7be74c5184f97148f9882554\", \"PiffTrackEncryptionBox\", true, false, function(stream) {\r\n\tthis.default_AlgorithmID = stream.readUint24();\r\n\tthis.default_IV_size = stream.readUint8();\r\n\tthis.default_KID = BoxParser.parseHex16(stream);\r\n});// file:src/parsing/uuid/piff/piffTfrf.js\r\nBoxParser.createUUIDBox(\"d4807ef2ca3946958e5426cb9e46a79f\", \"TfrfBox\", true, false, function(stream) {\r\n    this.fragment_count = stream.readUint8();\r\n    this.entries = [];\r\n\r\n    for (var i = 0; i < this.fragment_count; i++) {\r\n        var entry = {};\r\n        var absolute_time = 0;\r\n        var absolute_duration = 0;\r\n\r\n        if (this.version === 1) {\r\n            absolute_time = stream.readUint64();\r\n            absolute_duration = stream.readUint64();\r\n        } else {\r\n            absolute_time = stream.readUint32();\r\n            absolute_duration = stream.readUint32();\r\n        }\r\n\r\n        entry.absolute_time = absolute_time;\r\n        entry.absolute_duration = absolute_duration;\r\n\r\n        this.entries.push(entry);\r\n    }\r\n});// file:src/parsing/uuid/piff/piffTfxd.js\r\nBoxParser.createUUIDBox(\"6d1d9b0542d544e680e2141daff757b2\", \"TfxdBox\", true, false, function(stream) {\r\n    if (this.version === 1) {\r\n       this.absolute_time = stream.readUint64();\r\n       this.duration = stream.readUint64();\r\n    } else {\r\n       this.absolute_time = stream.readUint32();\r\n       this.duration = stream.readUint32();\r\n    }\r\n});// file:src/parsing/vmhd.js\r\nBoxParser.createFullBoxCtor(\"vmhd\", \"VideoMediaHeaderBox\", function(stream) {\r\n\tthis.graphicsmode = stream.readUint16();\r\n\tthis.opcolor = stream.readUint16Array(3);\r\n});\r\n\r\n// file:src/parsing/vpcC.js\r\nBoxParser.createFullBoxCtor(\"vpcC\", \"VPCodecConfigurationRecord\", function (stream) {\r\n\tvar tmp;\r\n\tif (this.version === 1) {\r\n\t\tthis.profile = stream.readUint8();\r\n\t\tthis.level = stream.readUint8();\r\n\t\ttmp = stream.readUint8();\r\n\t\tthis.bitDepth = tmp >> 4;\r\n\t\tthis.chromaSubsampling = (tmp >> 1) & 0x7;\r\n\t\tthis.videoFullRangeFlag = tmp & 0x1;\r\n\t\tthis.colourPrimaries = stream.readUint8();\r\n\t\tthis.transferCharacteristics = stream.readUint8();\r\n\t\tthis.matrixCoefficients = stream.readUint8();\r\n\t\tthis.codecIntializationDataSize = stream.readUint16();\r\n\t\tthis.codecIntializationData = stream.readUint8Array(this.codecIntializationDataSize);\r\n\t} else {\r\n\t\tthis.profile = stream.readUint8();\r\n\t\tthis.level = stream.readUint8();\r\n\t\ttmp = stream.readUint8();\r\n\t\tthis.bitDepth = (tmp >> 4) & 0xF;\r\n\t\tthis.colorSpace = tmp & 0xF;\r\n\t\ttmp = stream.readUint8();\r\n\t\tthis.chromaSubsampling = (tmp >> 4) & 0xF;\r\n\t\tthis.transferFunction = (tmp >> 1) & 0x7;\r\n\t\tthis.videoFullRangeFlag = tmp & 0x1;\r\n\t\tthis.codecIntializationDataSize = stream.readUint16();\r\n\t\tthis.codecIntializationData = stream.readUint8Array(this.codecIntializationDataSize);\r\n\t}\r\n});// file:src/parsing/vttC.js\r\nBoxParser.createBoxCtor(\"vttC\", \"WebVTTConfigurationBox\", function(stream) {\r\n\tthis.text = stream.readString(this.size - this.hdr_size);\r\n});\r\n\r\n// file:src/parsing/vvcC.js\r\nBoxParser.createFullBoxCtor(\"vvcC\", \"VvcConfigurationBox\", function (stream) {\r\n  var i, j;\r\n\r\n  // helper object to simplify extracting individual bits\r\n  var bitReader = {\r\n    held_bits: undefined,\r\n    num_held_bits: 0,\r\n\r\n    stream_read_1_bytes: function (strm) {\r\n      this.held_bits = strm.readUint8();\r\n      this.num_held_bits = 1 * 8;\r\n    },\r\n    stream_read_2_bytes: function (strm) {\r\n      this.held_bits = strm.readUint16();\r\n      this.num_held_bits = 2 * 8;\r\n    },\r\n\r\n    extract_bits: function (num_bits) {\r\n      var ret = (this.held_bits >> (this.num_held_bits - num_bits)) & ((1 << num_bits) - 1);\r\n      this.num_held_bits -= num_bits;\r\n      return ret;\r\n    }\r\n  };\r\n\r\n  // VvcDecoderConfigurationRecord\r\n  bitReader.stream_read_1_bytes(stream);\r\n  bitReader.extract_bits(5);  // reserved\r\n  this.lengthSizeMinusOne = bitReader.extract_bits(2);\r\n  this.ptl_present_flag = bitReader.extract_bits(1);\r\n\r\n  if (this.ptl_present_flag) {\r\n    bitReader.stream_read_2_bytes(stream);\r\n    this.ols_idx = bitReader.extract_bits(9);\r\n    this.num_sublayers = bitReader.extract_bits(3);\r\n    this.constant_frame_rate = bitReader.extract_bits(2);\r\n    this.chroma_format_idc = bitReader.extract_bits(2);\r\n\r\n    bitReader.stream_read_1_bytes(stream);\r\n    this.bit_depth_minus8 = bitReader.extract_bits(3);\r\n    bitReader.extract_bits(5);  // reserved\r\n\r\n    // VvcPTLRecord\r\n    {\r\n      bitReader.stream_read_2_bytes(stream);\r\n      bitReader.extract_bits(2);  // reserved\r\n      this.num_bytes_constraint_info = bitReader.extract_bits(6);\r\n      this.general_profile_idc = bitReader.extract_bits(7);\r\n      this.general_tier_flag = bitReader.extract_bits(1);\r\n\r\n      this.general_level_idc = stream.readUint8();\r\n\r\n      bitReader.stream_read_1_bytes(stream);\r\n      this.ptl_frame_only_constraint_flag = bitReader.extract_bits(1);\r\n      this.ptl_multilayer_enabled_flag = bitReader.extract_bits(1);\r\n\r\n      this.general_constraint_info = new Uint8Array(this.num_bytes_constraint_info);\r\n      if (this.num_bytes_constraint_info) {\r\n        for (i = 0; i < this.num_bytes_constraint_info - 1; i++) {\r\n          var cnstr1 = bitReader.extract_bits(6);\r\n          bitReader.stream_read_1_bytes(stream);\r\n          var cnstr2 = bitReader.extract_bits(2);\r\n\r\n          this.general_constraint_info[i] = ((cnstr1 << 2) | cnstr2);\r\n        }\r\n        this.general_constraint_info[this.num_bytes_constraint_info - 1] = bitReader.extract_bits(6);\r\n      } else {\r\n        //forbidden in spec!\r\n        bitReader.extract_bits(6);\r\n      }\r\n\r\n      if (this.num_sublayers > 1) {\r\n        bitReader.stream_read_1_bytes(stream);\r\n        this.ptl_sublayer_present_mask = 0;\r\n        for (j = this.num_sublayers - 2; j >= 0; --j) {\r\n          var val = bitReader.extract_bits(1);\r\n          this.ptl_sublayer_present_mask |= val << j;\r\n        }\r\n        for (j = this.num_sublayers; j <= 8 && this.num_sublayers > 1; ++j) {\r\n          bitReader.extract_bits(1);  // ptl_reserved_zero_bit\r\n        }\r\n\r\n        this.sublayer_level_idc = [];\r\n        for (j = this.num_sublayers - 2; j >= 0; --j) {\r\n          if (this.ptl_sublayer_present_mask & (1 << j)) {\r\n            this.sublayer_level_idc[j] = stream.readUint8();\r\n          }\r\n        }\r\n      }\r\n\r\n      this.ptl_num_sub_profiles = stream.readUint8();\r\n      this.general_sub_profile_idc = [];\r\n      if (this.ptl_num_sub_profiles) {\r\n        for (i = 0; i < this.ptl_num_sub_profiles; i++) {\r\n          this.general_sub_profile_idc.push(stream.readUint32());\r\n        }\r\n      }\r\n    }  // end VvcPTLRecord\r\n\r\n    this.max_picture_width = stream.readUint16();\r\n    this.max_picture_height = stream.readUint16();\r\n    this.avg_frame_rate = stream.readUint16();\r\n  }\r\n\r\n  var VVC_NALU_OPI = 12;\r\n  var VVC_NALU_DEC_PARAM = 13;\r\n\r\n  this.nalu_arrays = [];\r\n  var num_of_arrays = stream.readUint8();\r\n  for (i = 0; i < num_of_arrays; i++) {\r\n    var nalu_array = [];\r\n    this.nalu_arrays.push(nalu_array);\r\n\r\n    bitReader.stream_read_1_bytes(stream);\r\n    nalu_array.completeness = bitReader.extract_bits(1);\r\n    bitReader.extract_bits(2);  // reserved\r\n    nalu_array.nalu_type = bitReader.extract_bits(5);\r\n\r\n    var numNalus = 1;\r\n    if (nalu_array.nalu_type != VVC_NALU_DEC_PARAM && nalu_array.nalu_type != VVC_NALU_OPI) {\r\n      numNalus = stream.readUint16();\r\n    }\r\n\r\n    for (j = 0; j < numNalus; j++) {\r\n      var len = stream.readUint16();\r\n      nalu_array.push({\r\n        data: stream.readUint8Array(len),\r\n        length: len\r\n      });\r\n    }\r\n  }\r\n});\r\n// file:src/parsing/vvnC.js\r\nBoxParser.createFullBoxCtor(\"vvnC\", \"VvcNALUConfigBox\", function (stream) {\r\n  // VvcNALUConfigBox\r\n  var tmp = strm.readUint8();\r\n  this.lengthSizeMinusOne = (tmp & 0x3);\r\n});\r\n// file:src/box-codecs.js\r\nBoxParser.SampleEntry.prototype.isVideo = function() {\r\n\treturn false;\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.isAudio = function() {\r\n\treturn false;\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.isSubtitle = function() {\r\n\treturn false;\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.isMetadata = function() {\r\n\treturn false;\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.isHint = function() {\r\n\treturn false;\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.getCodec = function() {\r\n\treturn this.type.replace('.','');\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.getWidth = function() {\r\n\treturn \"\";\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.getHeight = function() {\r\n\treturn \"\";\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.getChannelCount = function() {\r\n\treturn \"\";\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.getSampleRate = function() {\r\n\treturn \"\";\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.getSampleSize = function() {\r\n\treturn \"\";\r\n}\r\n\r\nBoxParser.VisualSampleEntry.prototype.isVideo = function() {\r\n\treturn true;\r\n}\r\n\r\nBoxParser.VisualSampleEntry.prototype.getWidth = function() {\r\n\treturn this.width;\r\n}\r\n\r\nBoxParser.VisualSampleEntry.prototype.getHeight = function() {\r\n\treturn this.height;\r\n}\r\n\r\nBoxParser.AudioSampleEntry.prototype.isAudio = function() {\r\n\treturn true;\r\n}\r\n\r\nBoxParser.AudioSampleEntry.prototype.getChannelCount = function() {\r\n\treturn this.channel_count;\r\n}\r\n\r\nBoxParser.AudioSampleEntry.prototype.getSampleRate = function() {\r\n\treturn this.samplerate;\r\n}\r\n\r\nBoxParser.AudioSampleEntry.prototype.getSampleSize = function() {\r\n\treturn this.samplesize;\r\n}\r\n\r\nBoxParser.SubtitleSampleEntry.prototype.isSubtitle = function() {\r\n\treturn true;\r\n}\r\n\r\nBoxParser.MetadataSampleEntry.prototype.isMetadata = function() {\r\n\treturn true;\r\n}\r\n\r\n\r\nBoxParser.decimalToHex = function(d, padding) {\r\n\tvar hex = Number(d).toString(16);\r\n\tpadding = typeof (padding) === \"undefined\" || padding === null ? padding = 2 : padding;\r\n\twhile (hex.length < padding) {\r\n\t\thex = \"0\" + hex;\r\n\t}\r\n\treturn hex;\r\n}\r\n\r\nBoxParser.avc1SampleEntry.prototype.getCodec =\r\nBoxParser.avc2SampleEntry.prototype.getCodec =\r\nBoxParser.avc3SampleEntry.prototype.getCodec =\r\nBoxParser.avc4SampleEntry.prototype.getCodec = function() {\r\n\tvar baseCodec = BoxParser.SampleEntry.prototype.getCodec.call(this);\r\n\tif (this.avcC) {\r\n\t\treturn baseCodec+\".\"+BoxParser.decimalToHex(this.avcC.AVCProfileIndication)+\r\n\t\t\t\t\t\t  \"\"+BoxParser.decimalToHex(this.avcC.profile_compatibility)+\r\n\t\t\t\t\t\t  \"\"+BoxParser.decimalToHex(this.avcC.AVCLevelIndication);\r\n\t} else {\r\n\t\treturn baseCodec;\r\n\t}\r\n}\r\n\r\nBoxParser.hev1SampleEntry.prototype.getCodec =\r\nBoxParser.hvc1SampleEntry.prototype.getCodec = function() {\r\n\tvar i;\r\n\tvar baseCodec = BoxParser.SampleEntry.prototype.getCodec.call(this);\r\n\tif (this.hvcC) {\r\n\t\tbaseCodec += '.';\r\n\t\tswitch (this.hvcC.general_profile_space) {\r\n\t\t\tcase 0:\r\n\t\t\t\tbaseCodec += '';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tbaseCodec += 'A';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tbaseCodec += 'B';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tbaseCodec += 'C';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tbaseCodec += this.hvcC.general_profile_idc;\r\n\t\tbaseCodec += '.';\r\n\t\tvar val = this.hvcC.general_profile_compatibility;\r\n\t\tvar reversed = 0;\r\n\t\tfor (i=0; i<32; i++) {\r\n\t\t\treversed |= val & 1;\r\n\t\t\tif (i==31) break;\r\n\t\t\treversed <<= 1;\r\n\t\t\tval >>=1;\r\n\t\t}\r\n\t\tbaseCodec += BoxParser.decimalToHex(reversed, 0);\r\n\t\tbaseCodec += '.';\r\n\t\tif (this.hvcC.general_tier_flag === 0) {\r\n\t\t\tbaseCodec += 'L';\r\n\t\t} else {\r\n\t\t\tbaseCodec += 'H';\r\n\t\t}\r\n\t\tbaseCodec += this.hvcC.general_level_idc;\r\n\t\tvar hasByte = false;\r\n\t\tvar constraint_string = \"\";\r\n\t\tfor (i = 5; i >= 0; i--) {\r\n\t\t\tif (this.hvcC.general_constraint_indicator[i] || hasByte) {\r\n\t\t\t\tconstraint_string = \".\"+BoxParser.decimalToHex(this.hvcC.general_constraint_indicator[i], 0)+constraint_string;\r\n\t\t\t\thasByte = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbaseCodec += constraint_string;\r\n\t}\r\n\treturn baseCodec;\r\n}\r\n\r\nBoxParser.vvc1SampleEntry.prototype.getCodec =\r\nBoxParser.vvi1SampleEntry.prototype.getCodec = function () {\r\n\tvar i;\r\n\tvar baseCodec = BoxParser.SampleEntry.prototype.getCodec.call(this);\r\n\tif (this.vvcC) {\r\n\t\tbaseCodec += '.' + this.vvcC.general_profile_idc;\r\n\t\tif (this.vvcC.general_tier_flag) {\r\n\t\t\tbaseCodec += '.H';\r\n\t\t} else {\r\n\t\t\tbaseCodec += '.L';\r\n\t\t}\r\n\t\tbaseCodec += this.vvcC.general_level_idc;\r\n\r\n\t\tvar constraint_string = \"\";\r\n\t\tif (this.vvcC.general_constraint_info) {\r\n\t\t\tvar bytes = [];\r\n\t\t\tvar byte = 0;\r\n\t\t\tbyte |= this.vvcC.ptl_frame_only_constraint << 7;\r\n\t\t\tbyte |= this.vvcC.ptl_multilayer_enabled << 6;\r\n\t\t\tvar last_nonzero;\r\n\t\t\tfor (i = 0; i < this.vvcC.general_constraint_info.length; ++i) {\r\n\t\t\t\tbyte |= (this.vvcC.general_constraint_info[i] >> 2) & 0x3f;\r\n\t\t\t\tbytes.push(byte);\r\n\t\t\t\tif (byte) {\r\n\t\t\t\t\tlast_nonzero = i;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbyte = (this.vvcC.general_constraint_info[i] >> 2) & 0x03;\r\n\t\t\t}\r\n\r\n\t\t\tif (last_nonzero === undefined) {\r\n\t\t\t\tconstraint_string = \".CA\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconstraint_string = \".C\"\r\n\t\t\t\tvar base32_chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\";\r\n\t\t\t\tvar held_bits = 0;\r\n\t\t\t\tvar num_held_bits = 0;\r\n\t\t\t\tfor (i = 0; i <= last_nonzero; ++i) {\r\n\t\t\t\t\theld_bits = (held_bits << 8) | bytes[i];\r\n\t\t\t\t\tnum_held_bits += 8;\r\n\r\n\t\t\t\t\twhile (num_held_bits >= 5) {\r\n\t\t\t\t\t\tvar val = (held_bits >> (num_held_bits - 5)) & 0x1f;\r\n\t\t\t\t\t\tconstraint_string += base32_chars[val];\r\n\r\n\t\t\t\t\t\tnum_held_bits -= 5;\r\n\t\t\t\t\t\theld_bits &= (1 << num_held_bits) - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (num_held_bits) {\r\n\t\t\t\t\theld_bits <<= (5 - num_held_bits);  // right-pad with zeros to 5 bits (is this correct?)\r\n\t\t\t\t\tconstraint_string += base32_chars[held_bits & 0x1f];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tbaseCodec += constraint_string;\r\n\t}\r\n\treturn baseCodec;\r\n}\r\n\r\nBoxParser.mp4aSampleEntry.prototype.getCodec = function() {\r\n\tvar baseCodec = BoxParser.SampleEntry.prototype.getCodec.call(this);\r\n\tif (this.esds && this.esds.esd) {\r\n\t\tvar oti = this.esds.esd.getOTI();\r\n\t\tvar dsi = this.esds.esd.getAudioConfig();\r\n\t\treturn baseCodec+\".\"+BoxParser.decimalToHex(oti)+(dsi ? \".\"+dsi: \"\");\r\n\t} else {\r\n\t\treturn baseCodec;\r\n\t}\r\n}\r\n\r\nBoxParser.stxtSampleEntry.prototype.getCodec = function() {\r\n\tvar baseCodec = BoxParser.SampleEntry.prototype.getCodec.call(this);\r\n\tif(this.mime_format) {\r\n\t\treturn baseCodec + \".\" + this.mime_format;\r\n\t} else {\r\n\t\treturn baseCodec\r\n\t}\r\n}\r\n\r\nBoxParser.vp08SampleEntry.prototype.getCodec =\r\nBoxParser.vp09SampleEntry.prototype.getCodec = function() {\r\n\tvar baseCodec = BoxParser.SampleEntry.prototype.getCodec.call(this);\r\n\tvar level = this.vpcC.level;\r\n\tif (level == 0) {\r\n\t\tlevel = \"00\";\r\n\t}\r\n\tvar bitDepth = this.vpcC.bitDepth;\r\n\tif (bitDepth == 8) {\r\n\t\tbitDepth = \"08\";\r\n\t}\r\n\treturn baseCodec + \".0\" + this.vpcC.profile + \".\" + level + \".\" + bitDepth;\r\n}\r\n\r\nBoxParser.av01SampleEntry.prototype.getCodec = function() {\r\n\tvar baseCodec = BoxParser.SampleEntry.prototype.getCodec.call(this);\r\n\tvar level = this.av1C.seq_level_idx_0;\r\n\tif (level < 10) {\r\n\t\tlevel = \"0\" + level;\r\n\t}\r\n\tvar bitdepth;\r\n\tif (this.av1C.seq_profile === 2 && this.av1C.high_bitdepth === 1) {\r\n\t\tbitdepth = (this.av1C.twelve_bit === 1) ? \"12\" : \"10\";\r\n\t} else if ( this.av1C.seq_profile <= 2 ) {\r\n\t\tbitdepth = (this.av1C.high_bitdepth === 1) ? \"10\" : \"08\";\r\n\t}\r\n\t// TODO need to parse the SH to find color config\r\n\treturn baseCodec+\".\"+this.av1C.seq_profile+\".\"+level+(this.av1C.seq_tier_0?\"H\":\"M\")+\".\"+bitdepth;//+\".\"+this.av1C.monochrome+\".\"+this.av1C.chroma_subsampling_x+\"\"+this.av1C.chroma_subsampling_y+\"\"+this.av1C.chroma_sample_position;\r\n}\r\n// file:src/box-write.js\r\n/* \r\n * Copyright (c) Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nBoxParser.Box.prototype.writeHeader = function(stream, msg) {\r\n\tthis.size += 8;\r\n\tif (this.size > MAX_SIZE) {\r\n\t\tthis.size += 8;\r\n\t}\r\n\tif (this.type === \"uuid\") {\r\n\t\tthis.size += 16;\r\n\t}\r\n\tLog.debug(\"BoxWriter\", \"Writing box \"+this.type+\" of size: \"+this.size+\" at position \"+stream.getPosition()+(msg || \"\"));\r\n\tif (this.size > MAX_SIZE) {\r\n\t\tstream.writeUint32(1);\r\n\t} else {\r\n\t\tthis.sizePosition = stream.getPosition();\r\n\t\tstream.writeUint32(this.size);\r\n\t}\r\n\tstream.writeString(this.type, null, 4);\r\n\tif (this.type === \"uuid\") {\r\n\t\tstream.writeUint8Array(this.uuid);\r\n\t}\r\n\tif (this.size > MAX_SIZE) {\r\n\t\tstream.writeUint64(this.size);\r\n\t} \r\n}\r\n\r\nBoxParser.FullBox.prototype.writeHeader = function(stream) {\r\n\tthis.size += 4;\r\n\tBoxParser.Box.prototype.writeHeader.call(this, stream, \" v=\"+this.version+\" f=\"+this.flags);\r\n\tstream.writeUint8(this.version);\r\n\tstream.writeUint24(this.flags);\r\n}\r\n\r\nBoxParser.Box.prototype.write = function(stream) {\r\n\tif (this.type === \"mdat\") {\r\n\t\t/* TODO: fix this */\r\n\t\tif (this.data) {\r\n\t\t\tthis.size = this.data.length;\r\n\t\t\tthis.writeHeader(stream);\r\n\t\t\tstream.writeUint8Array(this.data);\r\n\t\t}\r\n\t} else {\r\n\t\tthis.size = (this.data ? this.data.length : 0);\r\n\t\tthis.writeHeader(stream);\r\n\t\tif (this.data) {\r\n\t\t\tstream.writeUint8Array(this.data);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nBoxParser.ContainerBox.prototype.write = function(stream) {\r\n\tthis.size = 0;\r\n\tthis.writeHeader(stream);\r\n\tfor (var i=0; i<this.boxes.length; i++) {\r\n\t\tif (this.boxes[i]) {\r\n\t\t\tthis.boxes[i].write(stream);\r\n\t\t\tthis.size += this.boxes[i].size;\r\n\t\t}\r\n\t}\r\n\t/* adjusting the size, now that all sub-boxes are known */\r\n\tLog.debug(\"BoxWriter\", \"Adjusting box \"+this.type+\" with new size \"+this.size);\r\n\tstream.adjustUint32(this.sizePosition, this.size);\r\n}\r\n\r\nBoxParser.TrackReferenceTypeBox.prototype.write = function(stream) {\r\n\tthis.size = this.track_ids.length*4;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32Array(this.track_ids);\r\n}\r\n\r\n// file:src/writing/avcC.js\r\nBoxParser.avcCBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tthis.size = 7;\r\n\tfor (i = 0; i < this.SPS.length; i++) {\r\n\t\tthis.size += 2+this.SPS[i].length;\r\n\t}\r\n\tfor (i = 0; i < this.PPS.length; i++) {\r\n\t\tthis.size += 2+this.PPS[i].length;\r\n\t}\r\n\tif (this.ext) {\r\n\t\tthis.size += this.ext.length;\r\n\t}\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint8(this.configurationVersion);\r\n\tstream.writeUint8(this.AVCProfileIndication);\r\n\tstream.writeUint8(this.profile_compatibility);\r\n\tstream.writeUint8(this.AVCLevelIndication);\r\n\tstream.writeUint8(this.lengthSizeMinusOne + (63<<2));\r\n\tstream.writeUint8(this.SPS.length + (7<<5));\r\n\tfor (i = 0; i < this.SPS.length; i++) {\r\n\t\tstream.writeUint16(this.SPS[i].length);\r\n\t\tstream.writeUint8Array(this.SPS[i].nalu);\r\n\t}\r\n\tstream.writeUint8(this.PPS.length);\r\n\tfor (i = 0; i < this.PPS.length; i++) {\r\n\t\tstream.writeUint16(this.PPS[i].length);\r\n\t\tstream.writeUint8Array(this.PPS[i].nalu);\r\n\t}\r\n\tif (this.ext) {\r\n\t\tstream.writeUint8Array(this.ext);\r\n\t}\r\n}\r\n\r\n// file:src/writing/co64.js\r\nBoxParser.co64Box.prototype.write = function(stream) {\r\n\tvar i;\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4+8*this.chunk_offsets.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.chunk_offsets.length);\r\n\tfor(i=0; i<this.chunk_offsets.length; i++) {\r\n\t\tstream.writeUint64(this.chunk_offsets[i]);\r\n\t}\r\n}\r\n\r\n// file:src/writing/cslg.js\r\nBoxParser.cslgBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4*5;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeInt32(this.compositionToDTSShift);\r\n\tstream.writeInt32(this.leastDecodeToDisplayDelta);\r\n\tstream.writeInt32(this.greatestDecodeToDisplayDelta);\r\n\tstream.writeInt32(this.compositionStartTime);\r\n\tstream.writeInt32(this.compositionEndTime);\r\n}\r\n\r\n// file:src/writing/ctts.js\r\nBoxParser.cttsBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4+8*this.sample_counts.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.sample_counts.length);\r\n\tfor(i=0; i<this.sample_counts.length; i++) {\r\n\t\tstream.writeUint32(this.sample_counts[i]);\r\n\t\tif (this.version === 1) {\r\n\t\t\tstream.writeInt32(this.sample_offsets[i]); /* signed */\r\n\t\t} else {\t\t\t\r\n\t\t\tstream.writeUint32(this.sample_offsets[i]); /* unsigned */\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// file:src/writing/dref.js\r\nBoxParser.drefBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4; //\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.entries.length);\r\n\tfor (var i = 0; i < this.entries.length; i++) {\r\n\t\tthis.entries[i].write(stream);\r\n\t\tthis.size += this.entries[i].size;\r\n\t}\t\r\n\t/* adjusting the size, now that all sub-boxes are known */\r\n\tLog.debug(\"BoxWriter\", \"Adjusting box \"+this.type+\" with new size \"+this.size);\r\n\tstream.adjustUint32(this.sizePosition, this.size);\r\n}\r\n\r\n// file:src/writing/elng.js\r\nBoxParser.elngBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\t\r\n\tthis.flags = 0;\r\n\tthis.size = this.extended_language.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeString(this.extended_language);\r\n}\r\n\r\n// file:src/writing/elst.js\r\nBoxParser.elstBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\t\r\n\tthis.flags = 0;\r\n\tthis.size = 4+12*this.entries.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.entries.length);\r\n\tfor (var i = 0; i < this.entries.length; i++) {\r\n\t\tvar entry = this.entries[i];\r\n\t\tstream.writeUint32(entry.segment_duration);\r\n\t\tstream.writeInt32(entry.media_time);\r\n\t\tstream.writeInt16(entry.media_rate_integer);\r\n\t\tstream.writeInt16(entry.media_rate_fraction);\r\n\t}\r\n}\r\n\r\n// file:src/writing/emsg.js\r\nBoxParser.emsgBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\t\r\n\tthis.flags = 0;\r\n\tthis.size = 4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1);\r\n\tthis.writeHeader(stream);\r\n\tstream.writeCString(this.scheme_id_uri);\r\n\tstream.writeCString(this.value);\r\n\tstream.writeUint32(this.timescale);\r\n\tstream.writeUint32(this.presentation_time_delta);\r\n\tstream.writeUint32(this.event_duration);\r\n\tstream.writeUint32(this.id);\r\n\tstream.writeUint8Array(this.message_data);\r\n}\r\n\r\n// file:src/writing/ftyp.js\r\nBoxParser.ftypBox.prototype.write = function(stream) {\r\n\tthis.size = 8+4*this.compatible_brands.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeString(this.major_brand, null, 4);\r\n\tstream.writeUint32(this.minor_version);\r\n\tfor (var i = 0; i < this.compatible_brands.length; i++) {\r\n\t\tstream.writeString(this.compatible_brands[i], null, 4);\r\n\t}\r\n}\r\n\r\n// file:src/writing/hdlr.js\r\nBoxParser.hdlrBox.prototype.write = function(stream) {\r\n\tthis.size = 5*4+this.name.length+1;\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(0);\r\n\tstream.writeString(this.handler, null, 4);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeCString(this.name);\r\n}\r\n\r\n// file:src/writing/hvcC.js\r\nBoxParser.hvcCBox.prototype.write = function(stream) {\r\n    var i,j;\r\n    this.size = 23;\r\n\r\n    for (i = 0; i < this.nalu_arrays.length; i++) {\r\n      this.size += 3;\r\n      for (j = 0; j < this.nalu_arrays[i].length; j++) {\r\n        this.size += 2 + this.nalu_arrays[i][j].data.length;\r\n      }\r\n    }\r\n\r\n    this.writeHeader(stream);\r\n\r\n    stream.writeUint8(this.configurationVersion);\r\n    stream.writeUint8((this.general_profile_space << 6) +\r\n                      (this.general_tier_flag << 5) +\r\n                      this.general_profile_idc);\r\n    stream.writeUint32(this.general_profile_compatibility);\r\n    stream.writeUint8Array(this.general_constraint_indicator);\r\n    stream.writeUint8(this.general_level_idc);\r\n    stream.writeUint16(this.min_spatial_segmentation_idc + (15<<24));\r\n    stream.writeUint8(this.parallelismType + (63<<2));\r\n    stream.writeUint8(this.chroma_format_idc + (63<<2));\r\n    stream.writeUint8(this.bit_depth_luma_minus8 + (31<<3));\r\n    stream.writeUint8(this.bit_depth_chroma_minus8 + (31<<3));\r\n    stream.writeUint16(this.avgFrameRate);\r\n    stream.writeUint8((this.constantFrameRate<<6) +\r\n                   (this.numTemporalLayers<<3) +\r\n                   (this.temporalIdNested<<2) +\r\n                   this.lengthSizeMinusOne);\r\n    stream.writeUint8(this.nalu_arrays.length);\r\n    for (i = 0; i < this.nalu_arrays.length; i++) {\r\n      // bit(1) array_completeness + bit(1) reserved = 0 + bit(6) nal_unit_type\r\n      stream.writeUint8((this.nalu_arrays[i].completeness<<7) +\r\n                         this.nalu_arrays[i].nalu_type);\r\n      stream.writeUint16(this.nalu_arrays[i].length);\r\n      for (j = 0; j < this.nalu_arrays[i].length; j++) {\r\n        stream.writeUint16(this.nalu_arrays[i][j].data.length);\r\n        stream.writeUint8Array(this.nalu_arrays[i][j].data);\r\n      }\r\n    }\r\n}\r\n// file:src/writing/kind.js\r\nBoxParser.kindBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\t\r\n\tthis.flags = 0;\r\n\tthis.size = (this.schemeURI.length+1)+(this.value.length+1);\r\n\tthis.writeHeader(stream);\r\n\tstream.writeCString(this.schemeURI);\r\n\tstream.writeCString(this.value);\r\n}\r\n\r\n// file:src/writing/mdhd.js\r\nBoxParser.mdhdBox.prototype.write = function(stream) {\r\n\tthis.size = 4*4+2*2;\r\n\tthis.flags = 0;\r\n\tthis.version = 0;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.creation_time);\r\n\tstream.writeUint32(this.modification_time);\r\n\tstream.writeUint32(this.timescale);\r\n\tstream.writeUint32(this.duration);\r\n\tstream.writeUint16(this.language);\r\n\tstream.writeUint16(0);\r\n}\r\n\r\n// file:src/writing/mehd.js\r\nBoxParser.mehdBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.fragment_duration);\r\n}\r\n\r\n// file:src/writing/mfhd.js\r\nBoxParser.mfhdBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.sequence_number);\r\n}\r\n\r\n// file:src/writing/mvhd.js\r\nBoxParser.mvhdBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 23*4+2*2;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.creation_time);\r\n\tstream.writeUint32(this.modification_time);\r\n\tstream.writeUint32(this.timescale);\r\n\tstream.writeUint32(this.duration);\r\n\tstream.writeUint32(this.rate);\r\n\tstream.writeUint16(this.volume<<8);\r\n\tstream.writeUint16(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32Array(this.matrix);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(this.next_track_id);\r\n}\r\n\r\n// file:src/writing/sampleentry.js\r\nBoxParser.SampleEntry.prototype.writeHeader = function(stream) {\r\n\tthis.size = 8;\r\n\tBoxParser.Box.prototype.writeHeader.call(this, stream);\r\n\tstream.writeUint8(0);\r\n\tstream.writeUint8(0);\r\n\tstream.writeUint8(0);\r\n\tstream.writeUint8(0);\r\n\tstream.writeUint8(0);\r\n\tstream.writeUint8(0);\r\n\tstream.writeUint16(this.data_reference_index);\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.writeFooter = function(stream) {\r\n\tfor (var i=0; i<this.boxes.length; i++) {\r\n\t\tthis.boxes[i].write(stream);\r\n\t\tthis.size += this.boxes[i].size;\r\n\t}\r\n\tLog.debug(\"BoxWriter\", \"Adjusting box \"+this.type+\" with new size \"+this.size);\r\n\tstream.adjustUint32(this.sizePosition, this.size);\t\r\n}\r\n\r\nBoxParser.SampleEntry.prototype.write = function(stream) {\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint8Array(this.data);\r\n\tthis.size += this.data.length;\r\n\tLog.debug(\"BoxWriter\", \"Adjusting box \"+this.type+\" with new size \"+this.size);\r\n\tstream.adjustUint32(this.sizePosition, this.size);\t\r\n}\r\n\r\nBoxParser.VisualSampleEntry.prototype.write = function(stream) {\r\n\tthis.writeHeader(stream);\r\n\tthis.size += 2*7+6*4+32;\r\n\tstream.writeUint16(0); \r\n\tstream.writeUint16(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint16(this.width);\r\n\tstream.writeUint16(this.height);\r\n\tstream.writeUint32(this.horizresolution);\r\n\tstream.writeUint32(this.vertresolution);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint16(this.frame_count);\r\n\tstream.writeUint8(Math.min(31, this.compressorname.length));\r\n\tstream.writeString(this.compressorname, null, 31);\r\n\tstream.writeUint16(this.depth);\r\n\tstream.writeInt16(-1);\r\n\tthis.writeFooter(stream);\r\n}\r\n\r\nBoxParser.AudioSampleEntry.prototype.write = function(stream) {\r\n\tthis.writeHeader(stream);\r\n\tthis.size += 2*4+3*4;\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint16(this.channel_count);\r\n\tstream.writeUint16(this.samplesize);\r\n\tstream.writeUint16(0);\r\n\tstream.writeUint16(0);\r\n\tstream.writeUint32(this.samplerate<<16);\r\n\tthis.writeFooter(stream);\r\n}\r\n\r\nBoxParser.stppSampleEntry.prototype.write = function(stream) {\r\n\tthis.writeHeader(stream);\r\n\tthis.size += this.namespace.length+1+\r\n\t\t\t\t this.schema_location.length+1+\r\n\t\t\t\t this.auxiliary_mime_types.length+1;\r\n\tstream.writeCString(this.namespace);\r\n\tstream.writeCString(this.schema_location);\r\n\tstream.writeCString(this.auxiliary_mime_types);\r\n\tthis.writeFooter(stream);\r\n}\r\n\r\n// file:src/writing/samplegroups/samplegroup.js\r\nBoxParser.SampleGroupEntry.prototype.write = function(stream) {\r\n\tstream.writeUint8Array(this.data);\r\n}\r\n\r\n// file:src/writing/sbgp.js\r\nBoxParser.sbgpBox.prototype.write = function(stream) {\r\n\tthis.version = 1;\t\r\n\tthis.flags = 0;\r\n\tthis.size = 12+8*this.entries.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeString(this.grouping_type, null, 4);\r\n\tstream.writeUint32(this.grouping_type_parameter);\r\n\tstream.writeUint32(this.entries.length);\r\n\tfor (var i = 0; i < this.entries.length; i++) {\r\n\t\tvar entry = this.entries[i];\r\n\t\tstream.writeInt32(entry.sample_count);\r\n\t\tstream.writeInt32(entry.group_description_index);\r\n\t}\r\n}\r\n\r\n// file:src/writing/sgpd.js\r\nBoxParser.sgpdBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tvar entry;\r\n\t// leave version as read\r\n\t// this.version;\r\n\tthis.flags = 0;\r\n\tthis.size = 12;\r\n\tfor (i = 0; i < this.entries.length; i++) {\r\n\t\tentry = this.entries[i];\r\n\t\tif (this.version === 1) {\r\n\t\t\tif (this.default_length === 0) {\r\n\t\t\t\tthis.size += 4;\r\n\t\t\t}\r\n\t\t\tthis.size += entry.data.length;\r\n\t\t}\r\n\t}\r\n\tthis.writeHeader(stream);\r\n\tstream.writeString(this.grouping_type, null, 4);\r\n\tif (this.version === 1) {\r\n\t\tstream.writeUint32(this.default_length);\r\n\t}\r\n\tif (this.version >= 2) {\r\n\t\tstream.writeUint32(this.default_sample_description_index);\r\n\t}\r\n\tstream.writeUint32(this.entries.length);\r\n\tfor (i = 0; i < this.entries.length; i++) {\r\n\t\tentry = this.entries[i];\r\n\t\tif (this.version === 1) {\r\n\t\t\tif (this.default_length === 0) {\r\n\t\t\t\tstream.writeUint32(entry.description_length);\r\n\t\t\t}\r\n\t\t}\r\n\t\tentry.write(stream);\r\n\t}\r\n}\r\n\r\n\r\n// file:src/writing/sidx.js\r\nBoxParser.sidxBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\t\r\n\tthis.flags = 0;\r\n\tthis.size = 4*4+2+2+12*this.references.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.reference_ID);\r\n\tstream.writeUint32(this.timescale);\r\n\tstream.writeUint32(this.earliest_presentation_time);\r\n\tstream.writeUint32(this.first_offset);\r\n\tstream.writeUint16(0);\r\n\tstream.writeUint16(this.references.length);\r\n\tfor (var i = 0; i < this.references.length; i++) {\r\n\t\tvar ref = this.references[i];\r\n\t\tstream.writeUint32(ref.reference_type << 31 | ref.referenced_size);\r\n\t\tstream.writeUint32(ref.subsegment_duration);\r\n\t\tstream.writeUint32(ref.starts_with_SAP << 31 | ref.SAP_type << 28 | ref.SAP_delta_time);\r\n\t}\r\n}\r\n\r\n// file:src/writing/smhd.js\r\nBoxParser.smhdBox.prototype.write = function(stream) {\r\n  var i;\r\n  this.version = 0;\r\n  this.flags = 1;\r\n  this.size = 4;\r\n  this.writeHeader(stream);\r\n  stream.writeUint16(this.balance);\r\n  stream.writeUint16(0);\r\n}\r\n// file:src/writing/stco.js\r\nBoxParser.stcoBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4+4*this.chunk_offsets.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.chunk_offsets.length);\r\n\tstream.writeUint32Array(this.chunk_offsets);\r\n}\r\n\r\n// file:src/writing/stsc.js\r\nBoxParser.stscBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4+12*this.first_chunk.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.first_chunk.length);\r\n\tfor(i=0; i<this.first_chunk.length; i++) {\r\n\t\tstream.writeUint32(this.first_chunk[i]);\r\n\t\tstream.writeUint32(this.samples_per_chunk[i]);\r\n\t\tstream.writeUint32(this.sample_description_index[i]);\r\n\t}\r\n}\r\n\r\n// file:src/writing/stsd.js\r\nBoxParser.stsdBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 0;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.entries.length);\r\n\tthis.size += 4;\r\n\tfor (i = 0; i < this.entries.length; i++) {\r\n\t\tthis.entries[i].write(stream);\r\n\t\tthis.size += this.entries[i].size;\r\n\t}\r\n\t/* adjusting the size, now that all sub-boxes are known */\r\n\tLog.debug(\"BoxWriter\", \"Adjusting box \"+this.type+\" with new size \"+this.size);\r\n\tstream.adjustUint32(this.sizePosition, this.size);\r\n}\r\n\r\n// file:src/writing/stsh.js\r\nBoxParser.stshBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4+8*this.shadowed_sample_numbers.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.shadowed_sample_numbers.length);\r\n\tfor(i=0; i<this.shadowed_sample_numbers.length; i++) {\r\n\t\tstream.writeUint32(this.shadowed_sample_numbers[i]);\r\n\t\tstream.writeUint32(this.sync_sample_numbers[i]);\r\n\t}\r\n}\r\n\r\n// file:src/writing/stss.js\r\nBoxParser.stssBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4+4*this.sample_numbers.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.sample_numbers.length);\r\n\tstream.writeUint32Array(this.sample_numbers);\r\n}\r\n\r\n// file:src/writing/stsz.js\r\nBoxParser.stszBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tvar constant = true;\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tif (this.sample_sizes.length > 0) {\r\n\t\ti = 0;\r\n\t\twhile (i+1 < this.sample_sizes.length) {\r\n\t\t\tif (this.sample_sizes[i+1] !==  this.sample_sizes[0]) {\r\n\t\t\t\tconstant = false;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tconstant = false;\r\n\t}\r\n\tthis.size = 8;\r\n\tif (!constant) {\r\n\t\tthis.size += 4*this.sample_sizes.length;\r\n\t}\r\n\tthis.writeHeader(stream);\r\n\tif (!constant) {\r\n\t\tstream.writeUint32(0);\r\n\t} else {\r\n\t\tstream.writeUint32(this.sample_sizes[0]);\r\n\t}\r\n\tstream.writeUint32(this.sample_sizes.length);\r\n\tif (!constant) {\r\n\t\tstream.writeUint32Array(this.sample_sizes);\r\n\t}\t\r\n}\r\n\r\n// file:src/writing/stts.js\r\nBoxParser.sttsBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4+8*this.sample_counts.length;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.sample_counts.length);\r\n\tfor(i=0; i<this.sample_counts.length; i++) {\r\n\t\tstream.writeUint32(this.sample_counts[i]);\r\n\t\tstream.writeUint32(this.sample_deltas[i]);\r\n\t}\r\n}\r\n\r\n// file:src/writing/tfdt.js\r\nBoxParser.tfdtBox.prototype.write = function(stream) {\r\n\tvar UINT32_MAX = Math.pow(2, 32) - 1;\r\n\t// use version 1 if baseMediaDecodeTime does not fit 32 bits\r\n\tthis.version = this.baseMediaDecodeTime > UINT32_MAX ? 1 : 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4;\r\n\tif (this.version === 1) {\r\n\t\tthis.size += 4;\r\n\t}\r\n\tthis.writeHeader(stream);\r\n\tif (this.version === 1) {\r\n\t\tstream.writeUint64(this.baseMediaDecodeTime);\r\n\t} else {\r\n\t\tstream.writeUint32(this.baseMediaDecodeTime);\r\n\t}\r\n}\r\n\r\n// file:src/writing/tfhd.js\r\nBoxParser.tfhdBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\tthis.size = 4;\r\n\tif (this.flags & BoxParser.TFHD_FLAG_BASE_DATA_OFFSET) {\r\n\t\tthis.size += 8;\r\n\t}\r\n\tif (this.flags & BoxParser.TFHD_FLAG_SAMPLE_DESC) {\r\n\t\tthis.size += 4;\r\n\t}\r\n\tif (this.flags & BoxParser.TFHD_FLAG_SAMPLE_DUR) {\r\n\t\tthis.size += 4;\r\n\t}\r\n\tif (this.flags & BoxParser.TFHD_FLAG_SAMPLE_SIZE) {\r\n\t\tthis.size += 4;\r\n\t}\r\n\tif (this.flags & BoxParser.TFHD_FLAG_SAMPLE_FLAGS) {\r\n\t\tthis.size += 4;\r\n\t}\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.track_id);\r\n\tif (this.flags & BoxParser.TFHD_FLAG_BASE_DATA_OFFSET) {\r\n\t\tstream.writeUint64(this.base_data_offset);\r\n\t}\r\n\tif (this.flags & BoxParser.TFHD_FLAG_SAMPLE_DESC) {\r\n\t\tstream.writeUint32(this.default_sample_description_index);\r\n\t}\r\n\tif (this.flags & BoxParser.TFHD_FLAG_SAMPLE_DUR) {\r\n\t\tstream.writeUint32(this.default_sample_duration);\r\n\t}\r\n\tif (this.flags & BoxParser.TFHD_FLAG_SAMPLE_SIZE) {\r\n\t\tstream.writeUint32(this.default_sample_size);\r\n\t}\r\n\tif (this.flags & BoxParser.TFHD_FLAG_SAMPLE_FLAGS) {\r\n\t\tstream.writeUint32(this.default_sample_flags);\r\n\t}\r\n}\r\n\r\n// file:src/writing/tkhd.js\r\nBoxParser.tkhdBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\t//this.flags = 0;\r\n\tthis.size = 4*18+2*4;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.creation_time);\r\n\tstream.writeUint32(this.modification_time);\r\n\tstream.writeUint32(this.track_id);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(this.duration);\r\n\tstream.writeUint32(0);\r\n\tstream.writeUint32(0);\r\n\tstream.writeInt16(this.layer);\r\n\tstream.writeInt16(this.alternate_group);\r\n\tstream.writeInt16(this.volume<<8);\r\n\tstream.writeUint16(0);\r\n\tstream.writeInt32Array(this.matrix);\r\n\tstream.writeUint32(this.width);\r\n\tstream.writeUint32(this.height);\r\n}\r\n\r\n// file:src/writing/trex.js\r\nBoxParser.trexBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\tthis.flags = 0;\r\n\tthis.size = 4*5;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.track_id);\r\n\tstream.writeUint32(this.default_sample_description_index);\r\n\tstream.writeUint32(this.default_sample_duration);\r\n\tstream.writeUint32(this.default_sample_size);\r\n\tstream.writeUint32(this.default_sample_flags);\r\n}\r\n\r\n// file:src/writing/trun.js\r\nBoxParser.trunBox.prototype.write = function(stream) {\r\n\tthis.version = 0;\r\n\tthis.size = 4;\r\n\tif (this.flags & BoxParser.TRUN_FLAGS_DATA_OFFSET) {\r\n\t\tthis.size += 4;\r\n\t}\r\n\tif (this.flags & BoxParser.TRUN_FLAGS_FIRST_FLAG) {\r\n\t\tthis.size += 4;\r\n\t}\r\n\tif (this.flags & BoxParser.TRUN_FLAGS_DURATION) {\r\n\t\tthis.size += 4*this.sample_duration.length;\r\n\t}\r\n\tif (this.flags & BoxParser.TRUN_FLAGS_SIZE) {\r\n\t\tthis.size += 4*this.sample_size.length;\r\n\t}\r\n\tif (this.flags & BoxParser.TRUN_FLAGS_FLAGS) {\r\n\t\tthis.size += 4*this.sample_flags.length;\r\n\t}\r\n\tif (this.flags & BoxParser.TRUN_FLAGS_CTS_OFFSET) {\r\n\t\tthis.size += 4*this.sample_composition_time_offset.length;\r\n\t}\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint32(this.sample_count);\r\n\tif (this.flags & BoxParser.TRUN_FLAGS_DATA_OFFSET) {\r\n\t\tthis.data_offset_position = stream.getPosition();\r\n\t\tstream.writeInt32(this.data_offset); //signed\r\n\t}\r\n\tif (this.flags & BoxParser.TRUN_FLAGS_FIRST_FLAG) {\r\n\t\tstream.writeUint32(this.first_sample_flags);\r\n\t}\r\n\tfor (var i = 0; i < this.sample_count; i++) {\r\n\t\tif (this.flags & BoxParser.TRUN_FLAGS_DURATION) {\r\n\t\t\tstream.writeUint32(this.sample_duration[i]);\r\n\t\t}\r\n\t\tif (this.flags & BoxParser.TRUN_FLAGS_SIZE) {\r\n\t\t\tstream.writeUint32(this.sample_size[i]);\r\n\t\t}\r\n\t\tif (this.flags & BoxParser.TRUN_FLAGS_FLAGS) {\r\n\t\t\tstream.writeUint32(this.sample_flags[i]);\r\n\t\t}\r\n\t\tif (this.flags & BoxParser.TRUN_FLAGS_CTS_OFFSET) {\r\n\t\t\tif (this.version === 0) {\r\n\t\t\t\tstream.writeUint32(this.sample_composition_time_offset[i]);\r\n\t\t\t} else {\r\n\t\t\t\tstream.writeInt32(this.sample_composition_time_offset[i]); //signed\r\n\t\t\t}\r\n\t\t}\r\n\t}\t\t\r\n}\r\n\r\n// file:src/writing/url.js\r\nBoxParser[\"url Box\"].prototype.write = function(stream) {\r\n\tthis.version = 0;\t\r\n\tif (this.location) {\r\n\t\tthis.flags = 0;\r\n\t\tthis.size = this.location.length+1;\r\n\t} else {\r\n\t\tthis.flags = 0x000001;\r\n\t\tthis.size = 0;\r\n\t}\r\n\tthis.writeHeader(stream);\r\n\tif (this.location) {\r\n\t\tstream.writeCString(this.location);\r\n\t}\r\n}\r\n\r\n// file:src/writing/urn.js\r\nBoxParser[\"urn Box\"].prototype.write = function(stream) {\r\n\tthis.version = 0;\t\r\n\tthis.flags = 0;\r\n\tthis.size = this.name.length+1+(this.location ? this.location.length+1 : 0);\r\n\tthis.writeHeader(stream);\r\n\tstream.writeCString(this.name);\r\n\tif (this.location) {\r\n\t\tstream.writeCString(this.location);\r\n\t}\r\n}\r\n\r\n// file:src/writing/vmhd.js\r\nBoxParser.vmhdBox.prototype.write = function(stream) {\r\n\tvar i;\r\n\tthis.version = 0;\r\n\tthis.flags = 1;\r\n\tthis.size = 8;\r\n\tthis.writeHeader(stream);\r\n\tstream.writeUint16(this.graphicsmode);\r\n\tstream.writeUint16Array(this.opcolor);\r\n}\r\n\r\n// file:src/box-unpack.js\r\n/* \r\n * Copyright (c) Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nBoxParser.cttsBox.prototype.unpack = function(samples) {\r\n\tvar i, j, k;\r\n\tk = 0;\r\n\tfor (i = 0; i < this.sample_counts.length; i++) {\r\n\t\tfor (j = 0; j < this.sample_counts[i]; j++) {\r\n\t\t\tsamples[k].pts = samples[k].dts + this.sample_offsets[i];\r\n\t\t\tk++;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nBoxParser.sttsBox.prototype.unpack = function(samples) {\r\n\tvar i, j, k;\r\n\tk = 0;\r\n\tfor (i = 0; i < this.sample_counts.length; i++) {\r\n\t\tfor (j = 0; j < this.sample_counts[i]; j++) {\r\n\t\t\tif (k === 0) {\r\n\t\t\t\tsamples[k].dts = 0;\r\n\t\t\t} else {\r\n\t\t\t\tsamples[k].dts = samples[k-1].dts + this.sample_deltas[i];\r\n\t\t\t}\r\n\t\t\tk++;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nBoxParser.stcoBox.prototype.unpack = function(samples) {\r\n\tvar i;\r\n\tfor (i = 0; i < this.chunk_offsets.length; i++) {\r\n\t\tsamples[i].offset = this.chunk_offsets[i];\r\n\t}\r\n}\r\n\r\nBoxParser.stscBox.prototype.unpack = function(samples) {\r\n\tvar i, j, k, l, m;\r\n\tl = 0;\r\n\tm = 0;\r\n\tfor (i = 0; i < this.first_chunk.length; i++) {\r\n\t\tfor (j = 0; j < (i+1 < this.first_chunk.length ? this.first_chunk[i+1] : Infinity); j++) {\r\n\t\t\tm++;\r\n\t\t\tfor (k = 0; k < this.samples_per_chunk[i]; k++) {\r\n\t\t\t\tif (samples[l]) {\r\n\t\t\t\t\tsamples[l].description_index = this.sample_description_index[i];\r\n\t\t\t\t\tsamples[l].chunk_index = m;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tl++;\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t}\r\n}\r\n\r\nBoxParser.stszBox.prototype.unpack = function(samples) {\r\n\tvar i;\r\n\tfor (i = 0; i < this.sample_sizes.length; i++) {\r\n\t\tsamples[i].size = this.sample_sizes[i];\r\n\t}\r\n}\r\n// file:src/box-diff.js\r\n\r\nBoxParser.DIFF_BOXES_PROP_NAMES = [ \"boxes\", \"entries\", \"references\", \"subsamples\",\r\n\t\t\t\t\t \t \"items\", \"item_infos\", \"extents\", \"associations\",\r\n\t\t\t\t\t \t \"subsegments\", \"ranges\", \"seekLists\", \"seekPoints\",\r\n\t\t\t\t\t \t \"esd\", \"levels\"];\r\n\r\nBoxParser.DIFF_PRIMITIVE_ARRAY_PROP_NAMES = [ \"compatible_brands\", \"matrix\", \"opcolor\", \"sample_counts\", \"sample_deltas\",\r\n\"first_chunk\", \"samples_per_chunk\", \"sample_sizes\", \"chunk_offsets\", \"sample_offsets\", \"sample_description_index\", \"sample_duration\" ];\r\n\r\nBoxParser.boxEqualFields = function(box_a, box_b) {\r\n\tif (box_a && !box_b) return false;\r\n\tvar prop;\r\n\tfor (prop in box_a) {\r\n\t\tif (BoxParser.DIFF_BOXES_PROP_NAMES.indexOf(prop) > -1) {\r\n\t\t\tcontinue;\r\n\t\t// } else if (excluded_fields && excluded_fields.indexOf(prop) > -1) {\r\n\t\t// \tcontinue;\r\n\t\t} else if (box_a[prop] instanceof BoxParser.Box || box_b[prop] instanceof BoxParser.Box) {\r\n\t\t\tcontinue;\r\n\t\t} else if (typeof box_a[prop] === \"undefined\" || typeof box_b[prop] === \"undefined\") {\r\n\t\t\tcontinue;\r\n\t\t} else if (typeof box_a[prop] === \"function\" || typeof box_b[prop] === \"function\") {\r\n\t\t\tcontinue;\r\n\t\t} else if (\r\n\t\t\t(box_a.subBoxNames && box_a.subBoxNames.indexOf(prop.slice(0,4)) > -1) ||\r\n\t\t\t(box_b.subBoxNames && box_b.subBoxNames.indexOf(prop.slice(0,4)) > -1))  {\r\n\t\t\tcontinue;\r\n\t\t} else {\r\n\t\t\tif (prop === \"data\" || prop === \"start\" || prop === \"size\" || prop === \"creation_time\" || prop === \"modification_time\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t} else if (BoxParser.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(prop) > -1) {\r\n\t\t\t\tcontinue;\r\n\t\t\t} else {\r\n\t\t\t\tif (box_a[prop] !== box_b[prop]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nBoxParser.boxEqual = function(box_a, box_b) {\r\n\tif (!BoxParser.boxEqualFields(box_a, box_b)) {\r\n\t\treturn false;\r\n\t}\r\n\tfor (var j = 0; j < BoxParser.DIFF_BOXES_PROP_NAMES.length; j++) {\r\n\t\tvar name = BoxParser.DIFF_BOXES_PROP_NAMES[j];\r\n\t\tif (box_a[name] && box_b[name]) {\r\n\t\t\tif (!BoxParser.boxEqual(box_a[name], box_b[name])) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n// file:src/text-mp4.js\r\n/* \r\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nvar VTTin4Parser = function() {\t\r\n}\r\n\r\nVTTin4Parser.prototype.parseSample = function(data) {\r\n\tvar cues, cue;\r\n\tvar stream = new MP4BoxStream(data.buffer);\r\n\tcues = [];\r\n\twhile (!stream.isEos()) {\r\n\t\tcue = BoxParser.parseOneBox(stream, false);\r\n\t\tif (cue.code === BoxParser.OK && cue.box.type === \"vttc\") {\r\n\t\t\tcues.push(cue.box);\r\n\t\t}\t\t\r\n\t}\r\n\treturn cues;\r\n}\r\n\r\nVTTin4Parser.prototype.getText = function (startTime, endTime, data) {\r\n\tfunction pad(n, width, z) {\r\n\t  z = z || '0';\r\n\t  n = n + '';\r\n\t  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\r\n\t}\r\n\tfunction secToTimestamp(insec) {\r\n\t\tvar h = Math.floor(insec/3600);\r\n\t\tvar m = Math.floor((insec - h*3600)/60);\r\n\t\tvar s = Math.floor(insec - h*3600 - m*60);\r\n\t\tvar ms = Math.floor((insec - h*3600 - m*60 - s)*1000);\r\n\t\treturn \"\"+pad(h, 2)+\":\"+pad(m,2)+\":\"+pad(s, 2)+\".\"+pad(ms, 3);\r\n\t}\r\n\tvar cues = this.parseSample(data);\r\n\tvar string = \"\";\r\n\tfor (var i = 0; i < cues.length; i++) {\r\n\t\tvar cueIn4 = cues[i];\r\n\t\tstring += secToTimestamp(startTime)+\" --> \"+secToTimestamp(endTime)+\"\\r\\n\";\r\n\t\tstring += cueIn4.payl.text;\r\n\t}\r\n\treturn string;\r\n}\r\n\r\nvar XMLSubtitlein4Parser = function() {\t\r\n}\r\n\r\nXMLSubtitlein4Parser.prototype.parseSample = function(sample) {\r\n\tvar res = {};\t\r\n\tvar i;\r\n\tres.resources = [];\r\n\tvar stream = new MP4BoxStream(sample.data.buffer);\r\n\tif (!sample.subsamples || sample.subsamples.length === 0) {\r\n\t\tres.documentString = stream.readString(sample.data.length);\r\n\t} else {\r\n\t\tres.documentString = stream.readString(sample.subsamples[0].size);\r\n\t\tif (sample.subsamples.length > 1) {\r\n\t\t\tfor (i = 1; i < sample.subsamples.length; i++) {\r\n\t\t\t\tres.resources[i] = stream.readUint8Array(sample.subsamples[i].size);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (typeof (DOMParser) !== \"undefined\") {\r\n\t\tres.document = (new DOMParser()).parseFromString(res.documentString, \"application/xml\");\r\n\t}\r\n\treturn res;\r\n}\r\n\r\nvar Textin4Parser = function() {\t\r\n}\r\n\r\nTextin4Parser.prototype.parseSample = function(sample) {\r\n\tvar textString;\r\n\tvar stream = new MP4BoxStream(sample.data.buffer);\r\n\ttextString = stream.readString(sample.data.length);\r\n\treturn textString;\r\n}\r\n\r\nTextin4Parser.prototype.parseConfig = function(data) {\r\n\tvar textString;\r\n\tvar stream = new MP4BoxStream(data.buffer);\r\n\tstream.readUint32(); // version & flags\r\n\ttextString = stream.readCString();\r\n\treturn textString;\r\n}\r\n\r\nif (typeof exports !== 'undefined') {\r\n\texports.VTTin4Parser = VTTin4Parser;\r\n\texports.XMLSubtitlein4Parser = XMLSubtitlein4Parser;\r\n\texports.Textin4Parser = Textin4Parser;\r\n}\r\n// file:src/isofile.js\r\n/*\r\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nvar ISOFile = function (stream) {\r\n\t/* MutiBufferStream object used to parse boxes */\r\n\tthis.stream = stream || new MultiBufferStream();\r\n\t/* Array of all boxes (in order) found in the file */\r\n\tthis.boxes = [];\r\n\t/* Array of all mdats */\r\n\tthis.mdats = [];\r\n\t/* Array of all moofs */\r\n\tthis.moofs = [];\r\n\t/* Boolean indicating if the file is compatible with progressive parsing (moov first) */\r\n\tthis.isProgressive = false;\r\n\t/* Boolean used to fire moov start event only once */\r\n\tthis.moovStartFound = false;\r\n\t/* Callback called when the moov parsing starts */\r\n\tthis.onMoovStart = null;\r\n\t/* Boolean keeping track of the call to onMoovStart, to avoid double calls */\r\n\tthis.moovStartSent = false;\r\n\t/* Callback called when the moov is entirely parsed */\r\n\tthis.onReady = null;\r\n\t/* Boolean keeping track of the call to onReady, to avoid double calls */\r\n\tthis.readySent = false;\r\n\t/* Callback to call when segments are ready */\r\n\tthis.onSegment = null;\r\n\t/* Callback to call when samples are ready */\r\n\tthis.onSamples = null;\r\n\t/* Callback to call when there is an error in the parsing or processing of samples */\r\n\tthis.onError = null;\r\n\t/* Boolean indicating if the moov box run-length encoded tables of sample information have been processed */\r\n\tthis.sampleListBuilt = false;\r\n\t/* Array of Track objects for which fragmentation of samples is requested */\r\n\tthis.fragmentedTracks = [];\r\n\t/* Array of Track objects for which extraction of samples is requested */\r\n\tthis.extractedTracks = [];\r\n\t/* Boolean indicating that fragmention is ready */\r\n\tthis.isFragmentationInitialized = false;\r\n\t/* Boolean indicating that fragmented has started */\r\n\tthis.sampleProcessingStarted = false;\r\n\t/* Number of the next 'moof' to generate when fragmenting */\r\n\tthis.nextMoofNumber = 0;\r\n\t/* Boolean indicating if the initial list of items has been produced */\r\n\tthis.itemListBuilt = false;\r\n\t/* Array of items */\r\n\tthis.items = [];\r\n\t/* Array of entity groups */\r\n\tthis.entity_groups = [];\r\n\t/* Callback called when the sidx box is entirely parsed */\r\n\tthis.onSidx = null;\r\n\t/* Boolean keeping track of the call to onSidx, to avoid double calls */\r\n\tthis.sidxSent = false;\r\n}\r\n\r\nISOFile.prototype.setSegmentOptions = function(id, user, options) {\r\n\tvar trak = this.getTrackById(id);\r\n\tif (trak) {\r\n\t\tvar fragTrack = {};\r\n\t\tthis.fragmentedTracks.push(fragTrack);\r\n\t\tfragTrack.id = id;\r\n\t\tfragTrack.user = user;\r\n\t\tfragTrack.trak = trak;\r\n\t\ttrak.nextSample = 0;\r\n\t\tfragTrack.segmentStream = null;\r\n\t\tfragTrack.nb_samples = 1000;\r\n\t\tfragTrack.rapAlignement = true;\r\n\t\tif (options) {\r\n\t\t\tif (options.nbSamples) fragTrack.nb_samples = options.nbSamples;\r\n\t\t\tif (options.rapAlignement) fragTrack.rapAlignement = options.rapAlignement;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nISOFile.prototype.unsetSegmentOptions = function(id) {\r\n\tvar index = -1;\r\n\tfor (var i = 0; i < this.fragmentedTracks.length; i++) {\r\n\t\tvar fragTrack = this.fragmentedTracks[i];\r\n\t\tif (fragTrack.id == id) {\r\n\t\t\tindex = i;\r\n\t\t}\r\n\t}\r\n\tif (index > -1) {\r\n\t\tthis.fragmentedTracks.splice(index, 1);\r\n\t}\r\n}\r\n\r\nISOFile.prototype.setExtractionOptions = function(id, user, options) {\r\n\tvar trak = this.getTrackById(id);\r\n\tif (trak) {\r\n\t\tvar extractTrack = {};\r\n\t\tthis.extractedTracks.push(extractTrack);\r\n\t\textractTrack.id = id;\r\n\t\textractTrack.user = user;\r\n\t\textractTrack.trak = trak;\r\n\t\ttrak.nextSample = 0;\r\n\t\textractTrack.nb_samples = 1000;\r\n\t\textractTrack.samples = [];\r\n\t\tif (options) {\r\n\t\t\tif (options.nbSamples) extractTrack.nb_samples = options.nbSamples;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nISOFile.prototype.unsetExtractionOptions = function(id) {\r\n\tvar index = -1;\r\n\tfor (var i = 0; i < this.extractedTracks.length; i++) {\r\n\t\tvar extractTrack = this.extractedTracks[i];\r\n\t\tif (extractTrack.id == id) {\r\n\t\t\tindex = i;\r\n\t\t}\r\n\t}\r\n\tif (index > -1) {\r\n\t\tthis.extractedTracks.splice(index, 1);\r\n\t}\r\n}\r\n\r\nISOFile.prototype.parse = function() {\r\n\tvar found;\r\n\tvar ret;\r\n\tvar box;\r\n\tvar parseBoxHeadersOnly = false;\r\n\r\n\tif (this.restoreParsePosition)\t{\r\n\t\tif (!this.restoreParsePosition()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\twhile (true) {\r\n\r\n\t\tif (this.hasIncompleteMdat && this.hasIncompleteMdat()) {\r\n\t\t\tif (this.processIncompleteMdat()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.saveParsePosition)\t{\r\n\t\t\t\tthis.saveParsePosition();\r\n\t\t\t}\r\n\t\t\tret = BoxParser.parseOneBox(this.stream, parseBoxHeadersOnly);\r\n\t\t\tif (ret.code === BoxParser.ERR_NOT_ENOUGH_DATA) {\r\n\t\t\t\tif (this.processIncompleteBox) {\r\n\t\t\t\t\tif (this.processIncompleteBox(ret)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar box_type;\r\n\t\t\t\t/* the box is entirely parsed */\r\n\t\t\t\tbox = ret.box;\r\n\t\t\t\tbox_type = (box.type !== \"uuid\" ? box.type : box.uuid);\r\n\t\t\t\t/* store the box in the 'boxes' array to preserve box order (for file rewrite if needed)  */\r\n\t\t\t\tthis.boxes.push(box);\r\n\t\t\t\t/* but also store box in a property for more direct access */\r\n\t\t\t\tswitch (box_type) {\r\n\t\t\t\t\tcase \"mdat\":\r\n\t\t\t\t\t\tthis.mdats.push(box);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"moof\":\r\n\t\t\t\t\t\tthis.moofs.push(box);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"moov\":\r\n\t\t\t\t\t\tthis.moovStartFound = true;\r\n\t\t\t\t\t\tif (this.mdats.length === 0) {\r\n\t\t\t\t\t\t\tthis.isProgressive = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t/* no break */\r\n\t\t\t\t\t\t/* falls through */\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif (this[box_type] !== undefined) {\r\n\t\t\t\t\t\t\tLog.warn(\"ISOFile\", \"Duplicate Box of type: \"+box_type+\", overriding previous occurrence\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis[box_type] = box;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.updateUsedBytes) {\r\n\t\t\t\t\tthis.updateUsedBytes(box, ret);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nISOFile.prototype.checkBuffer = function (ab) {\r\n\tif (ab === null || ab === undefined) {\r\n\t\tthrow(\"Buffer must be defined and non empty\");\r\n\t}\r\n\tif (ab.fileStart === undefined) {\r\n\t\tthrow(\"Buffer must have a fileStart property\");\r\n\t}\r\n\tif (ab.byteLength === 0) {\r\n\t\tLog.warn(\"ISOFile\", \"Ignoring empty buffer (fileStart: \"+ab.fileStart+\")\");\r\n\t\tthis.stream.logBufferLevel();\r\n\t\treturn false;\r\n\t}\r\n\tLog.info(\"ISOFile\", \"Processing buffer (fileStart: \"+ab.fileStart+\")\");\r\n\r\n\t/* mark the bytes in the buffer as not being used yet */\r\n\tab.usedBytes = 0;\r\n\tthis.stream.insertBuffer(ab);\r\n\tthis.stream.logBufferLevel();\r\n\r\n\tif (!this.stream.initialized()) {\r\n\t\tLog.warn(\"ISOFile\", \"Not ready to start parsing\");\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\n/* Processes a new ArrayBuffer (with a fileStart property)\r\n   Returns the next expected file position, or undefined if not ready to parse */\r\nISOFile.prototype.appendBuffer = function(ab, last) {\r\n\tvar nextFileStart;\r\n\tif (!this.checkBuffer(ab)) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t/* Parse whatever is in the existing buffers */\r\n\tthis.parse();\r\n\r\n\t/* Check if the moovStart callback needs to be called */\r\n\tif (this.moovStartFound && !this.moovStartSent) {\r\n\t\tthis.moovStartSent = true;\r\n\t\tif (this.onMoovStart) this.onMoovStart();\r\n\t}\r\n\r\n\tif (this.moov) {\r\n\t\t/* A moov box has been entirely parsed */\r\n\r\n\t\t/* if this is the first call after the moov is found we initialize the list of samples (may be empty in fragmented files) */\r\n\t\tif (!this.sampleListBuilt) {\r\n\t\t\tthis.buildSampleLists();\r\n\t\t\tthis.sampleListBuilt = true;\r\n\t\t}\r\n\r\n\t\t/* We update the sample information if there are any new moof boxes */\r\n\t\tthis.updateSampleLists();\r\n\r\n\t\t/* If the application needs to be informed that the 'moov' has been found,\r\n\t\t   we create the information object and callback the application */\r\n\t\tif (this.onReady && !this.readySent) {\r\n\t\t\tthis.readySent = true;\r\n\t\t\tthis.onReady(this.getInfo());\r\n\t\t}\r\n\r\n\t\t/* See if any sample extraction or segment creation needs to be done with the available samples */\r\n\t\tthis.processSamples(last);\r\n\r\n\t\t/* Inform about the best range to fetch next */\r\n\t\tif (this.nextSeekPosition) {\r\n\t\t\tnextFileStart = this.nextSeekPosition;\r\n\t\t\tthis.nextSeekPosition = undefined;\r\n\t\t} else {\r\n\t\t\tnextFileStart = this.nextParsePosition;\r\n\t\t}\r\n\t\tif (this.stream.getEndFilePositionAfter) {\r\n\t\t\tnextFileStart = this.stream.getEndFilePositionAfter(nextFileStart);\r\n\t\t}\r\n\t} else {\r\n\t\tif (this.nextParsePosition) {\r\n\t\t\t/* moov has not been parsed but the first buffer was received,\r\n\t\t\t   the next fetch should probably be the next box start */\r\n\t\t\tnextFileStart = this.nextParsePosition;\r\n\t\t} else {\r\n\t\t\t/* No valid buffer has been parsed yet, we cannot know what to parse next */\r\n\t\t\tnextFileStart = 0;\r\n\t\t}\r\n\t}\r\n\tif (this.sidx) {\r\n\t\tif (this.onSidx && !this.sidxSent) {\r\n\t\t\tthis.onSidx(this.sidx);\r\n\t\t\tthis.sidxSent = true;\r\n\t\t}\r\n\t}\r\n\tif (this.meta) {\r\n\t\tif (this.flattenItemInfo && !this.itemListBuilt) {\r\n\t\t\tthis.flattenItemInfo();\r\n\t\t\tthis.itemListBuilt = true;\r\n\t\t}\r\n\t\tif (this.processItems) {\r\n\t\t\tthis.processItems(this.onItem);\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.stream.cleanBuffers) {\r\n\t\tLog.info(\"ISOFile\", \"Done processing buffer (fileStart: \"+ab.fileStart+\") - next buffer to fetch should have a fileStart position of \"+nextFileStart);\r\n\t\tthis.stream.logBufferLevel();\r\n\t\tthis.stream.cleanBuffers();\r\n\t\tthis.stream.logBufferLevel(true);\r\n\t\tLog.info(\"ISOFile\", \"Sample data size in memory: \"+this.getAllocatedSampleDataSize());\r\n\t}\r\n\treturn nextFileStart;\r\n}\r\n\r\nISOFile.prototype.getInfo = function() {\r\n\tvar i, j;\r\n\tvar movie = {};\r\n\tvar trak;\r\n\tvar track;\r\n\tvar ref;\r\n\tvar sample_desc;\r\n\tvar _1904 = (new Date('1904-01-01T00:00:00Z').getTime());\r\n\r\n\tif (this.moov) {\r\n\t\tmovie.hasMoov = true;\r\n\t\tmovie.duration = this.moov.mvhd.duration;\r\n\t\tmovie.timescale = this.moov.mvhd.timescale;\r\n\t\tmovie.isFragmented = (this.moov.mvex != null);\r\n\t\tif (movie.isFragmented && this.moov.mvex.mehd) {\r\n\t\t\tmovie.fragment_duration = this.moov.mvex.mehd.fragment_duration;\r\n\t\t}\r\n\t\tmovie.isProgressive = this.isProgressive;\r\n\t\tmovie.hasIOD = (this.moov.iods != null);\r\n\t\tmovie.brands = [];\r\n\t\tmovie.brands.push(this.ftyp.major_brand);\r\n\t\tmovie.brands = movie.brands.concat(this.ftyp.compatible_brands);\r\n\t\tmovie.created = new Date(_1904+this.moov.mvhd.creation_time*1000);\r\n\t\tmovie.modified = new Date(_1904+this.moov.mvhd.modification_time*1000);\r\n\t\tmovie.tracks = [];\r\n\t\tmovie.audioTracks = [];\r\n\t\tmovie.videoTracks = [];\r\n\t\tmovie.subtitleTracks = [];\r\n\t\tmovie.metadataTracks = [];\r\n\t\tmovie.hintTracks = [];\r\n\t\tmovie.otherTracks = [];\r\n\t\tfor (i = 0; i < this.moov.traks.length; i++) {\r\n\t\t\ttrak = this.moov.traks[i];\r\n\t\t\tsample_desc = trak.mdia.minf.stbl.stsd.entries[0];\r\n\t\t\ttrack = {};\r\n\t\t\tmovie.tracks.push(track);\r\n\t\t\ttrack.id = trak.tkhd.track_id;\r\n\t\t\ttrack.name = trak.mdia.hdlr.name;\r\n\t\t\ttrack.references = [];\r\n\t\t\tif (trak.tref) {\r\n\t\t\t\tfor (j = 0; j < trak.tref.boxes.length; j++) {\r\n\t\t\t\t\tref = {};\r\n\t\t\t\t\ttrack.references.push(ref);\r\n\t\t\t\t\tref.type = trak.tref.boxes[j].type;\r\n\t\t\t\t\tref.track_ids = trak.tref.boxes[j].track_ids;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (trak.edts) {\r\n\t\t\t\ttrack.edits = trak.edts.elst.entries;\r\n\t\t\t}\r\n\t\t\ttrack.created = new Date(_1904+trak.tkhd.creation_time*1000);\r\n\t\t\ttrack.modified = new Date(_1904+trak.tkhd.modification_time*1000);\r\n\t\t\ttrack.movie_duration = trak.tkhd.duration;\r\n\t\t\ttrack.movie_timescale = movie.timescale;\r\n\t\t\ttrack.layer = trak.tkhd.layer;\r\n\t\t\ttrack.alternate_group = trak.tkhd.alternate_group;\r\n\t\t\ttrack.volume = trak.tkhd.volume;\r\n\t\t\ttrack.matrix = trak.tkhd.matrix;\r\n\t\t\ttrack.track_width = trak.tkhd.width/(1<<16);\r\n\t\t\ttrack.track_height = trak.tkhd.height/(1<<16);\r\n\t\t\ttrack.timescale = trak.mdia.mdhd.timescale;\r\n\t\t\ttrack.cts_shift = trak.mdia.minf.stbl.cslg;\r\n\t\t\ttrack.duration = trak.mdia.mdhd.duration;\r\n\t\t\ttrack.samples_duration = trak.samples_duration;\r\n\t\t\ttrack.codec = sample_desc.getCodec();\r\n\t\t\ttrack.kind = (trak.udta && trak.udta.kinds.length ? trak.udta.kinds[0] : { schemeURI: \"\", value: \"\"});\r\n\t\t\ttrack.language = (trak.mdia.elng ? trak.mdia.elng.extended_language : trak.mdia.mdhd.languageString);\r\n\t\t\ttrack.nb_samples = trak.samples.length;\r\n\t\t\ttrack.size = trak.samples_size;\r\n\t\t\ttrack.bitrate = (track.size*8*track.timescale)/track.samples_duration;\r\n\t\t\tif (sample_desc.isAudio()) {\r\n\t\t\t\ttrack.type = \"audio\";\r\n\t\t\t\tmovie.audioTracks.push(track);\r\n\t\t\t\ttrack.audio = {};\r\n\t\t\t\ttrack.audio.sample_rate = sample_desc.getSampleRate();\r\n\t\t\t\ttrack.audio.channel_count = sample_desc.getChannelCount();\r\n\t\t\t\ttrack.audio.sample_size = sample_desc.getSampleSize();\r\n\t\t\t} else if (sample_desc.isVideo()) {\r\n\t\t\t\ttrack.type = \"video\";\r\n\t\t\t\tmovie.videoTracks.push(track);\r\n\t\t\t\ttrack.video = {};\r\n\t\t\t\ttrack.video.width = sample_desc.getWidth();\r\n\t\t\t\ttrack.video.height = sample_desc.getHeight();\r\n\t\t\t} else if (sample_desc.isSubtitle()) {\r\n\t\t\t\ttrack.type = \"subtitles\";\r\n\t\t\t\tmovie.subtitleTracks.push(track);\r\n\t\t\t} else if (sample_desc.isHint()) {\r\n\t\t\t\ttrack.type = \"metadata\";\r\n\t\t\t\tmovie.hintTracks.push(track);\r\n\t\t\t} else if (sample_desc.isMetadata()) {\r\n\t\t\t\ttrack.type = \"metadata\";\r\n\t\t\t\tmovie.metadataTracks.push(track);\r\n\t\t\t} else {\r\n\t\t\t\ttrack.type = \"metadata\";\r\n\t\t\t\tmovie.otherTracks.push(track);\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tmovie.hasMoov = false;\r\n\t}\r\n\tmovie.mime = \"\";\r\n\tif (movie.hasMoov && movie.tracks) {\r\n\t\tif (movie.videoTracks && movie.videoTracks.length > 0) {\r\n\t\t\tmovie.mime += 'video/mp4; codecs=\\\"';\r\n\t\t} else if (movie.audioTracks && movie.audioTracks.length > 0) {\r\n\t\t\tmovie.mime += 'audio/mp4; codecs=\\\"';\r\n\t\t} else {\r\n\t\t\tmovie.mime += 'application/mp4; codecs=\\\"';\r\n\t\t}\r\n\t\tfor (i = 0; i < movie.tracks.length; i++) {\r\n\t\t\tif (i !== 0) movie.mime += ',';\r\n\t\t\tmovie.mime+= movie.tracks[i].codec;\r\n\t\t}\r\n\t\tmovie.mime += '\\\"; profiles=\\\"';\r\n\t\tmovie.mime += this.ftyp.compatible_brands.join();\r\n\t\tmovie.mime += '\\\"';\r\n\t}\r\n\treturn movie;\r\n}\r\n\r\nISOFile.prototype.setNextSeekPositionFromSample = function (sample) {\r\n\tif (!sample) {\r\n\t\treturn;\r\n\t}\r\n\tif (this.nextSeekPosition) {\r\n\t\tthis.nextSeekPosition = Math.min(sample.offset+sample.alreadyRead,this.nextSeekPosition);\r\n\t} else {\r\n\t\tthis.nextSeekPosition = sample.offset+sample.alreadyRead;\r\n\t}\r\n}\r\n\r\nISOFile.prototype.processSamples = function(last) {\r\n\tvar i;\r\n\tvar trak;\r\n\tif (!this.sampleProcessingStarted) return;\r\n\r\n\t/* For each track marked for fragmentation,\r\n\t   check if the next sample is there (i.e. if the sample information is known (i.e. moof has arrived) and if it has been downloaded)\r\n\t   and create a fragment with it */\r\n\tif (this.isFragmentationInitialized && this.onSegment !== null) {\r\n\t\tfor (i = 0; i < this.fragmentedTracks.length; i++) {\r\n\t\t\tvar fragTrak = this.fragmentedTracks[i];\r\n\t\t\ttrak = fragTrak.trak;\r\n\t\t\twhile (trak.nextSample < trak.samples.length && this.sampleProcessingStarted) {\r\n\t\t\t\t/* The sample information is there (either because the file is not fragmented and this is not the last sample,\r\n\t\t\t\tor because the file is fragmented and the moof for that sample has been received */\r\n\t\t\t\tLog.debug(\"ISOFile\", \"Creating media fragment on track #\"+fragTrak.id +\" for sample \"+trak.nextSample);\r\n\t\t\t\tvar result = this.createFragment(fragTrak.id, trak.nextSample, fragTrak.segmentStream);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tfragTrak.segmentStream = result;\r\n\t\t\t\t\ttrak.nextSample++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t/* The fragment could not be created because the media data is not there (not downloaded), wait for it */\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t/* A fragment is created by sample, but the segment is the accumulation in the buffer of these fragments.\r\n\t\t\t\t   It is flushed only as requested by the application (nb_samples) to avoid too many callbacks */\r\n\t\t\t\tif (trak.nextSample % fragTrak.nb_samples === 0 || (last || trak.nextSample >= trak.samples.length)) {\r\n\t\t\t\t\tLog.info(\"ISOFile\", \"Sending fragmented data on track #\"+fragTrak.id+\" for samples [\"+Math.max(0,trak.nextSample-fragTrak.nb_samples)+\",\"+(trak.nextSample-1)+\"]\");\r\n\t\t\t\t\tLog.info(\"ISOFile\", \"Sample data size in memory: \"+this.getAllocatedSampleDataSize());\r\n\t\t\t\t\tif (this.onSegment) {\r\n\t\t\t\t\t\tthis.onSegment(fragTrak.id, fragTrak.user, fragTrak.segmentStream.buffer, trak.nextSample, (last || trak.nextSample >= trak.samples.length));\r\n\t\t\t\t\t}\r\n\t\t\t\t\t/* force the creation of a new buffer */\r\n\t\t\t\t\tfragTrak.segmentStream = null;\r\n\t\t\t\t\tif (fragTrak !== this.fragmentedTracks[i]) {\r\n\t\t\t\t\t\t/* make sure we can stop fragmentation if needed */\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.onSamples !== null) {\r\n\t\t/* For each track marked for data export,\r\n\t\t   check if the next sample is there (i.e. has been downloaded) and send it */\r\n\t\tfor (i = 0; i < this.extractedTracks.length; i++) {\r\n\t\t\tvar extractTrak = this.extractedTracks[i];\r\n\t\t\ttrak = extractTrak.trak;\r\n\t\t\twhile (trak.nextSample < trak.samples.length && this.sampleProcessingStarted) {\r\n\t\t\t\tLog.debug(\"ISOFile\", \"Exporting on track #\"+extractTrak.id +\" sample #\"+trak.nextSample);\r\n\t\t\t\tvar sample = this.getSample(trak, trak.nextSample);\r\n\t\t\t\tif (sample) {\r\n\t\t\t\t\ttrak.nextSample++;\r\n\t\t\t\t\textractTrak.samples.push(sample);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setNextSeekPositionFromSample(trak.samples[trak.nextSample]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (trak.nextSample % extractTrak.nb_samples === 0 || trak.nextSample >= trak.samples.length) {\r\n\t\t\t\t\tLog.debug(\"ISOFile\", \"Sending samples on track #\"+extractTrak.id+\" for sample \"+trak.nextSample);\r\n\t\t\t\t\tif (this.onSamples) {\r\n\t\t\t\t\t\tthis.onSamples(extractTrak.id, extractTrak.user, extractTrak.samples);\r\n\t\t\t\t\t}\r\n\t\t\t\t\textractTrak.samples = [];\r\n\t\t\t\t\tif (extractTrak !== this.extractedTracks[i]) {\r\n\t\t\t\t\t\t/* check if the extraction needs to be stopped */\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/* Find and return specific boxes using recursion and early return */\r\nISOFile.prototype.getBox = function(type) {\r\n  var result = this.getBoxes(type, true);\r\n  return (result.length ? result[0] : null);\r\n}\r\n\r\nISOFile.prototype.getBoxes = function(type, returnEarly) {\r\n  var result = [];\r\n  ISOFile._sweep.call(this, type, result, returnEarly);\r\n  return result;\r\n}\r\n\r\nISOFile._sweep = function(type, result, returnEarly) {\r\n  if (this.type && this.type == type) result.push(this);\r\n  for (var box in this.boxes) {\r\n    if (result.length && returnEarly) return;\r\n    ISOFile._sweep.call(this.boxes[box], type, result, returnEarly);\r\n  }\r\n}\r\n\r\nISOFile.prototype.getTrackSamplesInfo = function(track_id) {\r\n\tvar track = this.getTrackById(track_id);\r\n\tif (track) {\r\n\t\treturn track.samples;\r\n\t} else {\r\n\t\treturn;\r\n\t}\r\n}\r\n\r\nISOFile.prototype.getTrackSample = function(track_id, number) {\r\n\tvar track = this.getTrackById(track_id);\r\n\tvar sample = this.getSample(track, number);\r\n\treturn sample;\r\n}\r\n\r\n/* Called by the application to release the resources associated to samples already forwarded to the application */\r\nISOFile.prototype.releaseUsedSamples = function (id, sampleNum) {\r\n\tvar size = 0;\r\n\tvar trak = this.getTrackById(id);\r\n\tif (!trak.lastValidSample) trak.lastValidSample = 0;\r\n\tfor (var i = trak.lastValidSample; i < sampleNum; i++) {\r\n\t\tsize+=this.releaseSample(trak, i);\r\n\t}\r\n\tLog.info(\"ISOFile\", \"Track #\"+id+\" released samples up to \"+sampleNum+\" (released size: \"+size+\", remaining: \"+this.samplesDataSize+\")\");\r\n\ttrak.lastValidSample = sampleNum;\r\n}\r\n\r\nISOFile.prototype.start = function() {\r\n\tthis.sampleProcessingStarted = true;\r\n\tthis.processSamples(false);\r\n}\r\n\r\nISOFile.prototype.stop = function() {\r\n\tthis.sampleProcessingStarted = false;\r\n}\r\n\r\n/* Called by the application to flush the remaining samples (e.g. once the download is finished or when no more samples will be added) */\r\nISOFile.prototype.flush = function() {\r\n\tLog.info(\"ISOFile\", \"Flushing remaining samples\");\r\n\tthis.updateSampleLists();\r\n\tthis.processSamples(true);\r\n\tthis.stream.cleanBuffers();\r\n\tthis.stream.logBufferLevel(true);\r\n}\r\n\r\n/* Finds the byte offset for a given time on a given track\r\n   also returns the time of the previous rap */\r\nISOFile.prototype.seekTrack = function(time, useRap, trak) {\r\n\tvar j;\r\n\tvar sample;\r\n\tvar seek_offset = Infinity;\r\n\tvar rap_seek_sample_num = 0;\r\n\tvar seek_sample_num = 0;\r\n\tvar timescale;\r\n\r\n\tif (trak.samples.length === 0) {\r\n\t\tLog.info(\"ISOFile\", \"No sample in track, cannot seek! Using time \"+Log.getDurationString(0, 1) +\" and offset: \"+0);\r\n\t\treturn { offset: 0, time: 0 };\r\n\t}\r\n\r\n\tfor (j = 0; j < trak.samples.length; j++) {\r\n\t\tsample = trak.samples[j];\r\n\t\tif (j === 0) {\r\n\t\t\tseek_sample_num = 0;\r\n\t\t\ttimescale = sample.timescale;\r\n\t\t} else if (sample.cts > time * sample.timescale) {\r\n\t\t\tseek_sample_num = j-1;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (useRap && sample.is_sync) {\r\n\t\t\trap_seek_sample_num = j;\r\n\t\t}\r\n\t}\r\n\tif (useRap) {\r\n\t\tseek_sample_num = rap_seek_sample_num;\r\n\t}\r\n\ttime = trak.samples[seek_sample_num].cts;\r\n\ttrak.nextSample = seek_sample_num;\r\n\twhile (trak.samples[seek_sample_num].alreadyRead === trak.samples[seek_sample_num].size) {\r\n\t\t// No remaining samples to look for, all are downloaded.\r\n\t\tif (!trak.samples[seek_sample_num + 1]) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tseek_sample_num++;\r\n\t}\r\n\tseek_offset = trak.samples[seek_sample_num].offset+trak.samples[seek_sample_num].alreadyRead;\r\n\tLog.info(\"ISOFile\", \"Seeking to \"+(useRap ? \"RAP\": \"\")+\" sample #\"+trak.nextSample+\" on track \"+trak.tkhd.track_id+\", time \"+Log.getDurationString(time, timescale) +\" and offset: \"+seek_offset);\r\n\treturn { offset: seek_offset, time: time/timescale };\r\n}\r\n\r\nISOFile.prototype.getTrackDuration = function (trak) {\r\n\tvar sample;\r\n\r\n\tif (!trak.samples) {\r\n\t\treturn Infinity;\r\n\t}\r\n\tsample = trak.samples[trak.samples.length - 1];\r\n\treturn (sample.cts + sample.duration) / sample.timescale;\r\n}\r\n\r\n/* Finds the byte offset in the file corresponding to the given time or to the time of the previous RAP */\r\nISOFile.prototype.seek = function(time, useRap) {\r\n\tvar moov = this.moov;\r\n\tvar trak;\r\n\tvar trak_seek_info;\r\n\tvar i;\r\n\tvar seek_info = { offset: Infinity, time: Infinity };\r\n\tif (!this.moov) {\r\n\t\tthrow \"Cannot seek: moov not received!\";\r\n\t} else {\r\n\t\tfor (i = 0; i<moov.traks.length; i++) {\r\n\t\t\ttrak = moov.traks[i];\r\n\t\t\tif (time > this.getTrackDuration(trak)) { // skip tracks that already ended\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\ttrak_seek_info = this.seekTrack(time, useRap, trak);\r\n\t\t\tif (trak_seek_info.offset < seek_info.offset) {\r\n\t\t\t\tseek_info.offset = trak_seek_info.offset;\r\n\t\t\t}\r\n\t\t\tif (trak_seek_info.time < seek_info.time) {\r\n\t\t\t\tseek_info.time = trak_seek_info.time;\r\n\t\t\t}\r\n\t\t}\r\n\t\tLog.info(\"ISOFile\", \"Seeking at time \"+Log.getDurationString(seek_info.time, 1)+\" needs a buffer with a fileStart position of \"+seek_info.offset);\r\n\t\tif (seek_info.offset === Infinity) {\r\n\t\t\t/* No sample info, in all tracks, cannot seek */\r\n\t\t\tseek_info = { offset: this.nextParsePosition, time: 0 };\r\n\t\t} else {\r\n\t\t\t/* check if the seek position is already in some buffer and\r\n\t\t\t in that case return the end of that buffer (or of the last contiguous buffer) */\r\n\t\t\t/* TODO: Should wait until append operations are done */\r\n\t\t\tseek_info.offset = this.stream.getEndFilePositionAfter(seek_info.offset);\r\n\t\t}\r\n\t\tLog.info(\"ISOFile\", \"Adjusted seek position (after checking data already in buffer): \"+seek_info.offset);\r\n\t\treturn seek_info;\r\n\t}\r\n}\r\n\r\nISOFile.prototype.equal = function(b) {\r\n\tvar box_index = 0;\r\n\twhile (box_index < this.boxes.length && box_index < b.boxes.length) {\r\n\t\tvar a_box = this.boxes[box_index];\r\n\t\tvar b_box = b.boxes[box_index];\r\n\t\tif (!BoxParser.boxEqual(a_box, b_box)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tbox_index++;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nif (typeof exports !== 'undefined') {\r\n\texports.ISOFile = ISOFile;\r\n}\r\n// file:src/isofile-advanced-parsing.js\r\n/* position in the current buffer of the beginning of the last box parsed */\r\nISOFile.prototype.lastBoxStartPosition = 0;\r\n/* indicator if the parsing is stuck in the middle of an mdat box */\r\nISOFile.prototype.parsingMdat = null;\r\n/* next file position that the parser needs:\r\n    - 0 until the first buffer (i.e. fileStart ===0) has been received \r\n    - otherwise, the next box start until the moov box has been parsed\r\n    - otherwise, the position of the next sample to fetch\r\n */\r\nISOFile.prototype.nextParsePosition = 0;\r\n/* keep mdat data */\r\nISOFile.prototype.discardMdatData = false;\r\n\r\nISOFile.prototype.processIncompleteBox = function(ret) {\r\n\tvar box;\r\n\tvar merged;\r\n\tvar found;\r\n\t\r\n\t/* we did not have enough bytes in the current buffer to parse the entire box */\r\n\tif (ret.type === \"mdat\") { \r\n\t\t/* we had enough bytes to get its type and size and it's an 'mdat' */\r\n\t\t\r\n\t\t/* special handling for mdat boxes, since we don't actually need to parse it linearly \r\n\t\t   we create the box */\r\n\t\tbox = new BoxParser[ret.type+\"Box\"](ret.size);\t\r\n\t\tthis.parsingMdat = box;\r\n\t\tthis.boxes.push(box);\r\n\t\tthis.mdats.push(box);\t\t\t\r\n\t\tbox.start = ret.start;\r\n\t\tbox.hdr_size = ret.hdr_size;\r\n\t\tthis.stream.addUsedBytes(box.hdr_size);\r\n\r\n\t\t/* indicate that the parsing should start from the end of the box */\r\n\t\tthis.lastBoxStartPosition = box.start + box.size;\r\n \t\t/* let's see if we have the end of the box in the other buffers */\r\n\t\tfound = this.stream.seek(box.start + box.size, false, this.discardMdatData);\r\n\t\tif (found) {\r\n\t\t\t/* found the end of the box */\r\n\t\t\tthis.parsingMdat = null;\r\n\t\t\t/* let's see if we can parse more in this buffer */\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\t/* 'mdat' end not found in the existing buffers */\r\n\t\t\t/* determine the next position in the file to start parsing from */\r\n\t\t\tif (!this.moovStartFound) {\r\n\t\t\t\t/* moov not find yet, \r\n\t\t\t\t   the file probably has 'mdat' at the beginning, and 'moov' at the end, \r\n\t\t\t\t   indicate that the downloader should not try to download those bytes now */\r\n\t\t\t\tthis.nextParsePosition = box.start + box.size;\r\n\t\t\t} else {\r\n\t\t\t\t/* we have the start of the moov box, \r\n\t\t\t\t   the next bytes should try to complete the current 'mdat' */\r\n\t\t\t\tthis.nextParsePosition = this.stream.findEndContiguousBuf();\r\n\t\t\t}\r\n\t\t\t/* not much we can do, wait for more buffers to arrive */\r\n\t\t\treturn false;\r\n\t\t}\r\n\t} else {\r\n\t\t/* box is incomplete, we may not even know its type */\r\n\t\tif (ret.type === \"moov\") { \r\n\t\t\t/* the incomplete box is a 'moov' box */\r\n\t\t\tthis.moovStartFound = true;\r\n\t\t\tif (this.mdats.length === 0) {\r\n\t\t\t\tthis.isProgressive = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t/* either it's not an mdat box (and we need to parse it, we cannot skip it)\r\n\t\t   (TODO: we could skip 'free' boxes ...)\r\n\t\t\t   or we did not have enough data to parse the type and size of the box, \r\n\t\t   we try to concatenate the current buffer with the next buffer to restart parsing */\r\n\t\tmerged = (this.stream.mergeNextBuffer ? this.stream.mergeNextBuffer() : false);\r\n\t\tif (merged) {\r\n\t\t\t/* The next buffer was contiguous, the merging succeeded,\r\n\t\t\t   we can now continue parsing, \r\n\t\t\t   the next best position to parse is at the end of this new buffer */\r\n\t\t\tthis.nextParsePosition = this.stream.getEndPosition();\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\t/* we cannot concatenate existing buffers because they are not contiguous or because there is no additional buffer */\r\n\t\t\t/* The next best position to parse is still at the end of this old buffer */\r\n\t\t\tif (!ret.type) {\r\n\t\t\t\t/* There were not enough bytes in the buffer to parse the box type and length,\r\n\t\t\t\t   the next fetch should retrieve those missing bytes, i.e. the next bytes after this buffer */\r\n\t\t\t\tthis.nextParsePosition = this.stream.getEndPosition();\r\n\t\t\t} else {\r\n\t\t\t\t/* we had enough bytes to parse size and type of the incomplete box\r\n\t\t\t\t   if we haven't found yet the moov box, skip this one and try the next one \r\n\t\t\t\t   if we have found the moov box, let's continue linear parsing */\r\n\t\t\t\tif (this.moovStartFound) {\r\n\t\t\t\t\tthis.nextParsePosition = this.stream.getEndPosition();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.nextParsePosition = this.stream.getPosition() + ret.size;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nISOFile.prototype.hasIncompleteMdat = function () {\r\n\treturn (this.parsingMdat !== null);\r\n}\r\n\r\nISOFile.prototype.processIncompleteMdat = function () {\r\n\tvar box;\r\n\tvar found;\r\n\t\r\n\t/* we are in the parsing of an incomplete mdat box */\r\n\tbox = this.parsingMdat;\r\n\r\n\tfound = this.stream.seek(box.start + box.size, false, this.discardMdatData);\r\n\tif (found) {\r\n\t\tLog.debug(\"ISOFile\", \"Found 'mdat' end in buffered data\");\r\n\t\t/* the end of the mdat has been found */ \r\n\t\tthis.parsingMdat = null;\r\n\t\t/* we can parse more in this buffer */\r\n\t\treturn true;\r\n\t} else {\r\n\t\t/* we don't have the end of this mdat yet, \r\n\t\t   indicate that the next byte to fetch is the end of the buffers we have so far, \r\n\t\t   return and wait for more buffer to come */\r\n\t\tthis.nextParsePosition = this.stream.findEndContiguousBuf();\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nISOFile.prototype.restoreParsePosition = function() {\r\n\t/* Reposition at the start position of the previous box not entirely parsed */\r\n\treturn this.stream.seek(this.lastBoxStartPosition, true, this.discardMdatData);\r\n}\r\n\r\nISOFile.prototype.saveParsePosition = function() {\r\n\t/* remember the position of the box start in case we need to roll back (if the box is incomplete) */\r\n\tthis.lastBoxStartPosition = this.stream.getPosition();\t\r\n}\r\n\r\nISOFile.prototype.updateUsedBytes = function(box, ret) {\r\n\tif (this.stream.addUsedBytes) {\r\n\t\tif (box.type === \"mdat\") {\r\n\t\t\t/* for an mdat box, only its header is considered used, other bytes will be used when sample data is requested */\r\n\t\t\tthis.stream.addUsedBytes(box.hdr_size);\r\n\t\t\tif (this.discardMdatData) {\r\n\t\t\t\tthis.stream.addUsedBytes(box.size-box.hdr_size);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t/* for all other boxes, the entire box data is considered used */\r\n\t\t\tthis.stream.addUsedBytes(box.size);\r\n\t\t}\t\r\n\t}\r\n}\r\n// file:src/isofile-advanced-creation.js\r\nISOFile.prototype.add = BoxParser.Box.prototype.add;\r\nISOFile.prototype.addBox = BoxParser.Box.prototype.addBox;\r\n\r\nISOFile.prototype.init = function (_options) {\r\n\tvar options = _options || {}; \r\n\tvar ftyp = this.add(\"ftyp\").set(\"major_brand\", (options.brands && options.brands[0]) || \"iso4\")\r\n\t\t\t\t\t\t\t   .set(\"minor_version\", 0)\r\n\t\t\t\t\t\t\t   .set(\"compatible_brands\", options.brands || [\"iso4\"]);\r\n\tvar moov = this.add(\"moov\");\r\n\tmoov.add(\"mvhd\").set(\"timescale\", options.timescale || 600)\r\n\t\t\t\t\t.set(\"rate\", options.rate || 1<<16)\r\n\t\t\t\t\t.set(\"creation_time\", 0)\r\n\t\t\t\t\t.set(\"modification_time\", 0)\r\n\t\t\t\t\t.set(\"duration\", options.duration || 0)\r\n\t\t\t\t\t.set(\"volume\", (options.width) ? 0 : 0x0100)\r\n\t\t\t\t\t.set(\"matrix\", [ 1<<16, 0, 0, 0, 1<<16, 0, 0, 0, 0x40000000])\r\n\t\t\t\t\t.set(\"next_track_id\", 1);\r\n\tmoov.add(\"mvex\");\r\n\treturn this;\r\n}\r\n\r\nISOFile.prototype.addTrack = function (_options) {\r\n\tif (!this.moov) {\r\n\t\tthis.init(_options);\r\n\t}\r\n\r\n\tvar options = _options || {}; \r\n\toptions.width = options.width || 320;\r\n\toptions.height = options.height || 320;\r\n\toptions.id = options.id || this.moov.mvhd.next_track_id;\r\n\toptions.type = options.type || \"avc1\";\r\n\r\n\tvar trak = this.moov.add(\"trak\");\r\n\tthis.moov.mvhd.next_track_id = options.id+1;\r\n\ttrak.add(\"tkhd\").set(\"flags\",BoxParser.TKHD_FLAG_ENABLED | \r\n\t\t\t\t\t\t\t\t BoxParser.TKHD_FLAG_IN_MOVIE | \r\n\t\t\t\t\t\t\t\t BoxParser.TKHD_FLAG_IN_PREVIEW)\r\n\t\t\t\t\t.set(\"creation_time\",0)\r\n\t\t\t\t\t.set(\"modification_time\", 0)\r\n\t\t\t\t\t.set(\"track_id\", options.id)\r\n\t\t\t\t\t.set(\"duration\", options.duration || 0)\r\n\t\t\t\t\t.set(\"layer\", options.layer || 0)\r\n\t\t\t\t\t.set(\"alternate_group\", 0)\r\n\t\t\t\t\t.set(\"volume\", 1)\r\n\t\t\t\t\t.set(\"matrix\", [ 1<<16, 0, 0, 0, 1<<16, 0, 0, 0, 0x40000000 ])\r\n\t\t\t\t\t.set(\"width\", options.width << 16)\r\n\t\t\t\t\t.set(\"height\", options.height << 16);\r\n\r\n\tvar mdia = trak.add(\"mdia\");\r\n\tmdia.add(\"mdhd\").set(\"creation_time\", 0)\r\n\t\t\t\t\t.set(\"modification_time\", 0)\r\n\t\t\t\t\t.set(\"timescale\", options.timescale || 1)\r\n\t\t\t\t\t.set(\"duration\", options.media_duration || 0)\r\n\t\t\t\t\t.set(\"language\", options.language || \"und\");\r\n\r\n\tmdia.add(\"hdlr\").set(\"handler\", options.hdlr || \"vide\")\r\n\t\t\t\t\t.set(\"name\", options.name || \"Track created with MP4Box.js\");\r\n\r\n\tmdia.add(\"elng\").set(\"extended_language\", options.language || \"fr-FR\");\r\n\r\n\tvar minf = mdia.add(\"minf\");\r\n\tif (BoxParser[options.type+\"SampleEntry\"] === undefined) return;\r\n\tvar sample_description_entry = new BoxParser[options.type+\"SampleEntry\"]();\r\n\tsample_description_entry.data_reference_index = 1;\r\n\tvar media_type = \"\";\r\n\tfor (var mediaType in BoxParser.sampleEntryCodes) {\r\n\t\tvar codes = BoxParser.sampleEntryCodes[mediaType];\r\n\t\tfor (var i = 0; i < codes.length; i++) {\r\n\t\t\tif (codes.indexOf(options.type) > -1) {\r\n\t\t\t\tmedia_type = mediaType;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tswitch(media_type) {\r\n\t\tcase \"Visual\":\r\n\t\t\tminf.add(\"vmhd\").set(\"graphicsmode\",0).set(\"opcolor\", [ 0, 0, 0 ]);\r\n\t\t\tsample_description_entry.set(\"width\", options.width)\r\n\t\t\t\t\t\t.set(\"height\", options.height)\r\n\t\t\t\t\t\t.set(\"horizresolution\", 0x48<<16)\r\n\t\t\t\t\t\t.set(\"vertresolution\", 0x48<<16)\r\n\t\t\t\t\t\t.set(\"frame_count\", 1)\r\n\t\t\t\t\t\t.set(\"compressorname\", options.type+\" Compressor\")\r\n\t\t\t\t\t\t.set(\"depth\", 0x18);\r\n\t\t\tif (options.avcDecoderConfigRecord) {\r\n\t\t\t\tvar avcC = new BoxParser.avcCBox();\r\n\t\t\t\tavcC.parse(new MP4BoxStream(options.avcDecoderConfigRecord));\r\n\t\t\t\tsample_description_entry.addBox(avcC);\r\n\t\t\t} else if (options.hevcDecoderConfigRecord) {\r\n\t\t\t\tvar hvcC = new BoxParser.hvcCBox();\r\n\t\t\t\thvcC.parse(new MP4BoxStream(options.hevcDecoderConfigRecord));\r\n\t\t\t\tsample_description_entry.addBox(hvcC);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"Audio\":\r\n\t\t\tminf.add(\"smhd\").set(\"balance\", options.balance || 0);\r\n\t\t\tsample_description_entry.set(\"channel_count\", options.channel_count || 2)\r\n\t\t\t\t\t\t.set(\"samplesize\", options.samplesize || 16)\r\n\t\t\t\t\t\t.set(\"samplerate\", options.samplerate || 1<<16);\r\n\t\t\tbreak;\r\n\t\tcase \"Hint\":\r\n\t\t\tminf.add(\"hmhd\"); // TODO: add properties\r\n\t\t\tbreak;\r\n\t\tcase \"Subtitle\":\r\n\t\t\tminf.add(\"sthd\");\r\n\t\t\tswitch (options.type) {\r\n\t\t\t\tcase \"stpp\":\r\n\t\t\t\t\tsample_description_entry.set(\"namespace\", options.namespace || \"nonamespace\")\r\n\t\t\t\t\t\t\t\t.set(\"schema_location\", options.schema_location || \"\")\r\n\t\t\t\t\t\t\t\t.set(\"auxiliary_mime_types\", options.auxiliary_mime_types || \"\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"Metadata\":\r\n\t\t\tminf.add(\"nmhd\");\r\n\t\t\tbreak;\r\n\t\tcase \"System\":\r\n\t\t\tminf.add(\"nmhd\");\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tminf.add(\"nmhd\");\r\n\t\t\tbreak;\r\n\t}\r\n\tif (options.description) {\r\n\t\tsample_description_entry.addBox(options.description);\r\n\t}\r\n\tif (options.description_boxes) {\r\n\t\toptions.description_boxes.forEach(function (b) {\r\n\t\t\tsample_description_entry.addBox(b);\r\n\t\t});\r\n\t}\r\n\tminf.add(\"dinf\").add(\"dref\").addEntry((new BoxParser[\"url Box\"]()).set(\"flags\", 0x1));\r\n\tvar stbl = minf.add(\"stbl\");\r\n\tstbl.add(\"stsd\").addEntry(sample_description_entry);\r\n\tstbl.add(\"stts\").set(\"sample_counts\", [])\r\n\t\t\t\t\t.set(\"sample_deltas\", []);\r\n\tstbl.add(\"stsc\").set(\"first_chunk\", [])\r\n\t\t\t\t\t.set(\"samples_per_chunk\", [])\r\n\t\t\t\t\t.set(\"sample_description_index\", []);\r\n\tstbl.add(\"stco\").set(\"chunk_offsets\", []);\r\n\tstbl.add(\"stsz\").set(\"sample_sizes\", []);\r\n\r\n\tthis.moov.mvex.add(\"trex\").set(\"track_id\", options.id)\r\n\t\t\t\t\t\t\t  .set(\"default_sample_description_index\", options.default_sample_description_index || 1)\r\n\t\t\t\t\t\t\t  .set(\"default_sample_duration\", options.default_sample_duration || 0)\r\n\t\t\t\t\t\t\t  .set(\"default_sample_size\", options.default_sample_size || 0)\r\n\t\t\t\t\t\t\t  .set(\"default_sample_flags\", options.default_sample_flags || 0);\r\n\tthis.buildTrakSampleLists(trak);\r\n\treturn options.id;\r\n}\r\n\r\nBoxParser.Box.prototype.computeSize = function(stream_) {\r\n\tvar stream = stream_ || new DataStream();\r\n\tstream.endianness = DataStream.BIG_ENDIAN;\r\n\tthis.write(stream);\r\n}\r\n\r\nISOFile.prototype.addSample = function (track_id, data, _options) {\r\n\tvar options = _options || {};\r\n\tvar sample = {};\r\n\tvar trak = this.getTrackById(track_id);\r\n\tif (trak === null) return;\r\n    sample.number = trak.samples.length;\r\n\tsample.track_id = trak.tkhd.track_id;\r\n\tsample.timescale = trak.mdia.mdhd.timescale;\r\n\tsample.description_index = (options.sample_description_index ? options.sample_description_index - 1: 0);\r\n\tsample.description = trak.mdia.minf.stbl.stsd.entries[sample.description_index];\r\n\tsample.data = data;\r\n\tsample.size = data.byteLength;\r\n\tsample.alreadyRead = sample.size;\r\n\tsample.duration = options.duration || 1;\r\n\tsample.cts = options.cts || 0;\r\n\tsample.dts = options.dts || 0;\r\n\tsample.is_sync = options.is_sync || false;\r\n\tsample.is_leading = options.is_leading || 0;\r\n\tsample.depends_on = options.depends_on || 0;\r\n\tsample.is_depended_on = options.is_depended_on || 0;\r\n\tsample.has_redundancy = options.has_redundancy || 0;\r\n\tsample.degradation_priority = options.degradation_priority || 0;\r\n\tsample.offset = 0;\r\n\tsample.subsamples = options.subsamples;\r\n\ttrak.samples.push(sample);\r\n\ttrak.samples_size += sample.size;\r\n\ttrak.samples_duration += sample.duration;\r\n\tif (trak.first_dts === undefined) {\r\n\t\ttrak.first_dts = options.dts;\r\n\t}\r\n\r\n\tthis.processSamples();\r\n\t\r\n\tvar moof = this.createSingleSampleMoof(sample);\r\n\tthis.addBox(moof);\r\n\tmoof.computeSize();\r\n\t/* adjusting the data_offset now that the moof size is known*/\r\n\tmoof.trafs[0].truns[0].data_offset = moof.size+8; //8 is mdat header\r\n\tthis.add(\"mdat\").data = new Uint8Array(data);\r\n\treturn sample;\r\n}\r\n\r\nISOFile.prototype.createSingleSampleMoof = function(sample) {\r\n\tvar sample_flags = 0;\r\n\tif (sample.is_sync)\r\n\t\tsample_flags = (1 << 25);  // sample_depends_on_none (I picture)\r\n\telse\r\n\t\tsample_flags = (1 << 16);  // non-sync\r\n\r\n\tvar moof = new BoxParser.moofBox();\r\n\tmoof.add(\"mfhd\").set(\"sequence_number\", this.nextMoofNumber);\r\n\tthis.nextMoofNumber++;\r\n\tvar traf = moof.add(\"traf\");\r\n\tvar trak = this.getTrackById(sample.track_id);\r\n\ttraf.add(\"tfhd\").set(\"track_id\", sample.track_id)\r\n\t\t\t\t\t.set(\"flags\", BoxParser.TFHD_FLAG_DEFAULT_BASE_IS_MOOF);\r\n\ttraf.add(\"tfdt\").set(\"baseMediaDecodeTime\", (sample.dts - (trak.first_dts || 0)));\r\n\ttraf.add(\"trun\").set(\"flags\", BoxParser.TRUN_FLAGS_DATA_OFFSET | BoxParser.TRUN_FLAGS_DURATION | \r\n\t\t\t\t \t\t\t\t  BoxParser.TRUN_FLAGS_SIZE | BoxParser.TRUN_FLAGS_FLAGS | \r\n\t\t\t\t \t\t\t\t  BoxParser.TRUN_FLAGS_CTS_OFFSET)\r\n\t\t\t\t\t.set(\"data_offset\",0)\r\n\t\t\t\t\t.set(\"first_sample_flags\",0)\r\n\t\t\t\t\t.set(\"sample_count\",1)\r\n\t\t\t\t\t.set(\"sample_duration\",[sample.duration])\r\n\t\t\t\t\t.set(\"sample_size\",[sample.size])\r\n\t\t\t\t\t.set(\"sample_flags\",[sample_flags])\r\n\t\t\t\t\t.set(\"sample_composition_time_offset\", [sample.cts - sample.dts]);\r\n\treturn moof;\r\n}\r\n\r\n// file:src/isofile-sample-processing.js\r\n/* Index of the last moof box received */\r\nISOFile.prototype.lastMoofIndex = 0;\r\n\r\n/* size of the buffers allocated for samples */\r\nISOFile.prototype.samplesDataSize = 0;\r\n\r\n/* Resets all sample tables */\r\nISOFile.prototype.resetTables = function () {\r\n\tvar i;\r\n\tvar trak, stco, stsc, stsz, stts, ctts, stss;\r\n\tthis.initial_duration = this.moov.mvhd.duration;\r\n\tthis.moov.mvhd.duration = 0;\r\n\tfor (i = 0; i < this.moov.traks.length; i++) {\r\n\t\ttrak = this.moov.traks[i];\r\n\t\ttrak.tkhd.duration = 0;\r\n\t\ttrak.mdia.mdhd.duration = 0;\r\n\t\tstco = trak.mdia.minf.stbl.stco || trak.mdia.minf.stbl.co64;\r\n\t\tstco.chunk_offsets = [];\r\n\t\tstsc = trak.mdia.minf.stbl.stsc;\r\n\t\tstsc.first_chunk = [];\r\n\t\tstsc.samples_per_chunk = [];\r\n\t\tstsc.sample_description_index = [];\r\n\t\tstsz = trak.mdia.minf.stbl.stsz || trak.mdia.minf.stbl.stz2;\r\n\t\tstsz.sample_sizes = [];\r\n\t\tstts = trak.mdia.minf.stbl.stts;\r\n\t\tstts.sample_counts = [];\r\n\t\tstts.sample_deltas = [];\r\n\t\tctts = trak.mdia.minf.stbl.ctts;\r\n\t\tif (ctts) {\r\n\t\t\tctts.sample_counts = [];\r\n\t\t\tctts.sample_offsets = [];\r\n\t\t}\r\n\t\tstss = trak.mdia.minf.stbl.stss;\r\n\t\tvar k = trak.mdia.minf.stbl.boxes.indexOf(stss);\r\n\t\tif (k != -1) trak.mdia.minf.stbl.boxes[k] = null;\r\n\t}\r\n}\r\n\r\nISOFile.initSampleGroups = function(trak, traf, sbgps, trak_sgpds, traf_sgpds) {\r\n\tvar l;\r\n\tvar k;\r\n\tvar sample_groups_info;\r\n\tvar sample_group_info;\r\n\tvar sample_group_key;\r\n\tfunction SampleGroupInfo(_type, _parameter, _sbgp) {\r\n\t\tthis.grouping_type = _type;\r\n\t\tthis.grouping_type_parameter = _parameter;\r\n\t\tthis.sbgp = _sbgp;\r\n\t\tthis.last_sample_in_run = -1;\r\n\t\tthis.entry_index = -1;\t\t\r\n\t}\r\n\tif (traf) {\r\n\t\ttraf.sample_groups_info = [];\r\n\t} \r\n\tif (!trak.sample_groups_info) {\r\n\t\ttrak.sample_groups_info = [];\r\n\t}\r\n\tfor (k = 0; k < sbgps.length; k++) {\r\n\t\tsample_group_key = sbgps[k].grouping_type +\"/\"+ sbgps[k].grouping_type_parameter;\r\n\t\tsample_group_info = new SampleGroupInfo(sbgps[k].grouping_type, sbgps[k].grouping_type_parameter, sbgps[k]);\r\n\t\tif (traf) {\r\n\t\t\ttraf.sample_groups_info[sample_group_key] = sample_group_info;\r\n\t\t}\r\n\t\tif (!trak.sample_groups_info[sample_group_key]) {\r\n\t\t\ttrak.sample_groups_info[sample_group_key] = sample_group_info;\r\n\t\t}\r\n\t\tfor (l=0; l <trak_sgpds.length; l++) {\r\n\t\t\tif (trak_sgpds[l].grouping_type === sbgps[k].grouping_type) {\r\n\t\t\t\tsample_group_info.description = trak_sgpds[l];\r\n\t\t\t\tsample_group_info.description.used = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (traf_sgpds) {\r\n\t\t\tfor (l=0; l <traf_sgpds.length; l++) {\r\n\t\t\t\tif (traf_sgpds[l].grouping_type === sbgps[k].grouping_type) {\r\n\t\t\t\t\tsample_group_info.fragment_description = traf_sgpds[l];\r\n\t\t\t\t\tsample_group_info.fragment_description.used = true;\r\n\t\t\t\t\tsample_group_info.is_fragment = true;\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t}\r\n\tif (!traf) {\r\n\t\tfor (k = 0; k < trak_sgpds.length; k++) {\r\n\t\t\tif (!trak_sgpds[k].used && trak_sgpds[k].version >= 2) {\r\n\t\t\t\tsample_group_key = trak_sgpds[k].grouping_type +\"/0\";\r\n\t\t\t\tsample_group_info = new SampleGroupInfo(trak_sgpds[k].grouping_type, 0);\r\n\t\t\t\tif (!trak.sample_groups_info[sample_group_key]) {\r\n\t\t\t\t\ttrak.sample_groups_info[sample_group_key] = sample_group_info;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tif (traf_sgpds) {\r\n\t\t\tfor (k = 0; k < traf_sgpds.length; k++) {\r\n\t\t\t\tif (!traf_sgpds[k].used && traf_sgpds[k].version >= 2) {\r\n\t\t\t\t\tsample_group_key = traf_sgpds[k].grouping_type +\"/0\";\r\n\t\t\t\t\tsample_group_info = new SampleGroupInfo(traf_sgpds[k].grouping_type, 0);\r\n\t\t\t\t\tsample_group_info.is_fragment = true;\r\n\t\t\t\t\tif (!traf.sample_groups_info[sample_group_key]) {\r\n\t\t\t\t\t\ttraf.sample_groups_info[sample_group_key] = sample_group_info;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nISOFile.setSampleGroupProperties = function(trak, sample, sample_number, sample_groups_info) {\r\n\tvar k;\r\n\tvar index;\r\n\tsample.sample_groups = [];\r\n\tfor (k in sample_groups_info) {\r\n\t\tsample.sample_groups[k] = {};\r\n\t\tsample.sample_groups[k].grouping_type = sample_groups_info[k].grouping_type;\r\n\t\tsample.sample_groups[k].grouping_type_parameter = sample_groups_info[k].grouping_type_parameter;\r\n\t\tif (sample_number >= sample_groups_info[k].last_sample_in_run) {\r\n\t\t\tif (sample_groups_info[k].last_sample_in_run < 0) {\r\n\t\t\t\tsample_groups_info[k].last_sample_in_run = 0;\r\n\t\t\t}\r\n\t\t\tsample_groups_info[k].entry_index++;\t\r\n\t\t\tif (sample_groups_info[k].entry_index <= sample_groups_info[k].sbgp.entries.length - 1) {\r\n\t\t\t\tsample_groups_info[k].last_sample_in_run += sample_groups_info[k].sbgp.entries[sample_groups_info[k].entry_index].sample_count;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sample_groups_info[k].entry_index <= sample_groups_info[k].sbgp.entries.length - 1) {\r\n\t\t\tsample.sample_groups[k].group_description_index = sample_groups_info[k].sbgp.entries[sample_groups_info[k].entry_index].group_description_index;\r\n\t\t} else {\r\n\t\t\tsample.sample_groups[k].group_description_index = -1; // special value for not defined\r\n\t\t}\r\n\t\tif (sample.sample_groups[k].group_description_index !== 0) {\r\n\t\t\tvar description;\r\n\t\t\tif (sample_groups_info[k].fragment_description) {\r\n\t\t\t\tdescription = sample_groups_info[k].fragment_description;\r\n\t\t\t} else {\r\n\t\t\t\tdescription = sample_groups_info[k].description;\r\n\t\t\t}\r\n\t\t\tif (sample.sample_groups[k].group_description_index > 0) {\r\n\t\t\t\tif (sample.sample_groups[k].group_description_index > 65535) {\r\n\t\t\t\t\tindex = (sample.sample_groups[k].group_description_index >> 16)-1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tindex = sample.sample_groups[k].group_description_index-1;\r\n\t\t\t\t}\r\n\t\t\t\tif (description && index >= 0) {\r\n\t\t\t\t\tsample.sample_groups[k].description = description.entries[index];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (description && description.version >= 2) {\r\n\t\t\t\t\tif (description.default_group_description_index > 0) {\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tsample.sample_groups[k].description = description.entries[description.default_group_description_index-1];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nISOFile.process_sdtp = function (sdtp, sample, number) {\r\n\tif (!sample) {\r\n\t\treturn;\r\n\t}\r\n\tif (sdtp) {\r\n\t\tsample.is_leading = sdtp.is_leading[number];\r\n\t\tsample.depends_on = sdtp.sample_depends_on[number];\r\n\t\tsample.is_depended_on = sdtp.sample_is_depended_on[number];\r\n\t\tsample.has_redundancy = sdtp.sample_has_redundancy[number];\r\n\t} else {\r\n\t\tsample.is_leading = 0;\r\n\t\tsample.depends_on = 0;\r\n\t\tsample.is_depended_on = 0\r\n\t\tsample.has_redundancy = 0;\r\n\t}\t\r\n}\r\n\r\n/* Build initial sample list from  sample tables */\r\nISOFile.prototype.buildSampleLists = function() {\t\r\n\tvar i;\r\n\tvar trak;\r\n\tfor (i = 0; i < this.moov.traks.length; i++) {\r\n\t\ttrak = this.moov.traks[i];\r\n\t\tthis.buildTrakSampleLists(trak);\r\n\t}\r\n}\r\n\r\nISOFile.prototype.buildTrakSampleLists = function(trak) {\t\r\n\tvar j, k;\r\n\tvar stco, stsc, stsz, stts, ctts, stss, stsd, subs, sbgps, sgpds, stdp;\r\n\tvar chunk_run_index, chunk_index, last_chunk_in_run, offset_in_chunk, last_sample_in_chunk;\r\n\tvar last_sample_in_stts_run, stts_run_index, last_sample_in_ctts_run, ctts_run_index, last_stss_index, last_subs_index, subs_entry_index, last_subs_sample_index;\r\n\r\n\ttrak.samples = [];\r\n\ttrak.samples_duration = 0;\r\n\ttrak.samples_size = 0;\r\n\tstco = trak.mdia.minf.stbl.stco || trak.mdia.minf.stbl.co64;\r\n\tstsc = trak.mdia.minf.stbl.stsc;\r\n\tstsz = trak.mdia.minf.stbl.stsz || trak.mdia.minf.stbl.stz2;\r\n\tstts = trak.mdia.minf.stbl.stts;\r\n\tctts = trak.mdia.minf.stbl.ctts;\r\n\tstss = trak.mdia.minf.stbl.stss;\r\n\tstsd = trak.mdia.minf.stbl.stsd;\r\n\tsubs = trak.mdia.minf.stbl.subs;\r\n\tstdp = trak.mdia.minf.stbl.stdp;\r\n\tsbgps = trak.mdia.minf.stbl.sbgps;\r\n\tsgpds = trak.mdia.minf.stbl.sgpds;\r\n\t\r\n\tlast_sample_in_stts_run = -1;\r\n\tstts_run_index = -1;\r\n\tlast_sample_in_ctts_run = -1;\r\n\tctts_run_index = -1;\r\n\tlast_stss_index = 0;\r\n\tsubs_entry_index = 0;\r\n\tlast_subs_sample_index = 0;\t\t\r\n\r\n\tISOFile.initSampleGroups(trak, null, sbgps, sgpds);\r\n\r\n\tif (typeof stsz === \"undefined\") {\r\n\t\treturn;\r\n\t}\r\n\r\n\t/* we build the samples one by one and compute their properties */\r\n\tfor (j = 0; j < stsz.sample_sizes.length; j++) {\r\n\t\tvar sample = {};\r\n\t\tsample.number = j;\r\n\t\tsample.track_id = trak.tkhd.track_id;\r\n\t\tsample.timescale = trak.mdia.mdhd.timescale;\r\n\t\tsample.alreadyRead = 0;\r\n\t\ttrak.samples[j] = sample;\r\n\t\t/* size can be known directly */\r\n\t\tsample.size = stsz.sample_sizes[j];\r\n\t\ttrak.samples_size += sample.size;\r\n\t\t/* computing chunk-based properties (offset, sample description index)*/\r\n\t\tif (j === 0) {\t\t\t\t\r\n\t\t\tchunk_index = 1; /* the first sample is in the first chunk (chunk indexes are 1-based) */\r\n\t\t\tchunk_run_index = 0; /* the first chunk is the first entry in the first_chunk table */\r\n\t\t\tsample.chunk_index = chunk_index;\r\n\t\t\tsample.chunk_run_index = chunk_run_index;\r\n\t\t\tlast_sample_in_chunk = stsc.samples_per_chunk[chunk_run_index];\r\n\t\t\toffset_in_chunk = 0;\r\n\r\n\t\t\t/* Is there another entry in the first_chunk table ? */\r\n\t\t\tif (chunk_run_index + 1 < stsc.first_chunk.length) {\r\n\t\t\t\t/* The last chunk in the run is the chunk before the next first chunk */\r\n\t\t\t\tlast_chunk_in_run = stsc.first_chunk[chunk_run_index+1]-1; \t\r\n\t\t\t} else {\r\n\t\t\t\t/* There is only one entry in the table, it is valid for all future chunks*/\r\n\t\t\t\tlast_chunk_in_run = Infinity;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (j < last_sample_in_chunk) {\r\n\t\t\t\t/* the sample is still in the current chunk */\r\n\t\t\t\tsample.chunk_index = chunk_index;\r\n\t\t\t\tsample.chunk_run_index = chunk_run_index;\r\n\t\t\t} else {\r\n\t\t\t\t/* the sample is in the next chunk */\r\n\t\t\t\tchunk_index++;\r\n\t\t\t\tsample.chunk_index = chunk_index;\r\n\t\t\t\t/* reset the accumulated offset in the chunk */\r\n\t\t\t\toffset_in_chunk = 0;\r\n\t\t\t\tif (chunk_index <= last_chunk_in_run) {\r\n\t\t\t\t\t/* stay in the same entry of the first_chunk table */\r\n\t\t\t\t\t/* chunk_run_index unmodified */\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchunk_run_index++;\r\n\t\t\t\t\t/* Is there another entry in the first_chunk table ? */\r\n\t\t\t\t\tif (chunk_run_index + 1 < stsc.first_chunk.length) {\r\n\t\t\t\t\t\t/* The last chunk in the run is the chunk before the next first chunk */\r\n\t\t\t\t\t\tlast_chunk_in_run = stsc.first_chunk[chunk_run_index+1]-1; \t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t/* There is only one entry in the table, it is valid for all future chunks*/\r\n\t\t\t\t\t\tlast_chunk_in_run = Infinity;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tsample.chunk_run_index = chunk_run_index;\r\n\t\t\t\tlast_sample_in_chunk += stsc.samples_per_chunk[chunk_run_index];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsample.description_index = stsc.sample_description_index[sample.chunk_run_index]-1;\r\n\t\tsample.description = stsd.entries[sample.description_index];\r\n\t\tsample.offset = stco.chunk_offsets[sample.chunk_index-1] + offset_in_chunk; /* chunk indexes are 1-based */\r\n\t\toffset_in_chunk += sample.size;\r\n\r\n\t\t/* setting dts, cts, duration and rap flags */\r\n\t\tif (j > last_sample_in_stts_run) {\r\n\t\t\tstts_run_index++;\r\n\t\t\tif (last_sample_in_stts_run < 0) {\r\n\t\t\t\tlast_sample_in_stts_run = 0;\r\n\t\t\t}\r\n\t\t\tlast_sample_in_stts_run += stts.sample_counts[stts_run_index];\t\t\t\t\r\n\t\t}\r\n\t\tif (j > 0) {\r\n\t\t\ttrak.samples[j-1].duration = stts.sample_deltas[stts_run_index];\r\n\t\t\ttrak.samples_duration += trak.samples[j-1].duration;\r\n\t\t\tsample.dts = trak.samples[j-1].dts + trak.samples[j-1].duration;\r\n\t\t} else {\r\n\t\t\tsample.dts = 0;\r\n\t\t}\r\n\t\tif (ctts) {\r\n\t\t\tif (j >= last_sample_in_ctts_run) {\r\n\t\t\t\tctts_run_index++;\r\n\t\t\t\tif (last_sample_in_ctts_run < 0) {\r\n\t\t\t\t\tlast_sample_in_ctts_run = 0;\r\n\t\t\t\t}\r\n\t\t\t\tlast_sample_in_ctts_run += ctts.sample_counts[ctts_run_index];\t\t\t\t\r\n\t\t\t}\r\n\t\t\tsample.cts = trak.samples[j].dts + ctts.sample_offsets[ctts_run_index];\r\n\t\t} else {\r\n\t\t\tsample.cts = sample.dts;\r\n\t\t}\r\n\t\tif (stss) {\r\n\t\t\tif (j == stss.sample_numbers[last_stss_index] - 1) { // sample numbers are 1-based\r\n\t\t\t\tsample.is_sync = true;\r\n\t\t\t\tlast_stss_index++;\r\n\t\t\t} else {\r\n\t\t\t\tsample.is_sync = false;\t\t\t\t\r\n\t\t\t\tsample.degradation_priority = 0;\r\n\t\t\t}\r\n\t\t\tif (subs) {\r\n\t\t\t\tif (subs.entries[subs_entry_index].sample_delta + last_subs_sample_index == j+1) {\r\n\t\t\t\t\tsample.subsamples = subs.entries[subs_entry_index].subsamples;\r\n\t\t\t\t\tlast_subs_sample_index += subs.entries[subs_entry_index].sample_delta;\r\n\t\t\t\t\tsubs_entry_index++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsample.is_sync = true;\r\n\t\t}\r\n\t\tISOFile.process_sdtp(trak.mdia.minf.stbl.sdtp, sample, sample.number);\r\n\t\tif (stdp) {\r\n\t\t\tsample.degradation_priority = stdp.priority[j];\r\n\t\t} else {\r\n\t\t\tsample.degradation_priority = 0;\r\n\t\t}\r\n\t\tif (subs) {\r\n\t\t\tif (subs.entries[subs_entry_index].sample_delta + last_subs_sample_index == j) {\r\n\t\t\t\tsample.subsamples = subs.entries[subs_entry_index].subsamples;\r\n\t\t\t\tlast_subs_sample_index += subs.entries[subs_entry_index].sample_delta;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sbgps.length > 0 || sgpds.length > 0) {\r\n\t\t\tISOFile.setSampleGroupProperties(trak, sample, j, trak.sample_groups_info);\r\n\t\t}\r\n\t}\r\n\tif (j>0) {\r\n\t\ttrak.samples[j-1].duration = Math.max(trak.mdia.mdhd.duration - trak.samples[j-1].dts, 0);\r\n\t\ttrak.samples_duration += trak.samples[j-1].duration;\r\n\t}\r\n}\r\n\r\n/* Update sample list when new 'moof' boxes are received */\r\nISOFile.prototype.updateSampleLists = function() {\t\r\n\tvar i, j, k;\r\n\tvar default_sample_description_index, default_sample_duration, default_sample_size, default_sample_flags;\r\n\tvar last_run_position;\r\n\tvar box, moof, traf, trak, trex;\r\n\tvar sample;\r\n\tvar sample_flags;\r\n\t\r\n\tif (this.moov === undefined) {\r\n\t\treturn;\r\n\t}\r\n\t/* if the input file is fragmented and fetched in multiple downloads, we need to update the list of samples */\r\n\twhile (this.lastMoofIndex < this.moofs.length) {\r\n\t\tbox = this.moofs[this.lastMoofIndex];\r\n\t\tthis.lastMoofIndex++;\r\n\t\tif (box.type == \"moof\") {\r\n\t\t\tmoof = box;\r\n\t\t\tfor (i = 0; i < moof.trafs.length; i++) {\r\n\t\t\t\ttraf = moof.trafs[i];\r\n\t\t\t\ttrak = this.getTrackById(traf.tfhd.track_id);\r\n\t\t\t\ttrex = this.getTrexById(traf.tfhd.track_id);\r\n\t\t\t\tif (traf.tfhd.flags & BoxParser.TFHD_FLAG_SAMPLE_DESC) {\r\n\t\t\t\t\tdefault_sample_description_index = traf.tfhd.default_sample_description_index;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdefault_sample_description_index = (trex ? trex.default_sample_description_index: 1);\r\n\t\t\t\t}\r\n\t\t\t\tif (traf.tfhd.flags & BoxParser.TFHD_FLAG_SAMPLE_DUR) {\r\n\t\t\t\t\tdefault_sample_duration = traf.tfhd.default_sample_duration;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdefault_sample_duration = (trex ? trex.default_sample_duration : 0);\r\n\t\t\t\t}\r\n\t\t\t\tif (traf.tfhd.flags & BoxParser.TFHD_FLAG_SAMPLE_SIZE) {\r\n\t\t\t\t\tdefault_sample_size = traf.tfhd.default_sample_size;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdefault_sample_size = (trex ? trex.default_sample_size : 0);\r\n\t\t\t\t}\r\n\t\t\t\tif (traf.tfhd.flags & BoxParser.TFHD_FLAG_SAMPLE_FLAGS) {\r\n\t\t\t\t\tdefault_sample_flags = traf.tfhd.default_sample_flags;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdefault_sample_flags = (trex ? trex.default_sample_flags : 0);\r\n\t\t\t\t}\r\n\t\t\t\ttraf.sample_number = 0;\r\n\t\t\t\t/* process sample groups */\r\n\t\t\t\tif (traf.sbgps.length > 0) {\r\n\t\t\t\t\tISOFile.initSampleGroups(trak, traf, traf.sbgps, trak.mdia.minf.stbl.sgpds, traf.sgpds);\r\n\t\t\t\t}\r\n\t\t\t\tfor (j = 0; j < traf.truns.length; j++) {\r\n\t\t\t\t\tvar trun = traf.truns[j];\r\n\t\t\t\t\tfor (k = 0; k < trun.sample_count; k++) {\r\n\t\t\t\t\t\tsample = {};\r\n\t\t\t\t\t\tsample.moof_number = this.lastMoofIndex;\r\n\t\t\t\t\t\tsample.number_in_traf = traf.sample_number;\r\n\t\t\t\t\t\ttraf.sample_number++;\r\n\t\t\t            sample.number = trak.samples.length;\r\n\t\t\t\t\t\ttraf.first_sample_index = trak.samples.length;\r\n\t\t\t\t\t\ttrak.samples.push(sample);\r\n\t\t\t\t\t\tsample.track_id = trak.tkhd.track_id;\r\n\t\t\t\t\t\tsample.timescale = trak.mdia.mdhd.timescale;\r\n\t\t\t\t\t\tsample.description_index = default_sample_description_index-1;\r\n\t\t\t\t\t\tsample.description = trak.mdia.minf.stbl.stsd.entries[sample.description_index];\r\n\t\t\t\t\t\tsample.size = default_sample_size;\r\n\t\t\t\t\t\tif (trun.flags & BoxParser.TRUN_FLAGS_SIZE) {\r\n\t\t\t\t\t\t\tsample.size = trun.sample_size[k];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttrak.samples_size += sample.size;\r\n\t\t\t\t\t\tsample.duration = default_sample_duration;\r\n\t\t\t\t\t\tif (trun.flags & BoxParser.TRUN_FLAGS_DURATION) {\r\n\t\t\t\t\t\t\tsample.duration = trun.sample_duration[k];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttrak.samples_duration += sample.duration;\r\n\t\t\t\t\t\tif (trak.first_traf_merged || k > 0) {\r\n\t\t\t\t\t\t\tsample.dts = trak.samples[trak.samples.length-2].dts+trak.samples[trak.samples.length-2].duration;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (traf.tfdt) {\r\n\t\t\t\t\t\t\t\tsample.dts = traf.tfdt.baseMediaDecodeTime;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tsample.dts = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttrak.first_traf_merged = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsample.cts = sample.dts;\r\n\t\t\t\t\t\tif (trun.flags & BoxParser.TRUN_FLAGS_CTS_OFFSET) {\r\n\t\t\t\t\t\t\tsample.cts = sample.dts + trun.sample_composition_time_offset[k];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsample_flags = default_sample_flags;\r\n\t\t\t\t\t\tif (trun.flags & BoxParser.TRUN_FLAGS_FLAGS) {\r\n\t\t\t\t\t\t\tsample_flags = trun.sample_flags[k];\r\n\t\t\t\t\t\t} else if (k === 0 && (trun.flags & BoxParser.TRUN_FLAGS_FIRST_FLAG)) {\r\n\t\t\t\t\t\t\tsample_flags = trun.first_sample_flags;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsample.is_sync = ((sample_flags >> 16 & 0x1) ? false : true);\r\n\t\t\t\t\t\tsample.is_leading = (sample_flags >> 26 & 0x3);\r\n\t\t\t\t\t\tsample.depends_on = (sample_flags >> 24 & 0x3);\r\n\t\t\t\t\t\tsample.is_depended_on = (sample_flags >> 22 & 0x3);\r\n\t\t\t\t\t\tsample.has_redundancy = (sample_flags >> 20 & 0x3);\r\n\t\t\t\t\t\tsample.degradation_priority = (sample_flags & 0xFFFF);\r\n\t\t\t\t\t\t//ISOFile.process_sdtp(traf.sdtp, sample, sample.number_in_traf);\r\n\t\t\t\t\t\tvar bdop = (traf.tfhd.flags & BoxParser.TFHD_FLAG_BASE_DATA_OFFSET) ? true : false;\r\n\t\t\t\t\t\tvar dbim = (traf.tfhd.flags & BoxParser.TFHD_FLAG_DEFAULT_BASE_IS_MOOF) ? true : false;\r\n\t\t\t\t\t\tvar dop = (trun.flags & BoxParser.TRUN_FLAGS_DATA_OFFSET) ? true : false;\r\n\t\t\t\t\t\tvar bdo = 0;\r\n\t\t\t\t\t\tif (!bdop) {\r\n\t\t\t\t\t\t\tif (!dbim) {\r\n\t\t\t\t\t\t\t\tif (j === 0) { // the first track in the movie fragment\r\n\t\t\t\t\t\t\t\t\tbdo = moof.start; // the position of the first byte of the enclosing Movie Fragment Box\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tbdo = last_run_position; // end of the data defined by the preceding *track* (irrespective of the track id) fragment in the moof\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tbdo = moof.start;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbdo = traf.tfhd.base_data_offset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (j === 0 && k === 0) {\r\n\t\t\t\t\t\t\tif (dop) {\r\n\t\t\t\t\t\t\t\tsample.offset = bdo + trun.data_offset; // If the data-offset is present, it is relative to the base-data-offset established in the track fragment header\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tsample.offset = bdo; // the data for this run starts the base-data-offset defined by the track fragment header\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsample.offset = last_run_position; // this run starts immediately after the data of the previous run\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlast_run_position = sample.offset + sample.size;\r\n\t\t\t\t\t\tif (traf.sbgps.length > 0 || traf.sgpds.length > 0 ||\r\n\t\t\t\t\t\t\ttrak.mdia.minf.stbl.sbgps.length > 0 || trak.mdia.minf.stbl.sgpds.length > 0) {\r\n\t\t\t\t\t\t\tISOFile.setSampleGroupProperties(trak, sample, sample.number_in_traf, traf.sample_groups_info);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (traf.subs) {\r\n\t\t\t\t\ttrak.has_fragment_subsamples = true;\r\n\t\t\t\t\tvar sample_index = traf.first_sample_index;\r\n\t\t\t\t\tfor (j = 0; j < traf.subs.entries.length; j++) {\r\n\t\t\t\t\t\tsample_index += traf.subs.entries[j].sample_delta;\r\n\t\t\t\t\t\tsample = trak.samples[sample_index-1];\r\n\t\t\t\t\t\tsample.subsamples = traf.subs.entries[j].subsamples;\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\t\r\n}\r\n\r\n/* Try to get sample data for a given sample:\r\n   returns null if not found\r\n   returns the same sample if already requested\r\n */\r\nISOFile.prototype.getSample = function(trak, sampleNum) {\t\r\n\tvar buffer;\r\n\tvar sample = trak.samples[sampleNum];\r\n\t\r\n\tif (!this.moov) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif (!sample.data) {\r\n\t\t/* Not yet fetched */\r\n\t\tsample.data = new Uint8Array(sample.size);\r\n\t\tsample.alreadyRead = 0;\r\n\t\tthis.samplesDataSize += sample.size;\r\n\t\tLog.debug(\"ISOFile\", \"Allocating sample #\"+sampleNum+\" on track #\"+trak.tkhd.track_id+\" of size \"+sample.size+\" (total: \"+this.samplesDataSize+\")\");\r\n\t} else if (sample.alreadyRead == sample.size) {\r\n\t\t/* Already fetched entirely */\r\n\t\treturn sample;\r\n\t}\r\n\r\n\t/* The sample has only been partially fetched, we need to check in all buffers */\r\n\twhile(true) {\r\n\t\tvar index =\tthis.stream.findPosition(true, sample.offset + sample.alreadyRead, false);\r\n\t\tif (index > -1) {\r\n\t\t\tbuffer = this.stream.buffers[index];\r\n\t\t\tvar lengthAfterStart = buffer.byteLength - (sample.offset + sample.alreadyRead - buffer.fileStart);\r\n\t\t\tif (sample.size - sample.alreadyRead <= lengthAfterStart) {\r\n\t\t\t\t/* the (rest of the) sample is entirely contained in this buffer */\r\n\r\n\t\t\t\tLog.debug(\"ISOFile\",\"Getting sample #\"+sampleNum+\" data (alreadyRead: \"+sample.alreadyRead+\" offset: \"+\r\n\t\t\t\t\t(sample.offset+sample.alreadyRead - buffer.fileStart)+\" read size: \"+(sample.size - sample.alreadyRead)+\" full size: \"+sample.size+\")\");\r\n\r\n\t\t\t\tDataStream.memcpy(sample.data.buffer, sample.alreadyRead,\r\n\t\t\t\t                  buffer, sample.offset+sample.alreadyRead - buffer.fileStart, sample.size - sample.alreadyRead);\r\n\r\n\t\t\t\t/* update the number of bytes used in this buffer and check if it needs to be removed */\r\n\t\t\t\tbuffer.usedBytes += sample.size - sample.alreadyRead;\r\n\t\t\t\tthis.stream.logBufferLevel();\r\n\r\n\t\t\t\tsample.alreadyRead = sample.size;\r\n\r\n\t\t\t\treturn sample;\r\n\t\t\t} else {\r\n\t\t\t\t/* the sample does not end in this buffer */\r\n\r\n\t\t\t\tif (lengthAfterStart === 0) return null;\r\n\r\n\t\t\t\tLog.debug(\"ISOFile\",\"Getting sample #\"+sampleNum+\" partial data (alreadyRead: \"+sample.alreadyRead+\" offset: \"+\r\n\t\t\t\t\t(sample.offset+sample.alreadyRead - buffer.fileStart)+\" read size: \"+lengthAfterStart+\" full size: \"+sample.size+\")\");\r\n\r\n\t\t\t\tDataStream.memcpy(sample.data.buffer, sample.alreadyRead,\r\n\t\t\t\t                  buffer, sample.offset+sample.alreadyRead - buffer.fileStart, lengthAfterStart);\r\n\t\t\t\tsample.alreadyRead += lengthAfterStart;\r\n\r\n\t\t\t\t/* update the number of bytes used in this buffer and check if it needs to be removed */\r\n\t\t\t\tbuffer.usedBytes += lengthAfterStart;\r\n\t\t\t\tthis.stream.logBufferLevel();\r\n\r\n\t\t\t\t/* keep looking in the next buffer */\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/* Release the memory used to store the data of the sample */\r\nISOFile.prototype.releaseSample = function(trak, sampleNum) {\t\r\n\tvar sample = trak.samples[sampleNum];\r\n\tif (sample.data) {\r\n\t\tthis.samplesDataSize -= sample.size;\r\n\t\tsample.data = null;\r\n\t\tsample.alreadyRead = 0;\r\n\t\treturn sample.size;\r\n\t} else {\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\nISOFile.prototype.getAllocatedSampleDataSize = function() {\r\n\treturn this.samplesDataSize;\r\n}\r\n\r\n/* Builds the MIME Type 'codecs' sub-parameters for the whole file */\r\nISOFile.prototype.getCodecs = function() {\t\r\n\tvar i;\r\n\tvar codecs = \"\";\r\n\tfor (i = 0; i < this.moov.traks.length; i++) {\r\n\t\tvar trak = this.moov.traks[i];\r\n\t\tif (i>0) {\r\n\t\t\tcodecs+=\",\"; \r\n\t\t}\r\n\t\tcodecs += trak.mdia.minf.stbl.stsd.entries[0].getCodec();\t\t\r\n\t}\r\n\treturn codecs;\r\n}\r\n\r\n/* Helper function */\r\nISOFile.prototype.getTrexById = function(id) {\t\r\n\tvar i;\r\n\tif (!this.moov || !this.moov.mvex) return null;\r\n\tfor (i = 0; i < this.moov.mvex.trexs.length; i++) {\r\n\t\tvar trex = this.moov.mvex.trexs[i];\r\n\t\tif (trex.track_id == id) return trex;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n/* Helper function */\r\nISOFile.prototype.getTrackById = function(id) {\r\n\tif (this.moov === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tfor (var j = 0; j < this.moov.traks.length; j++) {\r\n\t\tvar trak = this.moov.traks[j];\r\n\t\tif (trak.tkhd.track_id == id) return trak;\r\n\t}\r\n\treturn null;\r\n}\r\n// file:src/isofile-item-processing.js\r\n/* size of the buffers allocated for samples */\r\nISOFile.prototype.itemsDataSize = 0;\r\n\r\nISOFile.prototype.flattenItemInfo = function() {\t\r\n\tvar items = this.items;\r\n\tvar entity_groups = this.entity_groups;\r\n\tvar i, j;\r\n\tvar item;\r\n\tvar meta = this.meta;\r\n\tif (meta === null || meta === undefined) return;\r\n\tif (meta.hdlr === undefined) return;\r\n\tif (meta.iinf === undefined) return;\r\n\tfor (i = 0; i < meta.iinf.item_infos.length; i++) {\r\n\t\titem = {};\r\n\t\titem.id = meta.iinf.item_infos[i].item_ID;\r\n\t\titems[item.id] = item;\r\n\t\titem.ref_to = [];\r\n\t\titem.name = meta.iinf.item_infos[i].item_name;\r\n\t\tif (meta.iinf.item_infos[i].protection_index > 0) {\r\n\t\t\titem.protection = meta.ipro.protections[meta.iinf.item_infos[i].protection_index-1];\r\n\t\t}\r\n\t\tif (meta.iinf.item_infos[i].item_type) {\r\n\t\t\titem.type = meta.iinf.item_infos[i].item_type;\r\n\t\t} else {\r\n\t\t\titem.type = \"mime\";\r\n\t\t}\r\n\t\titem.content_type = meta.iinf.item_infos[i].content_type;\r\n\t\titem.content_encoding = meta.iinf.item_infos[i].content_encoding;\r\n\t\titem.item_uri_type = meta.iinf.item_infos[i].item_uri_type;\r\n\t}\r\n\tif (meta.grpl) {\r\n\t\tfor (i = 0; i < meta.grpl.boxes.length; i++) {\r\n\t\t\tentity_group = {};\r\n\t\t\tentity_group.id = meta.grpl.boxes[i].group_id;\r\n\t\t\tentity_group.entity_ids = meta.grpl.boxes[i].entity_ids;\r\n\t\t\tentity_group.type = meta.grpl.boxes[i].type;\r\n\t\t\tentity_groups[entity_group.id] = entity_group;\r\n\t\t}\r\n\t}\r\n\tif (meta.iloc) {\r\n\t\tfor(i = 0; i < meta.iloc.items.length; i++) {\r\n\t\t\tvar offset;\r\n\t\t\tvar itemloc = meta.iloc.items[i];\r\n\t\t\titem = items[itemloc.item_ID];\r\n\t\t\tif (itemloc.data_reference_index !== 0) {\r\n\t\t\t\tLog.warn(\"Item storage with reference to other files: not supported\");\r\n\t\t\t\titem.source = meta.dinf.boxes[itemloc.data_reference_index-1];\r\n\t\t\t}\r\n\t\t\tswitch(itemloc.construction_method) {\r\n\t\t\t\tcase 0: // offset into the file referenced by the data reference index\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 1: // offset into the idat box of this meta box\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 2: // offset into another item\r\n\t\t\t\tLog.warn(\"Item storage with construction_method : not supported\");\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\titem.extents = [];\r\n\t\t\titem.size = 0;\r\n\t\t\tfor (j = 0; j < itemloc.extents.length; j++) {\r\n\t\t\t\titem.extents[j] = {};\r\n\t\t\t\titem.extents[j].offset = itemloc.extents[j].extent_offset + itemloc.base_offset;\r\n\t\t\t\tif (itemloc.construction_method == 1) {\r\n\t\t\t\t\titem.extents[j].offset += meta.idat.start + meta.idat.hdr_size;\r\n\t\t\t\t}\r\n\t\t\t\titem.extents[j].length = itemloc.extents[j].extent_length;\r\n\t\t\t\titem.extents[j].alreadyRead = 0;\r\n\t\t\t\titem.size += item.extents[j].length;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (meta.pitm) {\r\n\t\titems[meta.pitm.item_id].primary = true;\r\n\t}\r\n\tif (meta.iref) {\r\n\t\tfor (i=0; i <meta.iref.references.length; i++) {\r\n\t\t\tvar ref = meta.iref.references[i];\r\n\t\t\tfor (j=0; j<ref.references.length; j++) {\r\n\t\t\t\titems[ref.from_item_ID].ref_to.push({type: ref.type, id: ref.references[j]});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (meta.iprp) {\r\n\t\tfor (var k = 0; k < meta.iprp.ipmas.length; k++) {\r\n\t\t\tvar ipma = meta.iprp.ipmas[k];\r\n\t\t\tfor (i = 0; i < ipma.associations.length; i++) {\r\n\t\t\t\tvar association = ipma.associations[i];\r\n\t\t\t\titem = items[association.id];\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\titem = entity_groups[association.id];\r\n\t\t\t\t}\r\n\t\t\t\tif (item) {\r\n\t\t\t\t\tif (item.properties === undefined) {\r\n\t\t\t\t\t\titem.properties = {};\r\n\t\t\t\t\t\titem.properties.boxes = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (j = 0; j < association.props.length; j++) {\r\n\t\t\t\t\t\tvar propEntry = association.props[j];\r\n\t\t\t\t\t\tif (propEntry.property_index > 0 && propEntry.property_index-1 < meta.iprp.ipco.boxes.length) {\r\n\t\t\t\t\t\t\tvar propbox = meta.iprp.ipco.boxes[propEntry.property_index-1];\r\n\t\t\t\t\t\t\titem.properties[propbox.type] = propbox;\r\n\t\t\t\t\t\t\titem.properties.boxes.push(propbox);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nISOFile.prototype.getItem = function(item_id) {\t\r\n\tvar buffer;\r\n\tvar item;\r\n\t\r\n\tif (!this.meta) {\r\n\t\treturn null;\r\n\t}\r\n\r\n \titem = this.items[item_id];\r\n\tif (!item.data && item.size) {\r\n\t\t/* Not yet fetched */\r\n\t\titem.data = new Uint8Array(item.size);\r\n\t\titem.alreadyRead = 0;\r\n\t\tthis.itemsDataSize += item.size;\r\n\t\tLog.debug(\"ISOFile\", \"Allocating item #\"+item_id+\" of size \"+item.size+\" (total: \"+this.itemsDataSize+\")\");\r\n\t} else if (item.alreadyRead === item.size) {\r\n\t\t/* Already fetched entirely */\r\n\t\treturn item;\r\n\t}\r\n\r\n\t/* The item has only been partially fetched, we need to check in all buffers to find the remaining extents*/\r\n\r\n\tfor (var i = 0; i < item.extents.length; i++) {\r\n\t\tvar extent = item.extents[i];\r\n\t\tif (extent.alreadyRead === extent.length) {\r\n\t\t\tcontinue;\r\n\t\t} else {\r\n\t\t\tvar index =\tthis.stream.findPosition(true, extent.offset + extent.alreadyRead, false);\r\n\t\t\tif (index > -1) {\r\n\t\t\t\tbuffer = this.stream.buffers[index];\r\n\t\t\t\tvar lengthAfterStart = buffer.byteLength - (extent.offset + extent.alreadyRead - buffer.fileStart);\r\n\t\t\t\tif (extent.length - extent.alreadyRead <= lengthAfterStart) {\r\n\t\t\t\t\t/* the (rest of the) extent is entirely contained in this buffer */\r\n\r\n\t\t\t\t\tLog.debug(\"ISOFile\",\"Getting item #\"+item_id+\" extent #\"+i+\" data (alreadyRead: \"+extent.alreadyRead+\r\n\t\t\t\t\t\t\" offset: \"+(extent.offset+extent.alreadyRead - buffer.fileStart)+\" read size: \"+(extent.length - extent.alreadyRead)+\r\n\t\t\t\t\t\t\" full extent size: \"+extent.length+\" full item size: \"+item.size+\")\");\r\n\r\n\t\t\t\t\tDataStream.memcpy(item.data.buffer, item.alreadyRead, \r\n\t\t\t\t\t                  buffer, extent.offset+extent.alreadyRead - buffer.fileStart, extent.length - extent.alreadyRead);\r\n\r\n\t\t\t\t\t/* update the number of bytes used in this buffer and check if it needs to be removed */\r\n\t\t\t\t\tbuffer.usedBytes += extent.length - extent.alreadyRead;\r\n\t\t\t\t\tthis.stream.logBufferLevel();\r\n\r\n\t\t\t\t\titem.alreadyRead += (extent.length - extent.alreadyRead);\r\n\t\t\t\t\textent.alreadyRead = extent.length;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t/* the sample does not end in this buffer */\r\n\r\n\t\t\t\t\tLog.debug(\"ISOFile\",\"Getting item #\"+item_id+\" extent #\"+i+\" partial data (alreadyRead: \"+extent.alreadyRead+\" offset: \"+\r\n\t\t\t\t\t\t(extent.offset+extent.alreadyRead - buffer.fileStart)+\" read size: \"+lengthAfterStart+\r\n\t\t\t\t\t\t\" full extent size: \"+extent.length+\" full item size: \"+item.size+\")\");\r\n\r\n\t\t\t\t\tDataStream.memcpy(item.data.buffer, item.alreadyRead, \r\n\t\t\t\t\t                  buffer, extent.offset+extent.alreadyRead - buffer.fileStart, lengthAfterStart);\r\n\t\t\t\t\textent.alreadyRead += lengthAfterStart;\r\n\t\t\t\t\titem.alreadyRead += lengthAfterStart;\r\n\r\n\t\t\t\t\t/* update the number of bytes used in this buffer and check if it needs to be removed */\r\n\t\t\t\t\tbuffer.usedBytes += lengthAfterStart;\r\n\t\t\t\t\tthis.stream.logBufferLevel();\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (item.alreadyRead === item.size) {\r\n\t\t/* fetched entirely */\r\n\t\treturn item;\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n/* Release the memory used to store the data of the item */\r\nISOFile.prototype.releaseItem = function(item_id) {\t\r\n\tvar item = this.items[item_id];\r\n\tif (item.data) {\r\n\t\tthis.itemsDataSize -= item.size;\r\n\t\titem.data = null;\r\n\t\titem.alreadyRead = 0;\r\n\t\tfor (var i = 0; i < item.extents.length; i++) {\r\n\t\t\tvar extent = item.extents[i];\r\n\t\t\textent.alreadyRead = 0;\r\n\t\t}\r\n\t\treturn item.size;\r\n\t} else {\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n\r\nISOFile.prototype.processItems = function(callback) {\r\n\tfor(var i in this.items) {\r\n\t\tvar item = this.items[i];\r\n\t\tthis.getItem(item.id);\r\n\t\tif (callback && !item.sent) {\r\n\t\t\tcallback(item);\r\n\t\t\titem.sent = true;\r\n\t\t\titem.data = null;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nISOFile.prototype.hasItem = function(name) {\r\n\tfor(var i in this.items) {\r\n\t\tvar item = this.items[i];\r\n\t\tif (item.name === name) {\r\n\t\t\treturn item.id;\r\n\t\t}\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\nISOFile.prototype.getMetaHandler = function() {\r\n\tif (!this.meta) {\r\n\t\treturn null;\r\n\t} else {\r\n\t\treturn this.meta.hdlr.handler;\t\t\r\n\t}\r\n}\r\n\r\nISOFile.prototype.getPrimaryItem = function() {\r\n\tif (!this.meta || !this.meta.pitm) {\r\n\t\treturn null;\r\n\t} else {\r\n\t\treturn this.getItem(this.meta.pitm.item_id);\r\n\t}\r\n}\r\n\r\nISOFile.prototype.itemToFragmentedTrackFile = function(_options) {\r\n\tvar options = _options || {};\r\n\tvar item = null;\r\n\tif (options.itemId) {\r\n\t\titem = this.getItem(options.itemId);\r\n\t} else {\r\n\t\titem = this.getPrimaryItem();\r\n\t}\r\n\tif (item == null) return null;\r\n\r\n\tvar file = new ISOFile();\r\n\tfile.discardMdatData = false;\r\n\t// assuming the track type is the same as the item type\r\n\tvar trackOptions = { type: item.type, description_boxes: item.properties.boxes};\r\n\tif (item.properties.ispe) {\r\n\t\ttrackOptions.width = item.properties.ispe.image_width;\r\n\t\ttrackOptions.height = item.properties.ispe.image_height;\r\n\t}\r\n\tvar trackId = file.addTrack(trackOptions);\r\n\tif (trackId) {\r\n\t\tfile.addSample(trackId, item.data);\r\n\t\treturn file;\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n// file:src/isofile-write.js\r\n/* Rewrite the entire file */\r\nISOFile.prototype.write = function(outstream) {\r\n\tfor (var i=0; i<this.boxes.length; i++) {\r\n\t\tthis.boxes[i].write(outstream);\r\n\t}\r\n}\r\n\r\nISOFile.prototype.createFragment = function(track_id, sampleNumber, stream_) {\r\n\tvar trak = this.getTrackById(track_id);\r\n\tvar sample = this.getSample(trak, sampleNumber);\r\n\tif (sample == null) {\r\n\t\tthis.setNextSeekPositionFromSample(trak.samples[sampleNumber]);\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tvar stream = stream_ || new DataStream();\r\n\tstream.endianness = DataStream.BIG_ENDIAN;\r\n\r\n\tvar moof = this.createSingleSampleMoof(sample);\r\n\tmoof.write(stream);\r\n\r\n\t/* adjusting the data_offset now that the moof size is known*/\r\n\tmoof.trafs[0].truns[0].data_offset = moof.size+8; //8 is mdat header\r\n\tLog.debug(\"MP4Box\", \"Adjusting data_offset with new value \"+moof.trafs[0].truns[0].data_offset);\r\n\tstream.adjustUint32(moof.trafs[0].truns[0].data_offset_position, moof.trafs[0].truns[0].data_offset);\r\n\t\t\r\n\tvar mdat = new BoxParser.mdatBox();\r\n\tmdat.data = sample.data;\r\n\tmdat.write(stream);\r\n\treturn stream;\r\n}\r\n\r\n/* Modify the file and create the initialization segment */\r\nISOFile.writeInitializationSegment = function(ftyp, moov, total_duration, sample_duration) {\r\n\tvar i;\r\n\tvar index;\r\n\tvar mehd;\r\n\tvar trex;\r\n\tvar box;\r\n\tLog.debug(\"ISOFile\", \"Generating initialization segment\");\r\n\r\n\tvar stream = new DataStream();\r\n\tstream.endianness = DataStream.BIG_ENDIAN;\r\n\tftyp.write(stream);\r\n\t\r\n\t/* we can now create the new mvex box */\r\n\tvar mvex = moov.add(\"mvex\");\r\n\tif (total_duration) {\r\n\t\tmvex.add(\"mehd\").set(\"fragment_duration\", total_duration);\r\n\t}\r\n\tfor (i = 0; i < moov.traks.length; i++) {\r\n\t\tmvex.add(\"trex\").set(\"track_id\", moov.traks[i].tkhd.track_id)\r\n\t\t\t\t\t\t.set(\"default_sample_description_index\", 1)\r\n\t\t\t\t\t\t.set(\"default_sample_duration\", sample_duration)\r\n\t\t\t\t\t\t.set(\"default_sample_size\", 0)\r\n\t\t\t\t\t\t.set(\"default_sample_flags\", 1<<16)\r\n\t}\r\n\tmoov.write(stream);\r\n\r\n\treturn stream.buffer;\r\n\r\n}\r\n\r\nISOFile.prototype.save = function(name) {\r\n\tvar stream = new DataStream();\r\n\tstream.endianness = DataStream.BIG_ENDIAN;\r\n\tthis.write(stream);\r\n\tstream.save(name);\t\r\n}\r\n\r\nISOFile.prototype.getBuffer = function() {\r\n\tvar stream = new DataStream();\r\n\tstream.endianness = DataStream.BIG_ENDIAN;\r\n\tthis.write(stream);\r\n\treturn stream.buffer;\r\n}\r\n\r\nISOFile.prototype.initializeSegmentation = function() {\r\n\tvar i;\r\n\tvar j;\r\n\tvar box;\r\n\tvar initSegs;\r\n\tvar trak;\r\n\tvar seg;\r\n\tif (this.onSegment === null) {\r\n\t\tLog.warn(\"MP4Box\", \"No segmentation callback set!\");\r\n\t}\r\n\tif (!this.isFragmentationInitialized) {\r\n\t\tthis.isFragmentationInitialized = true;\t\t\r\n\t\tthis.nextMoofNumber = 0;\r\n\t\tthis.resetTables();\r\n\t}\t\r\n\tinitSegs = [];\t\r\n\tfor (i = 0; i < this.fragmentedTracks.length; i++) {\r\n\t\tvar moov = new BoxParser.moovBox();\r\n\t\tmoov.mvhd = this.moov.mvhd;\r\n\t    moov.boxes.push(moov.mvhd);\r\n\t\ttrak = this.getTrackById(this.fragmentedTracks[i].id);\r\n\t\tmoov.boxes.push(trak);\r\n\t\tmoov.traks.push(trak);\r\n\t\tseg = {};\r\n\t\tseg.id = trak.tkhd.track_id;\r\n\t\tseg.user = this.fragmentedTracks[i].user;\r\n\t\tseg.buffer = ISOFile.writeInitializationSegment(this.ftyp, moov, (this.moov.mvex && this.moov.mvex.mehd ? this.moov.mvex.mehd.fragment_duration: undefined), (this.moov.traks[i].samples.length>0 ? this.moov.traks[i].samples[0].duration: 0));\r\n\t\tinitSegs.push(seg);\r\n\t}\r\n\treturn initSegs;\r\n}\r\n\r\n// file:src/box-print.js\r\n/* \r\n * Copyright (c) Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nBoxParser.Box.prototype.printHeader = function(output) {\r\n\tthis.size += 8;\r\n\tif (this.size > MAX_SIZE) {\r\n\t\tthis.size += 8;\r\n\t}\r\n\tif (this.type === \"uuid\") {\r\n\t\tthis.size += 16;\r\n\t}\r\n\toutput.log(output.indent+\"size:\"+this.size);\r\n\toutput.log(output.indent+\"type:\"+this.type);\r\n}\r\n\r\nBoxParser.FullBox.prototype.printHeader = function(output) {\r\n\tthis.size += 4;\r\n\tBoxParser.Box.prototype.printHeader.call(this, output);\r\n\toutput.log(output.indent+\"version:\"+this.version);\r\n\toutput.log(output.indent+\"flags:\"+this.flags);\r\n}\r\n\r\nBoxParser.Box.prototype.print = function(output) {\r\n\tthis.printHeader(output);\r\n}\r\n\r\nBoxParser.ContainerBox.prototype.print = function(output) {\r\n\tthis.printHeader(output);\r\n\tfor (var i=0; i<this.boxes.length; i++) {\r\n\t\tif (this.boxes[i]) {\r\n\t\t\tvar prev_indent = output.indent;\r\n\t\t\toutput.indent += \" \";\r\n\t\t\tthis.boxes[i].print(output);\r\n\t\t\toutput.indent = prev_indent;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nISOFile.prototype.print = function(output) {\r\n\toutput.indent = \"\";\r\n\tfor (var i=0; i<this.boxes.length; i++) {\r\n\t\tif (this.boxes[i]) {\r\n\t\t\tthis.boxes[i].print(output);\r\n\t\t}\r\n\t}\t\r\n}\r\n\r\nBoxParser.mvhdBox.prototype.print = function(output) {\r\n\tBoxParser.FullBox.prototype.printHeader.call(this, output);\r\n\toutput.log(output.indent+\"creation_time: \"+this.creation_time);\r\n\toutput.log(output.indent+\"modification_time: \"+this.modification_time);\r\n\toutput.log(output.indent+\"timescale: \"+this.timescale);\r\n\toutput.log(output.indent+\"duration: \"+this.duration);\r\n\toutput.log(output.indent+\"rate: \"+this.rate);\r\n\toutput.log(output.indent+\"volume: \"+(this.volume>>8));\r\n\toutput.log(output.indent+\"matrix: \"+this.matrix.join(\", \"));\r\n\toutput.log(output.indent+\"next_track_id: \"+this.next_track_id);\r\n}\r\n\r\nBoxParser.tkhdBox.prototype.print = function(output) {\r\n\tBoxParser.FullBox.prototype.printHeader.call(this, output);\r\n\toutput.log(output.indent+\"creation_time: \"+this.creation_time);\r\n\toutput.log(output.indent+\"modification_time: \"+this.modification_time);\r\n\toutput.log(output.indent+\"track_id: \"+this.track_id);\r\n\toutput.log(output.indent+\"duration: \"+this.duration);\r\n\toutput.log(output.indent+\"volume: \"+(this.volume>>8));\r\n\toutput.log(output.indent+\"matrix: \"+this.matrix.join(\", \"));\r\n\toutput.log(output.indent+\"layer: \"+this.layer);\r\n\toutput.log(output.indent+\"alternate_group: \"+this.alternate_group);\r\n\toutput.log(output.indent+\"width: \"+this.width);\r\n\toutput.log(output.indent+\"height: \"+this.height);\r\n}// file:src/mp4box.js\r\n/*\r\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\r\n * License: BSD-3-Clause (see LICENSE file)\r\n */\r\nvar MP4Box = {};\r\n\r\nMP4Box.createFile = function (_keepMdatData, _stream) {\r\n\t/* Boolean indicating if bytes containing media data should be kept in memory */\r\n\tvar keepMdatData = (_keepMdatData !== undefined ? _keepMdatData : true);\r\n\tvar file = new ISOFile(_stream);\r\n\tfile.discardMdatData = (keepMdatData ? false : true);\r\n\treturn file;\r\n}\r\n\r\nif (typeof exports !== 'undefined') {\r\n\texports.createFile = MP4Box.createFile;\r\n}\r\n","// js/converter.js\r\nimport MP4Box from 'mp4box';\r\nimport { Muxer, ArrayBufferTarget } from 'webm-muxer';\r\n\r\n// DOM Elements\r\ndocument.body.insertAdjacentHTML('beforeend', `\r\n  <div class=\"container\">\r\n    <h2>MP4 → WebM</h2>\r\n    <div id=\"drop-zone\">Drop MP4 here or click to select</div>\r\n    <input type=\"file\" id=\"file-input\" accept=\"video/mp4\" hidden />\r\n    <div id=\"progress-container\" hidden>\r\n      <div id=\"progress-bar\" aria-valuenow=\"0\"></div>\r\n      <div id=\"status-message\"></div>\r\n    </div>\r\n  </div>\r\n`);\r\n\r\nconst dropZone          = document.getElementById('drop-zone');\r\nconst fileInput         = document.getElementById('file-input');\r\nconst progressContainer = document.getElementById('progress-container');\r\nconst progressBar       = document.getElementById('progress-bar');\r\nconst statusMessage     = document.getElementById('status-message');\r\n\r\n// Event listeners\r\ndropZone.addEventListener('click', () => fileInput.click());\r\nfileInput.addEventListener('change', e => e.target.files[0] && handleFile(e.target.files[0]));\r\ndropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });\r\ndropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));\r\ndropZone.addEventListener('drop', e => {\r\n  e.preventDefault();\r\n  dropZone.classList.remove('dragover');\r\n  e.dataTransfer.files[0] && handleFile(e.dataTransfer.files[0]);\r\n});\r\n\r\nasync function handleFile(file) {\r\n  if (!file.name.toLowerCase().endsWith('.mp4')) {\r\n    alert('Please select an MP4 file.');\r\n    return;\r\n  }\r\n  dropZone.hidden = true;\r\n  progressContainer.hidden = false;\r\n  updateStatus('Starting conversion...');\r\n\r\n  try {\r\n    const { track, samples } = await demuxMp4(file);\r\n    await transcode(track, samples);\r\n    updateStatus('Conversion complete!');\r\n  } catch (err) {\r\n    console.error(err);\r\n    updateStatus(`Error: ${err.message}`);\r\n    setTimeout(resetUI, 3000);\r\n  }\r\n}\r\n\r\nfunction updateStatus(msg) {\r\n  statusMessage.textContent = msg;\r\n}\r\n\r\nfunction updateProgress(pct) {\r\n  const p = Math.min(100, Math.max(0, pct));\r\n  progressBar.style.width = p + '%';\r\n  progressBar.setAttribute('aria-valuenow', p);\r\n}\r\n\r\nfunction resetUI() {\r\n  progressContainer.hidden = true;\r\n  dropZone.hidden = false;\r\n}\r\n\r\n// Demux MP4 into track metadata + samples\r\nasync function demuxMp4(file) {\r\n  const buffer = await file.arrayBuffer();\r\n  buffer.fileStart = 0;\r\n  const mp4boxFile = MP4Box.createFile();\r\n  let trackInfo, samples = [];\r\n\r\n  return new Promise((resolve, reject) => {\r\n    mp4boxFile.onError = e => reject(new Error(e));\r\n\r\n    mp4boxFile.onReady = info => {\r\n      trackInfo = info.tracks.find(t => t.type === 'video' && t.codec?.startsWith('avc'));\r\n      if (!trackInfo) return reject(new Error('No H.264 track'));\r\n      mp4boxFile.setExtractionOptions(trackInfo.id, null, { nbSamples: trackInfo.nb_samples });\r\n      mp4boxFile.start();\r\n    };\r\n\r\n    mp4boxFile.onSamples = (_id, _user, arr) => samples.push(...arr);\r\n\r\n    try {\r\n      mp4boxFile.appendBuffer(buffer);\r\n      mp4boxFile.flush();\r\n    } catch (e) {\r\n      reject(e);\r\n    }\r\n\r\n    // Poll until samples collected\r\n    const check = () => {\r\n      if (samples.length >= trackInfo.nb_samples) {\r\n        resolve({ track: trackInfo, samples });\r\n      } else {\r\n        setTimeout(check, 50);\r\n      }\r\n    };\r\n    check();\r\n  });\r\n}\r\n\r\n// Transcode via WebCodecs & mux to WebM\r\nasync function transcode(track, samples) {\r\n  if (!window.VideoDecoder || !window.VideoEncoder) {\r\n    throw new Error('WebCodecs not supported');\r\n  }\r\n\r\n  const { codec, video: { width, height }, avcC, nb_samples } = track;\r\n  // Build description from avcC\r\n  const desc = buildAvcDescription(avcC);\r\n\r\n  // Setup muxer\r\n  const muxer = new Muxer({ target: new ArrayBufferTarget(), video: { codec: 'V_VP8', width, height, frameRate: 30 } });\r\n\r\n  let processed = 0;\r\n  const encoder = new VideoEncoder({\r\n    output: (chunk, meta) => {\r\n      muxer.addVideoChunk(chunk, meta);\r\n      processed++;\r\n      updateProgress((processed / nb_samples) * 100 * 0.95);\r\n    },\r\n    error: e => { throw new Error(e); }\r\n  });\r\n  encoder.configure({ codec: 'vp8', width, height, bitrate: 1_000_000, framerate: 30 });\r\n\r\n  const decoder = new VideoDecoder({\r\n    output: frame => { encoder.encode(frame); frame.close(); },\r\n    error: e => { throw new Error(e); }\r\n  });\r\n  const decCfg = { codec, description: desc };\r\n  decoder.configure(decCfg);\r\n\r\n  for (const s of samples) {\r\n    const chunk = new EncodedVideoChunk({ type: s.is_rap ? 'key' : 'delta', timestamp: s.cts, data: s.data });\r\n    decoder.decode(chunk);\r\n  }\r\n  await decoder.flush();\r\n  await encoder.flush();\r\n\r\n  muxer.finalize();\r\n  const { buffer } = muxer.target;\r\n  const blob = new Blob([buffer], { type: 'video/webm' });\r\n  saveBlob(blob, 'converted.webm');\r\n  updateProgress(100);\r\n}\r\n\r\n// Build Annex-B SPS/PPS description\r\nfunction buildAvcDescription(avcC) {\r\n  const pre = new Uint8Array([0,0,0,1]);\r\n  const parts = [];\r\n  avcC.sequenceParameterSets.forEach(s => parts.push(pre, new Uint8Array(s)));\r\n  avcC.pictureParameterSets.forEach(p => parts.push(pre, new Uint8Array(p)));\r\n  return concat(parts).buffer;\r\n}\r\n\r\nfunction concat(arrays) {\r\n  let len = 0; arrays.forEach(a => len += a.length);\r\n  const out = new Uint8Array(len); let off = 0;\r\n  arrays.forEach(a => { out.set(a, off); off += a.length; });\r\n  return out;\r\n}\r\n\r\nfunction saveBlob(blob, name) {\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a'); a.href = url; a.download = name; a.click();\r\n  setTimeout(() => URL.revokeObjectURL(url), 100);\r\n}\r\n"],"names":["_helper","_helperView","_writeByte","writeByte_fn","_writeFloat32","writeFloat32_fn","_writeFloat64","writeFloat64_fn","_writeUnsignedInt","writeUnsignedInt_fn","_writeString","writeString_fn","_target","_buffer","_bytes","_ensureSize","ensureSize_fn","start","log_level","Log","Date","setLogLevel","level","this","debug","info","warn","error","module","msg","undefined","console","log","getDurationString","duration","_timescale","neg","pad","number","length","a","split","join","duration_sec","hours","Math","floor","minutes","msec","printRanges","ranges","str","i","end","exports","MP4BoxStream","arrayBuffer","ArrayBuffer","buffer","dataview","DataView","position","prototype","getPosition","getEndPosition","byteLength","getLength","seek","pos","npos","max","min","isNaN","isFinite","isEos","readAnyInt","size","signed","res","getInt8","getUint8","getInt16","getUint16","getInt32","getUint32","readUint8","readUint16","readUint24","readUint32","readUint64","readString","s","String","fromCharCode","readCString","arr","b","push","apply","readInt8","readInt16","readInt32","readInt64","readUint8Array","Uint8Array","readInt16Array","Int16Array","readUint16Array","readUint32Array","Uint32Array","readInt32Array","Int32Array","DataStream","byteOffset","endianness","_byteOffset","dataView","LITTLE_ENDIAN","_realloc","extra","_dynamicSize","req","blen","_byteLength","buf","src","set","_trimAlloc","dst","BIG_ENDIAN","Object","defineProperty","get","v","_dataView","isEof","mapUint8Array","e","memcpy","BYTES_PER_ELEMENT","arrayToNative","readInt8Array","Int8Array","Uint16Array","readFloat64Array","Float64Array","readFloat32Array","Float32Array","readFloat32","getFloat32","readFloat64","getFloat64","dstOffset","srcOffset","dstU8","srcU8","array","arrayIsLittleEndian","flipArrayEndianness","nativeToEndian","littleEndian","u8","j","k","tmp","failurePosition","fromCharCodeUint8","uint8arr","encoding","TextDecoder","decode","len","MAX_SIZE","pow","save","filename","blob","Blob","window","URL","createObjectURL","url","document","createElement","body","appendChild","setAttribute","click","revokeObjectURL","shift","offset","writeInt32Array","mapInt32Array","writeInt32","writeInt16Array","mapInt16Array","writeInt16","writeInt8Array","mapInt8Array","writeInt8","writeUint32Array","mapUint32Array","writeUint32","writeUint16Array","mapUint16Array","writeUint16","writeUint8Array","writeUint8","writeFloat64Array","mapFloat64Array","writeFloat64","writeFloat32Array","mapFloat32Array","writeFloat32","setInt32","setInt16","setInt8","setUint32","setUint16","setUint8","setFloat32","setFloat64","writeUCS2String","lengthOverride","charCodeAt","writeString","TextEncoder","encode","substring","writeCString","writeStruct","structDefinition","struct","t","writeType","tp","Array","charset","test","parseInt","ta","writeUint64","h","writeUint24","adjustUint32","value","MultiBufferStream","buffers","bufferIndex","insertBuffer","initialized","firstBuffer","fileStart","logBufferLevel","concat","buffer1","buffer2","reduceBuffer","newLength","smallB","usedBytes","ab","to_add","splice","used","total","range","bufferedString","cleanBuffers","mergeNextBuffer","next_buffer","oldLength","oldUsedBytes","oldFileStart","findPosition","fromStart","filePosition","markAsUsed","abuffer","index","findEndContiguousBuf","inputindex","currentBuf","nextBuf","getEndFilePositionAfter","addUsedBytes","nbBytes","setAllUsedBytes","MPEG4DescriptorParser","descTagToName","getDescriptorName","tag","that","classes","parseOneDescriptor","stream","desc","byteRead","Descriptor","parse","_tag","_size","descs","data","findDescriptor","parseRemainingDescriptors","ES_Descriptor","call","ES_ID","flags","dependsOn_ES_ID","l","OCR_ES_ID","getOTI","dcd","oti","getAudioConfig","dsi","audioObjectType","DecoderConfigDescriptor","streamType","upStream","bufferSize","maxBitrate","avgBitrate","DecoderSpecificInfo","SLConfigDescriptor","BoxParser","ERR_INVALID_DATA","ERR_NOT_ENOUGH_DATA","OK","BASIC_BOXES","type","name","FULL_BOXES","CONTAINER_BOXES","boxCodes","fullBoxCodes","containerBoxCodes","sampleEntryCodes","sampleGroupEntryCodes","trackGroupTypes","UUIDBoxes","UUIDs","initialize","FullBox","Box","ContainerBox","SampleEntry","TrackGroupTypeBox","forEach","box","createBoxCtor","createFullBoxCtor","boxes","createContainerBoxCtor","_type","_name","_uuid","box_name","uuid","version","hdr_size","SampleGroupEntry","grouping_type","parseMethod","parseFullHeader","addSubBoxArrays","subBoxNames","nbSubBoxes","createMediaSampleEntryCtor","mediaType","createSampleEntryCtor","createEncryptedSampleEntryCtor","createSampleGroupCtor","createTrackGroupCtor","createUUIDBox","isFullBox","isContainerBox","printPS","ps","nalu","reduce","byte","toString","padStart","ColorPoint","x","y","Pixel","row","col","bad_pixel_row","bad_pixel_column","TKHD_FLAG_ENABLED","TKHD_FLAG_IN_MOVIE","TKHD_FLAG_IN_PREVIEW","TFHD_FLAG_BASE_DATA_OFFSET","TFHD_FLAG_SAMPLE_DESC","TFHD_FLAG_SAMPLE_DUR","TFHD_FLAG_SAMPLE_SIZE","TFHD_FLAG_SAMPLE_FLAGS","TFHD_FLAG_DUR_EMPTY","TFHD_FLAG_DEFAULT_BASE_IS_MOOF","TRUN_FLAGS_DATA_OFFSET","TRUN_FLAGS_FIRST_FLAG","TRUN_FLAGS_DURATION","TRUN_FLAGS_SIZE","TRUN_FLAGS_FLAGS","TRUN_FLAGS_CTS_OFFSET","add","addBox","prop","addEntry","_prop","parseUUID","parseHex16","hex16","hex","parseOneBox","headerOnly","parentSize","diff","code","box_type","has_unparsed_data","write","parseDataAndRewind","ret","indexOf","parseLanguage","language","chars","languageString","SAMPLE_ENTRY_TYPE_VISUAL","SAMPLE_ENTRY_TYPE_AUDIO","SAMPLE_ENTRY_TYPE_HINT","SAMPLE_ENTRY_TYPE_METADATA","SAMPLE_ENTRY_TYPE_SUBTITLE","SAMPLE_ENTRY_TYPE_SYSTEM","SAMPLE_ENTRY_TYPE_TEXT","parseHeader","data_reference_index","parseFooter","compressorname_length","width","height","horizresolution","vertresolution","frame_count","compressorname","depth","channel_count","samplesize","samplerate","FieldLength","layer_size","op_index","aux_type","aux_subtype_length","aux_subtype","seq_profile","seq_level_idx_0","seq_tier_0","high_bitdepth","twelve_bit","monochrome","chroma_subsampling_x","chroma_subsampling_y","chroma_sample_position","reserved_1","initial_presentation_delay_present","initial_presentation_delay_minus_one","reserved_2","configOBUs_length","configOBUs","toparse","configurationVersion","AVCProfileIndication","profile_compatibility","AVCLevelIndication","lengthSizeMinusOne","nb_SPS_nalus","SPS","nb_PPS_nalus","PPS","ext","bufferSizeDB","all_ref_pics_intra","intra_pred_used","max_ref_per_pic","channel_indexes","channel_types","channel_associations","cleanApertureWidthN","cleanApertureWidthD","cleanApertureHeightN","cleanApertureHeightD","horizOffN","horizOffD","vertOffN","vertOffD","max_content_light_level","max_pic_average_light_level","pos_x","pos_y","pos_z","quat_x","quat_y","quat_z","id","focal_length_x","principal_point_x","principal_point_y","focal_length_y","skew_factor","component_count","component_types","component_type_urls","component_type","entry_count","chunk_offsets","maxCLL","maxFALL","colour_type","colour_primaries","transfer_characteristics","matrix_coefficients","full_range_flag","ICC_profile","notice","compositionToDTSShift","leastDecodeToDisplayDelta","greatestDecodeToDisplayDelta","compositionStartTime","compositionEndTime","sample_counts","sample_offsets","tmp_byte1","tmp_byte2","tmp_byte3","fscod","bsid","bsmod","acmod","lfeon","bit_rate_code","tmp_16","data_rate","num_ind_sub","ind_subs","ind_sub","num_dep_sub","chan_loc","boxesFound","knownBlockTypes","flagAndType","numMetadataBlocks","bytessent","time","Version","OutputChannelCount","PreSkip","InputSampleRate","OutputGain","ChannelMappingFamily","StreamCount","CoupledCount","ChannelMapping","entries","extended_language","entry","segment_duration","media_time","media_rate_integer","media_rate_fraction","timescale","presentation_time","event_duration","scheme_id_uri","presentation_time_delta","message_size","message_data","createEntityToGroupCtor","group_id","num_entities_in_group","entity_ids","entity_id","tile_size_x","tile_size_y","layer_binning","tiles_in_layer_column_minus1","tiles_in_layer_row_minus1","esd_data","esd_parser","esd","fieldCount","fieldOrdering","data_format","major_brand","minor_version","compatible_brands","handler","slice","tmp_byte","general_profile_space","general_tier_flag","general_profile_idc","general_profile_compatibility","general_constraint_indicator","general_level_idc","min_spatial_segmentation_idc","parallelismType","chroma_format_idc","bit_depth_luma_minus8","bit_depth_chroma_minus8","avgFrameRate","constantFrameRate","numTemporalLayers","temporalIdNested","nalu_arrays","nalu_array","completeness","nalu_type","numOfArrays","numNalus","item_infos","offset_size","length_size","base_offset_size","index_size","items","item_count","item","item_ID","construction_method","base_offset","extent_count","extents","extent","extent_index","extent_offset","extent_length","reserved","axis","item_protection_index","item_name","content_type","content_encoding","extension_type","item_type","item_uri_type","associations","item_assoc","association_count","props","p","essential","property_index","references","SingleItemTypeReferenceBox","SingleItemTypeReferenceBoxLarge","angle","image_width","image_height","schemeURI","count","levels","track_ID","padding_flag","assignment_type","grouping_type_parameter","sub_track_id","layer_id","period","bytes","display_primaries","white_point","max_display_mastering_luminance","min_display_mastering_luminance","creation_time","modification_time","fragment_duration","sequence_number","bits_per_pixel","rate","volume","matrix","next_track_id","packetssent","sample_count","padbits","hSpacing","vSpacing","text","payloadID","rtpmap_string","initial_delay","item_id","num_channels","bits_per_channels","step_count","ref_track_id","ntp_timestamp","system_id","kid","datasize","descriptionformat","sdptext","aux_info_type","aux_info_type_parameter","default_sample_info_size","sample_info_size","mime_format","namespace","schema_location","auxiliary_mime_types","displayFlags","horizontal_justification","vertical_justification","bg_color_rgba","box_record","style_record","roll_count","first_output_sample","sample_offset","remaining","description_length","num_output_samples","num_total_samples","layerNumber","accurateStatisticsFlag","avgBitRate","subSequenceIdentifier","durationFlag","avgRateFlag","dependency","numReferences","dependencyInfo","subSeqDirectionFlag","roll_distance","num_leading_samples_known","num_leading_samples","operation_point_count","target_rate_share","available_bitrate","maximum_bitrate","minimum_bitrate","discard_priority","crypt_byte_block","skip_byte_block","isProtected","Per_Sample_IV_Size","KID","constant_IV_size","constant_IV","NAL_unit_type","level_independently_decodable","group_description_index","component_index","correction_applied","num_bad_rows","num_bad_cols","num_bad_pixels","bad_rows","bad_columns","bad_pixels","scheme_type","scheme_version","scheme_uri","is_leading","sample_depends_on","sample_is_depended_on","sample_has_redundancy","default_length","default_group_description_index","reference_ID","earliest_presentation_time","first_offset","ref","tmp_32","reference_type","referenced_size","subsegment_duration","starts_with_SAP","SAP_type","SAP_delta_time","from_item_ID","to_item_ID","primaryRChromaticity_x","primaryRChromaticity_y","primaryGChromaticity_x","primaryGChromaticity_y","primaryBChromaticity_x","primaryBChromaticity_y","whitePointChromaticity_x","whitePointChromaticity_y","luminanceMax","luminanceMin","balance","subsegments","subsegment_count","subsegment","range_count","range_size","priority","switch_group","alternate_group","attribute_list","first_chunk","samples_per_chunk","sample_description_index","entryCount","shadowed_sample_numbers","sync_sample_numbers","sample_numbers","sample_sizes","sample_size","delta","sample_deltas","tmp32","single_view_allowed","stereo_scheme","stereo_indication_type","ftypBox","field_size","subsample_count","sampleInfo","sample_delta","subsamples","subsample","discardable","codec_specific_parameters","default_crypt_byte_block","default_skip_byte_block","default_isProtected","default_Per_Sample_IV_Size","default_KID","default_constant_IV_size","default_constant_IV","baseMediaDecodeTime","readBytes","track_id","base_data_offset","default_sample_description_index","default_sample_duration","default_sample_size","default_sample_flags","length_size_of_traf_num","length_size_of_trun_num","length_size_of_sample_num","number_of_entries","moof_offset","traf_number","trun_number","sample_number","layer","track_group_id","TrackReferenceTypeBox","track_ids","trefBox","data_offset","first_sample_flags","sample_duration","sample_flags","sample_composition_time_offset","config","lang","description","tags","profile","component_bit_depth_minus_one","component_format","component_align_size","sampling_type","interleave_type","block_size","component_little_endian","block_pad_lsb","block_little_endian","block_reversed","pad_unknown","pixel_size","row_align_size","tile_align_size","num_tile_cols_minus_one","num_tile_rows_minus_one","location","LiveServerManifest","replace","default_AlgorithmID","default_IV_size","fragment_count","absolute_time","absolute_duration","graphicsmode","opcolor","bitDepth","chromaSubsampling","videoFullRangeFlag","colourPrimaries","transferCharacteristics","matrixCoefficients","codecIntializationDataSize","codecIntializationData","colorSpace","transferFunction","bitReader","held_bits","num_held_bits","stream_read_1_bytes","strm","stream_read_2_bytes","extract_bits","num_bits","ptl_present_flag","ols_idx","num_sublayers","constant_frame_rate","bit_depth_minus8","num_bytes_constraint_info","ptl_frame_only_constraint_flag","ptl_multilayer_enabled_flag","general_constraint_info","cnstr1","cnstr2","ptl_sublayer_present_mask","val","sublayer_level_idc","ptl_num_sub_profiles","general_sub_profile_idc","max_picture_width","max_picture_height","avg_frame_rate","num_of_arrays","isVideo","isAudio","isSubtitle","isMetadata","isHint","getCodec","getWidth","getHeight","getChannelCount","getSampleRate","getSampleSize","VisualSampleEntry","AudioSampleEntry","SubtitleSampleEntry","MetadataSampleEntry","decimalToHex","d","padding","Number","avc1SampleEntry","avc2SampleEntry","avc3SampleEntry","avc4SampleEntry","baseCodec","avcC","hev1SampleEntry","hvc1SampleEntry","hvcC","reversed","hasByte","constraint_string","vvc1SampleEntry","vvi1SampleEntry","vvcC","last_nonzero","ptl_frame_only_constraint","ptl_multilayer_enabled","base32_chars","mp4aSampleEntry","esds","stxtSampleEntry","vp08SampleEntry","vp09SampleEntry","vpcC","av01SampleEntry","bitdepth","av1C","writeHeader","sizePosition","avcCBox","co64Box","cslgBox","cttsBox","drefBox","elngBox","elstBox","emsgBox","hdlrBox","hvcCBox","kindBox","mdhdBox","mehdBox","mfhdBox","mvhdBox","writeFooter","stppSampleEntry","sbgpBox","sgpdBox","sidxBox","smhdBox","stcoBox","stscBox","stsdBox","stshBox","stssBox","stszBox","constant","sttsBox","tfdtBox","UINT32_MAX","tfhdBox","tkhdBox","trexBox","trunBox","data_offset_position","vmhdBox","unpack","samples","pts","dts","m","Infinity","description_index","chunk_index","DIFF_BOXES_PROP_NAMES","DIFF_PRIMITIVE_ARRAY_PROP_NAMES","boxEqualFields","box_a","box_b","boxEqual","VTTin4Parser","parseSample","cues","cue","getText","startTime","endTime","n","z","secToTimestamp","insec","ms","string","cueIn4","payl","XMLSubtitlein4Parser","sample","documentString","resources","DOMParser","parseFromString","Textin4Parser","parseConfig","ISOFile","mdats","moofs","isProgressive","moovStartFound","onMoovStart","moovStartSent","onReady","readySent","onSegment","onSamples","onError","sampleListBuilt","fragmentedTracks","extractedTracks","isFragmentationInitialized","sampleProcessingStarted","nextMoofNumber","itemListBuilt","entity_groups","onSidx","sidxSent","setSegmentOptions","user","options","trak","getTrackById","fragTrack","nextSample","segmentStream","nb_samples","rapAlignement","nbSamples","unsetSegmentOptions","setExtractionOptions","extractTrack","unsetExtractionOptions","restoreParsePosition","hasIncompleteMdat","processIncompleteMdat","saveParsePosition","processIncompleteBox","updateUsedBytes","checkBuffer","appendBuffer","last","nextFileStart","moov","buildSampleLists","updateSampleLists","getInfo","processSamples","nextSeekPosition","nextParsePosition","sidx","meta","flattenItemInfo","processItems","onItem","getAllocatedSampleDataSize","track","sample_desc","movie","_1904","getTime","hasMoov","mvhd","isFragmented","mvex","mehd","hasIOD","iods","brands","ftyp","created","modified","tracks","audioTracks","videoTracks","subtitleTracks","metadataTracks","hintTracks","otherTracks","traks","mdia","minf","stbl","stsd","tkhd","hdlr","tref","edts","edits","elst","movie_duration","movie_timescale","track_width","track_height","mdhd","cts_shift","cslg","samples_duration","codec","kind","udta","kinds","elng","samples_size","bitrate","audio","sample_rate","video","mime","setNextSeekPositionFromSample","alreadyRead","fragTrak","result","createFragment","extractTrak","getSample","getBox","getBoxes","returnEarly","_sweep","getTrackSamplesInfo","getTrackSample","releaseUsedSamples","sampleNum","lastValidSample","releaseSample","samplesDataSize","stop","flush","seekTrack","useRap","seek_offset","rap_seek_sample_num","seek_sample_num","cts","is_sync","getTrackDuration","trak_seek_info","seek_info","equal","box_index","a_box","b_box","lastBoxStartPosition","parsingMdat","discardMdatData","init","_options","addTrack","media_duration","sample_description_entry","media_type","codes","avcDecoderConfigRecord","hevcDecoderConfigRecord","description_boxes","buildTrakSampleLists","computeSize","stream_","addSample","depends_on","is_depended_on","has_redundancy","degradation_priority","first_dts","moof","createSingleSampleMoof","trafs","truns","moofBox","traf","lastMoofIndex","resetTables","stsc","stts","ctts","stss","initial_duration","stco","co64","stsz","stz2","initSampleGroups","sbgps","trak_sgpds","traf_sgpds","sample_group_info","sample_group_key","SampleGroupInfo","_parameter","_sbgp","sbgp","last_sample_in_run","entry_index","sample_groups_info","fragment_description","is_fragment","setSampleGroupProperties","sample_groups","process_sdtp","sdtp","subs","sgpds","stdp","chunk_run_index","last_chunk_in_run","offset_in_chunk","last_sample_in_chunk","last_sample_in_stts_run","stts_run_index","last_sample_in_ctts_run","ctts_run_index","last_stss_index","subs_entry_index","last_subs_sample_index","last_run_position","trex","tfhd","getTrexById","trun","moof_number","number_in_traf","first_sample_index","first_traf_merged","tfdt","bdop","dbim","dop","bdo","has_fragment_subsamples","sample_index","lengthAfterStart","getCodecs","codecs","trexs","itemsDataSize","iinf","ref_to","protection_index","protection","ipro","protections","grpl","entity_group","iloc","itemloc","source","dinf","idat","pitm","primary","iref","iprp","ipmas","ipma","association","properties","propEntry","ipco","propbox","getItem","releaseItem","callback","sent","hasItem","getMetaHandler","getPrimaryItem","itemToFragmentedTrackFile","itemId","file","trackOptions","ispe","trackId","outstream","sampleNumber","mdat","mdatBox","writeInitializationSegment","total_duration","getBuffer","initializeSegmentation","initSegs","seg","moovBox","printHeader","output","indent","print","prev_indent","MP4Box","_keepMdatData","_stream","keepMdatData","createFile","__accessCheck","obj","member","has","TypeError","__privateGet","getter","__privateAdd","WeakSet","__privateSet","setter","__privateMethod","method","EBMLFloat32","constructor","EBMLFloat64","measureUnsignedInt","readBits","bitIndex","Target","ArrayBufferTarget","super","arguments","StreamTarget","onData","onHeader","onCluster","chunked","chunkSize","isInteger","FileSystemWritableFileStreamTarget","FileSystemWritableFileStream","Writer","offsets","WeakMap","dataOffsets","newPos","writeEBMLVarInt","Error","measureEBMLVarInt","subarray","writeEBML","isArray","elem","sizePos","sizeSize","startPos","endPos","map","_trackingWrites","_trackedWrites","_trackedStart","_trackedEnd","ArrayBufferTargetWriter","target","finalize","newBuffer","newBytes","BaseStreamTargetWriter","neededSize","copy","startTrackingWrites","getTrackedWrites","_sections","_lastFlushEnd","_ensureMonotonicity","_chunked","_chunkSize","_chunks","_writeDataIntoChunks","writeDataIntoChunks_fn","_insertSectionIntoChunk","insertSectionIntoChunk_fn","_createChunk","createChunk_fn","_flushChunks","flushChunks_fn","StreamTargetWriter","ensureMonotonicity","chunks","sorted","sort","lastChunk","section","chunk","chunkIndex","findIndex","relativePosition","toWrite","written","shouldFlush","low","high","mid","includesPosition","force","_writer","_segment","_segmentInfo","_seekHead","_tracksElement","_segmentDuration","_colourElement","_videoCodecPrivate","_audioCodecPrivate","_subtitleCodecPrivate","_cues","_currentCluster","_currentClusterTimestamp","_duration","_videoChunkQueue","_audioChunkQueue","_subtitleChunkQueue","_firstVideoTimestamp","_firstAudioTimestamp","_lastVideoTimestamp","_lastAudioTimestamp","_lastSubtitleTimestamp","_colorSpace","_finalized","_validateOptions","validateOptions_fn","_createFileHeader","createFileHeader_fn","_writeEBMLHeader","writeEBMLHeader_fn","_createCodecPrivatePlaceholders","createCodecPrivatePlaceholders_fn","_createColourElement","createColourElement_fn","_createSeekHead","createSeekHead_fn","_createSegmentInfo","createSegmentInfo_fn","_createTracks","createTracks_fn","_createSegment","createSegment_fn","_createCues","createCues_fn","_maybeFlushStreamingTargetWriter","maybeFlushStreamingTargetWriter_fn","_segmentDataOffset","segmentDataOffset_get","_writeVideoDecoderConfig","writeVideoDecoderConfig_fn","_fixVP9ColorSpace","fixVP9ColorSpace_fn","_writeSubtitleChunks","writeSubtitleChunks_fn","_createInternalChunk","createInternalChunk_fn","_validateTimestamp","validateTimestamp_fn","_writeBlock","writeBlock_fn","_createCodecPrivateElement","createCodecPrivateElement_fn","_writeCodecPrivate","writeCodecPrivate_fn","_createNewCluster","createNewCluster_fn","_finalizeCurrentCluster","finalizeCurrentCluster_fn","_ensureNotFinalized","ensureNotFinalized_fn","FileSystemWritableFileStreamTargetWriter","CODEC_PRIVATE_MAX_SIZE","APP_NAME","FIRST_TIMESTAMP_BEHAVIORS","Muxer","firstTimestampBehavior","streaming","addVideoChunk","timestamp","EncodedVideoChunk","copyTo","addVideoChunkRaw","videoChunk","audioChunk","addAudioChunk","EncodedAudioChunk","addAudioChunkRaw","decoderConfig","addSubtitleChunk","additions","subtitles","subtitleChunk","segmentSize","frameRate","alpha","numberOfChannels","sampleRate","includes","ebmlHeader","kaxCues","kaxInfo","kaxTracks","segmentDuration","segmentInfo","tracksElement","segment","rgb","bt709","bt470bg","smpte170m","transfer","primaries","fullRange","showExistingFrame","frameType","syncCode","colorSpaceID","byteIndex","writeBits","lastWrittenMediaTimestamp","queue","trackNumber","lastTimestamp","firstTimestamp","canCreateNewCluster","msTimestamp","relativeTimestamp","shouldCreateNewClusterFromKeyFrame","clusterWouldBeTooLong","prelude","view","msDuration","blockGroup","simpleBlock","element","codecPrivateElementSize","voidDataSize","newByteLength","clusterOffsetFromSegment","clusterSize","insertAdjacentHTML","dropZone","getElementById","fileInput","progressContainer","progressBar","statusMessage","async","handleFile","toLowerCase","endsWith","hidden","updateStatus","mp4boxFile","trackInfo","Promise","resolve","reject","find","startsWith","_id","_user","check","setTimeout","demuxMp4","VideoDecoder","VideoEncoder","pre","parts","sequenceParameterSets","pictureParameterSets","arrays","out","off","buildAvcDescription","muxer","processed","encoder","updateProgress","configure","framerate","decoder","frame","close","decCfg","is_rap","href","download","saveBlob","transcode","err","message","resetUI","alert","textContent","pct","style","addEventListener","files","preventDefault","classList","remove","dataTransfer"],"mappings":"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"}